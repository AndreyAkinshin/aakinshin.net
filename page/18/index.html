<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.103.0-DEV"><meta name=author content="Andrey Akinshin"><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content><title>Andrey Akinshin's blog (Page 18)</title><meta name=description content="Andrey Akinshin's blog"><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><script>localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><link href=https://aakinshin.net/css/main.min.3694189c64d6e73f07022b9b02e5f1a3ce7adaa4b67d9bd3ed23e8f8115e6411.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"></head><body><nav><div class="container flex flex-wrap items-center justify-between mx-auto max-w-6xl h-12 px-6"><div class="flex items-center justify-start justify-self-start"><div class="flex nav-item h-12 w-12 items-center justify-center"><a class=text-white href=https://aakinshin.net/><svg class="fai w-5 h-5 pr-0 mb-0.5"><use xlink:href="/img/fa/all.svg#house-chimney"/></svg></a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/posts/>Posts</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/research/>Research</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/about/>About</a></div></div><button id=theme-toggle type=button class="nav-item p-3 content-center justify-self-end"><svg id="theme-toggle-dark-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001.0 1010.586 10.586z"/></svg><svg id="theme-toggle-light-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1A1 1 0 119 4V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707A1 1 0 1113.536 5.05l.707-.707a1 1 0 011.414.0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707A1 1 0 004.343 5.757l.707.707zm1.414 8.486-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"/></svg></button></div></nav><div class="main container mx-auto max-w-6xl px-6"><div class=main-content><div><h2><a href=/posts/edpelt/>Implementation of efficient algorithm for changepoint detection: ED-PELT</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2019-10-07>October 7, 2019</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/mathematics/>Mathematics</a>
<a class=label-link href=https://aakinshin.net/tags/statistics/>Statistics</a>
<a class=label-link href=https://aakinshin.net/tags/cpd/>Change point detection</a></div></div><br><p><a href=https://en.wikipedia.org/wiki/Change_detection>Changepoint detection</a> is an important task that has a lot of applications.
For example, I use it to detect changes in the <a href=https://www.jetbrains.com/rider/>Rider</a> performance test suite.
It&rsquo;s very important to detect not only performance degradations, but any kinds of performance changes
(e.g., the variance may increase, or a unimodal distribution may be split to several modes).
You can see examples of such changes on the following picture (we change the color when a changepoint is detected):</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/edpelt/img/edpelt-light.png target=_blank alt=edpelt><img src=/posts/edpelt/img/edpelt-light.png width=800></a>
<a class="img-dark hidden" href=/posts/edpelt/img/edpelt-dark.png target=_blank alt=edpelt><img src=/posts/edpelt/img/edpelt-dark.png width=800></a></div><p>Unfortunately, it&rsquo;s pretty hard to write a reliable and fast algorithm for changepoint detection.
Recently, I found a cool paper (<a href=https://link.springer.com/article/10.1007/s11222-016-9687-5>Haynes, K., Fearnhead, P. & Eckley, I.A. &ldquo;A computationally efficient nonparametric approach for changepoint detection,&rdquo; Stat Comput (2017) 27: 1293</a>) that describes the ED-PELT algorithm.
It has <code>O(N*log(N))</code> complexity and pretty good detection accuracy.
The reference implementation can be used via the <a href=https://cran.r-project.org/web/packages/changepoint.np/index.html>changepoint.np</a> R package.
However, I can&rsquo;t use <a href=https://www.r-project.org/>R</a> on our build server, so I decided to write my own C# implementation.</p><br><a href=/posts/edpelt/>Read more</a><br><br><hr></div><div><h2><a href=/posts/nuget-package-browsing/>A story about slow NuGet package browsing</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2018-05-08>May 8, 2018</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/programming/>Programming</a>
<a class=label-link href=https://aakinshin.net/tags/nuget/>NuGet</a>
<a class=label-link href=https://aakinshin.net/tags/rider/>Rider</a></div></div><br><p>In <a href=https://www.jetbrains.com/rider/>Rider</a>, we have integration tests which interact with <a href=https://api.nuget.org/>api.nuget.org</a>.
Also, we have an internal service which monitors the performance of these tests.
Two days ago, I noticed that some of these tests sometimes are running for too long.
For example, <code>nuget_NuGetTest_shouldUpgradeVersionForDotNetCore</code> usually takes around <code>10 sec</code>.
However, in some cases, it takes around <code>110 sec</code>, <code>210 sec</code>, or <code>310 sec</code>:</p><div class=row><div class=mx-auto><a href=/posts/nuget-package-browsing/img/perf-chart.png target=_blank alt=perf-chart><img class="mx-auto d-block img-fluid" width=800 src=/posts/nuget-package-browsing/img/perf-chart.png></a></div></div><br><p>It looks very suspicious and increases the whole test suite duration.
Also, our dashboard with performance degradations contains only such tests
and some real degradations (which are introduced by the changes in our codebase) can go unnoticed.
So, my colleagues and I decided to investigate it.</p><br><a href=/posts/nuget-package-browsing/>Read more</a><br><br><hr></div><div><h2><a href=/posts/dotnet-crossruntime-disasm/>Cross-runtime .NET disassembly with BenchmarkDotNet</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2018-04-10>April 10, 2018</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/programming/>Programming</a>
<a class=label-link href=https://aakinshin.net/tags/dotnet/>.NET</a>
<a class=label-link href=https://aakinshin.net/tags/cs/>C#</a>
<a class=label-link href=https://aakinshin.net/tags/benchmarkdotnet/>BenchmarkDotNet</a>
<a class=label-link href=https://aakinshin.net/tags/benchmarking/>Benchmarking</a>
<a class=label-link href=https://aakinshin.net/tags/disassembly/>disassembly</a></div></div><br><p><a href=https://github.com/dotnet/BenchmarkDotNet>BenchmarkDotNet</a> is a cool tool for benchmarking.
It has a lot of useful features that help you with performance investigations.
However, you can use these features even if you are not actually going to benchmark something.
One of these features is <code>DisassemblyDiagnoser</code>.
It shows you a disassembly listing of your code for all required runtimes.
In this post, I will show you how to get disassembly listing for .NET Framework, .NET Core, and Mono with one click!
You can do it with a very small code snippet like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=na>[DryCoreJob, DryMonoJob, DryClrJob(Platform.X86)]</span>
</span></span><span class=line><span class=cl><span class=na>[DisassemblyDiagnoser]</span>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=k>class</span> <span class=nc>IntroDisasm</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>    [Benchmark]</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=kt>double</span> <span class=n>Sum</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>double</span> <span class=n>res</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span> <span class=n>i</span> <span class=p>&lt;</span> <span class=m>64</span><span class=p>;</span> <span class=n>i</span><span class=p>++)</span>
</span></span><span class=line><span class=cl>            <span class=n>res</span> <span class=p>+=</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><br><a href=/posts/dotnet-crossruntime-disasm/>Read more</a><br><br><hr></div><div><h2><a href=/posts/bdn-v0_10_14/>BenchmarkDotNet v0.10.14</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2018-04-09>April 9, 2018</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/programming/>Programming</a>
<a class=label-link href=https://aakinshin.net/tags/dotnet/>.NET</a>
<a class=label-link href=https://aakinshin.net/tags/cs/>C#</a>
<a class=label-link href=https://aakinshin.net/tags/benchmarkdotnet/>BenchmarkDotNet</a>
<a class=label-link href=https://aakinshin.net/tags/benchmarking/>Benchmarking</a></div></div><br><p>BenchmarkDotNet v0.10.14 has been released! This release includes:</p><ul><li><strong>Per-method parameterization</strong> (<a href=http://benchmarkdotnet.org/Advanced/Arguments.htm>Read more</a>)</li><li><strong>Console histograms and multimodal disribution detection</strong> (<a href=https://aakinshin.net/posts/dotnet-crossruntime-disasm/>Read more</a>)</li><li><strong>Many improvements for Mono disassembly support on Windows</strong> (A blog post is coming soon)</li><li><strong>Many bugfixes</strong></li></ul><p>In the <a href="https://github.com/dotnet/BenchmarkDotNet/issues?q=milestone:v0.10.14">v0.10.14</a> scope,
8 issues were resolved and 11 pull requests where merged.
This release includes 47 commits by 8 contributors.</p><br><a href=/posts/bdn-v0_10_14/>Read more</a><br><br><hr></div><div><h2><a href=/posts/bdn-v0_10_13/>BenchmarkDotNet v0.10.13</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2018-03-02>March 2, 2018</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/programming/>Programming</a>
<a class=label-link href=https://aakinshin.net/tags/dotnet/>.NET</a>
<a class=label-link href=https://aakinshin.net/tags/cs/>C#</a>
<a class=label-link href=https://aakinshin.net/tags/benchmarkdotnet/>BenchmarkDotNet</a>
<a class=label-link href=https://aakinshin.net/tags/benchmarking/>Benchmarking</a></div></div><br><p>BenchmarkDotNet v0.10.13 has been released! This release includes:</p><ul><li><strong>Mono Support for DisassemblyDiagnoser:</strong>
Now you can easily get an assembly listing not only on .NET Framework/.NET Core, but also on Mono.
It works on Linux, macOS, and Windows (Windows requires installed cygwin with <code>obj</code> and <code>as</code>).
(See <a href=https://github.com/dotnet/BenchmarkDotNet/issues/541>#541</a>)</li><li><strong>Support ANY CoreFX and CoreCLR builds:</strong>
BenchmarkDotNet allows the users to run their benchmarks against ANY CoreCLR and CoreFX builds.
You can compare your local build vs MyGet feed or Debug vs Release or one version vs another.
(See <a href=https://github.com/dotnet/BenchmarkDotNet/issues/651>#651</a>)</li><li><strong>C# 7.2 support</strong>
(See <a href=https://github.com/dotnet/BenchmarkDotNet/issues/643>#643</a>)</li><li><strong>.NET 4.7.1 support</strong>
(See <a href=https://github.com/dotnet/BenchmarkDotNet/commit/28aa946a9a277b6c2b1166af0397134b02bedf2d>28aa94</a>)</li><li><strong>Support Visual Basic project files (.vbroj) targeting .NET Core</strong>
(See <a href=https://github.com/dotnet/BenchmarkDotNet/issues/626>#626</a>)</li><li><strong>DisassemblyDiagnoser now supports generic types</strong>
(See <a href=https://github.com/dotnet/BenchmarkDotNet/issues/640>#640</a>)</li><li><strong>Now it&rsquo;s possible to benchmark both Mono and .NET Core from the same app</strong>
(See <a href=https://github.com/dotnet/BenchmarkDotNet/issues/653>#653</a>)</li><li><strong>Many bug fixes</strong>
(See details below)</li></ul><br><a href=/posts/bdn-v0_10_13/>Read more</a><br><br><hr></div><div><h2><a href=/posts/mono-gc-collects/>Analyzing distribution of Mono GC collections</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2018-02-20>February 20, 2018</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/programming/>Programming</a>
<a class=label-link href=https://aakinshin.net/tags/dotnet/>.NET</a>
<a class=label-link href=https://aakinshin.net/tags/cs/>C#</a>
<a class=label-link href=https://aakinshin.net/tags/rider/>Rider</a>
<a class=label-link href=https://aakinshin.net/tags/mono/>Mono</a>
<a class=label-link href=https://aakinshin.net/tags/gc/>GC</a></div></div><br><p>Sometimes I want to understand the GC performance impact on an application quickly.
I know that there are many powerful diagnostic tools and approaches,
but I&rsquo;m a fan of the &ldquo;right tool for the job&rdquo; idea.
In simple cases, I prefer simple noninvasive approaches which provide a quick way
to get an overview of the current situation
(if everything is terrible, I always can switch to an advanced approach).
Today I want to share with you my favorite way to quickly get statistics
of GC pauses in Mono and generate nice plots like this:</p><div class=row><div class=mx-auto><a href=/posts/mono-gc-collects/img/plot-64.png target=_blank alt=plot-64><img class="mx-auto d-block img-fluid" width=800 src=/posts/mono-gc-collects/img/plot-64.png></a></div></div><br><br><a href=/posts/mono-gc-collects/>Read more</a><br><br><hr></div><div><h2><a href=/posts/bdn-v0_10_12/>BenchmarkDotNet v0.10.12</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2018-01-15>January 15, 2018</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/programming/>Programming</a>
<a class=label-link href=https://aakinshin.net/tags/dotnet/>.NET</a>
<a class=label-link href=https://aakinshin.net/tags/cs/>C#</a>
<a class=label-link href=https://aakinshin.net/tags/benchmarkdotnet/>BenchmarkDotNet</a>
<a class=label-link href=https://aakinshin.net/tags/benchmarking/>Benchmarking</a></div></div><br><p>BenchmarkDotNet v0.10.12 has been released! This release includes:</p><ul><li><strong>Improved DisassemblyDiagnoser:</strong>
BenchmarkDotNet contains an embedded disassembler so that it can print assembly code for all benchmarks;
it&rsquo;s not easy, but the disassembler evolves in every release.</li><li><strong>Improved MemoryDiagnoser:</strong>
it has a better precision level, and it takes less time to evaluate memory allocations in a benchmark.</li><li><strong>New TailCallDiagnoser:</strong>
now you get notifications when JIT applies the tail call optimizations to your methods.</li><li><strong>Better environment info:</strong>
when your share performance results, it&rsquo;s very important to share information about your environment.
The library generates the environment summary for you by default.
Now it contains information about the amount of physical CPU, physical cores, and logic cores.
If you run a benchmark on a virtual machine, you will get the name of the hypervisor
(e.g., Hyper-V, VMware, or VirtualBox).</li><li><strong>Better summary table:</strong>
one of the greatest features of BenchmarkDotNet is the summary table.
It shows all important information about results in a compact and understandable form.
Now it has better customization options: you can display relative performance of different environments
(e.g., compare .NET Framework and .NET Core) and group benchmarks by categories.</li><li><strong>New GC settings:</strong> now we support <code>NoAffinitize</code>, <code>HeapAffinitizeMask</code>, <code>HeapCount</code>.</li><li>Other minor improvements and bug fixes</li></ul><br><a href=/posts/bdn-v0_10_12/>Read more</a><br><br><hr></div><div><h2><a href=/posts/bdn-v0_10_10/>BenchmarkDotNet v0.10.10</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2017-11-03>November 3, 2017</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/programming/>Programming</a>
<a class=label-link href=https://aakinshin.net/tags/dotnet/>.NET</a>
<a class=label-link href=https://aakinshin.net/tags/cs/>C#</a>
<a class=label-link href=https://aakinshin.net/tags/benchmarkdotnet/>BenchmarkDotNet</a>
<a class=label-link href=https://aakinshin.net/tags/benchmarking/>Benchmarking</a></div></div><br><p>BenchmarkDotNet v0.10.10 has been released!
This release includes many new features like Disassembly Diagnoser, ParamsSources, .NET Core x86 support, Environment variables, and more!</p><br><a href=/posts/bdn-v0_10_10/>Read more</a><br><br><hr></div><div><h2><a href=/posts/reflecting-on-performance-testing/>Reflecting on performance testing</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2017-08-01>August 1, 2017</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/mathematics/>Mathematics</a>
<a class=label-link href=https://aakinshin.net/tags/statistics/>Statistics</a>
<a class=label-link href=https://aakinshin.net/tags/performance/>Performance</a>
<a class=label-link href=https://aakinshin.net/tags/performancetesting/>PerformanceTesting</a>
<a class=label-link href=https://aakinshin.net/tags/rider/>Rider</a>
<a class=label-link href=https://aakinshin.net/tags/benchmarkdotnet/>BenchmarkDotNet</a></div></div><br><p>Performance is an important feature for many projects.
Unfortunately, it&rsquo;s an all too common situation when a developer accidentally spoils the performance adding some new code.
After a series of such incidents, people often start to think about performance regression testing.</p><p>As developers, we write unit tests all the time.
These tests check that our business logic work as designed and that new features don&rsquo;t break existing code.
It looks like a good idea to write some perf tests as well, which will verify that we don&rsquo;t have any performance regressions.</p><p>Turns out this is harder than it sounds.
A lot of developers don&rsquo;t write perf tests at all.
Some teams write perf tests, but almost all of them use their own infrastructure for analysis
(which is not a bad thing in general because it&rsquo;s usually designed for specific projects and requirements).
There are a lot of books about test-driven development (TDD),
but there are no books about performance-driven development (PDD).
There are well-known libraries for unit-testing (like xUnit/NUnit/MSTest for .NET),
but there are almost no libraries for performance regression testing.
Yeah, of course, there are <em>some</em> libraries which you can use.
But there are troubles with <em>well-known all recognized</em> libraries, approaches, and tools.
Ask your colleagues about it: some of them will give you different answers, the rest of them will start Googling it.</p><p>There is no common understanding of what performance testing should look like.
This situation exists because it&rsquo;s really hard to develop a solution which solves <em>all problems</em> for <em>all kind of projects</em>.
However, it doesn&rsquo;t mean that we shouldn&rsquo;t try.
And we should try, we should share our experience and discuss best practices.</p><br><a href=/posts/reflecting-on-performance-testing/>Read more</a><br><br><hr></div><div><h2><a href=/posts/stephen-toub-benchmarks-part1/>Measuring Performance Improvements in .NET Core with BenchmarkDotNet (Part 1)</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2017-06-09>June 9, 2017</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/programming/>Programming</a>
<a class=label-link href=https://aakinshin.net/tags/dotnet/>.NET</a>
<a class=label-link href=https://aakinshin.net/tags/cs/>C#</a>
<a class=label-link href=https://aakinshin.net/tags/benchmarkdotnet/>BenchmarkDotNet</a>
<a class=label-link href=https://aakinshin.net/tags/benchmarks/>Benchmarks</a>
<a class=label-link href=https://aakinshin.net/tags/coreclr/>CoreCLR</a></div></div><br><p>A few days ago <a href=https://github.com/stephentoub>Stephen Toub</a> published a great post
at the <a href=https://blogs.msdn.microsoft.com/dotnet/>Microsoft .NET Blog</a>:
<a href=https://blogs.msdn.microsoft.com/dotnet/2017/06/07/performance-improvements-in-net-core/>Performance Improvements in .NET Core</a>.
He showed some significant performance changes in .NET Core 2.0 Preview 1 (compared with .NET Framework 4.7).
The .NET Core uses RyuJIT for generating assembly code.
When I first tried RyuJIT (e.g.,
<a href=https://blogs.msdn.microsoft.com/dotnet/2014/02/27/ryujit-ctp2-getting-ready-for-prime-time/>CTP2</a>,
<a href=https://blogs.msdn.microsoft.com/clrcodegeneration/2014/10/30/ryujit-ctp5-getting-closer-to-shipping-and-with-better-simd-support/>CTP5</a>, 2014),
I wasn&rsquo;t excited about this: the preview versions had some bugs, and it worked slowly on my applications.
However, the idea of a rethought and open-source JIT-compiler was a huge step forward and investment in the future.
RyuJIT had been developed very actively in recent years: not only by Microsoft but with the help of the community.
I&rsquo;m still not happy about the generated assembly code in some methods, but I have to admit that the RyuJIT (as a part of .NET Core) works pretty well today:
it shows a good performance level not only on artificial benchmarks but also on real user code.
Also, there are a lot of changes
not only in <a href=https://github.com/dotnet/coreclr>dotnet/coreclr</a> (the .NET Core runtime),
but also in <a href=https://github.com/dotnet/corefx>dotnet/corefx</a> (the .NET Core foundational libraries).
It&rsquo;s very nice to watch how the community helps to optimize well-used classes which have not changed for years.</p><p>Now let&rsquo;s talk about benchmarks.
For the demonstration, Stephen wrote a set of handwritten benchmarks.
A few people (in
<a href=https://blogs.msdn.microsoft.com/dotnet/2017/06/07/performance-improvements-in-net-core/#comments>comments</a> and on <a href="https://news.ycombinator.com/item?id=14507936">HackerNews</a>)
asked about <a href=https://github.com/dotnet/BenchmarkDotNet>BenchmarkDotNet</a> regarding these samples (as a better tool for performance measurements).
So, I decided to try all these benchmarks on BenchmarkDotNet.</p><p>In this post, we will discuss
how can BenchmarkDotNet help in such performance investigations,
which benchmarking approaches (and when) are better to use,
and how can we improve these measurements.</p><br><a href=/posts/stephen-toub-benchmarks-part1/>Read more</a><br><br><hr></div></div><div class=paginator><ul class="pagination pagination-default"><li class=page-item><a href=/ aria-label=First class=page-link role=button><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/page/17/ aria-label=Previous class=page-link role=button><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a href=/page/16/ aria-label="Page 16" class=page-link role=button>16</a></li><li class=page-item><a href=/page/17/ aria-label="Page 17" class=page-link role=button>17</a></li><li class="page-item active"><a aria-current=page aria-label="Page 18" class=page-link role=button>18</a></li><li class=page-item><a href=/page/19/ aria-label="Page 19" class=page-link role=button>19</a></li><li class=page-item><a href=/page/20/ aria-label="Page 20" class=page-link role=button>20</a></li><li class=page-item><a href=/page/19/ aria-label=Next class=page-link role=button><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/22/ aria-label=Last class=page-link role=button><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div><script>var themeToggleDarkIcon=document.getElementById("theme-toggle-dark-icon"),themeToggleBtn,themeToggleLightIcon=document.getElementById("theme-toggle-light-icon");const imagesDark=document.querySelectorAll(".img-dark"),imagesLight=document.querySelectorAll(".img-light");localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(themeToggleLightIcon.classList.remove("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")})):(themeToggleDarkIcon.classList.remove("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")})),themeToggleBtn=document.getElementById("theme-toggle"),themeToggleBtn.addEventListener("click",function(){themeToggleDarkIcon.classList.toggle("hidden"),themeToggleLightIcon.classList.toggle("hidden"),imagesLight.forEach(e=>{e.classList.toggle("hidden")}),imagesDark.forEach(e=>{e.classList.toggle("hidden")}),localStorage.getItem("color-theme")?localStorage.getItem("color-theme")==="light"?(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"))})</script><footer class="z-20 p-4 md:p-6 mt-3 w-full border-t border-gray-200 shadow flex items-center justify-center dark:border-gray-600 bg-white dark:bg-zinc-800"><span class="dark:text-gray-400 text-center">© 2013—2023 <span class=whitespace-nowrap>Andrey Akinshin</span></span><ul class="flex flex-wrap items-center px-4 mb-1"><li><a href=https://github.com/AndreyAkinshin><svg class="fai fai-link w-5 h-5"><title>GitHub</title><use xlink:href="/img/fa/all.svg#github"/></svg></a></li><li><a href=https://twitter.com/andrey_akinshin><svg class="fai fai-link w-5 h-5"><title>Twitter</title><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></li><li><a href=https://aakinshin.net/posts/index.xml><svg class="fai fai-link w-5 h-5"><title>RSS</title><use xlink:href="/img/fa/all.svg#rss"/></svg></a></li></ul><div class=main-content><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></div></footer><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script></body></html>