<!doctype html><html lang=en class=h-100><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.74.3"><meta name=author content="Andrey Akinshin"><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content><title>Andrey Akinshin's blog (Page 2)</title><meta name=description content="Andrey Akinshin's blog"><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><link href=/css/lumen-bootstrap.min.css theme=light rel=stylesheet type=text/css media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><link href=/css/slate-bootstrap.min.css theme=dark rel=stylesheet type=text/css media="(prefers-color-scheme: dark)"><link href=/css/syntax-light.css theme=light rel=stylesheet type=text/css media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><link href=/css/syntax-dark.css theme=dark rel=stylesheet type=text/css media="(prefers-color-scheme: dark)"><script src=https://aakinshin.net/js/theme-before.min.26d61b7027fe55e642f0001cef94cb75b567d721086492aab6b4e32d9ee7811d.js></script><script type=module src=https://aakinshin.net/js/dark-mode-toggle.min.882998740b9c4c24677576b997bde5a487246e2e3bd72128a0e922eaa59db029.mjs></script><link href=https://aakinshin.net/css/fontawesome-all.min.50da8736f05b35aac9691de67fe993cbe01b7d88fcf0cb682c3a8f39933fe4a3.css rel=stylesheet type=text/css media=all><link href=https://aakinshin.net/css/about.min.2a76db7cc14055b3bafacc363f453917ab54a818a7db2a0a9b2409c0f6bf07c5.css rel=stylesheet type=text/css media=all><link href=https://aakinshin.net/css/blog.min.ae812fc71daf5160d927febda5a991cee6c361345e3f685d3736931ed7537986.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZVB6MXSX32"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-ZVB6MXSX32');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-41419012-5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-41419012-5');</script><script type=text/javascript>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym");ym(28700916,"init",{clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src=https://mc.yandex.ru/watch/28700916 style=position:absolute;left:-9999px alt></div></noscript><script src=/js/jquery-3.3.1.slim.min.js></script></head><body><div class=bg-primary><div class="container bg-primary"><nav class="navbar navbar-expand-sm navbar-dark bg-primary"><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link id=nav-link-blog href=https://aakinshin.net/><i class="fas fa-home" title=Home style=color:#fff></i></a></li><li class=nav-item><a class=nav-link id=nav-link-posts href=https://aakinshin.net/posts/>Posts</a></li><li class=nav-item><a class=nav-link id=nav-link-about href=https://aakinshin.net/about/>About</a></li><li class=nav-item><a class=nav-link id=nav-link-pdnb href=https://aakinshin.net/prodotnetbenchmarking/>Pro .NET Benchmarking</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" data-toggle=dropdown href=# role=button aria-haspopup=true aria-expanded=false>EN</a><div class=dropdown-menu><a class=dropdown-item href=https://aakinshin.net/ru/>RU</a></div></li></ul><ul class="navbar-nav ml-auto"><li class=nav-item><dark-mode-toggle permanent=true></dark-mode-toggle></li></ul></nav></div></div><div class=container><main id=main><div class=blog-main><div class=blog-post><h2 class=blog-post-title><a href=/posts/statistics-for-performance/>Statistical approaches for performance analysis</a></h2><span class=blog-post-meta><div class=faicon><i class="far fa-calendar-alt"></i></div><time datetime=2020-12-15>December 15, 2020</time>
&nbsp;&nbsp;
<i class="fas fa-tag"></i>&nbsp;
<a href=https://aakinshin.net/tags/statistics/ class="badge badge-info">Statistics</a>
<a href=https://aakinshin.net/tags/performance-analysis/ class="badge badge-info">Performance analysis</a></span><br><br><p>Software performance is a complex discipline that requires knowledge in different areas
from benchmarking to the internals of modern runtimes, operating systems, and hardware.
Surprisingly, the most difficult challenges in performance analysis are not about programming,
they are about mathematical statistics!</p><p>Many software developers can drill into performance problems and implement excellent optimizations,
but they are not always know how to correctly verify these optimizations.
This may not look like a problem in the case of a single performance investigation.
However, the situation became worse when developers try to set up an infrastructure that
should automatically find performance problems or prevent degradations from merging.
In order to make such an infrastructure reliable and useful,
it&rsquo;s crucial to achieve an extremely low false-positive rate (otherwise, it&rsquo;s not trustable)
and be able to detect most of the degradations (otherwise, it&rsquo;s not so useful).
It&rsquo;s not easy if you don&rsquo;t know which statistical approaches should be used.
If you try to google it, you may find thousands of papers about statistics,
but only a small portion of them really works in practice.</p><p>In this post, I want to share some approaches that I use for performance analysis in everyday life.
I have been analyzing performance distributions for the last seven years,
and I have found a lot of approaches, metrics, and tricks which nice to have
in your statistical toolbox.
I would not say that all of them are must have to know,
but they can definitely help you to improve the reliability of your statistical checks
in different problems of performance analysis.
Consider the below list as a letter to a younger version of myself with a brief list of topics that are good to learn.</p><br><a href=/posts/statistics-for-performance/>Read more</a><br><br><hr></div><div class=blog-post><h2 class=blog-post-title><a href=/posts/weighted-quantiles-ci/>Quantile confidence intervals for weighted samples</a></h2><span class=blog-post-meta><div class=faicon><i class="far fa-calendar-alt"></i></div><time datetime=2020-12-08>December 8, 2020</time>
&nbsp;&nbsp;
<i class="fas fa-tag"></i>&nbsp;
<a href=https://aakinshin.net/tags/statistics/ class="badge badge-info">Statistics</a>
<a href=https://aakinshin.net/tags/quantile/ class="badge badge-info">Quantile</a>
<a href=https://aakinshin.net/tags/confidence-interval/ class="badge badge-info">Confidence Interval</a></span><br><br><p>When you work with non-parametric distributions,
quantile estimations are essential to get the main distribution properties.
Once you get the estimation values, you may be interested in measuring the accuracy of these estimations.
Without it, it&rsquo;s hard to understand how trustable the obtained values are.
One of the most popular ways to evaluate accuracy is confidence interval estimation.</p><p>Now imagine that you collect some measurements every day.
Each day you get a small sample of values that is not enough to get the accurate daily quantile estimations.
However, the full time-series over the last several weeks has a decent size.
You suspect that past measurements should be similar to today measurements,
but you are not 100% sure about it.
You feel a temptation to extend the up-to-date sample by the previously collected values,
but it may spoil the estimation (e.g., in the case of recent change points or positive/negative trends).</p><p>One of the possible approaches in this situation is to use <em>weighted samples</em>.
This assumes that we add past measurements to the &ldquo;today sample,&rdquo;
but these values should have smaller weight.
The older measurement we take, the smaller weight it gets.
If you have consistent values across the last several days,
this approach works like a charm.
If you have any recent changes, you can detect such situations by huge confidence intervals
due to the sample inconsistency.</p><p>So, how do we estimate confidence intervals around quantiles for the weighted samples?
In one of the previous posts, I have already shown how to <a href=https://aakinshin.net/posts/weighted-quantiles/>estimate quantiles on weighted samples</a>.
In this post, I will show how to estimate quantile confidence intervals for weighted samples.</p><br><a href=/posts/weighted-quantiles-ci/>Read more</a><br><br><hr></div><div class=blog-post><h2 class=blog-post-title><a href=/posts/qad/>Quantile absolute deviation: estimating statistical dispersion around quantiles</a></h2><span class=blog-post-meta><div class=faicon><i class="far fa-calendar-alt"></i></div><time datetime=2020-12-01>December 1, 2020</time>
&nbsp;&nbsp;
<i class="fas fa-tag"></i>&nbsp;
<a href=https://aakinshin.net/tags/statistics/ class="badge badge-info">Statistics</a>
<a href=https://aakinshin.net/tags/quantiles/ class="badge badge-info">Quantiles</a>
<a href=https://aakinshin.net/tags/mad/ class="badge badge-info">MAD</a>
<a href=https://aakinshin.net/tags/quantile-absolute-deviation/ class="badge badge-info">Quantile Absolute Deviation</a>
<a href=https://aakinshin.net/tags/dispersion/ class="badge badge-info">Dispersion</a>
<a href=https://aakinshin.net/tags/harrell-davis/ class="badge badge-info">Harrell-Davis</a></span><br><br><p>There are many different metrics for <a href=https://en.wikipedia.org/wiki/Statistical_dispersion>statistical dispersion</a>.
The most famous one is the <a href=https://en.wikipedia.org/wiki/Standard_deviation>standard deviation</a>.
The standard deviation is the most popular way to describe the spread around the mean when
you work with normally distributed data.
However, if you work with non-normal distributions, this metric may be misleading.</p><p>In the world of non-parametric distributions,
the most common measure of <a href=https://en.wikipedia.org/wiki/Central_tendency>central tendency</a> is the median.
For the median, you can describe dispersion using the
<a href=https://en.wikipedia.org/wiki/Median_absolute_deviation>median absolute deviation around the median</a> (MAD).
It works great if the median is the only <a href=https://en.wikipedia.org/wiki/Summary_statistics>summary statistic</a> that you care about.
However, if you work with multimodal distributions
(they can be detected using the <a href=https://aakinshin.net/posts/lowland-multimodality-detection/>lowland multimodality detector</a>),
you may be interested in other quantiles as well.
So, it makes sense to learn how to describe dispersion around the given quantile.
Which metric should we choose?</p><p>Recently, I came up with a great solution to this problem.
We can generalize the median absolute deviation into the quantile absolute deviation (QAD) around the given quantile based on the Harrell-Davis quantile estimator.
I will show how to calculate it, how to interpret it, and how to get insights about distribution properties
from images like this one:</p><div class=row><div class=mx-auto><a href=/posts/qad/img/modal5-light.png target=_blank class=imgldlink alt=modal5><picture>
<source theme=dark srcset=/posts/qad/img/modal5-dark.png media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/qad/img/modal5-light.png media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/qad/img/modal5-light.png></picture></a></div></div><br><br><a href=/posts/qad/>Read more</a><br><br><hr></div><div class=blog-post><h2 class=blog-post-title><a href=/posts/p2-quantile-estimator/>P² quantile estimator: estimating the median without storing values</a></h2><span class=blog-post-meta><div class=faicon><i class="far fa-calendar-alt"></i></div><time datetime=2020-11-24>November 24, 2020</time>
&nbsp;&nbsp;
<i class="fas fa-tag"></i>&nbsp;
<a href=https://aakinshin.net/tags/statistics/ class="badge badge-info">Statistics</a>
<a href=https://aakinshin.net/tags/quantiles/ class="badge badge-info">Quantiles</a>
<a href=https://aakinshin.net/tags/performance-telemetry/ class="badge badge-info">Performance Telemetry</a></span><br><br><p>Imagine that you are implementing performance telemetry in your application.
There is an operation that is executed millions of times, and you want to get its &ldquo;average&rdquo; duration.
It&rsquo;s not a good idea to use the arithmetic mean because the obtained value can be easily spoiled by outliers.
It&rsquo;s much better to use the median which is one of the most robust ways to describe the average.</p><p>The straightforward median estimation approach requires storing all the values.
In our case, it&rsquo;s a bad idea to keep all the values because it will significantly increase the memory footprint.
Such telemetry is harmful because it may become a new bottleneck instead of monitoring the actual performance.</p><p>Another way to get the median value is to use a sequential quantile estimator
(also known as an online quantile estimator or a streaming quantile estimator).
This is an algorithm that allows calculating the median value (or any other quantile value)
using a fixed amount of memory.
Of course, it provides only an approximation of the real median value,
but it&rsquo;s usually enough for typical telemetry use cases.</p><p>In this post, I will show one of the simplest sequential quantile estimators that is called the P² quantile estimator
(or the Piecewise-Parabolic quantile estimator).</p><br><a href=/posts/p2-quantile-estimator/>Read more</a><br><br><hr></div><div class=blog-post><h2 class=blog-post-title><a href=/posts/modality-summary-notation/>Plain-text summary notation for multimodal distributions</a></h2><span class=blog-post-meta><div class=faicon><i class="far fa-calendar-alt"></i></div><time datetime=2020-11-17>November 17, 2020</time>
&nbsp;&nbsp;
<i class="fas fa-tag"></i>&nbsp;
<a href=https://aakinshin.net/tags/statistics/ class="badge badge-info">Statistics</a>
<a href=https://aakinshin.net/tags/multimodality/ class="badge badge-info">Multimodality</a>
<a href=https://aakinshin.net/tags/qrde/ class="badge badge-info">QRDE</a>
<a href=https://aakinshin.net/tags/harrell-davis/ class="badge badge-info">Harrell-Davis</a>
<a href=https://aakinshin.net/tags/outliers/ class="badge badge-info">Outliers</a></span><br><br><p>Let&rsquo;s say you collected a lot of data and want to explore the underlying distributions of collected samples.
If you have only a few distributions, the best way to do that is to look at the density plots
(expressed via histograms, kernel density estimations, or <a href=https://aakinshin.net/posts/qrde-hd/>quantile-respectful density estimations</a>).
However, it&rsquo;s not always possible.</p><p>Suppose you have to process dozens, hundreds, or even thousands of distributions.
In that case,
it may be extremely time-consuming to manually check visualizations of each distribution.
If you analyze distributions from the command line or send notifications about suspicious samples,
it may be impossible to embed images in the reports.
In these cases, there is a need to present a distribution using plain text.</p><p>One way to do that is plain text histograms.
Unfortunately, this kind of visualization may occupy o lot of space.
In complicated cases, you may need 20 or 30 lines per a single distribution.</p><p>Another way is to present classic <a href=https://en.wikipedia.org/wiki/Summary_statistics>summary statistics</a>
like mean or median, standard deviation or median absolute deviation, quantiles, skewness, and kurtosis.
There is another problem here:
without experience, it&rsquo;s hard to reconstruct the true distribution shape based on these values.
Even if you are an experienced researcher, the statistical metrics may become misleading in the case of multimodal distributions.
Multimodality is one of the most severe challenges in distribution analysis because it distorts basic summary statistics.
It&rsquo;s important to not only find such distribution but also have a way to present brief information about multimodality effects.</p><p>So, how can we condense the underlying distribution shape of a given sample to a short text line?
I didn&rsquo;t manage to find an approach that works fine in my cases, so I came up with my own notation.
Most of the interpretation problems in my experiments arise from multimodality and outliers,
so I decided to focus on these two things and specifically highlight them.
Let&rsquo;s consider this plot:</p><div class=row><div class=mx-auto><a href=/posts/modality-summary-notation/img/thumbnail-light.svg target=_blank class=imgldlink alt=thumbnail><picture>
<source theme=dark srcset=/posts/modality-summary-notation/img/thumbnail-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/modality-summary-notation/img/thumbnail-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/modality-summary-notation/img/thumbnail-light.svg></picture></a></div></div><br><p>I suggest describing it like this:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=o>{</span>1.00, 2.00<span class=o>}</span> + <span class=o>[</span>7.16<span class=p>;</span> 13.12<span class=o>]</span>_100 + <span class=o>{</span>19.00<span class=o>}</span> + <span class=o>[</span>27.69<span class=p>;</span> 32.34<span class=o>]</span>_100 + <span class=o>{</span>37.00..39.00<span class=o>}</span>_3
</code></pre></div><p>Let me explain the suggested notation in detail.</p><br><a href=/posts/modality-summary-notation/>Read more</a><br><br><hr></div><div class=blog-post><h2 class=blog-post-title><a href=/posts/intermodal-outliers/>Intermodal outliers</a></h2><span class=blog-post-meta><div class=faicon><i class="far fa-calendar-alt"></i></div><time datetime=2020-11-10>November 10, 2020</time>
&nbsp;&nbsp;
<i class="fas fa-tag"></i>&nbsp;
<a href=https://aakinshin.net/tags/statistics/ class="badge badge-info">Statistics</a>
<a href=https://aakinshin.net/tags/multimodality/ class="badge badge-info">Multimodality</a>
<a href=https://aakinshin.net/tags/qrde/ class="badge badge-info">QRDE</a>
<a href=https://aakinshin.net/tags/harrell-davis/ class="badge badge-info">Harrell-Davis</a>
<a href=https://aakinshin.net/tags/outliers/ class="badge badge-info">Outliers</a></span><br><br><p><a href=https://en.wikipedia.org/wiki/Outlier>Outlier</a> analysis is a typical step in distribution exploration.
Usually, we work with the &ldquo;lower outliers&rdquo; (extremely low values) and the &ldquo;upper outliers&rdquo; (extremely high values).
However, outliers are not always extreme values.
In the general case, an outlier is a value that significantly differs from other values in the same sample.
In the case of multimodal distribution, we can also consider outliers in the middle of the distribution.
Let&rsquo;s call such outliers that we found between modes the &ldquo;<em>intermodal outliers</em>.&rdquo;</p><div class=row><div class=mx-auto><a href=/posts/intermodal-outliers/img/step4-light.svg target=_blank class=imgldlink alt=step4><picture>
<source theme=dark srcset=/posts/intermodal-outliers/img/step4-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/intermodal-outliers/img/step4-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/intermodal-outliers/img/step4-light.svg></picture></a></div></div><br><p>Look at the above density plot.
It&rsquo;s a bimodal distribution that is formed as a combination of two unimodal distributions.
Each of the unimodal distributions may have its own lower and upper outliers.
When we merge them, the upper outliers of the first distribution and the lower outliers of the second distribution
stop being lower or upper outliers.
However, if these values don&rsquo;t belong to the modes, they still are a subject of interest.
In this post, I will show you how to detect such intermodal outliers
and how they can be used to form a better distribution description.</p><br><a href=/posts/intermodal-outliers/>Read more</a><br><br><hr></div><div class=blog-post><h2 class=blog-post-title><a href=/posts/lowland-multimodality-detection/>Lowland multimodality detection</a></h2><span class=blog-post-meta><div class=faicon><i class="far fa-calendar-alt"></i></div><time datetime=2020-11-03>November 3, 2020</time>
&nbsp;&nbsp;
<i class="fas fa-tag"></i>&nbsp;
<a href=https://aakinshin.net/tags/statistics/ class="badge badge-info">Statistics</a>
<a href=https://aakinshin.net/tags/multimodality/ class="badge badge-info">Multimodality</a>
<a href=https://aakinshin.net/tags/qrde/ class="badge badge-info">QRDE</a>
<a href=https://aakinshin.net/tags/harrell-davis/ class="badge badge-info">Harrell-Davis</a></span><br><br><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/data5-light.svg target=_blank class=imgldlink alt=data5><picture>
<source theme=dark srcset=/posts/lowland-multimodality-detection/img/data5-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/data5-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/data5-light.svg></picture></a></div></div><br><p>Multimodality is an essential feature of a distribution, which may create many troubles during automatic analysis.
One of the best ways to work with such distributions is to detect all the modes in advance based on the given samples.
Unfortunately, this problem is much harder than it looks like.</p><p>I tried many different approaches for multimodality detection, but none of them was good enough.
During the past several years, my approach of choice was the <a href=http://www.brendangregg.com/FrequencyTrails/modes.html>mvalue-based modal test</a> by Brendan Gregg.
It works nicely in simple cases, but I was constantly stumbling over noisy samples where this algorithm doesn&rsquo;t produce reliable results.
Also, it has some limitations that make it unapplicable to some corner cases.</p><p>So, I needed a better approach.
Here are my main requirements:</p><ul><li>It should detect the exact mode locations and ranges</li><li>It should provide reliable results even on noisy samples</li><li>It should be able to detect multimodality even when some modes are extremely close to each other</li><li>It should work out of the box without tricky parameter tuning for each specific distribution</li></ul><p>I failed to find such an algorithm anywhere, so I came up with my own!
The current working title is &ldquo;the lowland multimodality detector.&rdquo;
It takes an estimation of the probability density function (PDF) and tries to find &ldquo;lowlands&rdquo; (areas that are much lower than neighboring peaks).
Next, it splits the plot by these lowlands and detects modes between them.
For the PDF estimation, it uses the <a href=https://aakinshin.net/posts/qrde-hd/>quantile-respectful density estimation based on the Harrell-Davis quantile estimator</a> (QRDE-HD).
Let me explain how it works in detail.</p><br><a href=/posts/lowland-multimodality-detection/>Read more</a><br><br><hr></div><div class=blog-post><h2 class=blog-post-title><a href=/posts/qrde-hd/>Quantile-respectful density estimation based on the Harrell-Davis quantile estimator</a></h2><span class=blog-post-meta><div class=faicon><i class="far fa-calendar-alt"></i></div><time datetime=2020-10-27>October 27, 2020</time>
&nbsp;&nbsp;
<i class="fas fa-tag"></i>&nbsp;
<a href=https://aakinshin.net/tags/statistics/ class="badge badge-info">Statistics</a>
<a href=https://aakinshin.net/tags/pdf/ class="badge badge-info">PDF</a>
<a href=https://aakinshin.net/tags/qrde/ class="badge badge-info">QRDE</a>
<a href=https://aakinshin.net/tags/harrell-davis/ class="badge badge-info">Harrell-Davis</a></span><br><br><p>The idea of this post was born when I was working on a presentation for my recent <a href=https://dotnext.ru/en/>DotNext</a> <a href="https://www.youtube.com/watch?v=gc3yVybPuaY&list=PL21xssNXOJNGUROqzSTOC8uZL4W2QZpvK&index=1">talk</a>.
It had a <a href=https://slides.aakinshin.net/dotnext-piter2020/#193>slide</a> with a density plot like this:</p><div class=row><div class=mx-auto><a href=/posts/qrde-hd/img/riddle-light.png target=_blank class=imgldlink alt=riddle><picture>
<source theme=dark srcset=/posts/qrde-hd/img/riddle-dark.png media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/qrde-hd/img/riddle-light.png media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/qrde-hd/img/riddle-light.png></picture></a></div></div><br><p>Here we can see a density plot based on a sample with highlighted <a href=https://en.wikipedia.org/wiki/Decile>decile</a> locations that split the plot into 10 equal parts.
Before the conference, I have been reviewed by <a href=https://twitter.com/VladimirSitnikv>@VladimirSitnikv</a>.
He raised a reasonable concern: it doesn&rsquo;t look like all the density plot segments are equal and contain exactly 10% of the whole plot.
And he was right!</p><p>However, I didn&rsquo;t make any miscalculations.
I generated a real sample with 61 elements.
Next, I build a density plot with the kernel density estimation (KDE) using the Sheather & Jones method and the normal kernel.
Next, I calculated decile values using the Harrell-Davis quantile estimator.
Although both the density plot and the decile values are calculated correctly and consistent with the sample,
they are not consistent with each other!
Indeed, such a density plot is just an estimation of the underlying distribution.
It has its own decile values, which are not equal to the sample decile values regardless of the used quantile estimator.
This problem is common for different kinds of visualization that presents density and quantiles at the same time (e.g., <a href=https://towardsdatascience.com/violin-plots-explained-fb1d115e023d>violin plots</a>)</p><p>It leads us to a question: how should we present the shape of our data together with quantile values without confusing inconsistency in the final image?
Today I will present a good solution: we should use the quantile-respectful density estimation based on the Harrell-Davis quantile estimator!
I know the title is a bit long, but it&rsquo;s not so complicated as it sounds.
In this post, I will show how to build such plots.
Also I will compare them to the classic histograms and kernel density estimations.
As a bonus, I will demonstrate how awesome these plots are for multimodality detection.</p><br><a href=/posts/qrde-hd/>Read more</a><br><br><hr></div><div class=blog-post><h2 class=blog-post-title><a href=/posts/misleading-histograms/>Misleading histograms</a></h2><span class=blog-post-meta><div class=faicon><i class="far fa-calendar-alt"></i></div><time datetime=2020-10-20>October 20, 2020</time>
&nbsp;&nbsp;
<i class="fas fa-tag"></i>&nbsp;
<a href=https://aakinshin.net/tags/statistics/ class="badge badge-info">Statistics</a>
<a href=https://aakinshin.net/tags/multimodality/ class="badge badge-info">Multimodality</a>
<a href=https://aakinshin.net/tags/r/ class="badge badge-info">R</a>
<a href=https://aakinshin.net/tags/histograms/ class="badge badge-info">Histograms</a></span><br><br><p>Below you see two histograms.
What could you say about them?</p><div class=row><div class=mx-auto><a href=/posts/misleading-histograms/img/hist-riddle-light.svg target=_blank class=imgldlink alt=hist-riddle><picture>
<source theme=dark srcset=/posts/misleading-histograms/img/hist-riddle-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/misleading-histograms/img/hist-riddle-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/misleading-histograms/img/hist-riddle-light.svg></picture></a></div></div><br><p>Most likely, you say that the first histogram is based on a uniform distribution,
and the second one is based on a multimodal distribution with four modes.
Although this is not obvious from the plots,
both histograms are based on the same sample:</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=m>20.13</span><span class=p>,</span> <span class=m>19.94</span><span class=p>,</span> <span class=m>20.03</span><span class=p>,</span> <span class=m>20.06</span><span class=p>,</span> <span class=m>20.04</span><span class=p>,</span> <span class=m>19.98</span><span class=p>,</span> <span class=m>20.15</span><span class=p>,</span> <span class=m>19.99</span><span class=p>,</span> <span class=m>20.20</span><span class=p>,</span> <span class=m>19.99</span><span class=p>,</span> <span class=m>20.13</span><span class=p>,</span> <span class=m>20.22</span><span class=p>,</span> <span class=m>19.86</span><span class=p>,</span> <span class=m>19.97</span><span class=p>,</span> <span class=m>19.98</span><span class=p>,</span> <span class=m>20.06</span><span class=p>,</span>
<span class=m>29.97</span><span class=p>,</span> <span class=m>29.73</span><span class=p>,</span> <span class=m>29.75</span><span class=p>,</span> <span class=m>30.13</span><span class=p>,</span> <span class=m>29.96</span><span class=p>,</span> <span class=m>29.82</span><span class=p>,</span> <span class=m>29.98</span><span class=p>,</span> <span class=m>30.12</span><span class=p>,</span> <span class=m>30.18</span><span class=p>,</span> <span class=m>29.95</span><span class=p>,</span> <span class=m>29.97</span><span class=p>,</span> <span class=m>29.82</span><span class=p>,</span> <span class=m>30.04</span><span class=p>,</span> <span class=m>29.93</span><span class=p>,</span> <span class=m>30.04</span><span class=p>,</span> <span class=m>30.07</span><span class=p>,</span>
<span class=m>40.10</span><span class=p>,</span> <span class=m>39.93</span><span class=p>,</span> <span class=m>40.05</span><span class=p>,</span> <span class=m>39.82</span><span class=p>,</span> <span class=m>39.92</span><span class=p>,</span> <span class=m>39.91</span><span class=p>,</span> <span class=m>39.75</span><span class=p>,</span> <span class=m>40.00</span><span class=p>,</span> <span class=m>40.02</span><span class=p>,</span> <span class=m>39.96</span><span class=p>,</span> <span class=m>40.07</span><span class=p>,</span> <span class=m>39.92</span><span class=p>,</span> <span class=m>39.86</span><span class=p>,</span> <span class=m>40.04</span><span class=p>,</span> <span class=m>39.91</span><span class=p>,</span> <span class=m>40.14</span><span class=p>,</span>
<span class=m>49.95</span><span class=p>,</span> <span class=m>50.06</span><span class=p>,</span> <span class=m>50.03</span><span class=p>,</span> <span class=m>49.92</span><span class=p>,</span> <span class=m>50.15</span><span class=p>,</span> <span class=m>50.06</span><span class=p>,</span> <span class=m>50.00</span><span class=p>,</span> <span class=m>50.02</span><span class=p>,</span> <span class=m>50.06</span><span class=p>,</span> <span class=m>50.00</span><span class=p>,</span> <span class=m>49.70</span><span class=p>,</span> <span class=m>50.02</span><span class=p>,</span> <span class=m>49.96</span><span class=p>,</span> <span class=m>50.01</span><span class=p>,</span> <span class=m>50.05</span><span class=p>,</span> <span class=m>50.13</span>
</code></pre></div><p>Thus, the only difference between histograms is the offset!</p><p>Visualization is a simple way to understand the shape of your data.
Unfortunately, this way may easily become a slippery slope.
In the <a href=https://aakinshin.net/posts/kde-bw/>previous post</a>, I have shown how density plots may deceive you when the bandwidth is poorly chosen.
Today, we talk about histograms and why you can&rsquo;t trust them in the general case.</p><br><a href=/posts/misleading-histograms/>Read more</a><br><br><hr></div><div class=blog-post><h2 class=blog-post-title><a href=/posts/kde-bw/>The importance of kernel density estimation bandwidth</a></h2><span class=blog-post-meta><div class=faicon><i class="far fa-calendar-alt"></i></div><time datetime=2020-10-13>October 13, 2020</time>
&nbsp;&nbsp;
<i class="fas fa-tag"></i>&nbsp;
<a href=https://aakinshin.net/tags/statistics/ class="badge badge-info">Statistics</a>
<a href=https://aakinshin.net/tags/density-plots/ class="badge badge-info">Density plots</a>
<a href=https://aakinshin.net/tags/r/ class="badge badge-info">R</a>
<a href=https://aakinshin.net/tags/bandwidth/ class="badge badge-info">bandwidth</a></span><br><br><p>Below see two kernel density estimations.
What could you say about them?</p><div class=row><div class=mx-auto><a href=/posts/kde-bw/img/kde-riddle-light.svg target=_blank class=imgldlink alt=kde-riddle><picture>
<source theme=dark srcset=/posts/kde-bw/img/kde-riddle-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/kde-bw/img/kde-riddle-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/kde-bw/img/kde-riddle-light.svg></picture></a></div></div><br><p>Most likely, you say that the first plot is based on a uniform distribution,
and the second one is based on a multimodal distribution with four modes.
Although this is not obvious from the plots,
both density plots are based on the same sample:</p><div class=highlight><pre class=chroma><code class=language-txt data-lang=txt>21.370, 19.435, 20.363, 20.632, 20.404, 19.893, 21.511, 19.905, 22.018, 19.93,
31.304, 32.286, 28.611, 29.721, 29.866, 30.635, 29.715, 27.343, 27.559, 31.32,
39.693, 38.218, 39.828, 41.214, 41.895, 39.569, 39.742, 38.236, 40.460, 39.36,
50.455, 50.704, 51.035, 49.391, 50.504, 48.282, 49.215, 49.149, 47.585, 50.03
</code></pre></div><p>The only difference between plots is in <a href=https://en.wikipedia.org/wiki/Kernel_density_estimation#Bandwidth_selection>bandwidth selection</a>!</p><p>Bandwidth selection is crucial when you are trying to visualize your distributions.
Unfortunately, most people just call a regular function to build a density plot and don&rsquo;t think about how the bandwidth will be chosen.
As a result, the plot may present data in the wrong way, which may lead to incorrect conclusions.
Let&rsquo;s discuss bandwidth selection in detail and figure out how to improve the correctness of your density plots.
In this post, we will cover the following topics:</p><ul><li>Kernel density estimation</li><li>How bandwidth selection affects plot smoothness</li><li>Which bandwidth selectors can we use</li><li>Which bandwidth selectors should we use</li><li>Insidious default bandwidth selectors in statistical packages</li></ul><br><a href=/posts/kde-bw/>Read more</a><br><br><hr></div></div><div class=paginator><ul class=pagination><li class=page-item><a href=/ class=page-link aria-label=First><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/ class=page-link aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a class=page-link href=/>1</a></li><li class="page-item active"><a class=page-link href=/page/2/>2</a></li><li class=page-item><a class=page-link href=/page/3/>3</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/8/>8</a></li><li class=page-item><a href=/page/3/ class=page-link aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/8/ class=page-link aria-label=Last><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></main></div><footer class=blog-footer><div class=container><p>&copy; 2013–2021 Andrey Akinshin
|
<a href=https://github.com/AndreyAkinshin><i class="fab fa-github" title=GitHub style=color:#fff></i></a><a href=https://twitter.com/andrey_akinshin><i class="fab fa-twitter" title=Twitter style=color:#fff></i></a><a href=https://aakinshin.net/posts/index.xml><i class="fas fa-rss" title=RSS style=color:#fff></i></a>|
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></p></div></footer><script src=https://aakinshin.net/js/theme-after.min.082780cb948cc57eabbc0d80172a7a5347d5572b599938b4c9876dfd7978b424.js></script><script src=/js/popper.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/anchor.min.js></script><script src=https://aakinshin.net/js/custom.min.11932490dde776463ed165b345838c701accc0cfdedf2e0868f13415f41f0872.js></script><script>window.MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']],processEscapes:true,processEnvironments:true,},options:{skipHtmlTags:['script','noscript','style','textarea','pre'],ignoreHtmlClass:'tex2jax_ignore',processHtmlClass:'tex2jax_process'}};</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></body></html>