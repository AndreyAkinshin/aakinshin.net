<!doctype html><html lang=en class=h-100><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.103.0-DEV"><meta name=author content="Andrey Akinshin"><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content><title>Andrey Akinshin's blog (Page 15)</title><meta name=description content="Andrey Akinshin's blog"><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><link href=https://aakinshin.net/sass/bootstrap-light.min.css theme=light rel=stylesheet type=text/css media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><link href=https://aakinshin.net/sass/bootstrap-dark.min.css theme=dark rel=stylesheet type=text/css media="(prefers-color-scheme: dark)"><script src=https://aakinshin.net/js/theme-before.min.d7f6578e23ad3f0c33c589f9bcb34f995b45121f1f3ce888869c86b26826c845.js></script>
<script type=module src=https://aakinshin.net/js/dark-mode-toggle.min.9e68d431432744c07a43381a8a833ffe0921cc0e006d84ad97f0b0d43c5cd82d.mjs></script>
<link href=https://aakinshin.net/css/main.min.d3894e60e337fa8d9f2c81dcda5dcb9144502462aaabed3c6bad2fcf178a8410.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"></head><body class="d-flex flex-column min-vh-100"><div class=bg-primary><div class="container bg-primary"><nav class="navbar navbar-expand-sm navbar-dark bg-primary"><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link id=nav-link-blog href=https://aakinshin.net/><svg class="fai"><use xlink:href="/img/fa/all.svg#house-chimney"/></svg></a></li><li class=nav-item><a class=nav-link id=nav-link-posts href=https://aakinshin.net/posts/>Posts</a></li><li class=nav-item><a class=nav-link id=nav-link-about href=https://aakinshin.net/about/>About</a></li></ul><ul class="navbar-nav ms-auto"><li class=nav-item><dark-mode-toggle permanent=true></dark-mode-toggle></li></ul></nav></div></div><div class=container><main id=main><div class=blog-main><div class=blog-post><h2 class=blog-post-title><a href=/posts/bdn-v0_10_10/>BenchmarkDotNet v0.10.10</a></h2><span class=blog-post-meta><svg class="fai"><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2017-11-03>November 3, 2017</time>
&nbsp;&nbsp;<svg class="fai"><use xlink:href="/img/fa/all.svg#tag"/></svg>
<a href=https://aakinshin.net/tags/programming/ class="badge badge-info">Programming</a>
<a href=https://aakinshin.net/tags/dotnet/ class="badge badge-info">.NET</a>
<a href=https://aakinshin.net/tags/cs/ class="badge badge-info">C#</a>
<a href=https://aakinshin.net/tags/benchmarkdotnet/ class="badge badge-info">BenchmarkDotNet</a>
<a href=https://aakinshin.net/tags/benchmarking/ class="badge badge-info">Benchmarking</a></span><br><br><p>BenchmarkDotNet v0.10.10 has been released!
This release includes many new features like Disassembly Diagnoser, ParamsSources, .NET Core x86 support, Environment variables, and more!</p><br><a href=/posts/bdn-v0_10_10/>Read more</a><br><br><hr></div><div class=blog-post><h2 class=blog-post-title><a href=/posts/reflecting-on-performance-testing/>Reflecting on performance testing</a></h2><span class=blog-post-meta><svg class="fai"><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2017-08-01>August 1, 2017</time>
&nbsp;&nbsp;<svg class="fai"><use xlink:href="/img/fa/all.svg#tag"/></svg>
<a href=https://aakinshin.net/tags/mathematics/ class="badge badge-info">Mathematics</a>
<a href=https://aakinshin.net/tags/statistics/ class="badge badge-info">Statistics</a>
<a href=https://aakinshin.net/tags/performance/ class="badge badge-info">Performance</a>
<a href=https://aakinshin.net/tags/performancetesting/ class="badge badge-info">PerformanceTesting</a>
<a href=https://aakinshin.net/tags/rider/ class="badge badge-info">Rider</a>
<a href=https://aakinshin.net/tags/benchmarkdotnet/ class="badge badge-info">BenchmarkDotNet</a></span><br><br><p>Performance is an important feature for many projects.
Unfortunately, it&rsquo;s an all too common situation when a developer accidentally spoils the performance adding some new code.
After a series of such incidents, people often start to think about performance regression testing.</p><p>As developers, we write unit tests all the time.
These tests check that our business logic work as designed and that new features don&rsquo;t break existing code.
It looks like a good idea to write some perf tests as well, which will verify that we don&rsquo;t have any performance regressions.</p><p>Turns out this is harder than it sounds.
A lot of developers don&rsquo;t write perf tests at all.
Some teams write perf tests, but almost all of them use their own infrastructure for analysis
(which is not a bad thing in general because it&rsquo;s usually designed for specific projects and requirements).
There are a lot of books about test-driven development (TDD),
but there are no books about performance-driven development (PDD).
There are well-known libraries for unit-testing (like xUnit/NUnit/MSTest for .NET),
but there are almost no libraries for performance regression testing.
Yeah, of course, there are <em>some</em> libraries which you can use.
But there are troubles with <em>well-known all recognized</em> libraries, approaches, and tools.
Ask your colleagues about it: some of them will give you different answers, the rest of them will start Googling it.</p><p>There is no common understanding of what performance testing should look like.
This situation exists because it&rsquo;s really hard to develop a solution which solves <em>all problems</em> for <em>all kind of projects</em>.
However, it doesn&rsquo;t mean that we shouldn&rsquo;t try.
And we should try, we should share our experience and discuss best practices.</p><br><a href=/posts/reflecting-on-performance-testing/>Read more</a><br><br><hr></div><div class=blog-post><h2 class=blog-post-title><a href=/posts/stephen-toub-benchmarks-part1/>Measuring Performance Improvements in .NET Core with BenchmarkDotNet (Part 1)</a></h2><span class=blog-post-meta><svg class="fai"><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2017-06-09>June 9, 2017</time>
&nbsp;&nbsp;<svg class="fai"><use xlink:href="/img/fa/all.svg#tag"/></svg>
<a href=https://aakinshin.net/tags/programming/ class="badge badge-info">Programming</a>
<a href=https://aakinshin.net/tags/dotnet/ class="badge badge-info">.NET</a>
<a href=https://aakinshin.net/tags/cs/ class="badge badge-info">C#</a>
<a href=https://aakinshin.net/tags/benchmarkdotnet/ class="badge badge-info">BenchmarkDotNet</a>
<a href=https://aakinshin.net/tags/benchmarks/ class="badge badge-info">Benchmarks</a>
<a href=https://aakinshin.net/tags/coreclr/ class="badge badge-info">CoreCLR</a></span><br><br><p>A few days ago <a href=https://github.com/stephentoub>Stephen Toub</a> published a great post
at the <a href=https://blogs.msdn.microsoft.com/dotnet/>Microsoft .NET Blog</a>:
<a href=https://blogs.msdn.microsoft.com/dotnet/2017/06/07/performance-improvements-in-net-core/>Performance Improvements in .NET Core</a>.
He showed some significant performance changes in .NET Core 2.0 Preview 1 (compared with .NET Framework 4.7).
The .NET Core uses RyuJIT for generating assembly code.
When I first tried RyuJIT (e.g.,
<a href=https://blogs.msdn.microsoft.com/dotnet/2014/02/27/ryujit-ctp2-getting-ready-for-prime-time/>CTP2</a>,
<a href=https://blogs.msdn.microsoft.com/clrcodegeneration/2014/10/30/ryujit-ctp5-getting-closer-to-shipping-and-with-better-simd-support/>CTP5</a>, 2014),
I wasn&rsquo;t excited about this: the preview versions had some bugs, and it worked slowly on my applications.
However, the idea of a rethought and open-source JIT-compiler was a huge step forward and investment in the future.
RyuJIT had been developed very actively in recent years: not only by Microsoft but with the help of the community.
I&rsquo;m still not happy about the generated assembly code in some methods, but I have to admit that the RyuJIT (as a part of .NET Core) works pretty well today:
it shows a good performance level not only on artificial benchmarks but also on real user code.
Also, there are a lot of changes
not only in <a href=https://github.com/dotnet/coreclr>dotnet/coreclr</a> (the .NET Core runtime),
but also in <a href=https://github.com/dotnet/corefx>dotnet/corefx</a> (the .NET Core foundational libraries).
It&rsquo;s very nice to watch how the community helps to optimize well-used classes which have not changed for years.</p><p>Now let&rsquo;s talk about benchmarks.
For the demonstration, Stephen wrote a set of handwritten benchmarks.
A few people (in
<a href=https://blogs.msdn.microsoft.com/dotnet/2017/06/07/performance-improvements-in-net-core/#comments>comments</a> and on <a href="https://news.ycombinator.com/item?id=14507936">HackerNews</a>)
asked about <a href=https://github.com/dotnet/BenchmarkDotNet>BenchmarkDotNet</a> regarding these samples (as a better tool for performance measurements).
So, I decided to try all these benchmarks on BenchmarkDotNet.</p><p>In this post, we will discuss
how can BenchmarkDotNet help in such performance investigations,
which benchmarking approaches (and when) are better to use,
and how can we improve these measurements.</p><br><a href=/posts/stephen-toub-benchmarks-part1/>Read more</a><br><br><hr></div><div class=blog-post><h2 class=blog-post-title><a href=/posts/bdn-v0_10_7/>BenchmarkDotNet v0.10.7</a></h2><span class=blog-post-meta><svg class="fai"><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2017-06-05>June 5, 2017</time>
&nbsp;&nbsp;<svg class="fai"><use xlink:href="/img/fa/all.svg#tag"/></svg>
<a href=https://aakinshin.net/tags/programming/ class="badge badge-info">Programming</a>
<a href=https://aakinshin.net/tags/dotnet/ class="badge badge-info">.NET</a>
<a href=https://aakinshin.net/tags/cs/ class="badge badge-info">C#</a>
<a href=https://aakinshin.net/tags/benchmarkdotnet/ class="badge badge-info">BenchmarkDotNet</a>
<a href=https://aakinshin.net/tags/benchmarking/ class="badge badge-info">Benchmarking</a></span><br><br><p>BenchmarkDotNet v0.10.7 has been released.
In this post, I will briefly cover the following features:</p><ul><li>LINQPad support</li><li>Filters and categories</li><li>Updated Setup/Cleanup attributes</li><li>Better Value Types support</li><li>Building Sources on Linux</li></ul><br><a href=/posts/bdn-v0_10_7/>Read more</a><br><br><hr></div><div class=blog-post><h2 class=blog-post-title><a href=/posts/mono-and-65535interfaces/>65535 interfaces ought to be enough for anybody</a></h2><span class=blog-post-meta><svg class="fai"><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2017-02-14>February 14, 2017</time>
&nbsp;&nbsp;<svg class="fai"><use xlink:href="/img/fa/all.svg#tag"/></svg>
<a href=https://aakinshin.net/tags/programming/ class="badge badge-info">Programming</a>
<a href=https://aakinshin.net/tags/dotnet/ class="badge badge-info">.NET</a>
<a href=https://aakinshin.net/tags/rider/ class="badge badge-info">Rider</a>
<a href=https://aakinshin.net/tags/bugs/ class="badge badge-info">Bugs</a>
<a href=https://aakinshin.net/tags/mono/ class="badge badge-info">Mono</a></span><br><br><p>It was a bright, sunny morning.
There were no signs of trouble.
I came to work, opened Slack, and received many messages from my coworkers about failed tests.</p><div class=mx-auto><img class="mx-auto d-block" width=800 src=/img/posts/dotnet/mono-and-65535interfaces/front.png></div><p>After a few hours of investigation, the situation became clear:</p><ul><li>I&rsquo;m responsible for the unit tests subsystem in <a href=https://www.jetbrains.com/rider/>Rider</a>, and only tests from this subsystem were failing.</li><li>I didn&rsquo;t commit anything to the subsystem for a week because I worked with a local branch.
Other developers also didn&rsquo;t touch this code.</li><li>The unit tests subsystem is completely independent.
It&rsquo;s hard to imagine a situation when only the corresponded tests would fail, thousands of other tests pass, and there are no changes in the source code.</li><li><code>git blame</code> helped to find the &ldquo;bad commit&rdquo;: it didn&rsquo;t include anything suspicious, only a few additional classes in other subsystems.</li><li>Only tests on Linux and MacOS were red.
On Windows, everything was ok.</li><li>Stacktraces in failed tests were completely random.
We had a new stack trace in each test from different subsystems.
There was no connection between these stack traces, unit tests source code, and the changes in the &ldquo;bad commit.&rdquo;
There was no clue where we should look for a problem.</li></ul><p>So, what was special about this &ldquo;bad commit&rdquo;? Spoiler: after these changes, we sometimes have more than 65535 interface implementations at runtime.</p><br><a href=/posts/mono-and-65535interfaces/>Read more</a><br><br><hr></div><div class=blog-post><h2 class=blog-post-title><a href=/posts/namedmutex-on-mono/>A bug story about named mutex on Mono</a></h2><span class=blog-post-meta><svg class="fai"><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2017-02-13>February 13, 2017</time>
&nbsp;&nbsp;<svg class="fai"><use xlink:href="/img/fa/all.svg#tag"/></svg>
<a href=https://aakinshin.net/tags/programming/ class="badge badge-info">Programming</a>
<a href=https://aakinshin.net/tags/dotnet/ class="badge badge-info">.NET</a>
<a href=https://aakinshin.net/tags/rider/ class="badge badge-info">Rider</a>
<a href=https://aakinshin.net/tags/bugs/ class="badge badge-info">Bugs</a>
<a href=https://aakinshin.net/tags/xplat/ class="badge badge-info">Xplat</a>
<a href=https://aakinshin.net/tags/mono/ class="badge badge-info">Mono</a>
<a href=https://aakinshin.net/tags/coreclr/ class="badge badge-info">CoreCLR</a></span><br><br><p>When you write some multithreading magic on .NET,
you can use a cool synchronization primitive called <a href="https://msdn.microsoft.com/en-us/library/system.threading.mutex(v=vs.110).aspx">Mutex</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=kt>var</span> <span class=n>mutex</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Mutex</span><span class=p>(</span><span class=k>false</span><span class=p>,</span> <span class=s>&#34;Global\\MyNamedMutex&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p>You also can make it <a href="https://msdn.microsoft.com/en-us/library/f55ddskf(v=vs.110).aspx">named</a> (and share the mutex between processes)
which works perfectly on Windows:</p><div class=mx-auto><img class="mx-auto d-block" width=600 src=/img/posts/dotnet/namedmutex-on-mono/front.png></div><p>However, today the .NET Framework is cross-platform, so this code should work on any operation system.
What will happen if you use named mutex on Linux or MacOS with the help of Mono or CoreCLR?
Is it possible to create some tricky bug based on this case?
Of course, it does.
Today I want to tell you a story about such bug in <a href=https://www.jetbrains.com/rider/>Rider</a> which was a headache for several weeks.</p><br><a href=/posts/namedmutex-on-mono/>Read more</a><br><br><hr></div><div class=blog-post><h2 class=blog-post-title><a href=/posts/invaliddataexception-in-getprocesses/>InvalidDataException in Process.GetProcesses</a></h2><span class=blog-post-meta><svg class="fai"><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2017-02-10>February 10, 2017</time>
&nbsp;&nbsp;<svg class="fai"><use xlink:href="/img/fa/all.svg#tag"/></svg>
<a href=https://aakinshin.net/tags/programming/ class="badge badge-info">Programming</a>
<a href=https://aakinshin.net/tags/dotnet/ class="badge badge-info">.NET</a>
<a href=https://aakinshin.net/tags/rider/ class="badge badge-info">Rider</a>
<a href=https://aakinshin.net/tags/bugs/ class="badge badge-info">Bugs</a>
<a href=https://aakinshin.net/tags/xplat/ class="badge badge-info">Xplat</a>
<a href=https://aakinshin.net/tags/coreclr/ class="badge badge-info">CoreCLR</a></span><br><br><p>Consider the following program:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=k>public</span> <span class=k>static</span> <span class=k>void</span> <span class=n>Main</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Process</span><span class=p>.</span><span class=n>GetProcesses</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>It seems that all exceptions should be caught.
However, <em>sometimes</em>, I had the following exception on Linux with <code>dotnet cli-1.0.0-preview2</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=err>$</span> <span class=n>dotnet</span> <span class=n>run</span>
</span></span><span class=line><span class=cl><span class=n>System</span><span class=p>.</span><span class=n>IO</span><span class=p>.</span><span class=n>InvalidDataException</span><span class=p>:</span> <span class=n>Found</span> <span class=n>invalid</span> <span class=n>data</span> <span class=k>while</span> <span class=n>decoding</span><span class=p>.</span>
</span></span><span class=line><span class=cl>   <span class=n>at</span> <span class=n>System</span><span class=p>.</span><span class=n>IO</span><span class=p>.</span><span class=n>StringParser</span><span class=p>.</span><span class=n>ParseNextChar</span><span class=p>()</span>
</span></span><span class=line><span class=cl>   <span class=n>at</span> <span class=n>Interop</span><span class=p>.</span><span class=n>procfs</span><span class=p>.</span><span class=n>TryParseStatFile</span><span class=p>(</span><span class=n>String</span> <span class=n>statFilePath</span><span class=p>,</span> <span class=n>ParsedStat</span><span class=p>&amp;</span> <span class=n>result</span><span class=p>,</span> <span class=n>ReusableTextReader</span> <span class=n>reusableReader</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>at</span> <span class=n>System</span><span class=p>.</span><span class=n>Diagnostics</span><span class=p>.</span><span class=n>ProcessManager</span><span class=p>.</span><span class=n>CreateProcessInfo</span><span class=p>(</span><span class=n>ParsedStat</span> <span class=n>procFsStat</span><span class=p>,</span> <span class=n>ReusableTextReader</span> <span class=n>reusableReader</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>at</span> <span class=n>System</span><span class=p>.</span><span class=n>Diagnostics</span><span class=p>.</span><span class=n>ProcessManager</span><span class=p>.</span><span class=n>CreateProcessInfo</span><span class=p>(</span><span class=n>Int32</span> <span class=n>pid</span><span class=p>,</span> <span class=n>ReusableTextReader</span> <span class=n>reusableReader</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>at</span> <span class=n>System</span><span class=p>.</span><span class=n>Diagnostics</span><span class=p>.</span><span class=n>ProcessManager</span><span class=p>.</span><span class=n>GetProcessInfos</span><span class=p>(</span><span class=n>String</span> <span class=n>machineName</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>at</span> <span class=n>System</span><span class=p>.</span><span class=n>Diagnostics</span><span class=p>.</span><span class=n>Process</span><span class=p>.</span><span class=n>GetProcesses</span><span class=p>(</span><span class=n>String</span> <span class=n>machineName</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>at</span> <span class=n>System</span><span class=p>.</span><span class=n>Diagnostics</span><span class=p>.</span><span class=n>Process</span><span class=p>.</span><span class=n>GetProcesses</span><span class=p>()</span>
</span></span><span class=line><span class=cl>   <span class=n>at</span> <span class=n>DotNetCoreConsoleApplication</span><span class=p>.</span><span class=n>Program</span><span class=p>.</span><span class=n>Main</span><span class=p>(</span><span class=n>String</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span> <span class=k>in</span> <span class=p>/</span><span class=n>home</span><span class=p>/</span><span class=n>akinshin</span><span class=p>/</span><span class=n>Program</span><span class=p>.</span><span class=n>cs</span><span class=p>:</span><span class=n>line</span> <span class=m>12</span>
</span></span></code></pre></div><p>How is that possible?</p><br><a href=/posts/invaliddataexception-in-getprocesses/>Read more</a><br><br><hr></div><div class=blog-post><h2 class=blog-post-title><a href=/posts/rider-nuget-search/>Why is NuGet search in Rider so fast?</a></h2><span class=blog-post-meta><svg class="fai"><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2017-02-08>February 8, 2017</time>
&nbsp;&nbsp;<svg class="fai"><use xlink:href="/img/fa/all.svg#tag"/></svg>
<a href=https://aakinshin.net/tags/programming/ class="badge badge-info">Programming</a>
<a href=https://aakinshin.net/tags/dotnet/ class="badge badge-info">.NET</a>
<a href=https://aakinshin.net/tags/rider/ class="badge badge-info">Rider</a>
<a href=https://aakinshin.net/tags/nuget/ class="badge badge-info">NuGet</a></span><br><br><p>I&rsquo;m the guy who develops the NuGet manager in <a href=https://www.jetbrains.com/rider/>Rider</a>.
It&rsquo;s not ready yet, there are some bugs here and there, but it already works pretty well.
The feature which I am most proud of is smart and fast search:</p><div class=mx-auto><img class="mx-auto d-block" width=400 src=/img/posts/dotnet/rider-nuget-search/front.gif></div><p>Today I want to share with you some technical details about how it was implemented.</p><br><a href=/posts/rider-nuget-search/>Read more</a><br><br><hr></div><div class=blog-post><h2 class=blog-post-title><a href=/posts/nuget2-and-directoryseparatorchar/>NuGet2 and a DirectorySeparatorChar bug</a></h2><span class=blog-post-meta><svg class="fai"><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2017-02-06>February 6, 2017</time>
&nbsp;&nbsp;<svg class="fai"><use xlink:href="/img/fa/all.svg#tag"/></svg>
<a href=https://aakinshin.net/tags/programming/ class="badge badge-info">Programming</a>
<a href=https://aakinshin.net/tags/dotnet/ class="badge badge-info">.NET</a>
<a href=https://aakinshin.net/tags/rider/ class="badge badge-info">Rider</a>
<a href=https://aakinshin.net/tags/bugs/ class="badge badge-info">Bugs</a>
<a href=https://aakinshin.net/tags/performance/ class="badge badge-info">Performance</a>
<a href=https://aakinshin.net/tags/nuget/ class="badge badge-info">NuGet</a></span><br><br><p>In <a href=https://www.jetbrains.com/rider/>Rider</a>, we care a lot about performance.
I like to improve the application responsiveness and do interesting optimizations all the time.
Rider is already well-optimized, and it&rsquo;s often hard to make significant performance improvements, so usually I do micro-optimizations which do not have a very big impact on the whole application.
However, sometimes it&rsquo;s possible to improve the speed of a feature 100 times with just a few lines of code.</p><p>Rider is based on <a href=https://www.jetbrains.com/resharper/>ReSharper</a>, so we have a lot of cool features out of the box.
One of these features is <a href=https://www.jetbrains.com/help/resharper/2016.3/Code_Analysis__Solution-Wide_Analysis.html>Solution-Wide Analysis</a>
which lets you constantly keep track of issues in your solution.
Sometimes, solution-wide analysis takes a lot of time to run because there are many files which should be analyzed.
Of course, it works super fast on small and projects.</p><p>Let&rsquo;s talk about a performance bug (<a href=https://youtrack.jetbrains.com/issue/RIDER-3742>#RIDER-3742</a>) that we recently had.</p><ul><li><em>Repro:</em> Open Rider, create a new &ldquo;ASP .NET MVC Application&rdquo;, enable solution wide-analysis.</li><li><em>Expected:</em> The analysis should take 1 second.</li><li><em>Actual:</em> The analysis takes 1 second on Windows and <strong>2 minutes</strong> on Linux and MacOS.</li></ul><br><a href=/posts/nuget2-and-directoryseparatorchar/>Read more</a><br><br><hr></div><div class=blog-post><h2 class=blog-post-title><a href=/posts/perfex-div/>Performance exercise: Division</a></h2><span class=blog-post-meta><svg class="fai"><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2016-12-26>December 26, 2016</time>
&nbsp;&nbsp;<svg class="fai"><use xlink:href="/img/fa/all.svg#tag"/></svg>
<a href=https://aakinshin.net/tags/programming/ class="badge badge-info">Programming</a>
<a href=https://aakinshin.net/tags/case-study/ class="badge badge-info">Case study</a>
<a href=https://aakinshin.net/tags/dotnet/ class="badge badge-info">.NET</a>
<a href=https://aakinshin.net/tags/performanceexercise/ class="badge badge-info">PerformanceExercise</a>
<a href=https://aakinshin.net/tags/benchmarking/ class="badge badge-info">Benchmarking</a>
<a href=https://aakinshin.net/tags/math/ class="badge badge-info">Math</a></span><br><br><p>In the previous post, we <a href=/en/blog/dotnet/perfex-min/>discussed</a> the performance space of the minimum function
which was implemented via a simple ternary operator and with the help of bit magic.
Now we continue to talk about performance and bit hacks.
In particular, we will divide a positive number by three:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=kt>uint</span> <span class=n>Div3Simple</span><span class=p>(</span><span class=kt>uint</span> <span class=n>n</span><span class=p>)</span>   <span class=p>=&gt;</span> <span class=n>n</span> <span class=p>/</span> <span class=m>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>uint</span> <span class=n>Div3BitHacks</span><span class=p>(</span><span class=kt>uint</span> <span class=n>n</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=kt>uint</span><span class=p>)((</span><span class=n>n</span> <span class=p>*</span> <span class=p>(</span><span class=kt>ulong</span><span class=p>)</span><span class=m>0xAAAAAAAB</span><span class=p>)</span> <span class=p>&gt;&gt;</span> <span class=m>33</span><span class=p>);</span>
</span></span></code></pre></div><p>As usual, it&rsquo;s hard to say which method is faster in advanced because the performance depends on the environment.
Here are some interesting results:</p><table class="table table-sm"><tr><th></th><th>Simple</th><th>BitHacks</th></tr><tr><th>LegacyJIT-x86</th><td class=norm>≈8.3ns</td><td class=fast>≈2.6ns</td></tr><tr><th>LegacyJIT-x64</th><td class=fast>≈2.6ns</td><td class=fast>≈1.7ns</td></tr><tr><th>RyuJIT-x64</th><td class=norm>≈6.9ns</td><td class=fast>≈1.5ns</td></tr><tr><th>Mono4.6.2-x86</th><td class=norm>≈8.5ns</td><td class=slow>≈14.4ns</td></tr><tr><th>Mono4.6.2-x64</th><td class=norm>≈8.3ns</td><td class=fast>≈2.8ns</td></tr></table><br><a href=/posts/perfex-div/>Read more</a><br><br><hr></div></div><div class=paginator><ul class="pagination pagination-default"><li class=page-item><a href=/ aria-label=First class=page-link role=button><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/page/14/ aria-label=Previous class=page-link role=button><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a href=/page/13/ aria-label="Page 13" class=page-link role=button>13</a></li><li class=page-item><a href=/page/14/ aria-label="Page 14" class=page-link role=button>14</a></li><li class="page-item active"><a aria-current=page aria-label="Page 15" class=page-link role=button>15</a></li><li class=page-item><a href=/page/16/ aria-label="Page 16" class=page-link role=button>16</a></li><li class=page-item><a href=/page/17/ aria-label="Page 17" class=page-link role=button>17</a></li><li class=page-item><a href=/page/16/ aria-label=Next class=page-link role=button><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/18/ aria-label=Last class=page-link role=button><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></main></div><footer class="blog-footer mt-auto"><div class=container><p>&copy; 2013&mdash;2022 Andrey Akinshin
|
<a href=https://github.com/AndreyAkinshin><svg class="fai"><title>GitHub</title><use xlink:href="/img/fa/all.svg#github"/></svg></a><a href=https://twitter.com/andrey_akinshin><svg class="fai"><title>Twitter</title><use xlink:href="/img/fa/all.svg#twitter"/></svg></a><a href=https://aakinshin.net/posts/index.xml><svg class="fai"><title>RSS</title><use xlink:href="/img/fa/all.svg#rss"/></svg></a>|
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></p></div></footer><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.1/anchor.min.js integrity="sha512-zPB79j2C+3sFS9zcA3vg/z6bVKzJVEyu9pY5w89akQRys76zpAT2t6S3wZKla3QQ14O5l/Yt0RUQ/DHXx82Y5g==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://aakinshin.net/js/theme-after.min.29520a8e1176193da7ea4e6cb56cf9b3e634b867c9979234d8dafb5ab61dd494.js></script>
<script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script></body></html>