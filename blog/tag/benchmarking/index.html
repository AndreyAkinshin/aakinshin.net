<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="description" content="Andrey Akinshin">
    <meta name="author" content="Andrey Akinshin">
    <link href="/img/favicon.ico" rel="icon" type="image/x-icon"/>
    <meta name="keywords" content=''>

    <title>Andrey Akinshin</title>

    <!-- Bootstrap CSS -->
    <link href="/css/lumen-bootstrap.min.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/minty-bootstrap.min.css" rel="stylesheet" type="text/css" media="all" disabled>
    <link href="/css/sketchy-bootstrap.min.css" rel="stylesheet" type="text/css" media="all" disabled>
    <link href="/css/slate-bootstrap.min.css" rel="stylesheet" type="text/css" media="all" disabled>
    <link href="/css/solar-bootstrap.min.css" rel="stylesheet" type="text/css" media="all" disabled>
    <link href="/css/superhero-bootstrap.min.css" rel="stylesheet" type="text/css" media="all" disabled>

    <!-- Highlight.js -->
    <link href="/css/github-highlight.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/hopscotch-highlight.css" rel="stylesheet" type="text/css" media="all" disabled>
    <link href="/css/solarized-highlight.css" rel="stylesheet" type="text/css" media="all" disabled>
    <link href="/css/darcula-highlight.css" rel="stylesheet" type="text/css" media="all" disabled>
    
    <!-- Custom styles -->
    <link href="/css/about.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/blog.css" rel="stylesheet" type="text/css" media="all">

    <!-- Load theme -->
    <script src="/js/load-theme.js"></script>

    <!-- Feeds -->
    <link href="/en/rss.xml" type="application/rss+xml" rel="alternate" title="Blog RSS Feed" />
    <link href="/en/atom.xml" type="application/atom+xml" rel="alternate" title="Blog ATOM Feed" />

    <!-- Google analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-41419012-5', 'auto');
      ga('send', 'pageview');
    </script>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
        (function (d, w, c) {
            (w[c] = w[c] || []).push(function() {
                try {
                    w.yaCounter28700916 = new Ya.Metrika({
                        id:28700916,
                        clickmap:true,
                        trackLinks:true,
                        accurateTrackBounce:true,
                        webvisor:true,
                        trackHash:true
                    });
                } catch(e) { }
            });

            var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function () { n.parentNode.insertBefore(s, n); };
            s.type = "text/javascript";
            s.async = true;
            s.src = "https://mc.yandex.ru/metrika/watch.js";

            if (w.opera == "[object Opera]") {
                d.addEventListener("DOMContentLoaded", f, false);
            } else { f(); }
        })(document, window, "yandex_metrika_callbacks");
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/28700916" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->

    <!-- jQuery -->
    <script src="/js/jquery-3.2.1.slim.min.js"></script>
  </head>

  <body>
    <div class="bg-primary">
      <div class="container bg-primary">
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" id="nav-link-blog" href="/blog/">Blog</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="nav-link-blog-content" href="/blog/content/">Content</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="nav-link-about" href="/about/">About author</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href='/ru/blog/tag/benchmarking/'>Russian version</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Theme</a>
              <div class="dropdown-menu">
                  <h6 class="dropdown-header" style="text-align: center">Light</h6>
                  <a class="dropdown-item" href="#" onclick="setTheme('lumen', 'github');">lumen</a>
                  <a class="dropdown-item" href="#" onclick="setTheme('sketchy', 'github');">sketchy</a>
                  <a class="dropdown-item" href="#" onclick="setTheme('minty', 'github');">minty</a>
                  <div class="dropdown-divider"></div>
                  <h6 class="dropdown-header" style="text-align: center">Dark</h6>
                  <a class="dropdown-item" href="#" onclick="setTheme('solar', 'solarized');">solar</a>
                  <a class="dropdown-item" href="#" onclick="setTheme('slate', 'darcula');">slate</a>
                  <a class="dropdown-item" href="#" onclick="setTheme('superhero', 'hopscotch');">superhero</a>
              </div>
            </li>
          </ul>
        </nav>
      </div>
    </div>

    <div class="container">
      <div class="blog-main">

<h1 id="benchmarking">Posts about Benchmarking</h1>
    <div class="blog-post">
        <h2 class="blog-post-title"><a href='/blog/post/perfex-div/'>Performance exercise: Division</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> December 26, 2016.
          <b>Tags:</b>
                <a href="/blog/tag/dotnet"><span class="badge badge-pill badge-info">.NET</span></a>
                <a href="/blog/tag/performanceexercise"><span class="badge badge-pill badge-info">PerformanceExercise</span></a>
                <a href="/blog/tag/benchmarking"><span class="badge badge-pill badge-info">Benchmarking</span></a>
                <a href="/blog/tag/math"><span class="badge badge-pill badge-info">Math</span></a>
        </span><br /><br />
        <p>In the previous post, we <a href="/en/blog/dotnet/perfex-min/">discussed</a> the performance space of the minimum function
which was implemented via a simple ternary operator and with the help of bit magic.
Now we continue to talk about performance and bit hacks.
In particular, we will divide a positive number by three:</p>
<pre><code class="language-cs">uint Div3Simple(uint n)   =&gt; n / 3;
uint Div3BitHacks(uint n) =&gt; (uint)((n * (ulong)0xAAAAAAAB) &gt;&gt; 33);
</code></pre>
<p>As usual, it's hard to say which method is faster in advanced because the performance depends on the environment.
Here are some interesting results:</p>
<table class="table table-sm">
  <tr> <th></th>              <th>Simple</th>              <th>BitHacks</th>             </tr>
  <tr> <th>LegacyJIT-x86</th> <td class="norm">≈8.3ns</td> <td class="fast">≈2.6ns</td>  </tr>
  <tr> <th>LegacyJIT-x64</th> <td class="fast">≈2.6ns</td> <td class="fast">≈1.7ns</td>  </tr>
  <tr> <th>RyuJIT-x64   </th> <td class="norm">≈6.9ns</td> <td class="fast">≈1.5ns</td>  </tr>
  <tr> <th>Mono4.6.2-x86</th> <td class="norm">≈8.5ns</td> <td class="slow">≈14.4ns</td> </tr>
  <tr> <th>Mono4.6.2-x64</th> <td class="norm">≈8.3ns</td> <td class="fast">≈2.8ns</td>  </tr>
</table>
</p>
        <a href='/blog/post/perfex-div/'>Read more</a><br /><br />
        <hr />
    </div>
    <div class="blog-post">
        <h2 class="blog-post-title"><a href='/blog/post/perfex-min/'>Performance exercise: Minimum</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> December 20, 2016.
          <b>Tags:</b>
                <a href="/blog/tag/dotnet"><span class="badge badge-pill badge-info">.NET</span></a>
                <a href="/blog/tag/performanceexercise"><span class="badge badge-pill badge-info">PerformanceExercise</span></a>
                <a href="/blog/tag/benchmarking"><span class="badge badge-pill badge-info">Benchmarking</span></a>
                <a href="/blog/tag/math"><span class="badge badge-pill badge-info">Math</span></a>
        </span><br /><br />
        <p>Performance is tricky. Especially, if you are working with very fast operations. In today benchmarking exercise, we will try to measure performance of two simple methods which calculate minimum of two numbers. Sounds easy? Ok, let's do it, here are our guinea pigs for today:</p>
<pre><code class="language-cs">int MinTernary(int x, int y)  =&gt; x &lt; y ? x : y;
int MinBitHacks(int x, int y) =&gt; x &amp; ((x - y) &gt;&gt; 31) | y &amp; (~(x - y) &gt;&gt; 31);
</code></pre>
<p>And here are some results:</p>
<table class="table table-sm">
  <style type="text/css" scoped>
    td.slow { color: #ff4444; } 
    td.fast { color: #00C851; }
  </style>
  
  <tr> <th></th> <th colspan="2">Random</th>        <th colspan="2">Const</th>          </tr>
  <tr> <th></th> <th>Ternary</th> <th>BitHacks</th> <th>Ternary</th> <th>BitHacks</th>  </tr>
  <tr> <th>LegacyJIT-x86</th>
       <td class="slow">≈643µs</td>
       <td class="fast">≈227µs</td>
       <td class="fast">≈160µs</td>
       <td class="slow">≈226µs</td>
  </tr>
  <tr> <th>LegacyJIT-x64</th>
       <td class="slow">≈450µs</td>
       <td class="fast">≈123µs</td>
       <td class="fast">≈68µs</td>
       <td class="slow">≈123µs</td>
  </tr>
  <tr> <th>RyuJIT-x64</th>
       <td class="slow">≈594µs</td>
       <td class="fast">≈241µs</td>
       <td class="fast">≈180µs</td>
       <td class="slow">≈241µs</td>
  </tr>
  <tr> <th>Mono-x64</th>
       <td class="fast">≈203µs</td>
       <td class="slow">≈283µs</td>
       <td class="fast">≈204µs</td>
       <td class="slow">≈282µs</td>
  </tr>
</table>
<p>What's going on here? Let's discuss it in detail.</p>
</p>
        <a href='/blog/post/perfex-min/'>Read more</a><br /><br />
        <hr />
    </div>
</div>
    </div>

    <footer class="blog-footer bg-light">
      <div class="container">
        <p>&copy; 2013–2018 Andrey Akinshin</p>
      </div>
    </footer>

    <!-- jQuery first (header), then popper, then Bootstrap JS. -->
    <script src="/js/popper.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <!-- Other scripts -->
    <script src="/js/highlight.pack.js"></script>
    <script src="/js/anchor.min.js"></script>
    <script src="/js/custom.js"></script>
  </body>
</html>
