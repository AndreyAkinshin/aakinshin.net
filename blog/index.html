<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="description" content="Andrey Akinshin&#39;s blog">
    <meta name="author" content="Andrey Akinshin">
    <link href="/img/favicon.ico" rel="icon" type="image/x-icon"/>
    <meta name="keywords" content=''>

    <title>Andrey Akinshin&#39;s blog</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

    <!-- Custom styles -->
    <link href="/css/about.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/blog.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/highlight.css" rel="stylesheet" type="text/css" media="all">

    <!-- Feeds -->
    <link href="/en/rss.xml" type="application/rss+xml" rel="alternate" title="Blog RSS Feed" />
    <link href="/en/atom.xml" type="application/atom+xml" rel="alternate" title="Blog ATOM Feed" />

    <!-- Google analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-41419012-5', 'auto');
      ga('send', 'pageview');
    </script>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter28700916 = new Ya.Metrika({id:28700916,
                        clickmap:true,
                        trackLinks:true,
                        accurateTrackBounce:true});
            } catch(e) { }
        });
        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";
        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
    </script>
    <!-- /Yandex.Metrika counter -->
    <!-- Disqus -->
    <script id="dsq-count-scr" src="//aakinshinnet-en.disqus.com/count.js" async></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
  </head>

  <body>
     <div class="blog-masthead">
      <div class="container">
        <nav class="nav blog-nav">
          <a class="nav-link" id="nav-link-blog" href="/blog/">Blog</a>
          <a class="nav-link" id="nav-link-blog-content" href="/blog/content/">Content</a>
          <a class="nav-link" id="nav-link-about" href="/about/">About author</a>
          <a class="nav-link" href='/ru/blog/'>Russian version</a>
        </nav>
      </div>
    </div>

    <div class="container">
      <div class="blog-main">
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/blog/post/reflecting-on-performance-testing/'>Reflecting on performance testing</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> August 01, 2017.
          <b>Tags:</b>
                <a href="/blog/tag/performance"><span class="badge badge-pill badge-info">Performance</span></a>
                <a href="/blog/tag/performancetesting"><span class="badge badge-pill badge-info">PerformanceTesting</span></a>
                <a href="/blog/tag/rider"><span class="badge badge-pill badge-info">Rider</span></a>
                <a href="/blog/tag/benchmarkdotnet"><span class="badge badge-pill badge-info">BenchmarkDotNet</span></a>
        </span><br /><br />
        <p>Performance is an important feature for many projects.
Unfortunately, it's an all too common situation when a developer accidentally spoils the performance adding some new code.
After a series of such incidents, people often start to think about performance regression testing.</p>
<p>As developers, we write unit tests all the time.
These tests check that our business logic work as designed and that new features don't break existing code.
It looks like a good idea to write some perf tests as well, which will verify that we don't have any performance regressions.</p>
<p>Turns out this is harder than it sounds.
A lot of developers don't write perf tests at all.
Some teams write perf tests, but almost all of them use their own infrastructure for analysis
(which is not a bad thing in general because it's usually designed for specific projects and requirements).
There are a lot of books about test-driven development (TDD),
but there are no books about performance-driven development (PDD).
There are well-known libraries for unit-testing (like xUnit/NUnit/MSTest for .NET),
but there are almost no libraries for performance regression testing.
Yeah, of course, there are <em>some</em> libraries which you can use.
But there are troubles with <em>well-known all recognized</em> libraries, approaches, and tools.
Ask your colleagues about it: some of them will give you different answers, the rest of them will start Googling it.</p>
<p>There is no common understanding of what performance testing should look like.
This situation exists because it's really hard to develop a solution which solves <em>all problems</em> for <em>all kind of projects</em>.
However, it doesn't mean that we shouldn't try.
And we should try, we should share our experience and discuss best practices.</p>
</p>
        <a href='/blog/post/reflecting-on-performance-testing/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/blog/post/reflecting-on-performance-testing/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/blog/post/stephen-toub-benchmarks-part1/'>Measuring Performance Improvements in .NET Core with BenchmarkDotNet (Part 1)</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> June 09, 2017.
          <b>Tags:</b>
                <a href="/blog/tag/dotnet"><span class="badge badge-pill badge-info">.NET</span></a>
                <a href="/blog/tag/csharp"><span class="badge badge-pill badge-info">C#</span></a>
                <a href="/blog/tag/benchmarkdotnet"><span class="badge badge-pill badge-info">BenchmarkDotNet</span></a>
                <a href="/blog/tag/benchmarks"><span class="badge badge-pill badge-info">benchmarks</span></a>
                <a href="/blog/tag/coreclr"><span class="badge badge-pill badge-info">CoreCLR</span></a>
        </span><br /><br />
        <p>A few days ago <a href="https://github.com/stephentoub">Stephen Toub</a> published a great post
at the <a href="https://blogs.msdn.microsoft.com/dotnet/">Microsoft .NET Blog</a>:
<a href="https://blogs.msdn.microsoft.com/dotnet/2017/06/07/performance-improvements-in-net-core/">Performance Improvements in .NET Core</a>.
He showed some significant performance changes in .NET Core 2.0 Preview 1 (compared with .NET Framework 4.7).
The .NET Core uses RyuJIT for generating assembly code.
When I first tried RyuJIT (e.g.,
<a href="https://blogs.msdn.microsoft.com/dotnet/2014/02/27/ryujit-ctp2-getting-ready-for-prime-time/">CTP2</a>,
<a href="https://blogs.msdn.microsoft.com/clrcodegeneration/2014/10/30/ryujit-ctp5-getting-closer-to-shipping-and-with-better-simd-support/">CTP5</a>, 2014),
I wasn't excited about this: the preview versions had some bugs, and it worked slowly on my applications.
However, the idea of a rethought and open-source JIT-compiler was a huge step forward and investment in the future.
RyuJIT had been developed very actively in recent years: not only by Microsoft but with the help of the community.
I'm still not happy about the generated assembly code in some methods, but I have to admit that the RyuJIT (as a part of .NET Core) works pretty well today:
it shows a good performance level not only on artificial benchmarks but also on real user code.
Also, there are a lot of changes
not only in <a href="https://github.com/dotnet/coreclr">dotnet/coreclr</a> (the .NET Core runtime),
but also in <a href="https://github.com/dotnet/corefx">dotnet/corefx</a> (the .NET Core foundational libraries).
It's very nice to watch how the community helps to optimize well-used classes which have not changed for years.</p>
<p>Now let's talk about benchmarks.
For the demonstration, Stephen wrote a set of handwritten benchmarks.
A few people (in
<a href="https://blogs.msdn.microsoft.com/dotnet/2017/06/07/performance-improvements-in-net-core/#comments">comments</a> and on <a href="https://news.ycombinator.com/item?id=14507936">HackerNews</a>)
asked about <a href="https://github.com/dotnet/BenchmarkDotNet">BenchmarkDotNet</a> regarding these samples (as a better tool for performance measurements).
So, I decided to try all these benchmarks on BenchmarkDotNet.</p>
<p>In this post, we will discuss
how can BenchmarkDotNet help in such performance investigations,
which benchmarking approaches (and when) are better to use,
and how can we improve these measurements.</p>
</p>
        <a href='/blog/post/stephen-toub-benchmarks-part1/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/blog/post/stephen-toub-benchmarks-part1/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/blog/post/bdn-v0_10_7/'>BenchmarkDotNet v0.10.7</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> June 05, 2017.
          <b>Tags:</b>
                <a href="/blog/tag/dotnet"><span class="badge badge-pill badge-info">.NET</span></a>
                <a href="/blog/tag/csharp"><span class="badge badge-pill badge-info">C#</span></a>
                <a href="/blog/tag/benchmarkdotnet"><span class="badge badge-pill badge-info">BenchmarkDotNet</span></a>
                <a href="/blog/tag/benchmarking"><span class="badge badge-pill badge-info">benchmarking</span></a>
        </span><br /><br />
        <p>BenchmarkDotNet v0.10.7 has been released.
In this post, I will briefly cover the following features:</p>
<ul>
<li>LINQPad support</li>
<li>Filters and categories</li>
<li>Updated Setup/Cleanup attributes</li>
<li>Better Value Types support</li>
<li>Building Sources on Linux</li>
</ul>
</p>
        <a href='/blog/post/bdn-v0_10_7/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/blog/post/bdn-v0_10_7/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/blog/post/namedmutex-on-mono/'>A bug story about named mutex on Mono</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> February 13, 2017.
          <b>Tags:</b>
                <a href="/blog/tag/dotnet"><span class="badge badge-pill badge-info">.NET</span></a>
                <a href="/blog/tag/rider"><span class="badge badge-pill badge-info">Rider</span></a>
                <a href="/blog/tag/bugs"><span class="badge badge-pill badge-info">Bugs</span></a>
                <a href="/blog/tag/xplat"><span class="badge badge-pill badge-info">Xplat</span></a>
                <a href="/blog/tag/mono"><span class="badge badge-pill badge-info">Mono</span></a>
                <a href="/blog/tag/coreclr"><span class="badge badge-pill badge-info">CoreCLR</span></a>
        </span><br /><br />
        <p>When you write some multithreading magic on .NET,
you can use a cool synchronization primitive called <a href="https://msdn.microsoft.com/en-us/library/system.threading.mutex(v=vs.110).aspx">Mutex</a>:</p>
<pre><code class="language-cs">var mutex = new Mutex(false, &quot;Global\\MyNamedMutex&quot;);
</code></pre>
<p>You also can make it <a href="https://msdn.microsoft.com/en-us/library/f55ddskf(v=vs.110).aspx">named</a> (and share the mutex between processes)
which works perfectly on Windows:</p>
<div class="mx-auto">
  <img class="mx-auto d-block" width="600" src="/img/posts/dotnet/namedmutex-on-mono/front.png" />
</div>
<p>However, today the .NET Framework is cross-platform, so this code should work on any operation system.
What will happen if you use named mutex on Linux or MacOS with the help of Mono or CoreCLR?
Is it possible to create some tricky bug based on this case?
Of course, it does.
Today I want to tell you a story about such bug in <a href="https://www.jetbrains.com/rider/">Rider</a> which was a headache for several weeks.</p>
</p>
        <a href='/blog/post/namedmutex-on-mono/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/blog/post/namedmutex-on-mono/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/blog/post/invaliddataexception-in-getprocesses/'>InvalidDataException in Process.GetProcesses</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> February 10, 2017.
          <b>Tags:</b>
                <a href="/blog/tag/dotnet"><span class="badge badge-pill badge-info">.NET</span></a>
                <a href="/blog/tag/rider"><span class="badge badge-pill badge-info">Rider</span></a>
                <a href="/blog/tag/bugs"><span class="badge badge-pill badge-info">Bugs</span></a>
                <a href="/blog/tag/xplat"><span class="badge badge-pill badge-info">Xplat</span></a>
                <a href="/blog/tag/coreclr"><span class="badge badge-pill badge-info">CoreCLR</span></a>
        </span><br /><br />
        <p>Consider the following program:</p>
<pre><code class="language-cs">public static void Main(string[] args)
{
    try
    {
        Process.GetProcesses();
    }
    catch (Exception e)
    {
        Console.WriteLine(e);
    }
}
</code></pre>
<p>It seems that all exceptions should be caught.
However, <em>sometimes</em>, I had the following exception on Linux with <code>dotnet cli-1.0.0-preview2</code>:</p>
<pre><code>$ dotnet run
System.IO.InvalidDataException: Found invalid data while decoding.
   at System.IO.StringParser.ParseNextChar()
   at Interop.procfs.TryParseStatFile(String statFilePath, ParsedStat&amp; result, ReusableTextReader reusableReader)
   at System.Diagnostics.ProcessManager.CreateProcessInfo(ParsedStat procFsStat, ReusableTextReader reusableReader)
   at System.Diagnostics.ProcessManager.CreateProcessInfo(Int32 pid, ReusableTextReader reusableReader)
   at System.Diagnostics.ProcessManager.GetProcessInfos(String machineName)
   at System.Diagnostics.Process.GetProcesses(String machineName)
   at System.Diagnostics.Process.GetProcesses()
   at DotNetCoreConsoleApplication.Program.Main(String[] args) in /home/akinshin/Program.cs:line 12
</code></pre>
<p>How is that possible?</p>
</p>
        <a href='/blog/post/invaliddataexception-in-getprocesses/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/blog/post/invaliddataexception-in-getprocesses/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/blog/post/rider-nuget-search/'>Why is NuGet search in Rider so fast?</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> February 08, 2017.
          <b>Tags:</b>
                <a href="/blog/tag/dotnet"><span class="badge badge-pill badge-info">.NET</span></a>
                <a href="/blog/tag/rider"><span class="badge badge-pill badge-info">Rider</span></a>
                <a href="/blog/tag/nuget"><span class="badge badge-pill badge-info">NuGet</span></a>
        </span><br /><br />
        <p>I'm the guy who develops the NuGet manager in <a href="https://www.jetbrains.com/rider/">Rider</a>.
It's not ready yet, there are some bugs here and there, but it already works pretty well.
The feature which I am most proud of is smart and fast search:</p>
<div class="mx-auto">
  <img class="mx-auto d-block" width="400" src="/img/posts/dotnet/rider-nuget-search/front.gif" />
</div>
<p>Today I want to share with you some technical details about how it was implemented.</p>
</p>
        <a href='/blog/post/rider-nuget-search/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/blog/post/rider-nuget-search/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/blog/post/nuget2-and-directoryseparatorchar/'>NuGet2 and a DirectorySeparatorChar bug</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> February 06, 2017.
          <b>Tags:</b>
                <a href="/blog/tag/dotnet"><span class="badge badge-pill badge-info">.NET</span></a>
                <a href="/blog/tag/rider"><span class="badge badge-pill badge-info">Rider</span></a>
                <a href="/blog/tag/bugs"><span class="badge badge-pill badge-info">Bugs</span></a>
                <a href="/blog/tag/performance"><span class="badge badge-pill badge-info">Performance</span></a>
                <a href="/blog/tag/nuget"><span class="badge badge-pill badge-info">NuGet</span></a>
        </span><br /><br />
        <p>In <a href="https://www.jetbrains.com/rider/">Rider</a>, we care a lot about performance.
I like to improve the application responsiveness and do interesting optimizations all the time.
Rider is already well-optimized, and it's often hard to make significant performance improvements, so usually I do micro-optimizations which do not have a very big impact on the whole application.
However, sometimes it's possible to improve the speed of a feature 100 times with just a few lines of code.</p>
<p>Rider is based on <a href="https://www.jetbrains.com/resharper/">ReSharper</a>, so we have a lot of cool features out of the box.
One of these features is <a href="https://www.jetbrains.com/help/resharper/2016.3/Code_Analysis__Solution-Wide_Analysis.html">Solution-Wide Analysis</a>
which lets you constantly keep track of issues in your solution.
Sometimes, solution-wide analysis takes a lot of time to run because there are many files which should be analyzed.
Of course, it works super fast on small and projects.</p>
<p>Let's talk about a performance bug (<a href="https://youtrack.jetbrains.com/issue/RIDER-3742">#RIDER-3742</a>) that we recently had.</p>
<ul>
<li><em>Repro:</em> Open Rider, create a new &quot;ASP .NET MVC Application&quot;, enable solution wide-analysis.</li>
<li><em>Expected:</em> The analysis should take 1 second.</li>
<li><em>Actual:</em> The analysis takes 1 second on Windows and <strong>2 minutes</strong> on Linux and MacOS.</li>
</ul>
</p>
        <a href='/blog/post/nuget2-and-directoryseparatorchar/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/blog/post/nuget2-and-directoryseparatorchar/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/blog/post/perfex-div/'>Performance exercise: Division</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> December 26, 2016.
          <b>Tags:</b>
                <a href="/blog/tag/dotnet"><span class="badge badge-pill badge-info">.NET</span></a>
                <a href="/blog/tag/performanceexercise"><span class="badge badge-pill badge-info">PerformanceExercise</span></a>
                <a href="/blog/tag/benchmarking"><span class="badge badge-pill badge-info">Benchmarking</span></a>
                <a href="/blog/tag/math"><span class="badge badge-pill badge-info">Math</span></a>
        </span><br /><br />
        <p>In the previous post, we <a href="/en/blog/dotnet/perfex-min/">discussed</a> the performance space of the minimum function
which was implemented via a simple ternary operator and with the help of bit magic.
Now we continue to talk about performance and bit hacks.
In particular, we will divide a positive number by three:</p>
<pre><code class="language-cs">uint Div3Simple(uint n)   =&gt; n / 3;
uint Div3BitHacks(uint n) =&gt; (uint)((n * (ulong)0xAAAAAAAB) &gt;&gt; 33);
</code></pre>
<p>As usual, it's hard to say which method is faster in advanced because the performance depends on the environment.
Here are some interesting results:</p>
<table class="table table-sm">
  <tr> <th></th>              <th>Simple</th>              <th>BitHacks</th>             </tr>
  <tr> <th>LegacyJIT-x86</th> <td class="norm">≈8.3ns</td> <td class="fast">≈2.6ns</td>  </tr>
  <tr> <th>LegacyJIT-x64</th> <td class="fast">≈2.6ns</td> <td class="fast">≈1.7ns</td>  </tr>
  <tr> <th>RyuJIT-x64   </th> <td class="norm">≈6.9ns</td> <td class="fast">≈1.5ns</td>  </tr>
  <tr> <th>Mono4.6.2-x86</th> <td class="norm">≈8.5ns</td> <td class="slow">≈14.4ns</td> </tr>
  <tr> <th>Mono4.6.2-x64</th> <td class="norm">≈8.3ns</td> <td class="fast">≈2.8ns</td>  </tr>
</table>
</p>
        <a href='/blog/post/perfex-div/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/blog/post/perfex-div/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/blog/post/perfex-min/'>Performance exercise: Minimum</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> December 20, 2016.
          <b>Tags:</b>
                <a href="/blog/tag/dotnet"><span class="badge badge-pill badge-info">.NET</span></a>
                <a href="/blog/tag/performanceexercise"><span class="badge badge-pill badge-info">PerformanceExercise</span></a>
                <a href="/blog/tag/benchmarking"><span class="badge badge-pill badge-info">Benchmarking</span></a>
                <a href="/blog/tag/math"><span class="badge badge-pill badge-info">Math</span></a>
        </span><br /><br />
        <p>Performance is tricky. Especially, if you are working with very fast operations. In today benchmarking exercise, we will try to measure performance of two simple methods which calculate minimum of two numbers. Sounds easy? Ok, let's do it, here are our guinea pigs for today:</p>
<pre><code class="language-cs">int MinTernary(int x, int y)  =&gt; x &lt; y ? x : y;
int MinBitHacks(int x, int y) =&gt; x &amp; ((x - y) &gt;&gt; 31) | y &amp; (~(x - y) &gt;&gt; 31);
</code></pre>
<p>And here are some results:</p>
<table class="table table-sm">
  <style type="text/css" scoped>
    td.slow { color: #ff4444; } 
    td.fast { color: #00C851; }
  </style>
  
  <tr> <th></th> <th colspan="2">Random</th>        <th colspan="2">Const</th>          </tr>
  <tr> <th></th> <th>Ternary</th> <th>BitHacks</th> <th>Ternary</th> <th>BitHacks</th>  </tr>
  <tr> <th>LegacyJIT-x86</th>
       <td class="slow">≈643µs</td>
       <td class="fast">≈227µs</td>
       <td class="fast">≈160µs</td>
       <td class="slow">≈226µs</td>
  </tr>
  <tr> <th>LegacyJIT-x64</th>
       <td class="slow">≈450µs</td>
       <td class="fast">≈123µs</td>
       <td class="fast">≈68µs</td>
       <td class="slow">≈123µs</td>
  </tr>
  <tr> <th>RyuJIT-x64</th>
       <td class="slow">≈594µs</td>
       <td class="fast">≈241µs</td>
       <td class="fast">≈180µs</td>
       <td class="slow">≈241µs</td>
  </tr>
  <tr> <th>Mono-x64</th>
       <td class="fast">≈203µs</td>
       <td class="slow">≈283µs</td>
       <td class="fast">≈204µs</td>
       <td class="slow">≈282µs</td>
  </tr>
</table>
<p>What's going on here? Let's discuss it in detail.</p>
</p>
        <a href='/blog/post/perfex-min/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/blog/post/perfex-min/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/blog/post/stopwatch/'>Stopwatch under the hood</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> September 09, 2016.
          <b>Tags:</b>
                <a href="/blog/tag/dotnet"><span class="badge badge-pill badge-info">.NET</span></a>
                <a href="/blog/tag/hardware"><span class="badge badge-pill badge-info">Hardware</span></a>
                <a href="/blog/tag/timers"><span class="badge badge-pill badge-info">Timers</span></a>
                <a href="/blog/tag/internals"><span class="badge badge-pill badge-info">Internals</span></a>
        </span><br /><br />
        <p>In <a href="/en/blog/dotnet/datetime/">the previous post</a>, we discussed <code>DateTime</code>.
This structure can be used in situations when you don't need a good level of precision.
If you want to do high-precision time measurements, you need a better tool because <code>DateTime</code> has a small resolution and a big latency.
Also, time is tricky, you can create wonderful bugs if you don't understand how it works (see <a href="http://infiniteundo.com/post/25326999628/falsehoods-programmers-believe-about-time">Falsehoods programmers believe about time</a> and <a href="http://infiniteundo.com/post/25509354022/more-falsehoods-programmers-believe-about-time">More falsehoods programmers believe about time</a>).</p>
<p>In this post, we will briefly talk about the <a href="https://msdn.microsoft.com/library/system.diagnostics.stopwatch.aspx">Stopwatch</a> class:</p>
<ul>
<li>Which kind of hardware timers could be a base for <code>Stopwatch</code></li>
<li>High precision timestamp API on Windows and Linux</li>
<li>Latency and Resolution of <code>Stopwatch</code> in different environments</li>
<li>Common pitfalls: which kind of problems could we get trying to measure small time intervals</li>
</ul>
<p>If you are not a .NET developer, you can also find a lot of useful information in this post: mainly we will discuss low-level details of high-resolution timestamping (probably your favorite language also uses the same API).
As usual, you can also find useful links for further reading.</p>
</p>
        <a href='/blog/post/stopwatch/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/blog/post/stopwatch/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
</div>
<nav>
  <ul class="pagination">
          <li class="page-item disabled">
        <a class="page-link" href="#" aria-label="Previous">
          <span aria-hidden="true">&laquo;</span>
          <span class="sr-only">Previous</span>
        </a>
      </li>
            <li class="page-item active">
          <a class="page-link" href="/blog/">1 <span class="sr-only">(current)</span></a>
        </li>
        <li class="page-item"><a class="page-link" href="/blog/page/2/">2</a></li>
        <li class="page-item"><a class="page-link" href="/blog/page/3/">3</a></li>
        <li class="page-item"><a class="page-link" href="/blog/page/4/">4</a></li>
          <li class="page-item">
        <a class="page-link" href='/blog/page/2/' aria-label="Next">
          <span aria-hidden="true">&raquo;</span>
          <span class="sr-only">Next</span>
        </a>
      </li>
      </ul>
</nav>
<hr />
<p style="font-size:150%"><a href="/ru/blog/">More posts in Russian</a></p>
<p>Subscribe: <a href="/rss.xml">RSS</a> <a href="/atom.xml">Atom</a></p>
    </div>

    <footer class="blog-footer">
      <div class="container">
        <p>&copy; 2014–2017 Andrey Akinshin</p>
      </div>
    </footer>

    <!-- jQuery first (header), then Tether, then Bootstrap JS. -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
    <!-- Other scripts -->
    <script src="/js/highlight.pack.js"></script>
    <script src="/js/anchor.min.js"></script>
    <script src="/js/custom.js"></script>
  </body>
</html>
