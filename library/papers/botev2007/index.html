<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.123.8"><meta name=author content='Andrey Akinshin'><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content='Mathematics,Statistics,Kernel Density Estimation,Bandwidth Selection'><title>Kernel Density Estimator | Andrey Akinshin</title>
<meta name=description content="The last version (1.5.0.0) was released on 30 Dec 2015.
function [bandwidth,density,xmesh,cdf]=kde(data,n,MIN,MAX) % Reliable and extremely fast kernel density estimator for one-dimensional data; % Gaussian kernel is assumed and the bandwidth is chosen auto..."><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><script>localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><link href=https://aakinshin.net/css/main.min.beef8b4fb043af14c2883e35de1b55e76fb412aa04a92889080ed30141cda7b6.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"></head><body class="flex flex-col min-h-screen"><nav><div class="container flex flex-wrap items-center justify-between mx-auto max-w-6xl h-12 px-2 xs:px-6"><div class="flex items-center justify-start justify-self-start"><div class="flex nav-item h-12 w-12 items-center justify-center"><a class=text-white href=https://aakinshin.net/><svg class="fai w-5 h-5 pr-0 mb-0.5"><use xlink:href="/img/fa/all.svg#house-chimney"/></svg></a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/feed/>Feed</a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/library/>Library</a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/research-projects/>Research</a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/about/>About</a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/search/><svg class="fai w-5 h-5 pr-0 mb-0.5"><use xlink:href="/img/fa/all.svg#magnifying-glass"/></svg></a></div></div><button id=theme-toggle type=button title="Alt+Click to match OS color theme" class="nav-item p-3 content-center justify-self-end"><svg id="theme-toggle-dark-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001.0 1010.586 10.586z"/></svg><svg id="theme-toggle-light-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1A1 1 0 119 4V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707A1 1 0 1113.536 5.05l.707-.707a1 1 0 011.414.0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707A1 1 0 004.343 5.757l.707.707zm1.414 8.486-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"/></svg></button></div></nav><div class="main container mx-auto max-w-6xl px-6 flex-grow"><div class=main-post><h1 class=blog-post-title id=post-title><a href=https://aakinshin.net/library/>Library</a> /
Kernel Density Estimator</h1><div class="flex w-full"><div class=flex-grow><table class=meta-table><tr><td>Author</td><td><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/library/authors/zdravko-botev/>Zdravko Botev</a></div></td></tr><tr><td>Year</td><td><span class=label>2007</span></td></tr><tr><td>Links</td><td><a class=label-link href=https://nl.mathworks.com/matlabcentral/fileexchange/14034-kernel-density-estimator>Link</a></td></tr><tr><td>Tags</td><td><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/mathematics/><svg class="rating-icon"><use xlink:href="/img/fa/all.svg#math"/></svg>
Mathematics
</a><a class=label-link href=https://aakinshin.net/tags/statistics/><svg class="rating-icon"><use xlink:href="/img/fa/all.svg#statistics"/></svg>
Statistics
</a><a class=label-link href=https://aakinshin.net/tags/kernel-density-estimation/>Kernel Density Estimation
</a><a class=label-link href=https://aakinshin.net/tags/bandwidth-selection/>Bandwidth Selection</a></div></td></tr></table></div></div><hr><div class=main-content><p>The last version (1.5.0.0) was released on 30 Dec 2015.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-matlab data-lang=matlab><span class=line><span class=cl><span class=k>function</span><span class=w> </span>[bandwidth,density,xmesh,cdf]<span class=p>=</span><span class=nf>kde</span><span class=p>(</span>data,n,MIN,MAX<span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>% Reliable and extremely fast kernel density estimator for one-dimensional data;</span>
</span></span><span class=line><span class=cl><span class=c>%        Gaussian kernel is assumed and the bandwidth is chosen automatically;</span>
</span></span><span class=line><span class=cl><span class=c>%        Unlike many other implementations, this one is immune to problems</span>
</span></span><span class=line><span class=cl><span class=c>%        caused by multimodal densities with widely separated modes (see example). The</span>
</span></span><span class=line><span class=cl><span class=c>%        estimation does not deteriorate for multimodal densities, because we never assume</span>
</span></span><span class=line><span class=cl><span class=c>%        a parametric model for the data.</span>
</span></span><span class=line><span class=cl><span class=c>% INPUTS:</span>
</span></span><span class=line><span class=cl><span class=c>%     data    - a vector of data from which the density estimate is constructed;</span>
</span></span><span class=line><span class=cl><span class=c>%          n  - the number of mesh points used in the uniform discretization of the</span>
</span></span><span class=line><span class=cl><span class=c>%               interval [MIN, MAX]; n has to be a power of two; if n is not a power of two, then</span>
</span></span><span class=line><span class=cl><span class=c>%               n is rounded up to the next power of two, i.e., n is set to n=2^ceil(log2(n));</span>
</span></span><span class=line><span class=cl><span class=c>%               the default value of n is n=2^12;</span>
</span></span><span class=line><span class=cl><span class=c>%   MIN, MAX  - defines the interval [MIN,MAX] on which the density estimate is constructed;</span>
</span></span><span class=line><span class=cl><span class=c>%               the default values of MIN and MAX are:</span>
</span></span><span class=line><span class=cl><span class=c>%               MIN=min(data)-Range/10 and MAX=max(data)+Range/10, where Range=max(data)-min(data);</span>
</span></span><span class=line><span class=cl><span class=c>% OUTPUTS:</span>
</span></span><span class=line><span class=cl><span class=c>%   bandwidth - the optimal bandwidth (Gaussian kernel assumed);</span>
</span></span><span class=line><span class=cl><span class=c>%     density - column vector of length &#39;n&#39; with the values of the density</span>
</span></span><span class=line><span class=cl><span class=c>%               estimate at the grid points;</span>
</span></span><span class=line><span class=cl><span class=c>%     xmesh   - the grid over which the density estimate is computed;</span>
</span></span><span class=line><span class=cl><span class=c>%             - If no output is requested, then the code automatically plots a graph of</span>
</span></span><span class=line><span class=cl><span class=c>%               the density estimate.</span>
</span></span><span class=line><span class=cl><span class=c>%        cdf  - column vector of length &#39;n&#39; with the values of the cdf</span>
</span></span><span class=line><span class=cl><span class=c>%  Reference:</span>
</span></span><span class=line><span class=cl><span class=c>% Kernel density estimation via diffusion</span>
</span></span><span class=line><span class=cl><span class=c>% Z. I. Botev, J. F. Grotowski, and D. P. Kroese (2010)</span>
</span></span><span class=line><span class=cl><span class=c>% Annals of Statistics, Volume 38, Number 5, pages 2916-2957.</span>
</span></span><span class=line><span class=cl><span class=c>%</span>
</span></span><span class=line><span class=cl><span class=c>%  Example:</span>
</span></span><span class=line><span class=cl><span class=c>%           data=[randn(100,1);randn(100,1)*2+35 ;randn(100,1)+55];</span>
</span></span><span class=line><span class=cl><span class=c>%              kde(data,2^14,min(data)-5,max(data)+5);</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=p>=</span><span class=n>data</span><span class=p>(:);</span> <span class=c>%make data a column vector</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>nargin</span><span class=o>&lt;</span><span class=mi>2</span> <span class=c>% if n is not supplied switch to the default</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span><span class=p>=</span><span class=mi>2</span>^<span class=mi>14</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl><span class=n>n</span><span class=p>=</span><span class=mi>2</span>^<span class=nb>ceil</span><span class=p>(</span><span class=nb>log2</span><span class=p>(</span><span class=n>n</span><span class=p>));</span> <span class=c>% round up n to the next power of 2;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>nargin</span><span class=o>&lt;</span><span class=mi>4</span> <span class=c>%define the default  interval [MIN,MAX]</span>
</span></span><span class=line><span class=cl>    <span class=n>minimum</span><span class=p>=</span><span class=n>min</span><span class=p>(</span><span class=n>data</span><span class=p>);</span> <span class=n>maximum</span><span class=p>=</span><span class=n>max</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Range</span><span class=p>=</span><span class=n>maximum</span><span class=o>-</span><span class=n>minimum</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>MIN</span><span class=p>=</span><span class=n>minimum</span><span class=o>-</span><span class=n>Range</span><span class=o>/</span><span class=mi>2</span><span class=p>;</span> <span class=n>MAX</span><span class=p>=</span><span class=n>maximum</span><span class=o>+</span><span class=n>Range</span><span class=o>/</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl><span class=c>% set up the grid over which the density estimate is computed;</span>
</span></span><span class=line><span class=cl><span class=n>R</span><span class=p>=</span><span class=n>MAX</span><span class=o>-</span><span class=n>MIN</span><span class=p>;</span> <span class=n>dx</span><span class=p>=</span><span class=n>R</span><span class=o>/</span><span class=p>(</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span> <span class=n>xmesh</span><span class=p>=</span><span class=n>MIN</span><span class=o>+</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=n>dx</span><span class=p>:</span><span class=n>R</span><span class=p>];</span> <span class=n>N</span><span class=p>=</span><span class=nb>length</span><span class=p>(</span><span class=n>unique</span><span class=p>(</span><span class=n>data</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=c>%bin the data uniformly using the grid defined above;</span>
</span></span><span class=line><span class=cl><span class=n>initial_data</span><span class=p>=</span><span class=n>histc</span><span class=p>(</span><span class=n>data</span><span class=p>,</span><span class=n>xmesh</span><span class=p>)</span><span class=o>/</span><span class=n>N</span><span class=p>;</span>  <span class=n>initial_data</span><span class=p>=</span><span class=n>initial_data</span><span class=o>/</span><span class=n>sum</span><span class=p>(</span><span class=n>initial_data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>a</span><span class=p>=</span><span class=n>dct1d</span><span class=p>(</span><span class=n>initial_data</span><span class=p>);</span> <span class=c>% discrete cosine transform of initial data</span>
</span></span><span class=line><span class=cl><span class=c>% now compute the optimal bandwidth^2 using the referenced method</span>
</span></span><span class=line><span class=cl><span class=n>I</span><span class=p>=[</span><span class=mi>1</span><span class=p>:</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>&#39;.^</span><span class=mi>2</span><span class=p>;</span> <span class=n>a2</span><span class=p>=(</span><span class=n>a</span><span class=p>(</span><span class=mi>2</span><span class=p>:</span><span class=k>end</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span><span class=p>)</span><span class=o>.^</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c>% use  fzero to solve the equation t=zeta*gamma^[5](t)</span>
</span></span><span class=line><span class=cl><span class=n>t_star</span><span class=p>=</span><span class=n>root</span><span class=p>(@(</span><span class=n>t</span><span class=p>)</span><span class=n>fixed_point</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>N</span><span class=p>,</span><span class=n>I</span><span class=p>,</span><span class=n>a2</span><span class=p>),</span><span class=n>N</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c>% smooth the discrete cosine transform of initial data using t_star</span>
</span></span><span class=line><span class=cl><span class=n>a_t</span><span class=p>=</span><span class=n>a</span><span class=o>.*</span><span class=nb>exp</span><span class=p>(</span><span class=o>-</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>&#39;.^</span><span class=mi>2</span><span class=o>*</span><span class=nb>pi</span>^<span class=mi>2</span><span class=o>*</span><span class=n>t_star</span><span class=o>/</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c>% now apply the inverse discrete cosine transform</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>nargout</span><span class=o>&gt;</span><span class=mi>1</span><span class=p>)</span><span class=o>|</span><span class=p>(</span><span class=n>nargout</span><span class=o>==</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>density</span><span class=p>=</span><span class=n>idct1d</span><span class=p>(</span><span class=n>a_t</span><span class=p>)</span><span class=o>/</span><span class=n>R</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl><span class=c>% take the rescaling of the data into account</span>
</span></span><span class=line><span class=cl><span class=n>bandwidth</span><span class=p>=</span><span class=nb>sqrt</span><span class=p>(</span><span class=n>t_star</span><span class=p>)</span><span class=o>*</span><span class=n>R</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>density</span><span class=p>(</span><span class=n>density</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>)=</span><span class=nb>eps</span><span class=p>;</span> <span class=c>% remove negatives due to round-off error</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>nargout</span><span class=o>==</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>figure</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span> <span class=n>plot</span><span class=p>(</span><span class=n>xmesh</span><span class=p>,</span><span class=n>density</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl><span class=c>% for cdf estimation</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>nargout</span><span class=o>&gt;</span><span class=mi>3</span>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=p>=</span><span class=mi>2</span><span class=o>*</span><span class=nb>pi</span>^<span class=mi>2</span><span class=o>*</span><span class=n>sum</span><span class=p>(</span><span class=n>I</span><span class=o>.*</span><span class=n>a2</span><span class=o>.*</span><span class=nb>exp</span><span class=p>(</span><span class=o>-</span><span class=n>I</span><span class=o>*</span><span class=nb>pi</span>^<span class=mi>2</span><span class=o>*</span><span class=n>t_star</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>t_cdf</span><span class=p>=(</span><span class=nb>sqrt</span><span class=p>(</span><span class=nb>pi</span><span class=p>)</span><span class=o>*</span><span class=n>f</span><span class=o>*</span><span class=n>N</span><span class=p>)</span>^<span class=p>(</span><span class=o>-</span><span class=mi>2</span><span class=o>/</span><span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c>% now get values of cdf on grid points using IDCT and cumsum function</span>
</span></span><span class=line><span class=cl>    <span class=n>a_cdf</span><span class=p>=</span><span class=n>a</span><span class=o>.*</span><span class=nb>exp</span><span class=p>(</span><span class=o>-</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>&#39;.^</span><span class=mi>2</span><span class=o>*</span><span class=nb>pi</span>^<span class=mi>2</span><span class=o>*</span><span class=n>t_cdf</span><span class=o>/</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>cdf</span><span class=p>=</span><span class=n>cumsum</span><span class=p>(</span><span class=n>idct1d</span><span class=p>(</span><span class=n>a_cdf</span><span class=p>))</span><span class=o>*</span><span class=p>(</span><span class=n>dx</span><span class=o>/</span><span class=n>R</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c>% take the rescaling into account if the bandwidth value is required</span>
</span></span><span class=line><span class=cl>    <span class=n>bandwidth_cdf</span><span class=p>=</span><span class=nb>sqrt</span><span class=p>(</span><span class=n>t_cdf</span><span class=p>)</span><span class=o>*</span><span class=n>R</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl><span class=c>%################################################################</span>
</span></span><span class=line><span class=cl><span class=k>function</span><span class=w>  </span>out<span class=p>=</span><span class=nf>fixed_point</span><span class=p>(</span>t,N,I,a2<span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>% this implements the function t-zeta*gamma^[l](t)</span>
</span></span><span class=line><span class=cl><span class=n>l</span><span class=p>=</span><span class=mi>7</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>f</span><span class=p>=</span><span class=mi>2</span><span class=o>*</span><span class=nb>pi</span>^<span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=n>l</span><span class=p>)</span><span class=o>*</span><span class=n>sum</span><span class=p>(</span><span class=n>I</span><span class=o>.^</span><span class=n>l</span><span class=o>.*</span><span class=n>a2</span><span class=o>.*</span><span class=nb>exp</span><span class=p>(</span><span class=o>-</span><span class=n>I</span><span class=o>*</span><span class=nb>pi</span>^<span class=mi>2</span><span class=o>*</span><span class=n>t</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>s</span><span class=p>=</span><span class=n>l</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=n>K0</span><span class=p>=</span><span class=n>prod</span><span class=p>([</span><span class=mi>1</span><span class=p>:</span><span class=mi>2</span><span class=p>:</span><span class=mi>2</span><span class=o>*</span><span class=n>s</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span><span class=o>/</span><span class=nb>sqrt</span><span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=nb>pi</span><span class=p>);</span>  <span class=n>const</span><span class=p>=(</span><span class=mi>1</span><span class=o>+</span><span class=p>(</span><span class=mi>1</span><span class=o>/</span><span class=mi>2</span><span class=p>)</span>^<span class=p>(</span><span class=n>s</span><span class=o>+</span><span class=mi>1</span><span class=o>/</span><span class=mi>2</span><span class=p>))</span><span class=o>/</span><span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=p>=(</span><span class=mi>2</span><span class=o>*</span><span class=n>const</span><span class=o>*</span><span class=n>K0</span><span class=o>/</span><span class=n>N</span><span class=o>/</span><span class=n>f</span><span class=p>)</span>^<span class=p>(</span><span class=mi>2</span><span class=o>/</span><span class=p>(</span><span class=mi>3</span><span class=o>+</span><span class=mi>2</span><span class=o>*</span><span class=n>s</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=p>=</span><span class=mi>2</span><span class=o>*</span><span class=nb>pi</span>^<span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=n>s</span><span class=p>)</span><span class=o>*</span><span class=n>sum</span><span class=p>(</span><span class=n>I</span><span class=o>.^</span><span class=n>s</span><span class=o>.*</span><span class=n>a2</span><span class=o>.*</span><span class=nb>exp</span><span class=p>(</span><span class=o>-</span><span class=n>I</span><span class=o>*</span><span class=nb>pi</span>^<span class=mi>2</span><span class=o>*</span><span class=n>time</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl><span class=n>out</span><span class=p>=</span><span class=n>t</span><span class=o>-</span><span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=n>N</span><span class=o>*</span><span class=nb>sqrt</span><span class=p>(</span><span class=nb>pi</span><span class=p>)</span><span class=o>*</span><span class=n>f</span><span class=p>)</span>^<span class=p>(</span><span class=o>-</span><span class=mi>2</span><span class=o>/</span><span class=mi>5</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl><span class=c>%##############################################################</span>
</span></span><span class=line><span class=cl><span class=k>function</span><span class=w> </span>out <span class=p>=</span><span class=w> </span><span class=nf>idct1d</span><span class=p>(</span>data<span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>% computes the inverse discrete cosine transform</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>nrows</span><span class=p>,</span><span class=n>ncols</span><span class=p>]=</span><span class=nb>size</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c>% Compute weights</span>
</span></span><span class=line><span class=cl><span class=n>weights</span> <span class=p>=</span> <span class=n>nrows</span><span class=o>*</span><span class=nb>exp</span><span class=p>(</span><span class=nb>i</span><span class=o>*</span><span class=p>(</span><span class=mi>0</span><span class=p>:</span><span class=n>nrows</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=nb>pi</span><span class=o>/</span><span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=n>nrows</span><span class=p>)).</span><span class=o>&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c>% Compute x tilde using equation (5.93) in Jain</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=p>=</span> <span class=nb>real</span><span class=p>(</span><span class=n>ifft</span><span class=p>(</span><span class=n>weights</span><span class=o>.*</span><span class=n>data</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=c>% Re-order elements of each column according to equations (5.93) and</span>
</span></span><span class=line><span class=cl><span class=c>% (5.94) in Jain</span>
</span></span><span class=line><span class=cl><span class=n>out</span> <span class=p>=</span> <span class=nb>zeros</span><span class=p>(</span><span class=n>nrows</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>out</span><span class=p>(</span><span class=mi>1</span><span class=p>:</span><span class=mi>2</span><span class=p>:</span><span class=n>nrows</span><span class=p>)</span> <span class=p>=</span> <span class=n>data</span><span class=p>(</span><span class=mi>1</span><span class=p>:</span><span class=n>nrows</span><span class=o>/</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>out</span><span class=p>(</span><span class=mi>2</span><span class=p>:</span><span class=mi>2</span><span class=p>:</span><span class=n>nrows</span><span class=p>)</span> <span class=p>=</span> <span class=n>data</span><span class=p>(</span><span class=n>nrows</span><span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=n>nrows</span><span class=o>/</span><span class=mi>2</span><span class=o>+</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c>%   Reference:</span>
</span></span><span class=line><span class=cl><span class=c>%      A. K. Jain, &#34;Fundamentals of Digital Image</span>
</span></span><span class=line><span class=cl><span class=c>%      Processing&#34;, pp. 150-153.</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl><span class=c>%##############################################################</span>
</span></span><span class=line><span class=cl><span class=k>function</span><span class=w> </span>data<span class=p>=</span><span class=nf>dct1d</span><span class=p>(</span>data<span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>% computes the discrete cosine transform of the column vector data</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>nrows</span><span class=p>,</span><span class=n>ncols</span><span class=p>]=</span> <span class=nb>size</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c>% Compute weights to multiply DFT coefficients</span>
</span></span><span class=line><span class=cl><span class=n>weight</span> <span class=p>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>;</span><span class=mi>2</span><span class=o>*</span><span class=p>(</span><span class=nb>exp</span><span class=p>(</span><span class=o>-</span><span class=nb>i</span><span class=o>*</span><span class=p>(</span><span class=mi>1</span><span class=p>:</span><span class=n>nrows</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=nb>pi</span><span class=o>/</span><span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=n>nrows</span><span class=p>))).</span><span class=o>&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=c>% Re-order the elements of the columns of x</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=p>=</span> <span class=p>[</span> <span class=n>data</span><span class=p>(</span><span class=mi>1</span><span class=p>:</span><span class=mi>2</span><span class=p>:</span><span class=k>end</span><span class=p>,:);</span> <span class=n>data</span><span class=p>(</span><span class=k>end</span><span class=p>:</span><span class=o>-</span><span class=mi>2</span><span class=p>:</span><span class=mi>2</span><span class=p>,:)</span> <span class=p>];</span>
</span></span><span class=line><span class=cl><span class=c>% Multiply FFT by weights:</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=p>=</span> <span class=nb>real</span><span class=p>(</span><span class=n>weight</span><span class=o>.*</span> <span class=n>fft</span><span class=p>(</span><span class=n>data</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>function</span><span class=w> </span>t<span class=p>=</span><span class=nf>root</span><span class=p>(</span>f,N<span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>% try to find smallest root whenever there is more than one</span>
</span></span><span class=line><span class=cl><span class=n>N</span><span class=p>=</span><span class=mi>50</span><span class=o>*</span><span class=p>(</span><span class=n>N</span><span class=o>&lt;</span><span class=p>=</span><span class=mi>50</span><span class=p>)</span><span class=o>+</span><span class=mi>1050</span><span class=o>*</span><span class=p>(</span><span class=n>N</span><span class=o>&gt;</span><span class=p>=</span><span class=mi>1050</span><span class=p>)</span><span class=o>+</span><span class=n>N</span><span class=o>*</span><span class=p>((</span><span class=n>N</span><span class=o>&lt;</span><span class=mi>1050</span><span class=p>)</span><span class=o>&amp;</span><span class=p>(</span><span class=n>N</span><span class=o>&gt;</span><span class=mi>50</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=n>tol</span><span class=p>=</span><span class=mi>10</span>^<span class=o>-</span><span class=mi>12</span><span class=o>+</span><span class=mf>0.01</span><span class=o>*</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>50</span><span class=p>)</span><span class=o>/</span><span class=mi>1000</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>flag</span><span class=p>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=n>flag</span><span class=o>==</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=p>=</span><span class=n>fzero</span><span class=p>(</span><span class=n>f</span><span class=p>,[</span><span class=mi>0</span><span class=p>,</span><span class=n>tol</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=n>flag</span><span class=p>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>catch</span>
</span></span><span class=line><span class=cl>        <span class=n>tol</span><span class=p>=</span><span class=n>min</span><span class=p>(</span><span class=n>tol</span><span class=o>*</span><span class=mi>2</span><span class=p>,.</span><span class=mi>1</span><span class=p>);</span> <span class=c>% double search interval</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>tol</span><span class=o>==</span><span class=p>.</span><span class=mi>1</span> <span class=c>% if all else fails</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=p>=</span><span class=n>fminbnd</span><span class=p>(@(</span><span class=n>x</span><span class=p>)</span><span class=nb>abs</span><span class=p>(</span><span class=n>f</span><span class=p>(</span><span class=n>x</span><span class=p>)),</span><span class=mi>0</span><span class=p>,.</span><span class=mi>1</span><span class=p>);</span> <span class=n>flag</span><span class=p>=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></div><h2 id=reference>Reference</h2><blockquote><p><i>Zdravko Botev</i> “Kernel Density Estimator” (2007)</p></blockquote><h2 id=abstract>Abstract</h2><blockquote><p>Reliable and extremely fast kernel density estimator for one-dimensional data; Gaussian kernel is assumed and the bandwidth is chosen automatically; Unlike many other implementations, this one is immune to problems caused by multimodal densities with widely separated modes (see example). The estimation does not deteriorate for multimodal densities, because we never assume a parametric model for the data (like those used in rules of thumb).</p></blockquote><h2 id=bib>Bib</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bib data-lang=bib><span class=line><span class=cl><span class=nc>@Article</span><span class=p>{</span><span class=nl>botev2007</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=na>title</span> <span class=p>=</span> <span class=s>{Kernel Density Estimator}</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=na>abstract</span> <span class=p>=</span> <span class=s>{Reliable and extremely fast kernel density estimator for one-dimensional data; Gaussian kernel is assumed and the bandwidth is chosen automatically; Unlike many other implementations, this one is immune to problems caused by multimodal densities with widely separated modes (see example). The estimation does not deteriorate for multimodal densities, because we never assume a parametric model for the data (like those used in rules of thumb).}</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=na>url</span> <span class=p>=</span> <span class=s>{https://nl.mathworks.com/matlabcentral/fileexchange/14034-kernel-density-estimator}</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=na>author</span> <span class=p>=</span> <span class=s>{Botev, Zdravko}</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=na>year</span> <span class=p>=</span> <span class=s>{2007}</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=na>note</span> <span class=p>=</span> <span class=s>{MATLAB Central File Exchange}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><br><br></div></div><script>var themeToggleDarkIcon=document.getElementById("theme-toggle-dark-icon"),themeToggleBtn,themeToggleLightIcon=document.getElementById("theme-toggle-light-icon");const imagesDark=document.querySelectorAll(".img-dark"),imagesLight=document.querySelectorAll(".img-light");localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(themeToggleLightIcon.classList.remove("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")})):(themeToggleDarkIcon.classList.remove("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")}));function toggleTheme(e){e?(document.documentElement.classList.add("dark"),themeToggleLightIcon.classList.remove("hidden"),themeToggleDarkIcon.classList.add("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")}),imagesLight.forEach(e=>{e.classList.add("hidden")})):(document.documentElement.classList.remove("dark"),themeToggleDarkIcon.classList.remove("hidden"),themeToggleLightIcon.classList.add("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")}),imagesDark.forEach(e=>{e.classList.add("hidden")}))}themeToggleBtn=document.getElementById("theme-toggle"),themeToggleBtn.addEventListener("click",function(){themeToggleDarkIcon.classList.toggle("hidden"),themeToggleLightIcon.classList.toggle("hidden"),imagesLight.forEach(e=>{e.classList.toggle("hidden")}),imagesDark.forEach(e=>{e.classList.toggle("hidden")}),event.altKey?(localStorage.removeItem("color-theme"),toggleTheme(window.matchMedia("(prefers-color-scheme: dark)").matches)):localStorage.getItem("color-theme")?localStorage.getItem("color-theme")==="light"?(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"))}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{if(localStorage.getItem("color-theme")===null){const t=e.matches?"dark":"light";toggleTheme(t==="dark")}})</script><footer class="z-20 p-4 md:p-6 mt-3 w-full border-t border-gray-200 shadow flex items-center justify-center dark:border-gray-600 bg-white dark:bg-zinc-800"><span class="dark:text-gray-400 text-center">© 2013—2024 <span class=whitespace-nowrap>Andrey Akinshin</span></span><ul class="flex flex-wrap items-center px-4 mb-1"><li><a href=https://github.com/AndreyAkinshin><svg class="fai fai-link w-5 h-5"><title>GitHub</title><use xlink:href="/img/fa/all.svg#github"/></svg></a></li><li><a href=https://twitter.com/andrey_akinshin><svg class="fai fai-link w-5 h-5"><title>Twitter</title><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></li><li><a href=https://aakinshin.net/posts/index.xml><svg class="fai fai-link w-5 h-5"><title>RSS</title><use xlink:href="/img/fa/all.svg#rss"/></svg></a></li></ul><div class=main-content><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></div></footer><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+=" has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script></body></html>