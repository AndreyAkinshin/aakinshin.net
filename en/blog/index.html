<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="Andrey Akinshin&#39;s blog">
    <meta name="author" content="Andrey Akinshin">
    <link href="/img/favicon.ico?v=2" rel="icon" type="image/x-icon"/>
    <meta name="keywords" content=''>

    <title>Andrey Akinshin&#39;s blog</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.3/css/bootstrap.min.css" integrity="sha384-MIwDKRSSImVFAZCVLtU0LMDdON6KVCrZHyVQQj6e8wIEJkW4tvwqXrbMIya1vriY" crossorigin="anonymous">

    <!-- Custom styles -->
    <link href="/css/about.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/blog.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/highlight.css" rel="stylesheet" type="text/css" media="all">

    <!-- Bootstrap scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js" integrity="sha384-THPy051/pYDQGanwU6poAc/hOdQxjnOEXzbT+OuUAFqNqFjL+4IGLBgCJC3ZOShY" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.2.0/js/tether.min.js" integrity="sha384-Plbmg8JY28KFelvJVai01l8WyZzrYWG825m+cZ0eDDS1f7d/js6ikvy1+X+guPIB" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.3/js/bootstrap.min.js" integrity="sha384-ux8v3A6CPtOTqOzMKiuo3d/DomGaaClxFYdCu2HPMBEkf6x2xiDyJ7gkXU0MWwaD" crossorigin="anonymous"></script>

    <!-- Other stuff -->
    <link href="/en/rss.xml" type="application/rss+xml" rel="alternate" title="Blog RSS Feed" />
    <link href="/en/atom.xml" type="application/atom+xml" rel="alternate" title="Blog ATOM Feed" />

    <!-- Google analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-41419012-5', 'auto');
      ga('send', 'pageview');
    </script>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter28700916 = new Ya.Metrika({id:28700916,
                        clickmap:true,
                        trackLinks:true,
                        accurateTrackBounce:true});
            } catch(e) { }
        });
        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";
        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
    </script>
    <!-- /Yandex.Metrika counter -->
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
       MathJax.Hub.Config({
        extensions: ["jsMath2jax.js"]
      });
    </script>
    <script
      src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
    </script>
    <!-- Disqus -->
    <script id="dsq-count-scr" src="//aakinshinnet-en.disqus.com/count.js" async></script>
  </head>

  <body>
     <div class="blog-masthead">
      <div class="container">
        <nav class="nav blog-nav">
          <a class="nav-link" id="nav-link-blog" href="/en/blog/">Blog</a>
          <a class="nav-link" id="nav-link-blog-content" href="/en/blog/content/">Content</a>
          <a class="nav-link" id="nav-link-about" href="/en/about/">About author</a>
          <a class="nav-link" href='/ru/blog/'>Russian version</a>
        </nav>
      </div>
    </div>

    <div class="container">
      <div class="blog-main">
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/en/blog/dotnet/datetime/'>DateTime under the hood</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> August 19, 2016.
          <b>Category:</b> <a href="/en/blog/content/#dotnet"><span class="tag tag-info">.NET</span></a>
          <b>Tags:</b>
                <a href="/en/blog/tags/#.NET"><span class="tag tag-pill tag-info">.NET</span></a>
                <a href="/en/blog/tags/#Timers"><span class="tag tag-pill tag-info">Timers</span></a>
        </span><br /><br />
        <p><a href="https://msdn.microsoft.com/library/system.datetime.aspx">DateTime</a> is a widely used .NET type. A lot of developers use it all the time, but not all of them really know how it works. In this post, I discuss <a href="https://msdn.microsoft.com/library/system.datetime.utcnow.aspx">DateTime.UtcNow</a>: how it's implemented, what the latency and the resolution of <code>DateTime</code> on Windows and Linux, how the resolution can be changed, and how it can affect your application. This post is an overview, so you probably will not see super detailed explanations of some topics, but you will find a lot of useful links for further reading.</p>
</p>
        <a href='/en/blog/dotnet/datetime/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/en/blog/dotnet/datetime/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/en/blog/dotnet/legacyjitx86-and-first-method-call/'>LegacyJIT-x86 and first method call</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> April 04, 2016.
          <b>Category:</b> <a href="/en/blog/content/#dotnet"><span class="tag tag-info">.NET</span></a>
          <b>Tags:</b>
                <a href="/en/blog/tags/#.NET"><span class="tag tag-pill tag-info">.NET</span></a>
                <a href="/en/blog/tags/#C#"><span class="tag tag-pill tag-info">C#</span></a>
                <a href="/en/blog/tags/#JIT"><span class="tag tag-pill tag-info">JIT</span></a>
                <a href="/en/blog/tags/#Benchmarks"><span class="tag tag-pill tag-info">Benchmarks</span></a>
        </span><br /><br />
        <p>Today I tell you about one of my favorite benchmarks (this method doesn't return a useful value, we need it only as an example):</p>
<pre><code class="language-cs">[Benchmark]
public string Sum()
{
    double a = 1, b = 1;
    var sw = new Stopwatch();
    for (int i = 0; i &lt; 10001; i++)
        a = a + b;
    return string.Format(&quot;{0}{1}&quot;, a, sw.ElapsedMilliseconds);
}
</code></pre>
<p>An interesting fact: if you call <code>Stopwatch.GetTimestamp()</code> before the first call of the <code>Sum</code> method, you improve <code>Sum</code> performance several times (works only with LegacyJIT-x86).</p>
</p>
        <a href='/en/blog/dotnet/legacyjitx86-and-first-method-call/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/en/blog/dotnet/legacyjitx86-and-first-method-call/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/en/blog/dotnet/projecttypeguids/'>Visual Studio and ProjectTypeGuids.cs</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> February 27, 2016.
          <b>Category:</b> <a href="/en/blog/content/#dotnet"><span class="tag tag-info">.NET</span></a>
          <b>Tags:</b>
                <a href="/en/blog/tags/#.NET"><span class="tag tag-pill tag-info">.NET</span></a>
                <a href="/en/blog/tags/#C#"><span class="tag tag-pill tag-info">C#</span></a>
                <a href="/en/blog/tags/#VisualStudio"><span class="tag tag-pill tag-info">VisualStudio</span></a>
                <a href="/en/blog/tags/#Hate"><span class="tag tag-pill tag-info">Hate</span></a>
        </span><br /><br />
        <p>It's a story about how I tried to open a project in Visual Studio for a few hours. The other day, I was going to do some work. I pulled last commits from a repo, opened Visual Studio, and prepared to start coding. However, one of a project in my solution failed to open with a strange message:</p>
<pre><code>error  : The operation could not be completed.
</code></pre>
<p>In the Solution Explorer, I had <em>&quot;load failed&quot;</em> as a project status and the following message instead of the file tree: <em>&quot;The project requires user input. Reload the project for more information.&quot;</em> Hmm, ok, I reloaded the project and got a few more errors:</p>
<pre><code>error  : The operation could not be completed.
error  : The operation could not be completed.
</code></pre>
</p>
        <a href='/en/blog/dotnet/projecttypeguids/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/en/blog/dotnet/projecttypeguids/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/en/blog/dotnet/blittable/'>Blittable types</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> November 26, 2015.
          <b>Category:</b> <a href="/en/blog/content/#dotnet"><span class="tag tag-info">.NET</span></a>
          <b>Tags:</b>
                <a href="/en/blog/tags/#.NET"><span class="tag tag-pill tag-info">.NET</span></a>
                <a href="/en/blog/tags/#C#"><span class="tag tag-pill tag-info">C#</span></a>
        </span><br /><br />
        <p>Challenge of the day: what will the following code display?</p>
<pre><code class="language-cs">[StructLayout(LayoutKind.Explicit)]
public struct UInt128
{
    [FieldOffset(0)]
    public ulong Value1;
    [FieldOffset(8)]
    public ulong Value2;
}
[StructLayout(LayoutKind.Sequential)]
public struct MyStruct
{
    public UInt128 UInt128;
    public char Char;
}
class Program
{
    public static unsafe void Main()
    {
        var myStruct = new MyStruct();
        var baseAddress = (int)&amp;myStruct;
        var uInt128Adress = (int)&amp;myStruct.UInt128;
        Console.WriteLine(uInt128Adress - baseAddress);
        Console.WriteLine(Marshal.OffsetOf(typeof(MyStruct), &quot;UInt128&quot;));
    }
}
</code></pre>
<p>A hint: two zeros or two another same values are wrong answers in the general case. The following table shows the console output on different runtimes:</p>
<table>
<tr><th></th><th>MS.NET-x86</th><th>MS.NET-x64</th><th>Mono</th></tr>
<tr><td>uInt128Adress - baseAddress                  </td><td>4</td><td>8</td><td>0</td></tr>
<tr><td>Marshal.OffsetOf(typeof(MyStruct), "UInt128")</td><td>0</td><td>0</td><td>0</td></tr>
</table>
<p>If you want to know why it happens, you probably should learn some useful information about blittable types.</p>
        <a href='/en/blog/dotnet/blittable/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/en/blog/dotnet/blittable/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/en/blog/dotnet/ryujit-rc-and-constant-folding/'>RyuJIT RC and constant folding</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> May 12, 2015.
          <b>Category:</b> <a href="/en/blog/content/#dotnet"><span class="tag tag-info">.NET</span></a>
          <b>Tags:</b>
                <a href="/en/blog/tags/#.NET"><span class="tag tag-pill tag-info">.NET</span></a>
                <a href="/en/blog/tags/#C#"><span class="tag tag-pill tag-info">C#</span></a>
                <a href="/en/blog/tags/#JIT"><span class="tag tag-pill tag-info">JIT</span></a>
                <a href="/en/blog/tags/#RyuJIT"><span class="tag tag-pill tag-info">RyuJIT</span></a>
                <a href="/en/blog/tags/#ConstantFolding"><span class="tag tag-pill tag-info">ConstantFolding</span></a>
        </span><br /><br />
        <p><strong>Update:</strong> The below results are valid for the release version of RyuJIT.</p>
<p>The challenge of the day: which method is faster?</p>
<pre><code class="language-cs">public double Sqrt13()
{
    return Math.Sqrt(1) + Math.Sqrt(2) + Math.Sqrt(3) + Math.Sqrt(4) + Math.Sqrt(5) + 
           Math.Sqrt(6) + Math.Sqrt(7) + Math.Sqrt(8) + Math.Sqrt(9) + Math.Sqrt(10) + 
           Math.Sqrt(11) + Math.Sqrt(12) + Math.Sqrt(13);
}
public double Sqrt14()
{
    return Math.Sqrt(1) + Math.Sqrt(2) + Math.Sqrt(3) + Math.Sqrt(4) + Math.Sqrt(5) + 
           Math.Sqrt(6) + Math.Sqrt(7) + Math.Sqrt(8) + Math.Sqrt(9) + Math.Sqrt(10) + 
           Math.Sqrt(11) + Math.Sqrt(12) + Math.Sqrt(13) + Math.Sqrt(14);
}
</code></pre>
<p>I have measured the methods performance with help of <a href="https://github.com/AndreyAkinshin/BenchmarkDotNet">BenchmarkDotNet</a> for RyuJIT RC (a part of .NET Framework 4.6 RC) and received the following results:</p>
<pre><code>// BenchmarkDotNet=v0.7.4.0
// OS=Microsoft Windows NT 6.2.9200.0
// Processor=Intel(R) Core(TM) i7-4702MQ CPU ＠ 2.20GHz, ProcessorCount=8
// CLR=MS.NET 4.0.30319.0, Arch=64-bit  [RyuJIT]
Common:  Type=Math_DoubleSqrtAvx  Mode=Throughput  Platform=X64  Jit=RyuJit  .NET=Current  
<p>Method |  AvrTime |    StdDev |         op/s |
------- |--------- |---------- |------------- |
Sqrt13 | 55.40 ns |  0.571 ns |  18050993.06 |
Sqrt14 |  1.43 ns | 0.0224 ns | 697125029.18 |
</code></pre></p>
<p>How so? If I add one more <code>Math.Sqrt</code> to the expression, the method starts work 40 times faster! Let's examine the situation..</p>
        <a href='/en/blog/dotnet/ryujit-rc-and-constant-folding/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/en/blog/dotnet/ryujit-rc-and-constant-folding/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/en/blog/dotnet/unrolling-of-small-loops-in-different-jit-versions/'>Unrolling of small loops in different JIT versions</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> March 02, 2015.
          <b>Category:</b> <a href="/en/blog/content/#dotnet"><span class="tag tag-info">.NET</span></a>
          <b>Tags:</b>
                <a href="/en/blog/tags/#.NET"><span class="tag tag-pill tag-info">.NET</span></a>
                <a href="/en/blog/tags/#C#"><span class="tag tag-pill tag-info">C#</span></a>
                <a href="/en/blog/tags/#JIT"><span class="tag tag-pill tag-info">JIT</span></a>
                <a href="/en/blog/tags/#Bugs"><span class="tag tag-pill tag-info">Bugs</span></a>
                <a href="/en/blog/tags/#LoopUnrolling"><span class="tag tag-pill tag-info">LoopUnrolling</span></a>
        </span><br /><br />
        <p>Challenge of the day: what will the following code display?</p>
<pre><code class="language-cs">struct Point
{
    public int X;
    public int Y;
}
static void Print(Point p)
{
    Console.WriteLine(p.X + &quot; &quot; + p.Y);
}
static void Main()
{
    var p = new Point();
    for (p.X = 0; p.X &lt; 2; p.X++)
        Print(p);
}
</code></pre>
<p>The right answer: it depends. There is a bug in CLR2 JIT-x86 which spoil this wonderful program. This story is about optimization that called unrolling of small loops. This is a very interesting theme, let's discuss it in detail.</p>
</p>
        <a href='/en/blog/dotnet/unrolling-of-small-loops-in-different-jit-versions/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/en/blog/dotnet/unrolling-of-small-loops-in-different-jit-versions/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/en/blog/dotnet/ryujit-ctp5-and-loop-unrolling/'>RyuJIT CTP5 and loop unrolling</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> March 01, 2015.
          <b>Category:</b> <a href="/en/blog/content/#dotnet"><span class="tag tag-info">.NET</span></a>
          <b>Tags:</b>
                <a href="/en/blog/tags/#.NET"><span class="tag tag-pill tag-info">.NET</span></a>
                <a href="/en/blog/tags/#C#"><span class="tag tag-pill tag-info">C#</span></a>
                <a href="/en/blog/tags/#JIT"><span class="tag tag-pill tag-info">JIT</span></a>
                <a href="/en/blog/tags/#RyuJIT"><span class="tag tag-pill tag-info">RyuJIT</span></a>
                <a href="/en/blog/tags/#LoopUnrolling"><span class="tag tag-pill tag-info">LoopUnrolling</span></a>
        </span><br /><br />
        <p>RyuJIT will be available soon. It is a next generation JIT-compiler for .NET-applications. Microsoft likes to tell us about the benefits of SIMD using and JIT-compilation time reducing. But what about basic code optimization which is usually applying by a compiler? Today we talk about the loop unrolling (unwinding) optimization. In general, in this type of code optimization, the code</p>
<pre><code class="language-cs">for (int i = 0; i &lt; 1024; i++)
    Foo(i);
</code></pre>
<p>transforms to</p>
<pre><code class="language-cs">for (int i = 0; i &lt; 1024; i += 4)
{
    Foo(i);
    Foo(i + 1);
    Foo(i + 2);
    Foo(i + 3);
}
</code></pre>
<p>Such approach can significantly increase performance of your code. So, what's about loop unrolling in .NET?</p>
</p>
        <a href='/en/blog/dotnet/ryujit-ctp5-and-loop-unrolling/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/en/blog/dotnet/ryujit-ctp5-and-loop-unrolling/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/en/blog/dotnet/jit-version-determining-in-runtime/'>JIT version determining in runtime</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> February 28, 2015.
          <b>Category:</b> <a href="/en/blog/content/#dotnet"><span class="tag tag-info">.NET</span></a>
          <b>Tags:</b>
                <a href="/en/blog/tags/#.NET"><span class="tag tag-pill tag-info">.NET</span></a>
                <a href="/en/blog/tags/#C#"><span class="tag tag-pill tag-info">C#</span></a>
                <a href="/en/blog/tags/#JIT"><span class="tag tag-pill tag-info">JIT</span></a>
        </span><br /><br />
        <p>Sometimes I want to know used JIT compiler version in my little C# experiments. It is clear that it is possible to determine the version in advance based on the environment. However, sometimes I want to know it in runtime to perform specific code for the current JIT compiler. More formally, I want to get the value from the following enum:</p>
<pre><code class="language-cs">public enum JitVersion
{
    Mono, MsX86, MsX64, RyuJit
}
</code></pre>
<p>It is easy to detect Mono by existing of the <code>Mono.Runtime</code> class. Otherwise, we can assume that we work with Microsoft JIT implementation. It is easy to detect JIT-x86 with help of <code>IntPtr.Size == 4</code>. The challenge is to distinguish JIT-x64 and RyuJIT. Next, I will show how you can do it with help of the bug from my <a href="http://aakinshin.net/en/blog/dotnet/subexpression-elimination-bug-in-jit-x64/">previous post</a>.</p>
</p>
        <a href='/en/blog/dotnet/jit-version-determining-in-runtime/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/en/blog/dotnet/jit-version-determining-in-runtime/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/en/blog/dotnet/subexpression-elimination-bug-in-jit-x64/'>A bug story about JIT-x64</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> February 27, 2015.
          <b>Category:</b> <a href="/en/blog/content/#dotnet"><span class="tag tag-info">.NET</span></a>
          <b>Tags:</b>
                <a href="/en/blog/tags/#.NET"><span class="tag tag-pill tag-info">.NET</span></a>
                <a href="/en/blog/tags/#C#"><span class="tag tag-pill tag-info">C#</span></a>
                <a href="/en/blog/tags/#JIT"><span class="tag tag-pill tag-info">JIT</span></a>
                <a href="/en/blog/tags/#Bugs"><span class="tag tag-pill tag-info">Bugs</span></a>
        </span><br /><br />
        <p>Can you say, what will the following code display for <code>step=1</code>?</p>
<pre><code class="language-cs">public void Foo(int step)
{
    for (int i = 0; i &lt; step; i++)
    {
        bar = i + 10;
        for (int j = 0; j &lt; 2 * step; j += step)
            Console.WriteLine(j + 10);
    }
}
</code></pre>
<p>If you think about specific numbers, you are wrong. The right answer: it depends. The post title suggests to us, the program can has a strange behavior for x64.</p>
        <a href='/en/blog/dotnet/subexpression-elimination-bug-in-jit-x64/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/en/blog/dotnet/subexpression-elimination-bug-in-jit-x64/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/en/blog/dotnet/inlining-and-starg/'>A story about JIT-x86 inlining and starg</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> February 26, 2015.
          <b>Category:</b> <a href="/en/blog/content/#dotnet"><span class="tag tag-info">.NET</span></a>
          <b>Tags:</b>
                <a href="/en/blog/tags/#.NET"><span class="tag tag-pill tag-info">.NET</span></a>
                <a href="/en/blog/tags/#C#"><span class="tag tag-pill tag-info">C#</span></a>
                <a href="/en/blog/tags/#Inlining"><span class="tag tag-pill tag-info">Inlining</span></a>
        </span><br /><br />
        <p>Sometimes you can learn a lot during reading source .NET. Let's open the source code of a <code>Decimal</code> constructor from .NET Reference Source (<a href="http://referencesource.microsoft.com/#mscorlib/system/decimal.cs,158">mscorlib/system/decimal.cs,158</a>):</p>
<pre><code class="language-cs">// Constructs a Decimal from an integer value.
//
public Decimal(int value) {
    //  JIT today can't inline methods that contains &quot;starg&quot; opcode.
    //  For more details, see DevDiv Bugs 81184: x86 JIT CQ: Removing the inline striction of &quot;starg&quot;.
    int value_copy = value;
    if (value_copy &gt;= 0) {
        flags = 0;
    }
    else {
        flags = SignMask;
        value_copy = -value_copy;
    }
    lo = value_copy;
    mid = 0;
    hi = 0;
}
</code></pre>
<p>The comment states that JIT-x86 can't apply the inlining optimization for a method that contains the <a href="https://msdn.microsoft.com/library/system.reflection.emit.opcodes.starg.aspx">starg</a> IL-opcode. Curious, is not it? </p>
        <a href='/en/blog/dotnet/inlining-and-starg/'>Read more</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/en/blog/dotnet/inlining-and-starg/#disqus_thread">Comments</a><br /><br />
        <hr />
    </div>
</div>
<nav>
  <ul class="pagination">
          <li class="page-item disabled">
        <a class="page-link" href="#" aria-label="Previous">
          <span aria-hidden="true">&laquo;</span>
          <span class="sr-only">Previous</span>
        </a>
      </li>
            <li class="page-item active">
          <a class="page-link" href="/en/blog/">1 <span class="sr-only">(current)</span></a>
        </li>
        <li class="page-item"><a class="page-link" href="/en/blog/page/2/">2</a></li>
        <li class="page-item"><a class="page-link" href="/en/blog/page/3/">3</a></li>
          <li class="page-item">
        <a class="page-link" href='/en/blog/page/2/' aria-label="Next">
          <span aria-hidden="true">&raquo;</span>
          <span class="sr-only">Next</span>
        </a>
      </li>
      </ul>
</nav>
<hr />
<p style="font-size:150%"><a href="/ru/blog/">More posts in Russian</a></p>
<p>Subscribe: <a href="/en/rss.xml">RSS</a> <a href="/en/atom.xml">Atom</a></p>
    </div>

    <footer class="blog-footer">
      <div class="container">
        <p>&copy; 2014–2016 Andrey Akinshin</p>
      </div>
    </footer>

    <script>
    $(function() {
       // standard classes
       $("table").addClass("table");
       $("table").addClass("table-bordered");
       $("table").addClass("table-hover");
       $("table").addClass("table-condensed");
       $("blockquote").addClass("blockquote");

       // nav
       var url = $(location).attr('href');
       if (url.indexOf("/blog/content") != -1) {
           $("#nav-link-blog-content").addClass("active");
       } else if (url.indexOf("/blog") != -1) {
           $("#nav-link-blog").addClass("active");
       } else if (url.indexOf("/about") != -1) {
           $("#nav-link-about").addClass("active");
       }
    });
    </script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/anchor.min.js"></script>
    <script>
      anchors.options = {
        placement: 'left',
        icon: '§'
      };
      anchors.add('h1');
      anchors.add('h2');
      anchors.add('h3');
    </script>
  </body>
</html>
