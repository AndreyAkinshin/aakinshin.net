<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.123.7"><meta name=author content='Andrey Akinshin'><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content='Mathematics,Statistics,Research,Mann-Whitney U-test'><title>Edgeworth expansion for the Mann-Whitney U test | Andrey Akinshin</title>
<meta name=description content="Explore how the Edgeworth expansion provides a more accurate alternative to the Normal approximation for calculating p-values in the Mann-Whitney U test"><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><script>localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><link href=https://aakinshin.net/css/main.min.d6826f88345af20c0769a313557ec1355465a3091b1f9869b936f2504c4dfe26.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"></head><body class="flex flex-col min-h-screen"><nav><div class="container flex flex-wrap items-center justify-between mx-auto max-w-6xl h-12 px-2 xs:px-6"><div class="flex items-center justify-start justify-self-start"><div class="flex nav-item h-12 w-12 items-center justify-center"><a class=text-white href=https://aakinshin.net/><svg class="fai w-5 h-5 pr-0 mb-0.5"><use xlink:href="/img/fa/all.svg#house-chimney"/></svg></a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/posts/>Posts</a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/research/>Research</a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/library/>Library</a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/about/>About</a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/search/><svg class="fai w-5 h-5 pr-0 mb-0.5"><use xlink:href="/img/fa/all.svg#magnifying-glass"/></svg></a></div></div><button id=theme-toggle type=button title="Alt+Click to match OS color theme" class="nav-item p-3 content-center justify-self-end"><svg id="theme-toggle-dark-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001.0 1010.586 10.586z"/></svg><svg id="theme-toggle-light-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1A1 1 0 119 4V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707A1 1 0 1113.536 5.05l.707-.707a1 1 0 011.414.0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707A1 1 0 004.343 5.757l.707.707zm1.414 8.486-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"/></svg></button></div></nav><div class="main container mx-auto max-w-6xl px-6 flex-grow"><div class=main-post><h1 class=blog-post-title id=post-title>Edgeworth expansion for the Mann-Whitney U test</h1><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg>
<time datetime=2023-05-30>May 30, 2023</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/mathematics/><svg class="rating-icon"><use xlink:href="/img/fa/all.svg#math"/></svg>
Mathematics
</a><a class=label-link href=https://aakinshin.net/tags/statistics/><svg class="rating-icon"><use xlink:href="/img/fa/all.svg#statistics"/></svg>
Statistics
</a><a class=label-link href=https://aakinshin.net/tags/research/>Research
</a><a class=label-link href=https://aakinshin.net/tags/mann-whitney/>Mann-Whitney U-test</a></div></div><br><div class=main-content><p>In <a href=https://aakinshin.net/posts/r-mann-whitney-incorrect-p-value/>previous posts</a>,
I have shown a severe drawback of the classic Normal approximation for the Mann-Whitney U test:
under certain conditions, can lead to quite substantial p-value errors,
distorting the significance level of the test.</p><p>In this post, we will explore the potential of the Edgeworth expansion
as a more accurate alternative for approximating the distribution of the Mann-Whitney U statistic.</p><h3 id=normal-approximation>Normal approximation</h3><p>We consider the one-sided Mann-Whitney U test that compares two samples $\mathbf{x}$ and $\mathbf{y}$:</p>$$
\mathbf{x} = \{ x_1, x_2, \ldots, x_n \}, \quad
\mathbf{y} = \{ y_1, y_2, \ldots, y_m \}.
$$<p>Firstly, let&rsquo;s discuss the classical Normal approximation.
The Mann-Whitney U test statistic, U, is defined as follows:</p>$$
U(x, y) = \sum_{i=1}^n \sum_{j=1}^m S(x_i, y_j),\quad
S(a,b) = \begin{cases}
1, & \text{if } a > b, \\
0.5, & \text{if } a = b, \\
0, & \text{if } a < b.
\end{cases}
$$<p>The normal approximation $\mathcal{N}(\mu_U, \sigma_U^2)$ is typically given by:</p>$$
\mu_U = \frac{nm}{2},\quad
\sigma_U = \sqrt{\frac{nm(n+m+1)}{12}}.
$$<p>Note, that in the case of tied elements, the equations need some adjustments.
However, we assume that <a href=https://aakinshin.net/posts/mw-confusing-tie-correction/>this case can be neglected</a>.
Once the approximation is defined, $z$ is given by:</p>$$
z = \frac{U - \mu_U \pm 0.5}{\sigma_U},
$$<p>where $\pm 0.5$ is the correction for continuity.</p><p>The final p-value is calculated as follows:</p>$$
p_\mathcal{N}(z) = \Phi(z),
$$<p>where $\Phi$ is the CDF of the standard normal distribution $\mathcal{N}(0, 1)$.
Depending on the direction of the test, $p_\mathcal{N}(z) = 1 - \Phi(z)$ may be also considered.</p><p>The problem with this approximation is that it does not hold well for all cases.
It tends to overestimate the p-values, especially for extreme U values,
leading to potentially false non-rejections of the null hypothesis.</p><h3 id=edgeworth-approximation>Edgeworth approximation</h3><p>A more accurate approximation can be obtained using the Edgeworth expansion.
The idea is to refine the Normal approximation by adding corrective terms
that depend on the higher moments of the distribution.
In this post, we use the Edgeworth expansion from <a href=https://aakinshin.net/library/papers/bean2004/><svg class="rating-icon"><use xlink:href="/img/fa/all.svg#paper"/></svg>bean2004</a>.
It is given by:</p>$$
p_E(z) = \Phi(z) - \phi(z) \frac{1}{n+m} \frac{c_{20}}{4!} H_3(z),
$$
$$
c_{20} = -\frac{6 \left(1-p^5 - (1-p)^5 \right)}{25 (p\cdot(1-p))^2},\quad
H_3(z) = z^3 - 3z,
$$<p>where $\phi$ is the PDF of $\mathcal{N}(0, 1)$</p><p>The second term in the above $p_E(z)$ equation captures the skewness of the U distribution
and corrects for the bias in the Normal approximation.
The Edgeworth expansion can be extended to include more terms, capturing even higher moments of the distribution,
but the first two terms usually suffice for practical purposes.
This approach generally provides much better approximations of the true p-values compared
to the classical Normal approximation, thereby ensuring more accurate hypothesis testing results.</p><h3 id=numerical-simulations>Numerical simulations</h3><p>Below you can see the charts that show the error between the true p-value and $p_\mathcal{N}$, $p_E$
(the normal approximation and the Edgeworth approximation) for various values of $n$ and $m$.</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/mw-edgeworth/img/nm50_5-light.png target=_blank alt=nm50_5><img src=/posts/mw-edgeworth/img/nm50_5-light.png width=800>
</a><a class="img-dark hidden" href=/posts/mw-edgeworth/img/nm50_5-dark.png target=_blank alt=nm50_5><img src=/posts/mw-edgeworth/img/nm50_5-dark.png width=800></a></div><p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/mw-edgeworth/img/nm10-light.png target=_blank alt=nm10><img src=/posts/mw-edgeworth/img/nm10-light.png width=800>
</a><a class="img-dark hidden" href=/posts/mw-edgeworth/img/nm10-dark.png target=_blank alt=nm10><img src=/posts/mw-edgeworth/img/nm10-dark.png width=800></a></div><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/mw-edgeworth/img/nm30-light.png target=_blank alt=nm30><img src=/posts/mw-edgeworth/img/nm30-light.png width=800>
</a><a class="img-dark hidden" href=/posts/mw-edgeworth/img/nm30-dark.png target=_blank alt=nm30><img src=/posts/mw-edgeworth/img/nm30-dark.png width=800></a></div><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/mw-edgeworth/img/nm50-light.png target=_blank alt=nm50><img src=/posts/mw-edgeworth/img/nm50-light.png width=800>
</a><a class="img-dark hidden" href=/posts/mw-edgeworth/img/nm50-dark.png target=_blank alt=nm50><img src=/posts/mw-edgeworth/img/nm50-dark.png width=800></a></div></p><p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/mw-edgeworth/img/nm50a-light.png target=_blank alt=nm50a><img src=/posts/mw-edgeworth/img/nm50a-light.png width=800>
</a><a class="img-dark hidden" href=/posts/mw-edgeworth/img/nm50a-dark.png target=_blank alt=nm50a><img src=/posts/mw-edgeworth/img/nm50a-dark.png width=800></a></div><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/mw-edgeworth/img/nm50b-light.png target=_blank alt=nm50b><img src=/posts/mw-edgeworth/img/nm50b-light.png width=800>
</a><a class="img-dark hidden" href=/posts/mw-edgeworth/img/nm50b-dark.png target=_blank alt=nm50b><img src=/posts/mw-edgeworth/img/nm50b-dark.png width=800></a></div><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/mw-edgeworth/img/nm50c-light.png target=_blank alt=nm50c><img src=/posts/mw-edgeworth/img/nm50c-light.png width=800>
</a><a class="img-dark hidden" href=/posts/mw-edgeworth/img/nm50c-dark.png target=_blank alt=nm50c><img src=/posts/mw-edgeworth/img/nm50c-dark.png width=800></a></div><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/mw-edgeworth/img/nm50d-light.png target=_blank alt=nm50d><img src=/posts/mw-edgeworth/img/nm50d-light.png width=800>
</a><a class="img-dark hidden" href=/posts/mw-edgeworth/img/nm50d-dark.png target=_blank alt=nm50d><img src=/posts/mw-edgeworth/img/nm50d-dark.png width=800></a></div><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/mw-edgeworth/img/nm50e-light.png target=_blank alt=nm50e><img src=/posts/mw-edgeworth/img/nm50e-light.png width=800>
</a><a class="img-dark hidden" href=/posts/mw-edgeworth/img/nm50e-dark.png target=_blank alt=nm50e><img src=/posts/mw-edgeworth/img/nm50e-dark.png width=800></a></div></p><p>As we can see, $p_E$ is much more accurate than $p_\mathcal{N}$.</p><h3 id=conclusion>Conclusion</h3><p>In statistical hypothesis testing, accuracy is crucial,
and the choice of the approximation method can substantially impact the results.
While the Normal approximation is simple and widely used,
it can lead to significant errors in p-value calculations, particularly for the Mann-Whitney U test.</p><p>The Edgeworth expansion, on the other hand, offers a promising alternative
that significantly improves the approximation accuracy by accounting for higher moments of the distribution.
Thus, it enhances the reliability and validity of the Mann-Whitney U test results.</p><p>So, the next time you perform a Mann-Whitney U test,
consider using the Edgeworth expansion to approximate your p-values.
You might find it to be a much more reliable and precise way to draw conclusions from your data.</p></div></div></div><script>var themeToggleDarkIcon=document.getElementById("theme-toggle-dark-icon"),themeToggleBtn,themeToggleLightIcon=document.getElementById("theme-toggle-light-icon");const imagesDark=document.querySelectorAll(".img-dark"),imagesLight=document.querySelectorAll(".img-light");localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(themeToggleLightIcon.classList.remove("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")})):(themeToggleDarkIcon.classList.remove("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")}));function toggleTheme(e){e?(document.documentElement.classList.add("dark"),themeToggleLightIcon.classList.remove("hidden"),themeToggleDarkIcon.classList.add("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")}),imagesLight.forEach(e=>{e.classList.add("hidden")})):(document.documentElement.classList.remove("dark"),themeToggleDarkIcon.classList.remove("hidden"),themeToggleLightIcon.classList.add("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")}),imagesDark.forEach(e=>{e.classList.add("hidden")}))}themeToggleBtn=document.getElementById("theme-toggle"),themeToggleBtn.addEventListener("click",function(){themeToggleDarkIcon.classList.toggle("hidden"),themeToggleLightIcon.classList.toggle("hidden"),imagesLight.forEach(e=>{e.classList.toggle("hidden")}),imagesDark.forEach(e=>{e.classList.toggle("hidden")}),event.altKey?(localStorage.removeItem("color-theme"),toggleTheme(window.matchMedia("(prefers-color-scheme: dark)").matches)):localStorage.getItem("color-theme")?localStorage.getItem("color-theme")==="light"?(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"))}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{if(localStorage.getItem("color-theme")===null){const t=e.matches?"dark":"light";toggleTheme(t==="dark")}})</script><footer class="z-20 p-4 md:p-6 mt-3 w-full border-t border-gray-200 shadow flex items-center justify-center dark:border-gray-600 bg-white dark:bg-zinc-800"><span class="dark:text-gray-400 text-center">© 2013—2024 <span class=whitespace-nowrap>Andrey Akinshin</span></span><ul class="flex flex-wrap items-center px-4 mb-1"><li><a href=https://github.com/AndreyAkinshin><svg class="fai fai-link w-5 h-5"><title>GitHub</title><use xlink:href="/img/fa/all.svg#github"/></svg></a></li><li><a href=https://twitter.com/andrey_akinshin><svg class="fai fai-link w-5 h-5"><title>Twitter</title><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></li><li><a href=https://aakinshin.net/posts/index.xml><svg class="fai fai-link w-5 h-5"><title>RSS</title><use xlink:href="/img/fa/all.svg#rss"/></svg></a></li></ul><div class=main-content><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></div></footer><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+=" has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script></body></html>