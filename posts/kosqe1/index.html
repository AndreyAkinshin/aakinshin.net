<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.103.0-DEV"><meta name=author content="Andrey Akinshin"><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content="Mathematics,Statistics,Research,Quantile Estimators,Quantile estimators based on k order statistics,Research: Building trimmed Harrell-Davis quantile estimator"><title>Quantile estimators based on k order statistics, Part 1: Motivation | Andrey Akinshin</title><meta name=description content="It&amp;rsquo;s not easy to choose a good quantile estimator. In my previous posts, I considered several groups of quantile estimators:
Quantile estimators base..."><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><script>localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><link href=https://aakinshin.net/css/main.min.62716e7c1ef4ceec024205096879cb60e17cf1138bc01a72d8d4b95b8822d168.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"></head><body><nav><div class="container flex flex-wrap items-center justify-between mx-auto max-w-6xl h-12 px-6"><div class="flex items-center justify-start justify-self-start"><div class="flex nav-item h-12 w-12 items-center justify-center"><a class=text-white href=https://aakinshin.net/><svg class="fai w-5 h-5 pr-0 mb-0.5"><use xlink:href="/img/fa/all.svg#house-chimney"/></svg></a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/posts/>Posts</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/research/>Research</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/about/>About</a></div></div><button id=theme-toggle type=button class="nav-item p-3 content-center justify-self-end"><svg id="theme-toggle-dark-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001.0 1010.586 10.586z"/></svg><svg id="theme-toggle-light-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1A1 1 0 119 4V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707A1 1 0 1113.536 5.05l.707-.707a1 1 0 011.414.0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707A1 1 0 004.343 5.757l.707.707zm1.414 8.486-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"/></svg></button></div></nav><div class="main container mx-auto max-w-6xl px-6"><div class=main-post><h1 class=blog-post-title id=post-title>Quantile estimators based on k order statistics, Part 1: Motivation</h1><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2021-08-03>August 3, 2021</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/mathematics/>Mathematics</a>
<a class=label-link href=https://aakinshin.net/tags/statistics/>Statistics</a>
<a class=label-link href=https://aakinshin.net/tags/research/>Research</a>
<a class=label-link href=https://aakinshin.net/tags/quantile-estimators/>Quantile Estimators</a>
<a class=label-link href=https://aakinshin.net/tags/quantile-estimators-based-on-k-order-statistics/>Quantile estimators based on k order statistics</a>
<a class=label-link href=https://aakinshin.net/tags/research-thdqe/>Research: Building trimmed Harrell-Davis quantile estimator</a></div></div><br><div class="main-content mb-3 px-2 py-1 rounded border text-alert-text-l border-alert-frame-l dark:text-alert-text-d dark:border-alert-frame-d">Update: this blog post is a part of research that aimed to build a statistically efficient and robust quantile estimator. A <a href=/posts/pub-thdqe/>paper with final results</a> is available in <em>Communications in Statistics - Simulation and Computation</em> (DOI: <a href=https://www.tandfonline.com/doi/abs/10.1080/03610918.2022.2050396>10.1080/03610918.2022.2050396</a>). A preprint is available on arXiv: <a href=https://arxiv.org/abs/2111.11776>arXiv:2111.11776 [stat.ME]</a>. Some information in this blog post can be obsolete: please, use the official paper as the primary reference.</div><div class=main-content><p>It&rsquo;s not easy to choose a good quantile estimator.
In my previous posts, I considered several groups of quantile estimators:</p><ul><li>Quantile estimators based 1 or 2 order statistics (Hyndman-Fan Type1-9)</li><li>Quantile estimators based on all order statistics
(the Harrell-Davis quantile estimator,
the <a href=https://aakinshin.net/posts/sfakianakis-verginis-quantile-estimator/>Sfakianakis-Verginis quantile estimator</a>, and
the <a href=https://aakinshin.net/posts/navruz-ozdemir-quantile-estimator/>Navruz-Özdemir quantile estimator</a>)</li><li>Quantile estimators based on a variable number of order statistics
(the <a href=https://aakinshin.net/posts/trimmed-hdqe/>trimmed</a> and <a href=https://aakinshin.net/posts/winsorized-hdqe/>winsorized</a> modifications
of the Harrell-Davis quantile estimator)</li></ul><p>Unfortunately, all of these estimators have significant drawbacks
(e.g., poor statistical efficiency or poor robustness).
In this post, I want to discuss all of the advantages and disadvantages of each approach
and suggest another family of quantile estimators that are based on k order statistics.</p><p>All posts from this series:</p><ul><li><a href=https://aakinshin.net/posts/kosqe1/>Quantile estimators based on k order statistics, Part 1: Motivation</a> <i>(August 3, 2021)</i></li><li><a href=https://aakinshin.net/posts/kosqe2/>Quantile estimators based on k order statistics, Part 2: Extending Hyndman-Fan equations</a> <i>(August 10, 2021)</i></li><li><a href=https://aakinshin.net/posts/kosqe3/>Quantile estimators based on k order statistics, Part 3: Playing with the Beta function</a> <i>(August 17, 2021)</i></li><li><a href=https://aakinshin.net/posts/kosqe4/>Quantile estimators based on k order statistics, Part 4: Adopting trimmed Harrell-Davis quantile estimator</a> <i>(August 24, 2021)</i></li><li><a href=https://aakinshin.net/posts/kosqe5/>Quantile estimators based on k order statistics, Part 5: Improving trimmed Harrell-Davis quantile estimator</a> <i>(August 31, 2021)</i></li><li><a href=https://aakinshin.net/posts/kosqe6/>Quantile estimators based on k order statistics, Part 6: Continuous trimmed Harrell-Davis quantile estimator</a> <i>(September 7, 2021)</i></li><li><a href=https://aakinshin.net/posts/kosqe7/>Quantile estimators based on k order statistics, Part 7: Optimal threshold for the trimmed Harrell-Davis quantile estimator</a> <i>(September 14, 2021)</i></li><li><a href=https://aakinshin.net/posts/kosqe8/>Quantile estimators based on k order statistics, Part 8: Winsorized Harrell-Davis quantile estimator</a> <i>(September 21, 2021)</i></li></ul><h3 id=properties-of-quantile-estimators>Properties of quantile estimators</h3><p>First of all, we should define the properties of quantile estimators that are important in practice.</p><ul><li><strong>Statistical efficiency</strong><br>This metric is one of the most important because the main task of a quantile estimator is to provide
quantile estimators that are closed to the true quantile values.
<em>Note that the classic definition of statistical efficiency</em>
<em>doesn&rsquo;t always provide a reliable measure of an estimator.</em>
<em>Since it&rsquo;s based on the mean square error (MSE), it&rsquo;s not robust, and it could be easily corrupted in the case</em>
<em>of heavy-tailed distributions.</em>
<em>As an alternative, we could consider</em>
<em><a href=https://aakinshin.net/posts/robust-statistical-efficiency/>the whole distribution of absolute estimation errors</a>.</em>
<em>This approach is not so convenient as the classic one because we have to operate</em>
<em>with a function instead of a single number.</em>
<em>Nevertheless, this function provides much more stable values that are mostly not so sensitive to outliers.</em></li><li><strong>Robustness</strong><br>Heavy-tailedness is a frequent property of real-life distributions.
With such a property, we could expect to have extreme outliers that could corrupt the estimations.
With a low breakdown point, even a few outliers may distort estimations for all required quantiles
and significantly reduce the statistical efficiency.
That&rsquo;s why it&rsquo;s so important to have robust estimators.</li><li><strong>Customizability of the trade-off between efficiency and robustness</strong><br>Unfortunately, it&rsquo;s impossible to get the maximum statistical efficiency in the light-tailed case
(which means that we should use more order statistics)
and get a low breakdown point that protects us against outliers in the heavy-tailed case
(which means that we should use fewer order statistics)
at the same time.
We always have to deal with a trade-off between statistical efficiency and robustness.
It&rsquo;s important to have the ability to customize this trade-off.
If we could control the breakdown point,
we would adjust the estimator settings using the a priori knowledge about distribution properties.</li><li><strong>Computational efficiency</strong><br>In practice, it&rsquo;s important to estimate quantiles fast.
A slow quantile estimator could easily become a bottleneck of software that analyzes your data.
If we need a single order statistics, we could get it using O(n) algorithmic complexity
(e.g., using the <a href=http://erdani.com/research/sea2017.pdf>Fast Deterministic Selection</a> by Andrei Alexandrescu).
If we need more order statistics, we may need O(n*log(n)) complexity to sort the whole sample.
Don&rsquo;t forget that complexity is not the only measure of performance; the computational constant is also important.
For example, the Harrell-Davis quantile estimator involves getting values of the Beta function,
which is not a fast operation.</li></ul><p>Now let&rsquo;s discuss different groups of quantile estimators according to the above properties.</p><h3 id=quantile-estimators-based-on-1-or-2-order-statistics>Quantile estimators based on 1 or 2 order statistics</h3><p>In this group, we have &ldquo;traditional&rdquo; quantile estimators which
peak a single element from a sample (Hyndman-Fan Type1-3)
or calculate a linear interpolation of two subsequent order statistics (Hyndman-Fan Type4-9).</p><ul><li><strong>Statistical efficiency</strong><br>In simple cases, quantile estimators from the Hyndman-Fan classification provide &ldquo;good enough&rdquo; efficiency.
However, it&rsquo;s not always optimal since these estimators use at most two sample elements and ignore the rest.
The efficiency could be noticeably improved if we take the other sample elements into account.</li><li><strong>Robustness</strong><br>The asymptotical breakdown point of the <span class="math inline">\(p^\textrm{th}\)</span> quantile is min(p, 1-p).
Thus, these estimators are robust.</li><li><strong>Customizability of the trade-off between efficiency and robustness</strong><br>It&rsquo;s impossible to change the trade-off.</li><li><strong>Computational efficiency</strong><br>These estimators are fast because a single order statistic could be obtained using O(n) algorithmic complexity
using the <a href=http://erdani.com/research/sea2017.pdf>Fast Deterministic Selection</a> by Andrei Alexandrescu.</li></ul><h3 id=quantile-estimators-based-on-all-order-statistics>Quantile estimators based on all order statistics</h3><p>In this group, we have
the Harrell-Davis quantile estimator,
the <a href=https://aakinshin.net/posts/sfakianakis-verginis-quantile-estimator/>Sfakianakis-Verginis quantile estimator</a>, and
the <a href=https://aakinshin.net/posts/navruz-ozdemir-quantile-estimator/>Navruz-Özdemir quantile estimator</a>.
All of them estimate a quantile as a weighted sum of <em>all</em> order statistics.
This means that it&rsquo;s not a good idea to use them with samples from heavy-tailed distribution:
a single extreme outlier could corrupt estimated values of all quantiles.</p><ul><li><strong>Statistical efficiency / Robustness</strong><br>These estimators typically have a decent statistical efficiency with samples from light-tailed distributions.
Unfortunately, the breakdown point is zero for all of the estimators because
the estimation involves all sample elements with non-zero weights.
Thus, these estimators are not robust, which means extremely low statistical efficiency for samples
from heavy-tailed distributions.</li><li><strong>Customizability of the trade-off between efficiency and robustness</strong><br>It&rsquo;s impossible to change the trade-off.</li><li><strong>Computational efficiency</strong><br>These estimators are pretty slow.
In addition to the O(n*log(n)) sorting complexity,
we have to perform O(n) summation (that involves heavy calculations of the Beta or Binomial function).</li></ul><h3 id=quantile-estimators-based-on-a-variable-number-of-order-statistics>Quantile estimators based on a variable number of order statistics</h3><p>In this group, we have
the <a href=https://aakinshin.net/posts/trimmed-hdqe/>trimmed</a> and <a href=https://aakinshin.net/posts/winsorized-hdqe/>winsorized</a> modifications
of the Harrell-Davis quantile estimator (THD and WHD).
The idea behind them is simple: we should drop all the order statistics with small weight coefficients.
In the case of light-tailed distributions, these terms don&rsquo;t have a noticeable impact on the result.
In the case of heavy-tailed distributions, these terms could corrupt the result
regardless of how small the corresponding weight coefficient is.</p><ul><li><strong>Statistical efficiency / Robustness / Customizability</strong><br>The trade-off between statistical efficiency and robustness could be customized using the trimming percentage.
In special cases, the above estimators could become
the classic Harrell-Davis quantile estimator (the trimming percentage is zero) or
a traditional quantile estimator (the trimming percentage is one).
Unfortunately, it&rsquo;s easy to achieve the required robustness because the breakdown point depends not only
on the trimming percentage but also on the required quantile position.</li><li><strong>Computational efficiency</strong><br>These quantile estimators are much faster than the classic Harrell-Davis quantile estimator
because they require only several values of the Beta function (instead of O(n) values).</li></ul><p>While these estimators is a good step forward in terms of customizability,
they have an <strong>important drawback: the quantile function is not continuous</strong>.
This introduces some troubles with:</p><ul><li>Statistical efficiency around the discontinuities</li><li>Building the <a href=https://aakinshin.net/posts/qrde-hd/>quantile-respectful density function (QRDE)</a></li><li>Using it in QRDE-based algorithms like the
<a href=https://aakinshin.net/posts/lowland-multimodality-detection/>lowland multimodality detector</a>.</li></ul><p>Thus, it would be nice to have another customizable quantile estimator without the above drawbacks.</p><h3 id=quantile-estimators-based-on-k-order-statistics>Quantile estimators based on k order statistics</h3><p>One of the main problems of the winsorized and trimmed modifications of the Harrell-Davis quantile estimator
is the lack of ability to directly customize the breakdown point.
This issue could be resolved using an approach that always uses k order statistics around the required quantile.
Let&rsquo;s briefly discuss the properties of such an estimator.</p><ul><li><strong>Statistical efficiency / Robustness / Customizability</strong><br>Using the known k value, we could easily get the asymptotical breakdown point: <span class="math inline">\(\max(\min(p, 1-p) - k/2n), 0)\)</span>.
The higher k we use, the higher efficiency (in the light-tailed case) we have
(because we use more data from the sample).
The smaller k we use, the higher robustness we have
(because several corrupted measurements typically will not be able to spoil the estimation).
By setting k=n, we can get the Harrell-Davis quantile estimator.
By setting k=1 or k=2, we can get the traditional quantile estimators from the Hyndman-Fan classification.</li><li><strong>Computational efficiency</strong><br>The performance of the suggested approach is similar to the previous section:
using the sorted data, we have to perform O(k) operations.</li></ul><p>Thus, quantile estimators based on k order statistics could be a bridge between
the traditional quantile estimators and the Harrell-Davis quantile estimators.
However, with a proper weight function, we could avoid the disadvantages of the THD/WHD and
obtain a continuous and smooth quantile function (more about it in the next post).</p><h3 id=conclusion>Conclusion</h3><p>In the scope of this post, we discussed only an idea of a quantile estimator based on k order statistics.
It looks like it could resolve issues related to other popular quantile estimators listed above.
In the next post, we will continue exploring the possibilities of using this approach.
We will discuss the weight function that allows transforming k order statistics to a single estimation number.
As usual, we will also perform Monte-Carlo simulations
that evaluate the actual statistical efficiency of the suggested estimators.</p></div><br><br><div class="flex flex-wrap justify-center items-center">The source code of this post and all the relevant files are&nbsp;<a href=https://github.com/AndreyAkinshin/aakinshin.net/tree/master/content/en/posts/2021/08/kosqe1/index.md>available on GitHub</a>.</div><div class="flex flex-wrap justify-center items-center mb-5"><span>Share:</span><div class="text-4xl pl-3"><a href="https://www.reddit.com/submit?url=https%3a%2f%2faakinshin.net%2fposts%2fkosqe1%2f&title=Quantile%20estimators%20based%20on%20k%20order%20statistics%2c%20Part%201%3a%20Motivation" target=_blank title="Share on Reddit"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#reddit"/></svg></a></div><div class="text-4xl pl-3"><a href="https://twitter.com/intent/tweet?text=Quantile%20estimators%20based%20on%20k%20order%20statistics%2c%20Part%201%3a%20Motivation&url=https%3a%2f%2faakinshin.net%2fposts%2fkosqe1%2f&via=andrey_akinshin&related=andrey_akinshin" rel=nofollow target=_blank title="Share on Twitter"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></div><div class="text-4xl pl-3"><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2faakinshin.net%2fposts%2fkosqe1%2f" target=_blank title="Share on HackerNews"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#hacker-news"/></svg></a></div><div class="text-4xl pl-3"><a href="https://getpocket.com/save?url=https%3a%2f%2faakinshin.net%2fposts%2fkosqe1%2f&title=Quantile%20estimators%20based%20on%20k%20order%20statistics%2c%20Part%201%3a%20Motivation" target=_blank title="Add to Pocket"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#get-pocket"/></svg></a></div></div></div></div><script>var themeToggleDarkIcon=document.getElementById("theme-toggle-dark-icon"),themeToggleBtn,themeToggleLightIcon=document.getElementById("theme-toggle-light-icon");const imagesDark=document.querySelectorAll(".img-dark"),imagesLight=document.querySelectorAll(".img-light");localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(themeToggleLightIcon.classList.remove("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")})):(themeToggleDarkIcon.classList.remove("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")})),themeToggleBtn=document.getElementById("theme-toggle"),themeToggleBtn.addEventListener("click",function(){themeToggleDarkIcon.classList.toggle("hidden"),themeToggleLightIcon.classList.toggle("hidden"),imagesLight.forEach(e=>{e.classList.toggle("hidden")}),imagesDark.forEach(e=>{e.classList.toggle("hidden")}),localStorage.getItem("color-theme")?localStorage.getItem("color-theme")==="light"?(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"))})</script><footer class="z-20 p-4 md:p-6 mt-3 w-full border-t border-gray-200 shadow flex items-center justify-center dark:border-gray-600 bg-white dark:bg-zinc-800"><span class="dark:text-gray-400 text-center">© 2013—2023 <span class=whitespace-nowrap>Andrey Akinshin</span></span><ul class="flex flex-wrap items-center px-4 mb-1"><li><a href=https://github.com/AndreyAkinshin><svg class="fai fai-link w-5 h-5"><title>GitHub</title><use xlink:href="/img/fa/all.svg#github"/></svg></a></li><li><a href=https://twitter.com/andrey_akinshin><svg class="fai fai-link w-5 h-5"><title>Twitter</title><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></li><li><a href=https://aakinshin.net/posts/index.xml><svg class="fai fai-link w-5 h-5"><title>RSS</title><use xlink:href="/img/fa/all.svg#rss"/></svg></a></li></ul><div class=main-content><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></div></footer><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script></body></html>