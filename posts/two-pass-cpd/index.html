<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.123.3"><meta name=author content='Andrey Akinshin'><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content='Mathematics,Statistics,Research,Change point detection'><title>Two-pass change point detection for temporary interval condensation | Andrey Akinshin</title>
<meta name=description content="When we choose a change point detection algorithm, the most important thing is to clearly understand why we want to detect the change points. The knowledge of the final business goals is essential. In this post, I show a simple example of how a business req..."><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><script>localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><link href=https://aakinshin.net/css/main.min.c61942ad3fb32a41f8a3bca6f32ed9e12e725f37cccbcd7c4e52232b65d7f106.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"></head><body><nav><div class="container flex flex-wrap items-center justify-between mx-auto max-w-6xl h-12 px-2 xs:px-6"><div class="flex items-center justify-start justify-self-start"><div class="flex nav-item h-12 w-12 items-center justify-center"><a class=text-white href=https://aakinshin.net/><svg class="fai w-5 h-5 pr-0 mb-0.5"><use xlink:href="/img/fa/all.svg#house-chimney"/></svg></a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/posts/>Posts</a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/research/>Research</a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/library/>Library</a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/about/>About</a></div></div><button id=theme-toggle type=button title="Alt+Click to match OS color theme" class="nav-item p-3 content-center justify-self-end"><svg id="theme-toggle-dark-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001.0 1010.586 10.586z"/></svg><svg id="theme-toggle-light-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1A1 1 0 119 4V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707A1 1 0 1113.536 5.05l.707-.707a1 1 0 011.414.0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707A1 1 0 004.343 5.757l.707.707zm1.414 8.486-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"/></svg></button></div></nav><div class="main container mx-auto max-w-6xl px-6"><div class=main-post><h1 class=blog-post-title id=post-title>Two-Pass Change Point Detection for Temporary Interval Condensation</h1><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg>
<time datetime=2023-12-12>December 12, 2023</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/mathematics/>Mathematics</a>
<a class=label-link href=https://aakinshin.net/tags/statistics/>Statistics</a>
<a class=label-link href=https://aakinshin.net/tags/research/>Research</a>
<a class=label-link href=https://aakinshin.net/tags/cpd/>Change Point Detection</a></div></div><br><div class=main-content><p>When we choose a change point detection algorithm, the most important thing is to clearly understand
why we want to detect the change points.
The knowledge of the final business goals is essential.
In this post, I show a simple example of how a business requirement can be translated into algorithm adjustments.</p><h3 id=the-problem>The problem</h3><p>Let us describe the context of a specific problem.
We monitor the values of the performance metrics of an application.
The source of these measurements does not matter: it can be server monitoring data or benchmark output from CI runs.
The underlying data often do not follow known distributions, and, therefore, we should use nonparametric statistics.
We want to be alerted in case of significant performance degradation.
We also want to have a dashboard of all recent non-investigated problems so that we can process them.
Each investigation takes time, and we want to avoid useless investigations due to false-positive degradation.
Only the most unpleasant problems should be reported.
It is acceptable to miss some minor problems if we decrease the false-positive rate.
The trustability of the system is more important than the completeness of the reports.</p><p>Now, with the context, let us consider the two following time series:</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/two-pass-cpd/img/timeline1-light.png target=_blank alt=timeline1><img src=/posts/two-pass-cpd/img/timeline1-light.png width=800>
</a><a class="img-dark hidden" href=/posts/two-pass-cpd/img/timeline1-dark.png target=_blank alt=timeline1><img src=/posts/two-pass-cpd/img/timeline1-dark.png width=800></a></div><p>In both cases, we have a clear degradation at the 200th iteration and a clear acceleration at the 250th iteration.
Most classic change point detectors easily detect both of these changes.
When we detect such a short interval (shorter than a predefined threshold), we call it &ldquo;temporary.&rdquo;
If there are several such intervals in a row, we join them into a single temporary interval.
Therefore, there are no two subsequent temporary intervals:
they are always separated by one of several long intervals that we call stable.
The temporary intervals are not so interesting to research,
so we want to condense the two corresponding change points into a single change event.
However, not all the temporary intervals are equally interesting from the business perspective.
Let us discuss two situations in the cases (1a) and (1b).</p><p>In the case (1a), the system was fully stabilized after a short period of degraded performance.
We call it &ldquo;temporary fluctuation.&rdquo;
Of course, the situation is suspicious: it may be worth considering researching why did this period happen.
However, since the problem is fully gone, it is a kind of &ldquo;important but not urgent&rdquo; problem.
I recommend silently adding it to the backlog of other suspicious cases deserving investigation.
Of course, do not forget to assign some of your time to process this backlog.
Systematic backlog processing is essential for building a reliable system.
This allows better task prioritization and protects you from an overwhelming flow of incoming alerts.</p><p>The case (1b) definitely deserves more attention.
Even though the last change point was an improvement,
the system has not fully recovered after the previous degradation.
We call such an interval &ldquo;transition stage,&rdquo; which can be also classified as degradation or acceleration.
Here we observe a degradation-type transition stage:
at the end, we still have worse performance than we had in the beginning.</p><p>Therefore, we have defined a business requirement: we want to distinguish
temporary fluctuation (like (1a)) from transition stages (like (1b)) in our change point alert system.</p><h3 id=the-adjustment>The adjustment</h3><p>There are plenty of existing change point detection algorithms.
It will be too tedious to adapt all of them to support the distinguishing mechanism.
Therefore, we suggest a postprocessing algorithm.
Once the list of change points is obtained, we find all temporary intervals.
In the cases (1a) and (1b), we suppose that both middle intervals are marked.</p><p>In the next stage, we cut the temporary intervals out and obtain the modified time series as shown below:</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/two-pass-cpd/img/timeline2-light.png target=_blank alt=timeline2><img src=/posts/two-pass-cpd/img/timeline2-light.png width=800>
</a><a class="img-dark hidden" href=/posts/two-pass-cpd/img/timeline2-dark.png target=_blank alt=timeline2><img src=/posts/two-pass-cpd/img/timeline2-dark.png width=800></a></div><p>After that, we perform a second pass of the same change point detection algorithm but on the modified time series.
If we detect a change point in the neighborhood of a cut point (say, half of the interval size threshold),
the corresponding interval may be considered as a transition stage between two stable stages as in the case (2b).
If there are no change points in the neighborhood of a cut point,
the corresponding interval may be considered as a temporary fluctuation as in the case (2a).</p><h3 id=conclusion>Conclusion</h3><p>The most reliable systems are typically designed with exceptional attention to detail.
Some improvements may seem minor, but together they can significantly improve the overall system quality.
Every single trick you apply to reduce the false-positive rate or improve the issue prioritization
simplifies the life of the persons on duty and makes their happiness level higher.</p></div><br><br></div></div><script>var themeToggleDarkIcon=document.getElementById("theme-toggle-dark-icon"),themeToggleBtn,themeToggleLightIcon=document.getElementById("theme-toggle-light-icon");const imagesDark=document.querySelectorAll(".img-dark"),imagesLight=document.querySelectorAll(".img-light");localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(themeToggleLightIcon.classList.remove("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")})):(themeToggleDarkIcon.classList.remove("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")}));function toggleTheme(e){e?(document.documentElement.classList.add("dark"),themeToggleLightIcon.classList.remove("hidden"),themeToggleDarkIcon.classList.add("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")}),imagesLight.forEach(e=>{e.classList.add("hidden")})):(document.documentElement.classList.remove("dark"),themeToggleDarkIcon.classList.remove("hidden"),themeToggleLightIcon.classList.add("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")}),imagesDark.forEach(e=>{e.classList.add("hidden")}))}themeToggleBtn=document.getElementById("theme-toggle"),themeToggleBtn.addEventListener("click",function(){themeToggleDarkIcon.classList.toggle("hidden"),themeToggleLightIcon.classList.toggle("hidden"),imagesLight.forEach(e=>{e.classList.toggle("hidden")}),imagesDark.forEach(e=>{e.classList.toggle("hidden")}),event.altKey?(localStorage.removeItem("color-theme"),toggleTheme(window.matchMedia("(prefers-color-scheme: dark)").matches)):localStorage.getItem("color-theme")?localStorage.getItem("color-theme")==="light"?(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"))}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{if(localStorage.getItem("color-theme")===null){const t=e.matches?"dark":"light";toggleTheme(t==="dark")}})</script><footer class="z-20 p-4 md:p-6 mt-3 w-full border-t border-gray-200 shadow flex items-center justify-center dark:border-gray-600 bg-white dark:bg-zinc-800"><span class="dark:text-gray-400 text-center">© 2013—2024 <span class=whitespace-nowrap>Andrey Akinshin</span></span><ul class="flex flex-wrap items-center px-4 mb-1"><li><a href=https://github.com/AndreyAkinshin><svg class="fai fai-link w-5 h-5"><title>GitHub</title><use xlink:href="/img/fa/all.svg#github"/></svg></a></li><li><a href=https://twitter.com/andrey_akinshin><svg class="fai fai-link w-5 h-5"><title>Twitter</title><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></li><li><a href=https://aakinshin.net/posts/index.xml><svg class="fai fai-link w-5 h-5"><title>RSS</title><use xlink:href="/img/fa/all.svg#rss"/></svg></a></li></ul><div class=main-content><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></div></footer><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+=" has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script></body></html>