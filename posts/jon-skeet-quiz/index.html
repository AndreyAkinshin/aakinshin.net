<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.103.0-DEV"><meta name=author content="Andrey Akinshin"><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content="Programming,.NET,C#"><title>Jon Skeet's Quiz | Andrey Akinshin</title><meta name=description content="Jon Skeet was once asked to give three questions to check how well you know C#. He asked the following questions:
Q1. What constructor call can you write s..."><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><script>localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><link href=https://aakinshin.net/css/main.min.13341ac97e21004cde7f286e6b392a1234aa8b2656426c008cfd9f98cd200dd1.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"></head><body><nav><div class="container flex flex-wrap items-center justify-between mx-auto max-w-6xl h-12 px-6"><div class="flex items-center justify-start justify-self-start"><div class="flex nav-item h-12 w-12 items-center justify-center"><a class=text-white href=https://aakinshin.net/><svg class="fai w-5 h-5 pr-0 mb-0.5"><use xlink:href="/img/fa/all.svg#house-chimney"/></svg></a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/posts/>Posts</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/research/>Research</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/about/>About</a></div></div><button id=theme-toggle type=button class="nav-item p-3 content-center justify-self-end"><svg id="theme-toggle-dark-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001.0 1010.586 10.586z"/></svg><svg id="theme-toggle-light-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1A1 1 0 119 4V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707A1 1 0 1113.536 5.05l.707-.707a1 1 0 011.414.0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707A1 1 0 004.343 5.757l.707.707zm1.414 8.486-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"/></svg></button></div></nav><div class="main container mx-auto max-w-6xl px-6"><div class=main-post><h1 class=blog-post-title id=post-title>Jon Skeet's Quiz</h1><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2013-11-03>November 3, 2013</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/programming/>Programming</a>
<a class=label-link href=https://aakinshin.net/tags/dotnet/>.NET</a>
<a class=label-link href=https://aakinshin.net/tags/cs/>C#</a></div></div><br><div class=main-content><p>Jon Skeet was once asked to give three questions to check how well you know C#. He asked the <a href=http://www.dotnetcurry.com/magazine/jon-skeet-quiz.aspx>following questions</a>:</p><ul><li><strong>Q1.</strong> <em>What constructor call can you write such that this prints True (at least on the Microsoft .NET implementation)?</em></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=kt>object</span> <span class=n>x</span> <span class=p>=</span> <span class=k>new</span> <span class=cm>/* fill in code here */</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>object</span> <span class=n>y</span> <span class=p>=</span> <span class=k>new</span> <span class=cm>/* fill in code here */</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>x</span> <span class=p>==</span> <span class=n>y</span><span class=p>);</span>
</span></span></code></pre></div><p><em>Note that it’s just a constructor call, and you can’t change the type of the variables.</em></p><ul><li><strong>Q2.</strong> <em>How can you make this code compile such that it calls three different method overloads?</em></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=k>void</span> <span class=n>Foo</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>EvilMethod</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=n>EvilMethod</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=n>EvilMethod</span><span class=p>&lt;</span><span class=kt>int?</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li><strong>Q3.</strong> <em>With a local variable (so no changing the variable value cunningly), how can you make this code fail on the second line?</em></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=kt>string</span> <span class=n>text</span> <span class=p>=</span> <span class=n>x</span><span class=p>.</span><span class=n>ToString</span><span class=p>();</span> <span class=c1>// No exception</span>
</span></span><span class=line><span class=cl><span class=n>Type</span> <span class=n>type</span> <span class=p>=</span> <span class=n>x</span><span class=p>.</span><span class=n>GetType</span><span class=p>();</span> <span class=c1>// Bang!</span>
</span></span></code></pre></div><p>These questions seemed interesting to me, that is why I decided to discuss the solutions.</p><hr><ul><li><strong>A1-1.</strong></li></ul><p>One of the simplest ways is using <a href="http://msdn.microsoft.com/en-us/library/1t3y8s4s(v=vs.90).aspx">Nullable</a> types:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=kt>object</span> <span class=n>x</span> <span class=p>=</span> <span class=k>new</span> <span class=kt>int?</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kt>object</span> <span class=n>y</span> <span class=p>=</span> <span class=k>new</span> <span class=kt>int?</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>x</span> <span class=p>==</span> <span class=n>y</span><span class=p>);</span>
</span></span></code></pre></div><p>In spite of the explicit call of the constructor, values we got are equal to null and thus they match.</p><ul><li><strong>A1-2.</strong>
Or you can remember of <a href=http://blogs.msdn.com/b/ericlippert/archive/2009/09/28/string-interning-and-string-empty.aspx>string interning</a> and declare two empty strings:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=kt>object</span> <span class=n>x</span> <span class=p>=</span> <span class=k>new</span> <span class=kt>string</span><span class=p>(</span><span class=k>new</span> <span class=kt>char</span><span class=p>[</span><span class=m>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=kt>object</span> <span class=n>y</span> <span class=p>=</span> <span class=k>new</span> <span class=kt>string</span><span class=p>(</span><span class=k>new</span> <span class=kt>char</span><span class=p>[</span><span class=m>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>x</span> <span class=p>==</span> <span class=n>y</span><span class=p>);</span>
</span></span></code></pre></div><ul><li><strong>A2.</strong> The second question is the most complicated one. It’s necessary to offer the solution which calls tree different method overloads. I can suggest the following code as a sample:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=k>public</span> <span class=k>class</span> <span class=nc>ReferenceGeneric</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;</span> <span class=k>where</span> <span class=n>T</span> <span class=p>:</span> <span class=k>class</span> <span class=p>{</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=k>class</span> <span class=nc>EvilClassBase</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>protected</span> <span class=k>void</span> <span class=n>EvilMethod</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;()</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;int?&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=k>class</span> <span class=nc>EvilClass</span> <span class=p>:</span> <span class=n>EvilClassBase</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>public</span> <span class=k>void</span> <span class=n>Run</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>EvilMethod</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=n>EvilMethod</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=n>EvilMethod</span><span class=p>&lt;</span><span class=kt>int?</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>private</span> <span class=k>void</span> <span class=n>EvilMethod</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;(</span><span class=n>ReferenceGeneric</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;</span> <span class=n>arg</span> <span class=p>=</span> <span class=k>null</span><span class=p>)</span> <span class=k>where</span> <span class=n>T</span> <span class=p>:</span> <span class=k>class</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;string&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>private</span> <span class=k>void</span> <span class=n>EvilMethod</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;(</span><span class=n>T</span><span class=p>?</span> <span class=n>arg</span> <span class=p>=</span> <span class=k>null</span><span class=p>)</span> <span class=k>where</span> <span class=n>T</span> <span class=p>:</span> <span class=k>struct</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;int&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Let’s consider <code>string</code> and <code>int</code> types. Here it’s quite simple: <code>string</code> is a reference type and <code>int</code> is a value type. The following constructions will help us write the code: <code>where T : class</code>, <code>where T : struct</code>. The default parameters will explicitly use <code>T</code> type in the corresponding way: the first method will use argument of the following type: <code>ReferenceGeneric&lt;T></code> (it can accept only reference types), and the second method will use <code>T</code>? (it can accept only value non-nullable types). Now calls of <code>EvilMethod&lt;string>()</code> and <code>EvilMethod&lt;int>()</code> will get correct overloads.</p><p>Let’s proceed to <code>int?</code>. We will create overload with a signature without any additional conditions <code>EvilMethod&lt;T>()</code> (unfortunately, C# doesn’t allow you to write anything of this kind <code>where T : Nullable&lt;int></code>). But if you declare this method in the same class, it will get calls of the first two methods. That is why you need to send it the base class.</p><p>Let’s look at what we have. Calls of <code>EvilMethod&lt;string>()</code> and <code>EvilMethod&lt;int>()</code> will see the suitable overloads in the current class and will use them. Call of <code>EvilMethod&lt;int?>()</code> won’t find a suitable overload in the current class and will apply to the base class for it. Power of <a href="http://msdn.microsoft.com/en-us/library/aa691336%28v=vs.71%29.aspx">C# Overload resolution rules</a> helped us once again!</p><ul><li><strong>A3.</strong> Again, Nullable types will help us!</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=kt>var</span> <span class=n>x</span> <span class=p>=</span> <span class=k>new</span> <span class=kt>int?</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kt>string</span> <span class=n>text</span> <span class=p>=</span> <span class=n>x</span><span class=p>.</span><span class=n>ToString</span><span class=p>();</span> <span class=c1>// No exception</span>
</span></span><span class=line><span class=cl><span class=n>Type</span> <span class=n>type</span> <span class=p>=</span> <span class=n>x</span><span class=p>.</span><span class=n>GetType</span><span class=p>();</span> <span class=c1>// Bang!</span>
</span></span></code></pre></div><p><a href=http://msdn.microsoft.com/en-us/library/9hd15ket.aspx>Remember</a> that <code>ToString()</code> method is overloaded in <code>Nullable&lt;T></code>, it will get an empty string for the null value. Unfortunately, this trick won’t work for <code>GetType()</code>. It can’t be overloaded and will through an exception for the null value. You can also <a href=http://stackoverflow.com/questions/12725631/nullable-type-gettype-throws-exception>read</a> the Jon’s original answer to this question.</p><p>Don’t forget that if you really want you can always access methods table via the unmanaged code and manually substitute reference to <code>GetType()</code>, but we were asked not to shuffle =).</p><h2 id=cross-posts>Cross-posts</h2><ul><li><a href=http://blogs.perpetuumsoft.com/dotnet/jon-skeets-quiz/>blogs.perpetuumsoft.com</a></li></ul></div><br><br><div class="flex flex-wrap justify-center items-center mb-5"><span>Share:</span><div class="text-4xl pl-3"><a href="https://www.reddit.com/submit?url=https%3a%2f%2faakinshin.net%2fposts%2fjon-skeet-quiz%2f&title=Jon%20Skeet%27s%20Quiz" target=_blank title="Share on Reddit"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#reddit"/></svg></a></div><div class="text-4xl pl-3"><a href="https://twitter.com/intent/tweet?text=Jon%20Skeet%27s%20Quiz&url=https%3a%2f%2faakinshin.net%2fposts%2fjon-skeet-quiz%2f&via=andrey_akinshin&related=andrey_akinshin" rel=nofollow target=_blank title="Share on Twitter"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></div><div class="text-4xl pl-3"><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2faakinshin.net%2fposts%2fjon-skeet-quiz%2f" target=_blank title="Share on HackerNews"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#hacker-news"/></svg></a></div><div class="text-4xl pl-3"><a href="https://getpocket.com/save?url=https%3a%2f%2faakinshin.net%2fposts%2fjon-skeet-quiz%2f&title=Jon%20Skeet%27s%20Quiz" target=_blank title="Add to Pocket"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#get-pocket"/></svg></a></div></div></div></div><script>var themeToggleDarkIcon=document.getElementById("theme-toggle-dark-icon"),themeToggleBtn,themeToggleLightIcon=document.getElementById("theme-toggle-light-icon");const imagesDark=document.querySelectorAll(".img-dark"),imagesLight=document.querySelectorAll(".img-light");localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(themeToggleLightIcon.classList.remove("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")})):(themeToggleDarkIcon.classList.remove("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")})),themeToggleBtn=document.getElementById("theme-toggle"),themeToggleBtn.addEventListener("click",function(){themeToggleDarkIcon.classList.toggle("hidden"),themeToggleLightIcon.classList.toggle("hidden"),imagesLight.forEach(e=>{e.classList.toggle("hidden")}),imagesDark.forEach(e=>{e.classList.toggle("hidden")}),localStorage.getItem("color-theme")?localStorage.getItem("color-theme")==="light"?(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"))})</script><footer class="z-20 p-4 md:p-6 mt-3 w-full border-t border-gray-200 shadow flex items-center justify-center dark:border-gray-600 bg-white dark:bg-zinc-800"><span class="dark:text-gray-400 text-center">© 2013—2022 <span class=whitespace-nowrap>Andrey Akinshin</span></span><ul class="flex flex-wrap items-center px-4 mb-1"><li><a href=https://github.com/AndreyAkinshin><svg class="fai fai-link w-5 h-5"><title>GitHub</title><use xlink:href="/img/fa/all.svg#github"/></svg></a></li><li><a href=https://twitter.com/andrey_akinshin><svg class="fai fai-link w-5 h-5"><title>Twitter</title><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></li><li><a href=https://aakinshin.net/posts/index.xml><svg class="fai fai-link w-5 h-5"><title>RSS</title><use xlink:href="/img/fa/all.svg#rss"/></svg></a></li></ul><div class=main-content><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></div></footer></body></html>