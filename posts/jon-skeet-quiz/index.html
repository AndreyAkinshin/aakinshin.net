<!doctype html><html lang=en class=h-100><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.74.3"><meta name=author content="Andrey Akinshin"><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content=".NET,C#"><title>Jon Skeet's Quiz | Andrey Akinshin</title><meta name=description content="Jon Skeet was once asked to give three questions to check how well you know C#. He asked the following questions:
 Q1. What constructor call can you write ..."><link href=/css/lumen-bootstrap.min.css theme=light rel=stylesheet type=text/css media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><link href=/css/slate-bootstrap.min.css theme=dark rel=stylesheet type=text/css media="(prefers-color-scheme: dark)"><link href=/css/syntax-light.css theme=light rel=stylesheet type=text/css media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><link href=/css/syntax-dark.css theme=dark rel=stylesheet type=text/css media="(prefers-color-scheme: dark)"><script src=https://aakinshin.net/js/theme-before.min.26d61b7027fe55e642f0001cef94cb75b567d721086492aab6b4e32d9ee7811d.js></script><script type=module src=https://aakinshin.net/js/dark-mode-toggle.min.882998740b9c4c24677576b997bde5a487246e2e3bd72128a0e922eaa59db029.mjs></script><link href=https://aakinshin.net/css/fontawesome-all.min.e78467baec0179d7ccd2ef995e0c94f25b4a63a3191a93c3547e22bdf590ef5d.css rel=stylesheet type=text/css media=all><link href=https://aakinshin.net/css/about.min.2a76db7cc14055b3bafacc363f453917ab54a818a7db2a0a9b2409c0f6bf07c5.css rel=stylesheet type=text/css media=all><link href=https://aakinshin.net/css/blog.min.fe41ce51781393cea2f6a8fd3567674242dd6203d0a0b62f852fb257e992a236.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZVB6MXSX32"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-ZVB6MXSX32');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-41419012-5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-41419012-5');</script><script type=text/javascript>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym");ym(28700916,"init",{clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src=https://mc.yandex.ru/watch/28700916 style=position:absolute;left:-9999px alt></div></noscript><script src=/js/jquery-3.3.1.slim.min.js></script></head><body><div class=bg-primary><div class="container bg-primary"><nav class="navbar navbar-expand-sm navbar-dark bg-primary"><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link id=nav-link-blog href=https://aakinshin.net/><i class="fas fa-home" title=Home style=color:#fff></i></a></li><li class=nav-item><a class=nav-link id=nav-link-posts href=https://aakinshin.net/posts/>Posts</a></li><li class=nav-item><a class=nav-link id=nav-link-about href=https://aakinshin.net/about/>About</a></li><li class=nav-item><a class=nav-link id=nav-link-pdnb href=https://aakinshin.net/pages/prodotnetbenchmarking/>Pro .NET Benchmarking</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" data-toggle=dropdown href=# role=button aria-haspopup=true aria-expanded=false>EN</a><div class=dropdown-menu><a class=dropdown-item href=https://aakinshin.net/ru/posts/jon-skeet-quiz/>RU</a></div></li></ul><ul class="navbar-nav ml-auto"><li class=nav-item><dark-mode-toggle permanent=true></dark-mode-toggle></li></ul></nav></div></div><div class=container><main id=main><div class=blog-main><div class=blog-post><h1 class=blog-post-title id=post-title>Jon Skeet's Quiz</h1><span class=blog-post-meta><div class=faicon><i class="far fa-calendar-alt"></i></div><time datetime=2013-11-03>November 3, 2013</time>
&nbsp;&nbsp;
<i class="fas fa-tag"></i>&nbsp;
<a href=https://aakinshin.net/tags/dotnet/ class="badge badge-info">.NET</a>
<a href=https://aakinshin.net/tags/cs/ class="badge badge-info">C#</a></span><br><br><p>Jon Skeet was once asked to give three questions to check how well you know C#. He asked the <a href=http://www.dotnetcurry.com/magazine/jon-skeet-quiz.aspx>following questions</a>:</p><ul><li><strong>Q1.</strong> <em>What constructor call can you write such that this prints True (at least on the Microsoft .NET implementation)?</em></li></ul><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=kt>object</span> <span class=n>x</span> <span class=p>=</span> <span class=k>new</span> <span class=cm>/* fill in code here */</span><span class=p>;</span>
<span class=kt>object</span> <span class=n>y</span> <span class=p>=</span> <span class=k>new</span> <span class=cm>/* fill in code here */</span><span class=p>;</span>
<span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>x</span> <span class=p>==</span> <span class=n>y</span><span class=p>);</span>
</code></pre></div><p><em>Note that it’s just a constructor call, and you can’t change the type of the variables.</em></p><ul><li><strong>Q2.</strong> <em>How can you make this code compile such that it calls three different method overloads?</em></li></ul><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=k>void</span> <span class=n>Foo</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>EvilMethod</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
    <span class=n>EvilMethod</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;();</span>
    <span class=n>EvilMethod</span><span class=p>&lt;</span><span class=kt>int?</span><span class=p>&gt;();</span>
<span class=p>}</span>
</code></pre></div><ul><li><strong>Q3.</strong> <em>With a local variable (so no changing the variable value cunningly), how can you make this code fail on the second line?</em></li></ul><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=kt>string</span> <span class=n>text</span> <span class=p>=</span> <span class=n>x</span><span class=p>.</span><span class=n>ToString</span><span class=p>();</span> <span class=c1>// No exception
</span><span class=c1></span><span class=n>Type</span> <span class=n>type</span> <span class=p>=</span> <span class=n>x</span><span class=p>.</span><span class=n>GetType</span><span class=p>();</span> <span class=c1>// Bang!
</span></code></pre></div><p>These questions seemed interesting to me, that is why I decided to discuss the solutions.</p><hr><ul><li><strong>A1-1.</strong></li></ul><p>One of the simplest ways is using <a href="http://msdn.microsoft.com/en-us/library/1t3y8s4s(v=vs.90).aspx">Nullable</a> types:</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=kt>object</span> <span class=n>x</span> <span class=p>=</span> <span class=k>new</span> <span class=kt>int?</span><span class=p>();</span>
<span class=kt>object</span> <span class=n>y</span> <span class=p>=</span> <span class=k>new</span> <span class=kt>int?</span><span class=p>();</span>
<span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>x</span> <span class=p>==</span> <span class=n>y</span><span class=p>);</span>
</code></pre></div><p>In spite of the explicit call of the constructor, values we got are equal to null and thus they match.</p><ul><li><strong>A1-2.</strong>
Or you can remember of <a href=http://blogs.msdn.com/b/ericlippert/archive/2009/09/28/string-interning-and-string-empty.aspx>string interning</a> and declare two empty strings:</li></ul><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=kt>object</span> <span class=n>x</span> <span class=p>=</span> <span class=k>new</span> <span class=kt>string</span><span class=p>(</span><span class=k>new</span> <span class=kt>char</span><span class=p>[</span><span class=m>0</span><span class=p>]);</span>
<span class=kt>object</span> <span class=n>y</span> <span class=p>=</span> <span class=k>new</span> <span class=kt>string</span><span class=p>(</span><span class=k>new</span> <span class=kt>char</span><span class=p>[</span><span class=m>0</span><span class=p>]);</span>
<span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>x</span> <span class=p>==</span> <span class=n>y</span><span class=p>);</span>
</code></pre></div><ul><li><strong>A2.</strong> The second question is the most complicated one. It’s necessary to offer the solution which calls tree different method overloads. I can suggest the following code as a sample:</li></ul><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=k>public</span> <span class=k>class</span> <span class=nc>ReferenceGeneric</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;</span> <span class=k>where</span> <span class=n>T</span> <span class=p>:</span> <span class=k>class</span> <span class=p>{</span> <span class=p>}</span>

<span class=k>public</span> <span class=k>class</span> <span class=nc>EvilClassBase</span>
<span class=p>{</span>
  <span class=k>protected</span> <span class=k>void</span> <span class=n>EvilMethod</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;()</span>
  <span class=p>{</span>
    <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;int?&#34;</span><span class=p>);</span>
  <span class=p>}</span>
<span class=p>}</span>

<span class=k>public</span> <span class=k>class</span> <span class=nc>EvilClass</span> <span class=p>:</span> <span class=n>EvilClassBase</span>
<span class=p>{</span>
  <span class=k>public</span> <span class=k>void</span> <span class=n>Run</span><span class=p>()</span>
  <span class=p>{</span>
    <span class=n>EvilMethod</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
    <span class=n>EvilMethod</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;();</span>
    <span class=n>EvilMethod</span><span class=p>&lt;</span><span class=kt>int?</span><span class=p>&gt;();</span>
  <span class=p>}</span>

  <span class=k>private</span> <span class=k>void</span> <span class=n>EvilMethod</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;(</span><span class=n>ReferenceGeneric</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;</span> <span class=n>arg</span> <span class=p>=</span> <span class=k>null</span><span class=p>)</span> <span class=k>where</span> <span class=n>T</span> <span class=p>:</span> <span class=k>class</span>
  <span class=p>{</span>
    <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;string&#34;</span><span class=p>);</span>
  <span class=p>}</span>

  <span class=k>private</span> <span class=k>void</span> <span class=n>EvilMethod</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;(</span><span class=n>T</span><span class=p>?</span> <span class=n>arg</span> <span class=p>=</span> <span class=k>null</span><span class=p>)</span> <span class=k>where</span> <span class=n>T</span> <span class=p>:</span> <span class=k>struct</span>
  <span class=p>{</span>
    <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;int&#34;</span><span class=p>);</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>Let’s consider <code>string</code> and <code>int</code> types. Here it’s quite simple: <code>string</code> is a reference type and <code>int</code> is a value type. The following constructions will help us write the code: <code>where T : class</code>, <code>where T : struct</code>. The default parameters will explicitly use <code>T</code> type in the corresponding way: the first method will use argument of the following type: <code>ReferenceGeneric&lt;T></code> (it can accept only reference types), and the second method will use <code>T</code>? (it can accept only value non-nullable types). Now calls of <code>EvilMethod&lt;string>()</code> and <code>EvilMethod&lt;int>()</code> will get correct overloads.</p><p>Let’s proceed to <code>int?</code>. We will create overload with a signature without any additional conditions <code>EvilMethod&lt;T>()</code> (unfortunately, C# doesn’t allow you to write anything of this kind <code>where T : Nullable&lt;int></code>). But if you declare this method in the same class, it will get calls of the first two methods. That is why you need to send it the base class.</p><p>Let’s look at what we have. Calls of <code>EvilMethod&lt;string>()</code> and <code>EvilMethod&lt;int>()</code> will see the suitable overloads in the current class and will use them. Call of <code>EvilMethod&lt;int?>()</code> won’t find a suitable overload in the current class and will apply to the base class for it. Power of <a href="http://msdn.microsoft.com/en-us/library/aa691336%28v=vs.71%29.aspx">C# Overload resolution rules</a> helped us once again!</p><ul><li><strong>A3.</strong> Again, Nullable types will help us!</li></ul><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=kt>var</span> <span class=n>x</span> <span class=p>=</span> <span class=k>new</span> <span class=kt>int?</span><span class=p>();</span>
<span class=kt>string</span> <span class=n>text</span> <span class=p>=</span> <span class=n>x</span><span class=p>.</span><span class=n>ToString</span><span class=p>();</span> <span class=c1>// No exception
</span><span class=c1></span><span class=n>Type</span> <span class=n>type</span> <span class=p>=</span> <span class=n>x</span><span class=p>.</span><span class=n>GetType</span><span class=p>();</span> <span class=c1>// Bang!
</span></code></pre></div><p><a href=http://msdn.microsoft.com/en-us/library/9hd15ket.aspx>Remember</a> that <code>ToString()</code> method is overloaded in <code>Nullable&lt;T></code>, it will get an empty string for the null value. Unfortunately, this trick won’t work for <code>GetType()</code>. It can’t be overloaded and will through an exception for the null value. You can also <a href=http://stackoverflow.com/questions/12725631/nullable-type-gettype-throws-exception>read</a> the Jon’s original answer to this question.</p><p>Don’t forget that if you really want you can always access methods table via the unmanaged code and manually substitute reference to <code>GetType()</code>, but we were asked not to shuffle =).</p><h2 id=cross-posts>Cross-posts</h2><ul><li><a href=http://blogs.perpetuumsoft.com/dotnet/jon-skeets-quiz/>blogs.perpetuumsoft.com</a></li></ul><br><br><div class=row><div class="mx-auto share-block"><div class=share-title>Share:</div><div class=share-button><a href="https://www.reddit.com/submit?url=https%3a%2f%2faakinshin.net%2fposts%2fjon-skeet-quiz%2f&title=Jon%20Skeet%27s%20Quiz" target=_blank title="Share on Reddit"><i class="fab fa-reddit fa-2x"></i></a></div><div class=share-button><a href="https://twitter.com/intent/tweet?text=Jon%20Skeet%27s%20Quiz&url=https%3a%2f%2faakinshin.net%2fposts%2fjon-skeet-quiz%2f&via=andrey_akinshin&related=andrey_akinshin" rel=nofollow target=_blank title="Share on Twitter"><i class="fab fa-twitter fa-2x"></i></a></div><div class=share-button><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2faakinshin.net%2fposts%2fjon-skeet-quiz%2f" target=_blank title="Share on HackerNews"><i class="fab fa-hacker-news fa-2x"></i></a></div><div class=share-button><a href="https://facebook.com/sharer.php?u=https%3a%2f%2faakinshin.net%2fposts%2fjon-skeet-quiz%2f" rel=nofollow target=_blank title="Share on Facebook"><i class="fab fa-facebook fa-2x"></i></a></div><div class=share-button><a href="http://vk.com/share.php?url=https%3a%2f%2faakinshin.net%2fposts%2fjon-skeet-quiz%2f" target=_blank title="Share on VKontakte"><i class="fab fa-vk fa-2x"></i></a></div><div class=share-button><a href="https://getpocket.com/save?url=https%3a%2f%2faakinshin.net%2fposts%2fjon-skeet-quiz%2f&title=Jon%20Skeet%27s%20Quiz" target=_blank title="Add to Pocket"><i class="fab fa-get-pocket fa-2x"></i></a></div></div></div></div><hr></div></div></main></div><footer class=blog-footer><div class=container><p>&copy; 2013–2020 Andrey Akinshin
|
<a href=https://github.com/AndreyAkinshin><i class="fab fa-github" title=GitHub style=color:#fff></i></a><a href=https://twitter.com/andrey_akinshin><i class="fab fa-twitter" title=Twitter style=color:#fff></i></a><a href=https://aakinshin.net/posts/index.xml><i class="fas fa-rss" title=RSS style=color:#fff></i></a>|
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></p></div></footer><script src=https://aakinshin.net/js/theme-after.min.082780cb948cc57eabbc0d80172a7a5347d5572b599938b4c9876dfd7978b424.js></script><script src=/js/popper.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/anchor.min.js></script><script src=https://aakinshin.net/js/custom.min.11932490dde776463ed165b345838c701accc0cfdedf2e0868f13415f41f0872.js></script></body></html>