<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="description" content="Distribution comparison via the shift and ratio functions">
    <meta name="author" content="Andrey Akinshin">
    <link href="/img/favicon.ico" rel="icon" type="image/x-icon"/>
    <meta name="keywords" content='Statistics'>

    <title>Distribution comparison via the shift and ratio functions</title>

    <!-- Bootstrap CSS & Highlight.js-->
    <link href="/css/lumen-bootstrap.min.css" theme="light" rel="stylesheet" type="text/css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
    <link href="/css/slate-bootstrap.min.css" theme="dark" rel="stylesheet" type="text/css" media="(prefers-color-scheme: dark)">
    <link href="/css/github-highlight.css" theme="light" rel="stylesheet" type="text/css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
    <link href="/css/darcula-highlight.css" theme="dark" rel="stylesheet" type="text/css" media="(prefers-color-scheme: dark)">
    <script src="/js/theme-before.js"></script>

    <!-- DarkModeToggle -->
    <script type="module" src="https://googlechromelabs.github.io/dark-mode-toggle/src/dark-mode-toggle.mjs"></script>

    <!-- FontAwesome -->
    <link href="/css/fontawesome-all.min.css" rel="stylesheet" type="text/css" media="all">
    
    <!-- Custom styles -->
    <link href="/css/about.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/blog.css" rel="stylesheet" type="text/css" media="all">

    <!-- Feeds -->
    <link href="/en/rss.xml" type="application/rss+xml" rel="alternate" title="Blog RSS Feed" />
    <link href="/en/atom.xml" type="application/atom+xml" rel="alternate" title="Blog ATOM Feed" />

    <!-- Google analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-41419012-5', 'auto');
      ga('send', 'pageview');
    </script>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
        (function (d, w, c) {
            (w[c] = w[c] || []).push(function() {
                try {
                    w.yaCounter28700916 = new Ya.Metrika({
                        id:28700916,
                        clickmap:true,
                        trackLinks:true,
                        accurateTrackBounce:true,
                        webvisor:true,
                        trackHash:true
                    });
                } catch(e) { }
            });

            var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function () { n.parentNode.insertBefore(s, n); };
            s.type = "text/javascript";
            s.async = true;
            s.src = "https://mc.yandex.ru/metrika/watch.js";

            if (w.opera == "[object Opera]") {
                d.addEventListener("DOMContentLoaded", f, false);
            } else { f(); }
        })(document, window, "yandex_metrika_callbacks");
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/28700916" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->

    <!-- jQuery -->
    <script src="/js/jquery-3.3.1.slim.min.js"></script>
  </head>

  <body>
    <div class="bg-primary">
      <div class="container bg-primary">
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" id="nav-link-blog" href="/posts/">Posts</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="nav-link-blog-content" href="/content/">Content</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="nav-link-about" href="/about/">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="nav-link-about" href="/prodotnetbenchmarking/">Pro .NET Benchmarking</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">En</a>
              <div class="dropdown-menu">
                  <a class="dropdown-item" href='/ru/posts/shift-and-ratio-functions/'>Ru</a>
              </div>
            </li>
            <li class="nav-item"></li>
              <dark-mode-toggle permanent="true"></dark-mode-toggle>
            </li>
          </ul>
          <ul class="navbar-nav ml-auto">
            <li class="nav-item"><a class="nav-link" href="https://github.com/AndreyAkinshin"><i class="fab fa-github" title="GitHub" style="color:white"></i></a></li>
            <li class="nav-item"><a class="nav-link" href="https://twitter.com/andrey_akinshin"><i class="fab fa-twitter" title="Twitter" style="color:white"></i></a></li>
            <li class="nav-item"><a class="nav-link" href="/rss.xml"><i class="fas fa-rss" title="RSS" style="color:white"></i></a></li>
          </ul>
        </nav>
      </div>
    </div>

    <div class="container">
      <div class="blog-main">
<div class="blog-post">

<h2 class="blog-post-title" id="post-title">Distribution comparison via the shift and ratio functions</h2>
<span class="blog-post-meta">
  <b>Date:</b> October 11, 2019.
  <b>Tags:</b>
        <a href="/tags/statistics"><span class="badge badge-pill badge-info">Statistics</span></a>
</span><br /><br />

<p>When we compare two distributions, it's not always enough to detect a statistically significant difference between them.
In many cases, we also want to evaluate the magnitude of this difference.
Let's look at the following image:</p>
<div class="mx-auto">
<a href="/img/posts/shift-and-ratio-functions/compare1-light.png" target="_blank">
<picture>
<source theme='dark' srcset="/img/posts/shift-and-ratio-functions/compare1-dark.png" media="(prefers-color-scheme: dark)">
<source theme='light' srcset="/img/posts/shift-and-ratio-functions/compare1-light.png" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<img class="mx-auto d-block img-fluid" width="800" src="/img/posts/shift-and-ratio-functions/compare1-light.png">
</picture>
</a>
</div>
<p>On the left side, we can see a timeline plot with 2000 points
(at the middle of this plot, the distribution was significantly changed).
On the right side, you can see density plots for the left and the right side of
the timeline plot (before and after the change).
It's a pretty simple case, the difference between distributions be expressed via the
difference between mean values.</p>
<p>Now let's look at a more tricky case:</p>
<div class="mx-auto">
<a href="/img/posts/shift-and-ratio-functions/compare2-light.png" target="_blank">
<picture>
<source theme='dark' srcset="/img/posts/shift-and-ratio-functions/compare2-dark.png" media="(prefers-color-scheme: dark)">
<source theme='light' srcset="/img/posts/shift-and-ratio-functions/compare2-light.png" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<img class="mx-auto d-block img-fluid" width="800" src="/img/posts/shift-and-ratio-functions/compare2-light.png">
</picture>
</a>
</div>
<p>Here we have a bimodal distribution; after the change, the left mode &quot;moved right.&quot;
Now it's much harder to evaluate the difference between distributions
because the mean and the median values almost not changed:
the right mode has the biggest impact on these metrics than the left more.</p>
<p>And here is a much more tricky case:</p>
<div class="mx-auto">
<a href="/img/posts/shift-and-ratio-functions/compare3-light.png" target="_blank">
<picture>
<source theme='dark' srcset="/img/posts/shift-and-ratio-functions/compare3-dark.png" media="(prefers-color-scheme: dark)">
<source theme='light' srcset="/img/posts/shift-and-ratio-functions/compare3-light.png" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<img class="mx-auto d-block img-fluid" width="800" src="/img/posts/shift-and-ratio-functions/compare3-light.png">
</picture>
</a>
</div>
<p>Here we also have a bimodal distribution; after the change, both modes moved:
the left mode &quot;moved right&quot; and the right mode &quot;moved left.&quot;
How should we describe the difference between these distributions now?</p>
<!--more-->
<h3 id="shift-function">Shift function</h3>
<p>One of my favorite ways to do it is the
<a href="https://garstats.wordpress.com/2016/07/12/shift-function/">shift function</a>
that was introduced by Kjell Doksum in 1974 (check out these two papers:
<a href="https://doi.org/10.1214/aos/1176342662">&quot;Empirical Probability Plots and Statistical Inference for Nonlinear Models in the Two-Sample Case&quot;</a> and
<a href="https://doi.org/10.2307/2335720">&quot;Plotting with Confidence: Graphical Comparisons of Two Populations&quot;</a>).
The idea is pretty simple: for each <a href="https://en.wikipedia.org/wiki/Quantile">quantile</a>,
we should calculate the corresponding value for both distributions and find the difference between them.
For the above three cases, the shift function plots will look like this:</p>
<div class="mx-auto">
<a href="/img/posts/shift-and-ratio-functions/shift-light.png" target="_blank">
<picture>
<source theme='dark' srcset="/img/posts/shift-and-ratio-functions/shift-dark.png" media="(prefers-color-scheme: dark)">
<source theme='light' srcset="/img/posts/shift-and-ratio-functions/shift-light.png" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<img class="mx-auto d-block img-fluid" width="800" src="/img/posts/shift-and-ratio-functions/shift-light.png">
</picture>
</a>
</div>
<p>Based on these pictures, we can quickly come up with the following conclusions:</p>
<ul>
<li>Case 1. All of the quantiles were increased by ≈30.</li>
<li>Case 2. Some small quantiles were increased by ≈20;
other quantiles remained in place.</li>
<li>Case 3. Some small quantiles were increased by ≈20;
other quantiles decreased by ≈40.</li>
</ul>
<p>As you can see, the shift function helps us to understand the changes for all of the individual quantiles.</p>
<h3 id="ratio-function">Ratio function</h3>
<p>By analog, we can evaluate the ratio function:
instead of the difference, we should divide the value on each quantile for one distribution
on the value of the same quantile for another distribution (check out this paper:
<a href="https://arxiv.org/abs/1308.2845">&quot;Quantile and quantile-function estimations under density ratio model&quot;</a>).
It will look like this:</p>
<div class="mx-auto">
<a href="/img/posts/shift-and-ratio-functions/ratio-light.png" target="_blank">
<picture>
<source theme='dark' srcset="/img/posts/shift-and-ratio-functions/ratio-dark.png" media="(prefers-color-scheme: dark)">
<source theme='light' srcset="/img/posts/shift-and-ratio-functions/ratio-light.png" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<img class="mx-auto d-block img-fluid" width="800" src="/img/posts/shift-and-ratio-functions/ratio-light.png">
</picture>
</a>
</div>
<p>These pictures also allow us making conclusions about the presented distributions:</p>
<ul>
<li>Case 1. All of the quantiles were increased by ≈20-30%.</li>
<li>Case 2. Some small quantiles were increased by ≈60-80%;
other quantiles remained in place.</li>
<li>Case 3. Some small quantiles were increased by ≈60-80%;
other quantiles decreased by ≈15%.</li>
</ul>
<h3 id="more-complicated-cases">More complicated cases</h3>
<p>Let's look at a few more complicated cases.</p>
<div class="mx-auto">
<a href="/img/posts/shift-and-ratio-functions/compare4-light.png" target="_blank">
<picture>
<source theme='dark' srcset="/img/posts/shift-and-ratio-functions/compare4-dark.png" media="(prefers-color-scheme: dark)">
<source theme='light' srcset="/img/posts/shift-and-ratio-functions/compare4-light.png" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<img class="mx-auto d-block img-fluid" width="800" src="/img/posts/shift-and-ratio-functions/compare4-light.png">
</picture>
</a>
</div>
<br />
<div class="mx-auto">
<a href="/img/posts/shift-and-ratio-functions/compare5-light.png" target="_blank">
<picture>
<source theme='dark' srcset="/img/posts/shift-and-ratio-functions/compare5-dark.png" media="(prefers-color-scheme: dark)">
<source theme='light' srcset="/img/posts/shift-and-ratio-functions/compare5-light.png" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<img class="mx-auto d-block img-fluid" width="800" src="/img/posts/shift-and-ratio-functions/compare5-light.png">
</picture>
</a>
</div>
<br />
<div class="mx-auto">
<a href="/img/posts/shift-and-ratio-functions/compare6-light.png" target="_blank">
<picture>
<source theme='dark' srcset="/img/posts/shift-and-ratio-functions/compare6-dark.png" media="(prefers-color-scheme: dark)">
<source theme='light' srcset="/img/posts/shift-and-ratio-functions/compare6-light.png" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<img class="mx-auto d-block img-fluid" width="800" src="/img/posts/shift-and-ratio-functions/compare6-light.png">
</picture>
</a>
</div>
<p>The last two cases are especially complicated because it's not easy to say what's going on there
even if look at the density functions.
Fortunately, the shift functions helps us to get more useful information from the data.</p>
<h3 id="implementation-notes">Implementation notes</h3>
<p>I would like to highlight some important facts that can be useful if you decided to adopt the shift and ratio functions:</p>
<ul>
<li>The value of shift and ratio functions for extreme quantiles (≤0.1 or ≥0.9) may be very unstable
(the situation can be improved using the percentile bootstrap approach).
If you don't care about extreme quantiles and want to describe the difference for the &quot;main&quot; part of your distributions, I recommend using the <code>[0.1, 0.9]</code> quantile interval.</li>
<li>There are several ways to visualize shift functions.
You can find an example of an alternative visualization <a href="https://garstats.wordpress.com/2016/07/12/shift-function/">here</a>.</li>
<li>There are several ways to calculate the quantile values for a sample.
For example, in this blog post, I used the Harrell-Davis quantile estimator (see
Harrell, F.E. &amp; Davis, C.E. (1982) <a href="https://academic.oup.com/biomet/article-abstract/69/3/635/221346/">A new distribution-free quantile estimator</a>. Biometrika, 69, 635-640;
<a href="https://garstats.wordpress.com/2016/06/09/the-harrell-davis-quantile-estimator/">The Harrell-Davis quantile estimator</a> by Guillaume Rousselet).
Also, you can use <a href="https://garstats.wordpress.com/2016/05/27/the-percentile-bootstrap/">the percentile bootstrap</a> (see
Wilcox, R.R. (2012) <a href="https://doi.org/10.1016/C2010-0-67044-1">Introduction to robust estimation and hypothesis testing</a>. Academic Press, Amsterdam; Boston;
Wilcox, R.R. &amp; Erceg-Hurn, D.M. (2012) <a href="https://doi.org/10.1080/02664763.2012.724665">Comparing two dependent groups via quantiles</a>. J Appl Stat, 39, 2655-2664;
<a href="https://garstats.wordpress.com/2016/07/12/shift-function/">the shift function: a powerful tool to compare two entire distributions</a> by Guillaume Rousselet).</li>
<li>Harrell-Davis quantile estimator provides not only approximated quantile values, but also confidence intervals.</li>
</ul>
<h3 id="conclusion">Conclusion</h3>
<p>The shift and ratio functions provide an easy way to describe the difference between two distributions.
The shift function shows the absolute difference for each quantile;
the ratio function shows the relative difference.
The best thing about them is that they work pretty good even with multimodal distributions
(it's very important because <a href="/posts/normality/">normality is a myth</a>).</p>
<p>You may need some time to get used to these charts and learn how to extract information from them quickly.
But as soon as you learn, this visualization approach will become your faithful assistant
which will allow you to compare distributions fast and easy way.</p>

<!-- Share -->

Share:
<a href="https://twitter.com/intent/tweet?text=Distribution comparison via the shift and ratio functions&url=http://aakinshin.net/posts/shift-and-ratio-functions/&via=andrey_akinshin&related=andrey_akinshin" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fab fa-twitter fa-2x" title="Twitter"></i></a>
<a href="https://www.reddit.com/submit?url=http://aakinshin.net/posts/shift-and-ratio-functions/" target="_blank" title="Share on Reddit"><i class="fab fa-reddit fa-2x"></i></a>
<a href="https://news.ycombinator.com/submitlink?u=http://aakinshin.net/posts/shift-and-ratio-functions/" target="_blank" title="Share on HackerNews"><i class="fab fa-hacker-news fa-2x"></i></a>
<a href="https://facebook.com/sharer.php?u=http://aakinshin.net/posts/shift-and-ratio-functions/" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fab fa-facebook fa-2x"></i></a>
<a href="https://plus.google.com/share?url=http://aakinshin.net/posts/shift-and-ratio-functions/" rel="nofollow" target="_blank" title="Share on Google+"><i class="fab fab fa-google-plus-g fa-2x"></i></a>
<a href="http://vk.com/share.php?url=http://aakinshin.net/posts/shift-and-ratio-functions/" target="_blank" title="Share on VKontakte"><i class="fab fa-vk fa-2x"></i></a>
<a href="https://getpocket.com/save?url=http://aakinshin.net/posts/shift-and-ratio-functions/&title=Distribution comparison via the shift and ratio functions" target="_blank" title="Add to Pocket"><i class="fab fa-get-pocket fa-2x"></i></a>
<hr />

<!-- GitHub -->
<div>
  You can find source code of this post on GitHub:<br />
  <a href="https://github.com/AndreyAkinshin/aakinshin.net/blob/master/web/_posts/en/2019/shift-and-ratio-functions.md">https://github.com/AndreyAkinshin/aakinshin.net/blob/master/web/_posts/en/2019/shift-and-ratio-functions.md</a>
</div>

</div>
</div>
    </div>

    <footer class="blog-footer">
      <div class="container">
        <p>&copy; 2013–2020 Andrey Akinshin | <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></p>
      </div>
    </footer>

    <script src="/js/theme-after.js"></script>
    <!-- jQuery first (header), then popper, then Bootstrap JS. -->
    <script src="/js/popper.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <!-- Other scripts -->
    <script src="/js/highlight.pack.js"></script>
    <script src="/js/anchor.min.js"></script>
    <script src="/js/custom.js"></script>
  </body>
</html>
