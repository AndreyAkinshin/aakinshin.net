<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="description" content="Nonparametric Cohen&#39;s d-consistent effect size">
    <meta name="author" content="Andrey Akinshin">
    <link href="/img/favicon.ico" rel="icon" type="image/x-icon"/>
    <meta name="keywords" content='Statistics,Effect size,MAD,Harrell-Davis,R,Perfolizer'>

    <title>Nonparametric Cohen&#39;s d-consistent effect size</title>

    <!-- Bootstrap CSS & Highlight.js-->
    <link href="/css/lumen-bootstrap.min.css" theme="light" rel="stylesheet" type="text/css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
    <link href="/css/slate-bootstrap.min.css" theme="dark" rel="stylesheet" type="text/css" media="(prefers-color-scheme: dark)">
    <link href="/css/github-highlight.css" theme="light" rel="stylesheet" type="text/css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
    <link href="/css/darcula-highlight.css" theme="dark" rel="stylesheet" type="text/css" media="(prefers-color-scheme: dark)">
    <script src="/js/theme-before.js"></script>

    <!-- DarkModeToggle -->
    <script type="module" src="https://googlechromelabs.github.io/dark-mode-toggle/src/dark-mode-toggle.mjs"></script>

    <!-- FontAwesome -->
    <link href="/css/fontawesome-all.min.css" rel="stylesheet" type="text/css" media="all">
    
    <!-- Custom styles -->
    <link href="/css/about.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/blog.css" rel="stylesheet" type="text/css" media="all">

    <!-- Feeds -->
    <link href="/en/rss.xml" type="application/rss+xml" rel="alternate" title="Blog RSS Feed" />
    <link href="/en/atom.xml" type="application/atom+xml" rel="alternate" title="Blog ATOM Feed" />

    <!-- Google analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-41419012-5', 'auto');
      ga('send', 'pageview');
    </script>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
        (function (d, w, c) {
            (w[c] = w[c] || []).push(function() {
                try {
                    w.yaCounter28700916 = new Ya.Metrika({
                        id:28700916,
                        clickmap:true,
                        trackLinks:true,
                        accurateTrackBounce:true,
                        webvisor:true,
                        trackHash:true
                    });
                } catch(e) { }
            });

            var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function () { n.parentNode.insertBefore(s, n); };
            s.type = "text/javascript";
            s.async = true;
            s.src = "https://mc.yandex.ru/metrika/watch.js";

            if (w.opera == "[object Opera]") {
                d.addEventListener("DOMContentLoaded", f, false);
            } else { f(); }
        })(document, window, "yandex_metrika_callbacks");
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/28700916" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->

    <!-- jQuery -->
    <script src="/js/jquery-3.3.1.slim.min.js"></script>
  </head>

  <body>
    <div class="bg-primary">
      <div class="container bg-primary">
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" id="nav-link-blog" href="/posts/">Posts</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="nav-link-blog-content" href="/content/">Content</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="nav-link-about" href="/about/">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="nav-link-about" href="/prodotnetbenchmarking/">Pro .NET Benchmarking</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">En</a>
              <div class="dropdown-menu">
                  <a class="dropdown-item" href='/ru/posts/nonparametric-effect-size/'>Ru</a>
              </div>
            </li>
            <li class="nav-item"></li>
              <dark-mode-toggle permanent="true"></dark-mode-toggle>
            </li>
          </ul>
          <ul class="navbar-nav ml-auto">
            <li class="nav-item"><a class="nav-link" href="https://github.com/AndreyAkinshin"><i class="fab fa-github" title="GitHub" style="color:white"></i></a></li>
            <li class="nav-item"><a class="nav-link" href="https://twitter.com/andrey_akinshin"><i class="fab fa-twitter" title="Twitter" style="color:white"></i></a></li>
            <li class="nav-item"><a class="nav-link" href="/rss.xml"><i class="fas fa-rss" title="RSS" style="color:white"></i></a></li>
          </ul>
        </nav>
      </div>
    </div>

    <div class="container">
      <div class="blog-main">
<div class="blog-post">

<h2 class="blog-post-title" id="post-title">Nonparametric Cohen&#39;s d-consistent effect size</h2>
<span class="blog-post-meta">
  <b>Date:</b> June 25, 2020.
  <b>Tags:</b>
        <a href="/tags/statistics"><span class="badge badge-pill badge-info">Statistics</span></a>
        <a href="/tags/effect-size"><span class="badge badge-pill badge-info">Effect size</span></a>
        <a href="/tags/mad"><span class="badge badge-pill badge-info">MAD</span></a>
        <a href="/tags/harrell-davis"><span class="badge badge-pill badge-info">Harrell-Davis</span></a>
        <a href="/tags/r"><span class="badge badge-pill badge-info">R</span></a>
        <a href="/tags/perfolizer"><span class="badge badge-pill badge-info">Perfolizer</span></a>
</span><br /><br />

<p>The effect size is a common way to describe a difference between two distributions.
When these distributions are normal, one of the most popular approaches to express the effect size is <a href="https://en.wikipedia.org/wiki/Effect_size#Cohen%27s_d">Cohen's d</a>.
Unfortunately, it doesn't work great for non-normal distributions.</p>
<p>In this post, I will show a robust Cohen's d-consistent effect size formula for nonparametric distributions.</p>
<div class="mx-auto"><a href="/img/posts/nonparametric-effect-size/blackboard.png" target="_blank"><img class="mx-auto d-block img-fluid" width="800" src="/img/posts/nonparametric-effect-size/blackboard.png" /></a></div>
<!--more-->
<h3 id="cohens-d">Cohen's d</h3>
<p>Let's start with the basics.
For two samples <span class="math">\(X = \{ X_1, X_2, \ldots, X_{n_X} \}\)</span> and <span class="math">\(Y = \{ Y_1, Y_2, \ldots, Y_{n_Y} \}\)</span>, the <em>Cohen's d</em> is defined as follows (<a href="#Cohen1988">[Cohen1988]</a>):</p>
<div class="math">
\[

d = \frac{\overline{Y}-\overline{X}}{s}

\]</div>
<p>where <span class="math">\(s\)</span> is the <a href="https://en.wikipedia.org/wiki/Pooled_standard_deviation">pooled standard deviation</a>:</p>
<div class="math">
\[

s = \sqrt{\frac{(n_X - 1) s^2_X + (n_Y - 1) s^2_Y}{n_X + n_Y - 2}}.

\]</div>
<p>Our goal is to build a robust effect size formula that works the same way for normal distributions,
but also is applicable for nonparametric distributions.</p>
<h3 id="existing-nonparametric-effect-size-measures">Existing nonparametric effect size measures</h3>
<p>There are some existing nonparametric effect size measures, but most of them are clamped (they have fixed lower and upper bounds):</p>
<ul>
<li>Cliff's Delta (<a href="#Cliff1993">[Cliff1993]</a>): <span class="math">\([-1; 1]\)</span></li>
<li>Vargha-Delaney A (<a href="#Vargha2000">[Vargha2000]</a>): <span class="math">\([0; 1]\)</span></li>
<li>Wilcox's Q (<a href="#Wilcox2019">[Wilcox2019]</a>): <span class="math">\([0; 1]\)</span></li>
</ul>
<p>Let's consider the two following cases of nonoverlapped distribution pairs:</p>
<div class="math">
\[

X^{(1)} \in [0; 5] \quad \textrm{vs.} \quad Y^{(1)} \in [10; 20]

\]</div>
<p>and</p>
<div class="math">
\[

X^{(2)} \in [0; 5] \quad \textrm{vs.} \quad Y^{(2)} \in [50; 100].

\]</div>
<p>In both cases, all of the above measures have extreme values.
Thus, they don't help to distinguish these cases.
Meanwhile, the effect for <span class="math">\(X^{(2)} \; \textrm{vs.} \; Y^{(2)}\)</span> is much larger than the effect for <span class="math">\(X^{(1)} \; \textrm{vs.} \; Y^{(1)}\)</span>.
It would be nice to have an effect size measure that highlights this difference.</p>
<h3 id="quantiles-and-the-shift-function">Quantiles and the shift function</h3>
<p>When we compare two nonparametric distributions, it's a good idea to track differences for all quantile values.
We can do it via the <a href="/posts/shift-and-ratio-functions/">shift function</a> (<a href="#Doksum1974">[Doksum1974]</a>, <a href="#Doksum1976">[Doksum1976]</a>):</p>
<div class="mx-auto">
<a href="/img/posts/nonparametric-effect-size/compare4-light.png" target="_blank">
<picture>
<source theme='dark' srcset="/img/posts/nonparametric-effect-size/compare4-dark.png" media="(prefers-color-scheme: dark)">
<source theme='light' srcset="/img/posts/nonparametric-effect-size/compare4-light.png" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<img class="mx-auto d-block img-fluid" width="800" src="/img/posts/nonparametric-effect-size/compare4-light.png">
</picture>
</a>
</div>
<p>It shows the absolute shift for each quantile.
The robustness of the shift function can be improved with the help of <em>the Harrell-Davis quantile estimator</em> (<a href="Harrell1982">[Harrell1982]</a>).</p>
<p>Unfortunately, the raw shift function can't be used as the effect size because it heavily depends on the distribution dispersion.
Without it, we can't say if the shift values are large or small.
So, we need a way to normalize it.</p>
<h3 id="mad-normalization">MAD normalization</h3>
<p>My favorite measure of the statistical dispersion is <em>the median absolute deviation (MAD)</em>:</p>
<div class="math">
\[
\mathcal{MAD}_X = C \cdot \textrm{median}(|X_i - \textrm{median}(X)|), \quad
\mathcal{MAD}_Y = C \cdot \textrm{median}(|Y_i - \textrm{median}(Y)|).
\]</div>
<p>For the normally distributed values, there is a well-known relationship between the standard deviation and the median absolute deviation:</p>
<div class="math">
\[
s_X \approx 1.4826 \cdot \textrm{median}(|X_i - \textrm{median}(X)|).
\]</div>
<p>Thus, we can use <span class="math">\(C = 1.4826\)</span> (which is also known as <em>the consistency constant</em>) to make <span class="math">\(\mathcal{MAD}\)</span> a consistent estimator for the standard deviation estimation.</p>
<p>By analogy with the pooled standard deviation, we can introduce <em>the pooled median absolute deviation</em>:</p>
<div class="math">
\[

\mathcal{PMAD}_{XY} = \sqrt{\frac{(n_X - 1) \mathcal{MAD}^2_X + (n_Y - 1) \mathcal{MAD}^2_Y}{n_X + n_Y - 2}}.

\]</div>
<p>As usual, we can use the Harrell-Davis quantile estimator to improve the robustness of this metric.</p>
<h3 id="a-quantile-specific-effect-size">A quantile-specific effect size</h3>
<p>Now we are ready to write down the effect size for the given quantile <span class="math">\(p\)</span>.
Let's call it <span class="math">\(\gamma_p\)</span> (just because a lot of other good letters like
<a href="https://en.wikipedia.org/wiki/Effect_size#Cohen%27s_d">d</a>,
<a href="https://en.wikipedia.org/wiki/Effect_size#Glass%27_%CE%94">Δ</a>,
<a href="https://en.wikipedia.org/wiki/Effect_size#Hedges%27_g">g</a>,
<a href="https://en.wikipedia.org/wiki/Effect_size#%CE%A8,_root-mean-square_standardized_effect">Ψ</a>,
<a href="https://en.wikipedia.org/wiki/Effect_size#Cohen%27s_%C6%922">f</a>,
<a href="https://en.wikipedia.org/wiki/Effect_size#Cohen%27s_q">q</a>,
<a href="https://en.wikipedia.org/wiki/Effect_size#Cohen%27s_w">w</a>,
<a href="https://en.wikipedia.org/wiki/Effect_size#Cohen%27s_h">h</a>
are already occupied):</p>
<div class="math">
\[

\gamma_p = \frac{Q_p(Y) - Q_p(X)}{\mathcal{PMAD}_{XY}}

\]</div>
<p>where <span class="math">\(Q_p\)</span> is the <span class="math">\(p^{\textrm{th}}\)</span> quantile of the given sample.</p>
<p>For the normal distribution, the Cohen's d equals to <span class="math">\(\gamma_{0.5}\)</span>:</p>
<div class="math">
\[

d = \frac{\overline{Y}-\overline{X}}{s} \approx \frac{Q_{0.5}(Y) - Q_{0.5}(X)}{\mathcal{PMAD}_{XY}} = \gamma_{0.5}.

\]</div>
<h3 id="condensation">Condensation</h3>
<p>It's nice to have the effect size value for each specific quantile.
However, it would be more convenient to have a single number (or a few numbers) that express the difference.
Let's introduce a set of the <span class="math">\(\gamma_p\)</span> values for an interval:</p>
<div class="math">
\[

\tilde{\gamma}_p = \{ \gamma_t | t \in [p; 1 - p] \}.

\]</div>
<p>The shift function may be unstable around 0 and 1.
Thus, it makes sense to drop these values and operate with the middle of the shift function.
In practice, <span class="math">\(\tilde{\gamma}_{0.2}\)</span> or <span class="math">\(\tilde{\gamma}_{0.3}\)</span> work pretty well.
For the given <span class="math">\(\tilde{\gamma}_p\)</span>, we can calculate the minimum and maximum values for this function across all quantiles:</p>
<div class="math">
\[

\min (\tilde{\gamma}_p) = \min_{t \in [p; 1 - p] } \gamma_t, \quad
\max (\tilde{\gamma}_p) = \max_{t \in [p; 1 - p] } \gamma_t.

\]</div>
<p>Finally, we can define a range of <span class="math">\(\tilde{\gamma}_p\)</span>:</p>
<div class="math">
\[

\textrm{range}(\tilde{\gamma}_p) = [\min (\tilde{\gamma}_p); \max (\tilde{\gamma}_p)].

\]</div>
<p>When the range is narrow, we can replace <span class="math">\(\tilde{\gamma}_p\)</span> by the minimum of the maximum value (or the average of these values).
In practice, it will be a good way to describe the difference between two distributions using a single number.</p>
<p>When the range is wide, we can't condensate <span class="math">\(\tilde{\gamma}_p\)</span> to a single number
because the relationship between these distributions is too complex.
In this case, it's recommended to look at the plot of <span class="math">\(\tilde{\gamma}_p\)</span> (or just work with the range).</p>
<h3 id="reference-implementation">Reference implementation</h3>
<p>If you use R, here is the function that you can use in your scripts:</p>
<pre><code class="language-R">library(Hmisc)

pooled &lt;- function(x, y, FUN) {
  nx &lt;- length(x)
  ny &lt;- length(y)
  sqrt(((nx - 1) * FUN(x) ^ 2 + (ny - 1) * FUN(y) ^ 2) / (nx + ny - 2))
}
hdmedian &lt;- function(x) as.numeric(hdquantile(x, 0.5))
hdmad &lt;- function(x) 1.4826 * hdmedian(abs(x - hdmedian(x)))
phdmad &lt;- function(x, y) pooled(x, y, hdmad)
gammaEffectSize &lt;- function(x, y, prob)
  as.numeric((hdquantile(y, prob) - hdquantile(x, prob)) / phdmad(x, y))
</code></pre>
<p>If you use C#, you can take an implementation from
the latest nightly version (0.3.0-nightly.33+) of <a href="https://github.com/AndreyAkinshin/perfolizer">Perfolizer</a>
(you need <code>GammaEffectSize.CalcValue</code>).</p>
<h3 id="conclusion">Conclusion</h3>
<p>In this post, we built a new formula for the effect size:</p>
<div class="math">
\[

\gamma_p = \frac{Q_p(Y) - Q_p(X)}{\mathcal{PMAD}_{XY}}, \quad
\tilde{\gamma}_p = \{ \gamma_t | t \in [p; 1 - p] \}.

\]</div>
<p>It provides the effect size for each quantile, but it can also be condensed to a range or a single number.
It has the following advantages:</p>
<ul>
<li>It's robust (the robustness can be improved using the Harrell-Davis quantile estimator).</li>
<li>It's applicable for nonparametric distributions.</li>
<li>It's consistent with the Cohen's d for normal distributions.</li>
<li>It's not clamped, and it allows comparing large effect sizes for nonoverlapped distribution pairs.</li>
</ul>
<p>I use this approach to compare distributions of software performance measurements
(they are often right-skewed and heavily-tailed) in <a href="https://www.jetbrains.com/rider/">Rider</a>.
For my use cases, it works well and provides a good measure of the effect size.
I hope it can be useful in many other applications.
If you decide to try it, I will be happy to hear feedback about your experience.</p>
<h3 id="references">References</h3>
<ul>
<li><b id="Cohen1988">[Cohen1988]</b><br />
Cohen, Jacob. (1988).
Statistical Power Analysis for the Behavioral Sciences.
New York, NY: Routledge Academic</li>
<li><b id="Cliff1993">[Cliff1993]</b><br />
Cliff, Norman.
&quot;Dominance statistics: Ordinal analyses to answer ordinal questions.&quot;
<em>Psychological bulletin</em> 114, no. 3 (1993): 494.<br />
<a href="https://doi.org/10.1037/0033-2909.114.3.494">https://doi.org/10.1037/0033-2909.114.3.494</a></li>
<li><b id="Vargha2000">[Vargha2000]</b><br />
Vargha A., and Delaney, H. D.
&quot;A critique and improvement of the CL common language effect size statistics of McGraw and Wong.&quot;
<em>Journal of Educational and Behavioral Statistics</em>, 25(2):101-132, 2000<br />
<a href="https://doi.org/10.3102/10769986025002101">https://doi.org/10.3102/10769986025002101</a></li>
<li><b id="Wilcox2019">[Wilcox2019]</b><br />
Wilcox, Rand.
&quot;A Robust Nonparametric Measure of Effect Size Based on an Analog of Cohen's d, Plus Inferences About the Median of the Typical Difference.&quot;
<em>Journal of Modern Applied Statistical Methods</em> 17, no. 2 (2019): 1.</li>
<li><b id="Doksum1974">[Doksum1974]</b><br />
Doksum, Kjell.
&quot;Empirical probability plots and statistical inference for nonlinear models in the two-sample case.&quot;
<em>The annals of statistics</em> (1974): 267-277.<br />
<a href="https://doi.org/10.1214/aos/1176342662">https://doi.org/10.1214/aos/1176342662</a></li>
<li><b id="Doksum1976">[Doksum1976]</b><br />
Doksum, Kjell A., and Gerald L. Sievers.
&quot;Plotting with confidence: Graphical comparisons of two populations.&quot;
<em>Biometrika</em>, 63, no. 3 (1976): 421-434.<br />
<a href="https://doi.org/10.2307/2335720">https://doi.org/10.2307/2335720</a></li>
<li><b id="Harrell1982">[Harrell1982]</b><br />
Harrell, F.E. and Davis, C.E., 1982.
&quot;A new distribution-free quantile estimator.&quot;
<em>Biometrika</em>, 69(3), pp.635-640.<br />
<a href="https://pdfs.semanticscholar.org/1a48/9bb74293753023c5bb6bff8e41e8fe68060f.pdf">https://pdfs.semanticscholar.org/1a48/9bb74293753023c5bb6bff8e41e8fe68060f.pdf</a></li>
</ul>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<!-- Share -->

Share:
<a href="https://twitter.com/intent/tweet?text=Nonparametric Cohen&#39;s d-consistent effect size&url=http://aakinshin.net/posts/nonparametric-effect-size/&via=andrey_akinshin&related=andrey_akinshin" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fab fa-twitter fa-2x" title="Twitter"></i></a>
<a href="https://www.reddit.com/submit?url=http://aakinshin.net/posts/nonparametric-effect-size/" target="_blank" title="Share on Reddit"><i class="fab fa-reddit fa-2x"></i></a>
<a href="https://news.ycombinator.com/submitlink?u=http://aakinshin.net/posts/nonparametric-effect-size/" target="_blank" title="Share on HackerNews"><i class="fab fa-hacker-news fa-2x"></i></a>
<a href="https://facebook.com/sharer.php?u=http://aakinshin.net/posts/nonparametric-effect-size/" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fab fa-facebook fa-2x"></i></a>
<a href="https://plus.google.com/share?url=http://aakinshin.net/posts/nonparametric-effect-size/" rel="nofollow" target="_blank" title="Share on Google+"><i class="fab fab fa-google-plus-g fa-2x"></i></a>
<a href="http://vk.com/share.php?url=http://aakinshin.net/posts/nonparametric-effect-size/" target="_blank" title="Share on VKontakte"><i class="fab fa-vk fa-2x"></i></a>
<a href="https://getpocket.com/save?url=http://aakinshin.net/posts/nonparametric-effect-size/&title=Nonparametric Cohen&#39;s d-consistent effect size" target="_blank" title="Add to Pocket"><i class="fab fa-get-pocket fa-2x"></i></a>
<hr />

<!-- GitHub -->
<div>
  You can find source code of this post on GitHub:<br />
  <a href="https://github.com/AndreyAkinshin/aakinshin.net/blob/master/web/_posts/en/2020/nonparametric-effect-size.md">https://github.com/AndreyAkinshin/aakinshin.net/blob/master/web/_posts/en/2020/nonparametric-effect-size.md</a>
</div>

</div>
</div>
    </div>

    <footer class="blog-footer">
      <div class="container">
        <p>&copy; 2013–2020 Andrey Akinshin | <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></p>
      </div>
    </footer>

    <script src="/js/theme-after.js"></script>
    <!-- jQuery first (header), then popper, then Bootstrap JS. -->
    <script src="/js/popper.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <!-- Other scripts -->
    <script src="/js/highlight.pack.js"></script>
    <script src="/js/anchor.min.js"></script>
    <script src="/js/custom.js"></script>
  </body>
</html>
