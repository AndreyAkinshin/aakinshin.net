<!doctype html><html lang=en class=h-100><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.74.3"><meta name=author content="Andrey Akinshin"><link href=/img/favicon.ico rel=icon type=image/x-icon><title>About System.Drawing.Color and operator == | Andrey Akinshin</title><link href=/css/lumen-bootstrap.min.css theme=light rel=stylesheet type=text/css media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><link href=/css/slate-bootstrap.min.css theme=dark rel=stylesheet type=text/css media="(prefers-color-scheme: dark)"><link href=/css/syntax-light.css theme=light rel=stylesheet type=text/css media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><link href=/css/syntax-dark.css theme=dark rel=stylesheet type=text/css media="(prefers-color-scheme: dark)"><script src=https://aakinshin.net/js/theme-before.min.26d61b7027fe55e642f0001cef94cb75b567d721086492aab6b4e32d9ee7811d.js></script><script type=module src=https://googlechromelabs.github.io/dark-mode-toggle/src/dark-mode-toggle.mjs></script><link href=https://aakinshin.net/css/fontawesome-all.min.e78467baec0179d7ccd2ef995e0c94f25b4a63a3191a93c3547e22bdf590ef5d.css rel=stylesheet type=text/css media=all><link href=https://aakinshin.net/css/about.min.2a76db7cc14055b3bafacc363f453917ab54a818a7db2a0a9b2409c0f6bf07c5.css rel=stylesheet type=text/css media=all><link href=https://aakinshin.net/css/blog.min.9e48d5a207f4a82d87fecd2301c8fa28b13a2f0e434f87c47dc5f2ff25c61342.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-XXXXX-Y','auto');ga('send','pageview');</script><script type=text/javascript>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym");ym(28700916,"init",{clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src=https://mc.yandex.ru/watch/28700916 style=position:absolute;left:-9999px alt></div></noscript><script src=/js/jquery-3.3.1.slim.min.js></script></head><body><div class=bg-primary><div class="container bg-primary"><nav class="navbar navbar-expand-lg navbar-dark bg-primary"><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link id=nav-link-blog href=https://aakinshin.net/><i class="fas fa-home" title=Home style=color:#fff></i></a></li><li class=nav-item><a class=nav-link id=nav-link-blog href=https://aakinshin.net/posts/>Posts</a></li><li class=nav-item><a class=nav-link id=nav-link-about href=https://aakinshin.net/about/>About</a></li><li class=nav-item><a class=nav-link id=nav-link-about href=https://aakinshin.net/prodotnetbenchmarking/>Pro .NET Benchmarking</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" data-toggle=dropdown href=# role=button aria-haspopup=true aria-expanded=false>EN</a><div class=dropdown-menu><a class=dropdown-item href=https://aakinshin.net/ru/posts/system-drawing-color-equals/>RU</a></div></li><li class=nav-item></li><dark-mode-toggle permanent=true></dark-mode-toggle></li></ul><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://github.com/AndreyAkinshin><i class="fab fa-github" title=GitHub style=color:#fff></i></a></li><li class=nav-item><a class=nav-link href=https://twitter.com/andrey_akinshin><i class="fab fa-twitter" title=Twitter style=color:#fff></i></a></li><li class=nav-item><a class=nav-link href=https://aakinshin.net/posts/index.xml><i class="fas fa-rss" title=RSS style=color:#fff></i></a></li></ul></nav></div></div><div class=container><main id=main><div class=blog-main><div class=blog-post><h2 class=blog-post-title id=post-title>About System.Drawing.Color and operator ==</h2><span class=blog-post-meta><div class=faicon><i class="far fa-calendar-alt"></i></div><time datetime=2014-02-21>February 21, 2014</time>
&nbsp;&nbsp;<div class=faicon><i class="fas fa-tag"></i></div><a href=https://aakinshin.net/tags/.net class="badge badge-info">.NET</a>
<a href=https://aakinshin.net/tags/colors class="badge badge-info">Colors</a>
<a href=https://aakinshin.net/tags/c class="badge badge-info">C#</a>
<a href=https://aakinshin.net/tags/equals class="badge badge-info">Equals</a></span><br><br><p>Operator <code>==</code> that allows easy comparison of your objects is overridden for many standard structures in .NET. Unfortunately, not every developer really knows what is actually compared when working with this wonderful operator. This brief blog post will show the comparison logic based on a sample of <code>System.Drawing.Color</code>. What do you think the following code will get:</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=kt>var</span> <span class=n>redName</span> <span class=p>=</span> <span class=n>Color</span><span class=p>.</span><span class=n>Red</span><span class=p>;</span>
<span class=kt>var</span> <span class=n>redArgb</span> <span class=p>=</span> <span class=n>Color</span><span class=p>.</span><span class=n>FromArgb</span><span class=p>(</span><span class=m>255</span><span class=p>,</span> <span class=m>255</span><span class=p>,</span> <span class=m>0</span><span class=p>,</span> <span class=m>0</span><span class=p>);</span>
<span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>redName</span> <span class=p>==</span> <span class=n>redArgb</span><span class=p>);</span>
</code></pre></div><p>“It’s red here and it’s red there. Probably, the objects should be equal”, the reader might think. Let’s open <a href=http://www.dotnetframework.org/default.aspx/Net/Net/3@5@50727@3053/DEVDIV/depot/DevDiv/releases/whidbey/netfxsp/ndp/fx/src/CommonUI/System/Drawing/Color@cs/1/Color@cs>source code</a> and review the operator <code>==</code>:</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=k>public</span> <span class=k>static</span> <span class=kt>bool</span> <span class=k>operator</span> <span class=p>==(</span><span class=n>Color</span> <span class=n>left</span><span class=p>,</span> <span class=n>Color</span> <span class=n>right</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>left</span><span class=p>.</span><span class=k>value</span> <span class=p>==</span> <span class=n>right</span><span class=p>.</span><span class=k>value</span>
        <span class=p>&amp;&amp;</span> <span class=n>left</span><span class=p>.</span><span class=n>state</span> <span class=p>==</span> <span class=n>right</span><span class=p>.</span><span class=n>state</span>
        <span class=p>&amp;&amp;</span> <span class=n>left</span><span class=p>.</span><span class=n>knownColor</span> <span class=p>==</span> <span class=n>right</span><span class=p>.</span><span class=n>knownColor</span><span class=p>)</span> <span class=p>{</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>left</span><span class=p>.</span><span class=n>name</span> <span class=p>==</span> <span class=n>right</span><span class=p>.</span><span class=n>name</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>return</span> <span class=k>true</span><span class=p>;</span>
        <span class=p>}</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>left</span><span class=p>.</span><span class=n>name</span> <span class=p>==</span> <span class=p>(</span><span class=kt>object</span><span class=p>)</span> <span class=k>null</span> <span class=p>||</span> <span class=n>right</span><span class=p>.</span><span class=n>name</span> <span class=p>==</span> <span class=p>(</span><span class=kt>object</span><span class=p>)</span> <span class=k>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>return</span> <span class=k>false</span><span class=p>;</span>
        <span class=p>}</span>

        <span class=k>return</span> <span class=n>left</span><span class=p>.</span><span class=n>name</span><span class=p>.</span><span class=n>Equals</span><span class=p>(</span><span class=n>right</span><span class=p>.</span><span class=n>name</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=k>return</span> <span class=k>false</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p>Code review help us make an interesting conclusion: colors are compared by the Name property rather than the ARGB-value. What are the names of our objects? Let’s see.</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>redName</span><span class=p>.</span><span class=n>Name</span><span class=p>);</span> <span class=c1>// Red
</span><span class=c1></span><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>redArgb</span><span class=p>.</span><span class=n>Name</span><span class=p>);</span> <span class=c1>// ffff0000
</span></code></pre></div><p>Hmm, they’ve got different names. So, the expression <code>redName == redArgb</code> gets <code>False</code>. There may occur an irritating situation, for example, when initial <code>Color.Red</code> was serialized to ARGB and then de-serialized back and then you decided to compare the final color with the original. Let’s read what <a href="http://msdn.microsoft.com/en-us/library/system.drawing.color.op_equality(v=vs.110).aspx">MSDN</a> says about operator <code>==</code>:</p><blockquote><p>This method compares more than the ARGB values of the <a href="http://msdn.microsoft.com/en-us/library/system.drawing.color(v=vs.110).aspx">Color</a> structures. It also does a comparison of some state flags. If you want to compare just the ARGB values of two Color structures, compare them using the <a href="http://msdn.microsoft.com/en-us/library/system.drawing.color.toargb(v=vs.110).aspx">ToArgb</a> method.</p></blockquote><p>Everything is clear now. In order to compare our colors we need the <code>ToArgb</code> method.</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>redName</span><span class=p>.</span><span class=n>ToArgb</span><span class=p>()</span> <span class=p>==</span> <span class=n>redArgb</span><span class=p>.</span><span class=n>ToArgb</span><span class=p>());</span> <span class=c1>// True
</span></code></pre></div><h2 id=summary>Summary</h2><p>I think you shouldn’t relay on a guess about logic of the standard comparison methods even if they might seem obvious to you. If you use operator == or Equals method for value types it would be a good idea to have a look at the documentation and check what will be actually compared.</p><h2 id=cross-posts>Cross-posts</h2><ul><li><a href=http://blogs.perpetuumsoft.com/dotnet/about-system-drawing-color-and-operator/>blogs.perpetuumsoft.com</a></li></ul><br><br><div class=mx-auto>Share:
<a href="https://twitter.com/intent/tweet?text=About%20System.Drawing.Color%20and%20operator%20%3d%3d&url=https%3a%2f%2faakinshin.net%2fposts%2fsystem-drawing-color-equals%2f&via=andrey_akinshin&related=andrey_akinshin" rel=nofollow target=_blank title="Share on Twitter"><i class="fab fa-twitter fa-2x" title=Twitter></i></a><a href="https://www.reddit.com/submit?url=https%3a%2f%2faakinshin.net%2fposts%2fsystem-drawing-color-equals%2f&title=About%20System.Drawing.Color%20and%20operator%20%3d%3d" target=_blank title="Share on Reddit"><i class="fab fa-reddit fa-2x"></i></a><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2faakinshin.net%2fposts%2fsystem-drawing-color-equals%2f" target=_blank title="Share on HackerNews"><i class="fab fa-hacker-news fa-2x"></i></a><a href="https://facebook.com/sharer.php?u=https%3a%2f%2faakinshin.net%2fposts%2fsystem-drawing-color-equals%2f" rel=nofollow target=_blank title="Share on Facebook"><i class="fab fa-facebook fa-2x"></i></a><a href="http://vk.com/share.php?url=https%3a%2f%2faakinshin.net%2fposts%2fsystem-drawing-color-equals%2f" target=_blank title="Share on VKontakte"><i class="fab fa-vk fa-2x"></i></a><a href="https://getpocket.com/save?url=https%3a%2f%2faakinshin.net%2fposts%2fsystem-drawing-color-equals%2f&title=About%20System.Drawing.Color%20and%20operator%20%3d%3d" target=_blank title="Add to Pocket"><i class="fab fa-get-pocket fa-2x"></i></a></div><hr></div></div></main></div><footer class=blog-footer><div class=container><p>&copy; 2013–2020 Andrey Akinshin | <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></p></div></footer><script src=https://aakinshin.net/js/theme-after.min.ea4f51ac7f59c8e13f4df787df946eb1a447174ce2f1fc5349483de93a607ecb.js></script><script src=/js/popper.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/anchor.min.js></script><script src=https://aakinshin.net/js/custom.min.11932490dde776463ed165b345838c701accc0cfdedf2e0868f13415f41f0872.js></script></body></html>