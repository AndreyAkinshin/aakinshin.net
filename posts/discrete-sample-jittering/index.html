<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.103.0-DEV"><meta name=author content="Andrey Akinshin"><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content="Mathematics,Statistics,Research,Density estimation,Discrete distributions,Ties,Jittering"><title>How to build a smooth density estimation for a discrete sample using jittering | Andrey Akinshin</title><meta name=description content="A simple technique that removes ties from samples without noticeable changes in density"><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><script src=https://cdn.tailwindcss.com/3.2.4></script>
<script>tailwind.config={darkMode:"class"}</script><style type=text/tailwindcss>
    @layer base {
       
      body {
        @apply bg-white dark:bg-zinc-800;
        @apply text-black dark:text-gray-400;
      }
      nav {
        @apply bg-sky-800 dark:bg-zinc-900;
      }
      a {
        @apply text-sky-600 dark:text-white;
        @apply no-underline;
      }
      .main-content a:not(.label-link) {
        @apply hover:underline;
      }
      hr {
        @apply h-px my-3 border-0 bg-gray-300 dark:bg-gray-600;
      }
      h1, h2, h3, h4, h5, h6 {
        @apply leading-tight;
      }
      h1, h2, h3 {
        @apply text-4xl py-4;
      }
      h4 {
        @apply text-3xl py-3;
      }
      h5, h6 {
        @apply text-2xl py-2;
      }
      table {
        @apply border self-center mx-auto;
      }
      th, td {
        @apply border p-2
      }
      blockquote {
        @apply border-l-8 border-gray-300 bg-gray-100 dark:border-zinc-600 dark:bg-zinc-700;
        @apply ml-4 my-4 px-4 py-2;
      }

       
      .main ul {
        @apply list-disc ml-10 my-2;
      }
      .main ol {
        @apply list-decimal ml-10 my-2;
      }
      .main p {
        @apply mb-3;
      }

       
      .label {
        @apply mx-1 px-1 py-0.5;
        @apply rounded border border-gray-400 dark:border-gray-500;
      }
      .label-link {
        @apply mx-1 px-1 py-0.5;
        @apply rounded border border-sky-600 dark:border-slate-400;
        @apply hover:bg-sky-200 dark:hover:bg-gray-500;
      }
      .nav-item {
        @apply text-white hover:bg-sky-700 dark:hover:bg-gray-700;
      }

       
      .paginator {
        @apply flex flex-wrap justify-center mb-4;
      }
      .paginator .page-item {
        @apply inline-flex border rounded px-3 py-1;
      }
      .paginator .page-item:not(.active):not(.disabled) {
        @apply border-gray-400 dark:border-gray-400;
      }
      .paginator .page-item.active {
        @apply border-sky-600 dark:border-white;
      }
      .paginator .page-item.disabled {
        @apply bg-gray-50 dark:bg-gray-500 dark:border-gray-400;
      }
      .paginator .page-item.disabled a {
        @apply text-gray-400 dark:text-gray-400;
      }

       
      .block-example {
        @apply my-4 pl-3;
        @apply border-l-8 border-gray-300 dark:border-zinc-600;
      }

       
      #about img {
        @apply inline-flex h-4;
      }

       
      .fai {
        @apply inline-flex h-[1.2em] w-[1.2em] pr-[0.4em] fill-current;
      }
      .fai-link {
        @apply hover:text-sky-400 dark:hover:text-blue-400;
      }
      .label-link .fai {
        @apply pl-1 pb-1 h-[1.5em] w-[1.5em];
      }

       
      .chroma {
        @apply my-5 overflow-y-scroll;
        @apply p-1 border rounded;
      }
    }
  </style><style>.block-example-title::before{counter-increment:example;content:"Example " counter(example)}body{counter-reset:example}code.has-jax{-webkit-font-smoothing:antialiased;background:inherit!important;border:none!important;font-size:100%}.anchorjs-link{transition:all .25s linear}*:hover>.anchorjs-link{margin-left:-1.125em!important}.chroma{background-color:#fff}.chroma .x{}.chroma .err{color:#a61717;background-color:#e3d2d2}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.chroma .hl{display:block;width:100%;background-color:#ffc}.chroma .lnt{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .k{color:#000;font-weight:700}.chroma .kc{color:#000;font-weight:700}.chroma .kd{color:#000;font-weight:700}.chroma .kn{color:#000;font-weight:700}.chroma .kp{color:#000;font-weight:700}.chroma .kr{color:#000;font-weight:700}.chroma .kt{color:#458;font-weight:700}.chroma .n{}.chroma .na{color:teal}.chroma .nb{color:#0086b3}.chroma .bp{color:#999}.chroma .nc{color:#458;font-weight:700}.chroma .no{color:teal}.chroma .nd{color:#3c5d5d;font-weight:700}.chroma .ni{color:purple}.chroma .ne{color:#900;font-weight:700}.chroma .nf{color:#900;font-weight:700}.chroma .fm{}.chroma .nl{color:#900;font-weight:700}.chroma .nn{color:#555}.chroma .nx{}.chroma .py{}.chroma .nt{color:navy}.chroma .nv{color:teal}.chroma .vc{color:teal}.chroma .vg{color:teal}.chroma .vi{color:teal}.chroma .vm{}.chroma .l{}.chroma .ld{}.chroma .s{color:#d14}.chroma .sa{color:#d14}.chroma .sb{color:#d14}.chroma .sc{color:#d14}.chroma .dl{color:#d14}.chroma .sd{color:#d14}.chroma .s2{color:#d14}.chroma .se{color:#d14}.chroma .sh{color:#d14}.chroma .si{color:#d14}.chroma .sx{color:#d14}.chroma .sr{color:#009926}.chroma .s1{color:#d14}.chroma .ss{color:#990073}.chroma .m{color:#099}.chroma .mb{color:#099}.chroma .mf{color:#099}.chroma .mh{color:#099}.chroma .mi{color:#099}.chroma .il{color:#099}.chroma .mo{color:#099}.chroma .o{color:#000;font-weight:700}.chroma .ow{color:#000;font-weight:700}.chroma .p{}.chroma .c{color:#998;font-style:italic}.chroma .ch{color:#998;font-style:italic}.chroma .cm{color:#998;font-style:italic}.chroma .c1{color:#998;font-style:italic}.chroma .cs{color:#999;font-weight:700;font-style:italic}.chroma .cp{color:#999;font-weight:700;font-style:italic}.chroma .cpf{color:#999;font-weight:700;font-style:italic}.chroma .g{}.chroma .gd{color:#000;background-color:#fdd}.chroma .ge{color:#000;font-style:italic}.chroma .gr{color:#a00}.chroma .gh{color:#999}.chroma .gi{color:#000;background-color:#dfd}.chroma .go{color:#888}.chroma .gp{color:#555}.chroma .gs{font-weight:700}.chroma .gu{color:#aaa}.chroma .gt{color:#a00}.chroma .gl{text-decoration:underline}.chroma .w{color:#bbb}.dark.chroma{color:#f8f8f2;background-color:#272822}.dark .chroma{color:#f8f8f2;background-color:#272822}.dark .chroma .x{}.dark .chroma .err{color:#960050;background-color:#1e0010}.dark .chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.dark .chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.dark .chroma .hl{display:block;width:100%;background-color:#ffc}.dark .chroma .lnt{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.dark .chroma .ln{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.dark .chroma .k{color:#66d9ef}.dark .chroma .kc{color:#66d9ef}.dark .chroma .kd{color:#66d9ef}.dark .chroma .kn{color:#f92672}.dark .chroma .kp{color:#66d9ef}.dark .chroma .kr{color:#66d9ef}.dark .chroma .kt{color:#66d9ef}.dark .chroma .n{}.dark .chroma .na{color:#a6e22e}.dark .chroma .nb{}.dark .chroma .bp{}.dark .chroma .nc{color:#a6e22e}.dark .chroma .no{color:#66d9ef}.dark .chroma .nd{color:#a6e22e}.dark .chroma .ni{}.dark .chroma .ne{color:#a6e22e}.dark .chroma .nf{color:#a6e22e}.dark .chroma .fm{}.dark .chroma .nl{}.dark .chroma .nn{}.dark .chroma .nx{color:#a6e22e}.dark .chroma .py{}.dark .chroma .nt{color:#f92672}.dark .chroma .nv{}.dark .chroma .vc{}.dark .chroma .vg{}.dark .chroma .vi{}.dark .chroma .vm{}.dark .chroma .l{color:#ae81ff}.dark .chroma .ld{color:#e6db74}.dark .chroma .s{color:#e6db74}.dark .chroma .sa{color:#e6db74}.dark .chroma .sb{color:#e6db74}.dark .chroma .sc{color:#e6db74}.dark .chroma .dl{color:#e6db74}.dark .chroma .sd{color:#e6db74}.dark .chroma .s2{color:#e6db74}.dark .chroma .se{color:#ae81ff}.dark .chroma .sh{color:#e6db74}.dark .chroma .si{color:#e6db74}.dark .chroma .sx{color:#e6db74}.dark .chroma .sr{color:#e6db74}.dark .chroma .s1{color:#e6db74}.dark .chroma .ss{color:#e6db74}.dark .chroma .m{color:#ae81ff}.dark .chroma .mb{color:#ae81ff}.dark .chroma .mf{color:#ae81ff}.dark .chroma .mh{color:#ae81ff}.dark .chroma .mi{color:#ae81ff}.dark .chroma .il{color:#ae81ff}.dark .chroma .mo{color:#ae81ff}.dark .chroma .o{color:#f92672}.dark .chroma .ow{color:#f92672}.dark .chroma .p{}.dark .chroma .c{color:#75715e}.dark .chroma .ch{color:#75715e}.dark .chroma .cm{color:#75715e}.dark .chroma .c1{color:#75715e}.dark .chroma .cs{color:#75715e}.dark .chroma .cp{color:#75715e}.dark .chroma .cpf{color:#75715e}.dark .chroma .g{}.dark .chroma .gd{color:#f92672}.dark .chroma .ge{font-style:italic}.dark .chroma .gr{}.dark .chroma .gh{}.dark .chroma .gi{color:#a6e22e}.dark .chroma .go{}.dark .chroma .gp{}.dark .chroma .gs{font-weight:700}.dark .chroma .gu{color:#75715e}.dark .chroma .gt{}.dark .chroma .gl{}.dark .chroma .w{}</style><script>localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"></head><body><nav><div class="container flex flex-wrap items-center justify-between mx-auto max-w-6xl h-12 px-6"><div class="flex items-center justify-start justify-self-start"><div class="flex nav-item h-12 w-12 items-center justify-center"><a class=text-white href=https://aakinshin.net/><svg class="fai w-6 h-6"><use xlink:href="/img/fa/all.svg#house-chimney"/></svg></a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/posts/>Posts</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/about/>About</a></div></div><button id=theme-toggle type=button class="nav-item p-3 content-center justify-self-end"><svg id="theme-toggle-dark-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001.0 1010.586 10.586z"/></svg><svg id="theme-toggle-light-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1A1 1 0 119 4V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707A1 1 0 1113.536 5.05l.707-.707a1 1 0 011.414.0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707A1 1 0 004.343 5.757l.707.707zm1.414 8.486-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"/></svg></button></div></nav><div class="main container mx-auto max-w-6xl px-6"><div class=main-post><h1 class=blog-post-title id=post-title>How to build a smooth density estimation for a discrete sample using jittering</h1><div class="flex flex-wrap justify-start items-center"><svg class="fai"><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2021-04-20>April 20, 2021</time><svg class="fai ml-3"><use xlink:href="/img/fa/all.svg#tag"/></svg>
<a class=label-link href=https://aakinshin.net/tags/mathematics/>Mathematics</a>
<a class=label-link href=https://aakinshin.net/tags/statistics/>Statistics</a>
<a class=label-link href=https://aakinshin.net/tags/research/>Research</a>
<a class=label-link href=https://aakinshin.net/tags/density-estimation/>Density estimation</a>
<a class=label-link href=https://aakinshin.net/tags/discrete-distributions/>Discrete distributions</a>
<a class=label-link href=https://aakinshin.net/tags/ties/>Ties</a>
<a class=label-link href=https://aakinshin.net/tags/jittering/>Jittering</a></div><br><div class=main-content><p>Let&rsquo;s say you have a sample with tied values.
If you draw a kernel density estimation (KDE) for such a sample,
you may get a serrated pattern like this:</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/discrete-sample-jittering/img/intro-light.png target=_blank alt=intro><img src=/posts/discrete-sample-jittering/img/intro-light.png width=800></a>
<a class="img-dark hidden" href=/posts/discrete-sample-jittering/img/intro-dark.png target=_blank alt=intro><img src=/posts/discrete-sample-jittering/img/intro-dark.png width=800></a></div><p>KDE requires samples from continuous distributions
while tied values arise in discrete or mixture distributions.
Even if the original distribution is continuous,
you may observe artificial sample discretization due to a limited resolution of the measuring tool.
This effect may lead to distorted density plots like in the above picture.</p><p>The problem could be solved using a nice technique called <em>jittering</em>.
In the simplest case, jittering just adds random noise to each measurement.
Such a trick removes all ties from the sample and allows building a smooth density estimation.</p><p>However, there are many different ways to apply jittering.
The trickiest question here is how to choose proper noise values.
In this post, I want to share one of my favorite jittering approaches.
It generates a non-randomized noise pattern with a low risk of noticeable sample corruption.</p><h3 id=the-problem>The problem</h3><p>Let me show a small real-life example that illustrates the problem.
Imagine you collect some duration measurements, most of which are between 0 and 100 milliseconds.
You don&rsquo;t need excellent accuracy, so it&rsquo;s OK to round all observations to integer values.
Despite the continuous nature of time, you come up with a discrete sample.
If the sample size is &ldquo;not-so-big,&rdquo; the corresponding kernel density estimation may look pretty smooth:</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/discrete-sample-jittering/img/problem1-light.png target=_blank alt=problem1><img src=/posts/discrete-sample-jittering/img/problem1-light.png width=800></a>
<a class="img-dark hidden" href=/posts/discrete-sample-jittering/img/problem1-dark.png target=_blank alt=problem1><img src=/posts/discrete-sample-jittering/img/problem1-dark.png width=800></a></div><p>However, if you continue to collect more measurements,
the KDE &ldquo;will be able to guess&rdquo; that the non-integer values are not allowed in this sample.
Thus, the density between observed integer measurements should be zero.
It gives us the serrated pattern:</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/discrete-sample-jittering/img/problem2-light.png target=_blank alt=problem2><img src=/posts/discrete-sample-jittering/img/problem2-light.png width=800></a>
<a class="img-dark hidden" href=/posts/discrete-sample-jittering/img/problem2-dark.png target=_blank alt=problem2><img src=/posts/discrete-sample-jittering/img/problem2-dark.png width=800></a></div><p>You can also find a more detailed discussion about this problem in my <a href=https://aakinshin.net/posts/kde-discrete/>previous post</a>.</p><h3 id=random-jittering>Random jittering</h3><p>One of the easiest ways to resolve the problem is to add random noise to each sample element.
In simple cases, you can use the normal distribution to generate noise values.
If we apply this simple trick to the sample from the first picture,
it will instantly make the KDE plot smooth:</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/discrete-sample-jittering/img/comparison-light.png target=_blank alt=comparison><img src=/posts/discrete-sample-jittering/img/comparison-light.png width=800></a>
<a class="img-dark hidden" href=/posts/discrete-sample-jittering/img/comparison-dark.png target=_blank alt=comparison><img src=/posts/discrete-sample-jittering/img/comparison-dark.png width=800></a></div><p>If you are interested in a formal definition of the jittering kernel density estimator or a literature overview,
it&rsquo;s recommended to read <a href=#Nagler2018>[Nagler2018]</a>.</p><h3 id=my-noise-pattern-preferences>My noise pattern preferences</h3><p>There are many different ways to introduce a noise pattern.
The normal or uniform distributions may be reasonable choices for simple single-shot experiments.
Note that you would need to tweak parameters for a while to get a reasonable density estimation in some cases.
Jittering is always a trade-off between two states:</p><ul><li>The noise is too small (the serrated pattern is not fixed, jittering had no effect)</li><li>The noise is too large (density estimation is inaccurate because the sample is corrupted)</li></ul><p>If we want to find a proper balance between these states, we should define requirements for the noise pattern
that improve our chances to get a nice density estimation.
I didn&rsquo;t find any bulletproof guidance on how to build a good noise distribution.
So, I came up with my own list of rules that I use during jittering to form the noise pattern:</p><ul><li><strong>Use stable noise pattern instead of random values</strong><br>One of the main goals of the density estimation is to discover the true distribution nature
based on a set of random measurements.
This goal is about <em>removing</em> the randomness, not <em>increasing</em> it.
Whenever it&rsquo;s possible, I prefer to avoid using additional random values.
It&rsquo;s better to define a fixed noise pattern in advance based on the configuration of the tied values.</li><li><strong>Modify only tied values</strong><br>One may experience a temptation to add noise to each sample element.
This approach is quite simple to implement because there is no need to actually detect ties.
However, the primary intention of jittering is to only eliminate ties from the sample.
What the point of modifying non-tied values?
It would just reduce the accuracy of the final density estimation.
I prefer to detect all groups of tied values and don&rsquo;t touch the other values.</li><li><strong>Maintain noise range within discretization step</strong><br>It&rsquo;s important to pay attention to the minimum and maximum noise values.
In the case of extreme noise values (which may happen if you generate noise based on the normal distribution),
one may corrupt the sample and reduce the reliability of the density estimation.
It&rsquo;s better to detect the discretization step and ensure that all noise values fit within a narrow band.
In the simplest case, we could define the discretization step as the minimum positive difference
between consequent order statistics.
In more complicated cases, the discretization step could be defined adaptively based on neighbor values.</li><li><strong>Preserve sample range</strong><br>If jittering spoils the minimum and the maximum value of the sample, it may introduce problems.
Let&rsquo;s say we work with the
<a href=https://aakinshin.net/posts/kde-discrete/#pdf-and-mixed-distributions>rectified Gaussian distribution</a>.
In this case, we probably have a lot of tied values that equal exactly zero.
If we add negative noise to some of the tied values, we will get negative sample values.
It will be a violation of the sample invariant for the rectified Gaussian distribution.
To avoid such a situation, it&rsquo;s better to preserve the minimum and the maximum value.</li><li><strong>Ensure high density near the original value</strong><br>Without jittering, the density estimation should probably use
<a href=https://en.wikipedia.org/wiki/Dirac_delta_function>the Dirac delta function</a> to express tied values.
With a smoother approximation, it should look like a sharp peak.
Sometimes, this peak is explained not by artificial discretization but by other distribution features.
For the rectified Gaussian distribution, the location of this peak is exactly zero.
If we add non-negative random noise to the tied zero values, in this case,
we may introduce a bias for this peak.
For example, the biased peak location may become 0.2 instead of 0.0, which distorts the density shape.
Whenever it&rsquo;s possible, I prefer preserving the peak location.</li></ul><p>Now let me show an example of such noise patterns that satisfy all of the above requirements.</p><h3 id=noise-pattern-example>Noise pattern example</h3><p>We are going to introduce an independent noise pattern for each group of tied values.
Let&rsquo;s say our sample contains <span class="math inline">\(k\)</span> tied values that equal <span class="math inline">\(x^*\)</span>.
Let <span class="math inline">\(l\)</span> be the number of sample values lower than <span class="math inline">\(x^*\)</span>, and <span class="math inline">\(r\)</span> be the number of sample values higher than <span class="math inline">\(x^*\)</span>.
For the given <span class="math inline">\(l\)</span> and <span class="math inline">\(r\)</span>,
we could define a beta distribution <span class="math inline">\(\textrm{Beta}(\alpha, \beta)\)</span> with the following <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>:</p><p><span class="math display">\[\alpha = \frac{9l+r}{l+r}, \quad \beta = \frac{l+9r}{l+r}.
\]</span></p><p>This distributions satisfy the following properties:</p><ul><li><span class="math inline">\(\alpha + \beta = 10\)</span></li><li>The mode of this distribution is always <span class="math inline">\(l / (l + r)\)</span>.</li></ul><p>Here are examples of the corresponding density plots:</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/discrete-sample-jittering/img/noise-patterns-light.png target=_blank alt=noise-patterns><img src=/posts/discrete-sample-jittering/img/noise-patterns-light.png width=800></a>
<a class="img-dark hidden" href=/posts/discrete-sample-jittering/img/noise-patterns-dark.png target=_blank alt=noise-patterns><img src=/posts/discrete-sample-jittering/img/noise-patterns-dark.png width=800></a></div><p>Now let&rsquo;s define <span class="math inline">\(k\)</span> uniformly distributed numbers <span class="math inline">\(p_i\)</span> on <span class="math inline">\([0;1]\)</span>:</p><p><span class="math display">\[p_i = i / (k + 1), \quad i = 1, \ldots, k.
\]</span></p><p>Let <span class="math inline">\(p_0\)</span> be equal to <span class="math inline">\(p_i\)</span> that is nearest to the mode value <span class="math inline">\(l / (l + r)\)</span>.
If <span class="math inline">\(Q(p)\)</span> is the quantile function of <span class="math inline">\(\textrm{Beta}(\alpha, \beta)\)</span>,
we could introduce the following noise vector:</p><p><span class="math display">\[\xi_i = Q(p_i) - Q(p_0), \quad i = 1, \ldots, k.
\]</span></p><p>Now we could rescale the noise vector according to the discretization step and define jittered values <span class="math inline">\(\hat{x}_i\)</span>:</p><p><span class="math display">\[\hat{x}_i = x^* + s \cdot \xi_i
\]</span></p><p>where <span class="math inline">\(s\)</span> is the scale constant.
Based on my local experiments, I assume that <span class="math inline">\(s = 1.5\)</span> is usually enough to get a smooth approximation.</p><p>The above equation may look confusing, but they satisfy the requirements from the previous section.
Let me show a few examples (for this table, <span class="math inline">\(s = 1.0\)</span>):</p><table><thead><tr><th align=right><span class="math inline">\(k\)</span></th><th align=right><span class="math inline">\(l\)</span></th><th align=right><span class="math inline">\(r\)</span></th><th align=right><span class="math inline">\(\xi_i\)</span></th></tr></thead><tbody><tr><td align=right><span class="math inline">\(1\)</span></td><td align=right><span class="math inline">\(1\)</span></td><td align=right><span class="math inline">\(1\)</span></td><td align=right><span class="math inline">\(\{ 0.000 \} \)</span></td></tr><tr><td align=right><span class="math inline">\(3\)</span></td><td align=right><span class="math inline">\(1\)</span></td><td align=right><span class="math inline">\(1\)</span></td><td align=right><span class="math inline">\(\{ -0.108,\; 0.000,\; 0.108 \} \)</span></td></tr><tr><td align=right><span class="math inline">\(5\)</span></td><td align=right><span class="math inline">\(1\)</span></td><td align=right><span class="math inline">\(1\)</span></td><td align=right><span class="math inline">\(\{ -0.153,\; -0.069,\; 0.000,\; 0.069,\; 0.153 \} \)</span></td></tr><tr><td align=right><span class="math inline">\(4\)</span></td><td align=right><span class="math inline">\(5\)</span></td><td align=right><span class="math inline">\(0\)</span></td><td align=right><span class="math inline">\(\{-0.139,\; -0.072,\; -0.031,\; 0.000 \} \)</span></td></tr><tr><td align=right><span class="math inline">\(4\)</span></td><td align=right><span class="math inline">\(0\)</span></td><td align=right><span class="math inline">\(5\)</span></td><td align=right><span class="math inline">\(\{0.000,\; 0.031,\; 0.072,\; 0.139 \} \)</span></td></tr></tbody></table><p>Thus, the suggested approach
preserves the sample range,
provides small bias,
and returns consistent non-randomized values.
In addition, one of the noise vector components is always zero (which is a lovely property for manual sample exploration).
The noise range can be controlled via the scale constant <span class="math inline">\(s\)</span>.</p><p>Let&rsquo;s look at a few examples.
Here is two kernel density estimations (normal kernel, Sheather & Jones bandwidth selector)
for a sample of size 1000 from the binomial distribution <span class="math inline">\(\textrm{B}(n = 30, p = 0.2)\)</span>
without and with jittering (<span class="math inline">\(s = 1.5\)</span>):</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/discrete-sample-jittering/img/jittering-demo1-light.png target=_blank alt=jittering-demo1><img src=/posts/discrete-sample-jittering/img/jittering-demo1-light.png width=800></a>
<a class="img-dark hidden" href=/posts/discrete-sample-jittering/img/jittering-demo1-dark.png target=_blank alt=jittering-demo1><img src=/posts/discrete-sample-jittering/img/jittering-demo1-dark.png width=800></a></div><p>As you can see, the jittered version is much smoother.
The suggested approach works nicely with multimodal distribution as well.
Here is another two KDEs for a mixture of
a sample of size 1000 from <span class="math inline">\(\textrm{B}(n = 20, p = 0.2)\)</span> and
a sample of size 1000 from <span class="math inline">\(\textrm{B}(n = 20, p = 0.8)\)</span>:</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/discrete-sample-jittering/img/jittering-demo2-light.png target=_blank alt=jittering-demo2><img src=/posts/discrete-sample-jittering/img/jittering-demo2-light.png width=800></a>
<a class="img-dark hidden" href=/posts/discrete-sample-jittering/img/jittering-demo2-dark.png target=_blank alt=jittering-demo2><img src=/posts/discrete-sample-jittering/img/jittering-demo2-dark.png width=800></a></div><h3 id=conclusion>Conclusion</h3><p>Jittering is an excellent technique that allows getting smooth density estimations for discrete samples.
In this post, I described an example of a non-randomized noise pattern with a low risk of noticeable sample corruption.</p><h3 id=references>References</h3><ul><li><b id=Nagler2018>[Nagler2018]</b><br>Nagler, Thomas.
&ldquo;A generic approach to nonparametric function estimation with mixed data.&rdquo;
Statistics & Probability Letters 137 (2018): 326-330.<br><a href=https://doi.org/10.1016/j.spl.2018.02.040>https://doi.org/10.1016/j.spl.2018.02.040</a><br><a href=https://arxiv.org/pdf/1704.07457.pdf>https://arxiv.org/pdf/1704.07457.pdf</a></li></ul></div><br><br><div class="flex flex-wrap justify-center items-center mb-5"><span>Share:</span><div class="text-4xl pl-3"><a href="https://www.reddit.com/submit?url=https%3a%2f%2faakinshin.net%2fposts%2fdiscrete-sample-jittering%2f&title=How%20to%20build%20a%20smooth%20density%20estimation%20for%20a%20discrete%20sample%20using%20jittering" target=_blank title="Share on Reddit"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#reddit"/></svg></a></div><div class="text-4xl pl-3"><a href="https://twitter.com/intent/tweet?text=How%20to%20build%20a%20smooth%20density%20estimation%20for%20a%20discrete%20sample%20using%20jittering&url=https%3a%2f%2faakinshin.net%2fposts%2fdiscrete-sample-jittering%2f&via=andrey_akinshin&related=andrey_akinshin" rel=nofollow target=_blank title="Share on Twitter"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></div><div class="text-4xl pl-3"><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2faakinshin.net%2fposts%2fdiscrete-sample-jittering%2f" target=_blank title="Share on HackerNews"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#hacker-news"/></svg></a></div><div class="text-4xl pl-3"><a href="https://getpocket.com/save?url=https%3a%2f%2faakinshin.net%2fposts%2fdiscrete-sample-jittering%2f&title=How%20to%20build%20a%20smooth%20density%20estimation%20for%20a%20discrete%20sample%20using%20jittering" target=_blank title="Add to Pocket"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#get-pocket"/></svg></a></div></div></div></div><script>var themeToggleDarkIcon=document.getElementById("theme-toggle-dark-icon"),themeToggleBtn,themeToggleLightIcon=document.getElementById("theme-toggle-light-icon");const imagesDark=document.querySelectorAll(".img-dark"),imagesLight=document.querySelectorAll(".img-light");localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(themeToggleLightIcon.classList.remove("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")})):(themeToggleDarkIcon.classList.remove("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")})),themeToggleBtn=document.getElementById("theme-toggle"),themeToggleBtn.addEventListener("click",function(){themeToggleDarkIcon.classList.toggle("hidden"),themeToggleLightIcon.classList.toggle("hidden"),imagesLight.forEach(e=>{e.classList.toggle("hidden")}),imagesDark.forEach(e=>{e.classList.toggle("hidden")}),localStorage.getItem("color-theme")?localStorage.getItem("color-theme")==="light"?(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"))})</script><footer class="z-20 p-4 md:p-6 mt-3 w-full border-t border-gray-200 shadow flex items-center justify-center dark:border-gray-600 bg-white dark:bg-zinc-800"><span class="dark:text-gray-400 text-center">© 2013—2022 Andrey Akinshin</span><ul class="flex flex-wrap items-center px-4 mb-1"><li><a href=https://github.com/AndreyAkinshin><svg class="fai fai-link w-5 h-5"><title>GitHub</title><use xlink:href="/img/fa/all.svg#github"/></svg></a></li><li><a href=https://twitter.com/andrey_akinshin><svg class="fai fai-link w-5 h-5"><title>Twitter</title><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></li><li><a href=https://aakinshin.net/posts/index.xml><svg class="fai fai-link w-5 h-5"><title>RSS</title><use xlink:href="/img/fa/all.svg#rss"/></svg></a></li></ul><div class=main-content><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.1/anchor.min.js integrity="sha512-zPB79j2C+3sFS9zcA3vg/z6bVKzJVEyu9pY5w89akQRys76zpAT2t6S3wZKla3QQ14O5l/Yt0RUQ/DHXx82Y5g==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>anchors.options={placement:"left",icon:"§"},anchors.add("h1"),anchors.add("h2"),anchors.add("h3")</script><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script></body></html>