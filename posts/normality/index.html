<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.103.0-DEV"><meta name=author content="Andrey Akinshin"><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content="Mathematics,Statistics,Normality,Central Limit Theorem"><title>Normality is a myth | Andrey Akinshin</title><meta name=description content="In many statistical papers, you can find the following phrase: &amp;ldquo;assuming that we have a normal distribution.&amp;rdquo; Probably, you saw plots of the no..."><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><script src=https://cdn.tailwindcss.com/3.2.4></script>
<script>tailwind.config={darkMode:"class"}</script><style type=text/tailwindcss>
    @layer base {
       
      body {
        @apply bg-white dark:bg-zinc-800;
        @apply text-black dark:text-gray-400;
      }
      nav {
        @apply bg-sky-800 dark:bg-zinc-900;
      }
      a {
        @apply text-sky-600 dark:text-white;
        @apply no-underline;
      }
      .main-content a:not(.label-link) {
        @apply hover:underline;
      }
      hr {
        @apply h-px my-3 border-0 bg-gray-300 dark:bg-gray-600;
      }
      h1, h2, h3, h4, h5, h6 {
        @apply leading-tight;
      }
      h1, h2, h3 {
        @apply text-4xl py-4;
      }
      h4 {
        @apply text-3xl py-3;
      }
      h5, h6 {
        @apply text-2xl py-2;
      }
      table {
        @apply border self-center mx-auto;
      }
      th, td {
        @apply border p-2
      }
      blockquote {
        @apply border-l-8 border-gray-300 bg-gray-100 dark:border-zinc-600 dark:bg-zinc-700;
        @apply ml-4 my-4 px-4 py-2;
      }
       
      .main ul {
        @apply list-disc ml-10 my-2;
      }
      .main ol {
        @apply list-decimal ml-10 my-2;
      }
      .main p {
        @apply mb-3;
      }
       
      .label {
        @apply mx-1 px-1 py-0.5 whitespace-nowrap;
        @apply rounded border border-gray-400 dark:border-gray-500;
      }
      .label-link {
        @apply mx-1 px-1 py-0.5 whitespace-nowrap;
        @apply rounded border border-sky-600 dark:border-slate-400;
        @apply hover:bg-sky-200 dark:hover:bg-gray-500;
      }
      .nav-item {
        @apply text-white hover:bg-sky-700 dark:hover:bg-gray-700;
      }
       
      .paginator {
        @apply flex flex-wrap justify-center mb-4;
      }
      .paginator .page-item {
        @apply inline-flex border rounded px-3 py-1;
      }
      .paginator .page-item:not(.active):not(.disabled) {
        @apply border-gray-400 dark:border-gray-400;
      }
      .paginator .page-item.active {
        @apply border-sky-600 dark:border-white;
      }
      .paginator .page-item.disabled {
        @apply bg-gray-50 dark:bg-gray-500 dark:border-gray-400;
      }
      .paginator .page-item.disabled a {
        @apply text-gray-400 dark:text-gray-400;
      }
       
      .block-example {
        @apply my-4 pl-3;
        @apply border-l-8 border-gray-300 dark:border-zinc-600;
      }
       
      #about img {
        @apply inline-flex h-4;
      }
       
      .fai {
        @apply inline-flex h-[1.2em] w-[1.2em] pr-[0.4em] fill-current;
      }
      .fai-link {
        @apply hover:text-sky-400 dark:hover:text-blue-400;
      }
      .label-link .fai {
        @apply pl-1 pb-1 h-[1.5em] w-[1.5em];
      }
       
      .chroma {
        @apply my-5 overflow-y-scroll;
        @apply p-1 border rounded;
      }
    }
  </style><style>.block-example-title::before{counter-increment:example;content:"Example " counter(example)}body{counter-reset:example}code.has-jax{-webkit-font-smoothing:antialiased;background:inherit!important;border:none!important;font-size:100%}*:hover>.anchorjs-link{margin-left:-1.125em!important}.chroma{background-color:#fff}.chroma .x{}.chroma .err{color:#a61717;background-color:#e3d2d2}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.chroma .hl{display:block;width:100%;background-color:#ffc}.chroma .lnt{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .k{color:#000;font-weight:700}.chroma .kc{color:#000;font-weight:700}.chroma .kd{color:#000;font-weight:700}.chroma .kn{color:#000;font-weight:700}.chroma .kp{color:#000;font-weight:700}.chroma .kr{color:#000;font-weight:700}.chroma .kt{color:#458;font-weight:700}.chroma .n{}.chroma .na{color:teal}.chroma .nb{color:#0086b3}.chroma .bp{color:#999}.chroma .nc{color:#458;font-weight:700}.chroma .no{color:teal}.chroma .nd{color:#3c5d5d;font-weight:700}.chroma .ni{color:purple}.chroma .ne{color:#900;font-weight:700}.chroma .nf{color:#900;font-weight:700}.chroma .fm{}.chroma .nl{color:#900;font-weight:700}.chroma .nn{color:#555}.chroma .nx{}.chroma .py{}.chroma .nt{color:navy}.chroma .nv{color:teal}.chroma .vc{color:teal}.chroma .vg{color:teal}.chroma .vi{color:teal}.chroma .vm{}.chroma .l{}.chroma .ld{}.chroma .s{color:#d14}.chroma .sa{color:#d14}.chroma .sb{color:#d14}.chroma .sc{color:#d14}.chroma .dl{color:#d14}.chroma .sd{color:#d14}.chroma .s2{color:#d14}.chroma .se{color:#d14}.chroma .sh{color:#d14}.chroma .si{color:#d14}.chroma .sx{color:#d14}.chroma .sr{color:#009926}.chroma .s1{color:#d14}.chroma .ss{color:#990073}.chroma .m{color:#099}.chroma .mb{color:#099}.chroma .mf{color:#099}.chroma .mh{color:#099}.chroma .mi{color:#099}.chroma .il{color:#099}.chroma .mo{color:#099}.chroma .o{color:#000;font-weight:700}.chroma .ow{color:#000;font-weight:700}.chroma .p{}.chroma .c{color:#998;font-style:italic}.chroma .ch{color:#998;font-style:italic}.chroma .cm{color:#998;font-style:italic}.chroma .c1{color:#998;font-style:italic}.chroma .cs{color:#999;font-weight:700;font-style:italic}.chroma .cp{color:#999;font-weight:700;font-style:italic}.chroma .cpf{color:#999;font-weight:700;font-style:italic}.chroma .g{}.chroma .gd{color:#000;background-color:#fdd}.chroma .ge{color:#000;font-style:italic}.chroma .gr{color:#a00}.chroma .gh{color:#999}.chroma .gi{color:#000;background-color:#dfd}.chroma .go{color:#888}.chroma .gp{color:#555}.chroma .gs{font-weight:700}.chroma .gu{color:#aaa}.chroma .gt{color:#a00}.chroma .gl{text-decoration:underline}.chroma .w{color:#bbb}.dark.chroma{color:#f8f8f2;background-color:#272822}.dark .chroma{color:#f8f8f2;background-color:#272822}.dark .chroma .x{}.dark .chroma .err{color:#960050;background-color:#1e0010}.dark .chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.dark .chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.dark .chroma .hl{display:block;width:100%;background-color:#ffc}.dark .chroma .lnt{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.dark .chroma .ln{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.dark .chroma .k{color:#66d9ef}.dark .chroma .kc{color:#66d9ef}.dark .chroma .kd{color:#66d9ef}.dark .chroma .kn{color:#f92672}.dark .chroma .kp{color:#66d9ef}.dark .chroma .kr{color:#66d9ef}.dark .chroma .kt{color:#66d9ef}.dark .chroma .n{}.dark .chroma .na{color:#a6e22e}.dark .chroma .nb{}.dark .chroma .bp{}.dark .chroma .nc{color:#a6e22e}.dark .chroma .no{color:#66d9ef}.dark .chroma .nd{color:#a6e22e}.dark .chroma .ni{}.dark .chroma .ne{color:#a6e22e}.dark .chroma .nf{color:#a6e22e}.dark .chroma .fm{}.dark .chroma .nl{}.dark .chroma .nn{}.dark .chroma .nx{color:#a6e22e}.dark .chroma .py{}.dark .chroma .nt{color:#f92672}.dark .chroma .nv{}.dark .chroma .vc{}.dark .chroma .vg{}.dark .chroma .vi{}.dark .chroma .vm{}.dark .chroma .l{color:#ae81ff}.dark .chroma .ld{color:#e6db74}.dark .chroma .s{color:#e6db74}.dark .chroma .sa{color:#e6db74}.dark .chroma .sb{color:#e6db74}.dark .chroma .sc{color:#e6db74}.dark .chroma .dl{color:#e6db74}.dark .chroma .sd{color:#e6db74}.dark .chroma .s2{color:#e6db74}.dark .chroma .se{color:#ae81ff}.dark .chroma .sh{color:#e6db74}.dark .chroma .si{color:#e6db74}.dark .chroma .sx{color:#e6db74}.dark .chroma .sr{color:#e6db74}.dark .chroma .s1{color:#e6db74}.dark .chroma .ss{color:#e6db74}.dark .chroma .m{color:#ae81ff}.dark .chroma .mb{color:#ae81ff}.dark .chroma .mf{color:#ae81ff}.dark .chroma .mh{color:#ae81ff}.dark .chroma .mi{color:#ae81ff}.dark .chroma .il{color:#ae81ff}.dark .chroma .mo{color:#ae81ff}.dark .chroma .o{color:#f92672}.dark .chroma .ow{color:#f92672}.dark .chroma .p{}.dark .chroma .c{color:#75715e}.dark .chroma .ch{color:#75715e}.dark .chroma .cm{color:#75715e}.dark .chroma .c1{color:#75715e}.dark .chroma .cs{color:#75715e}.dark .chroma .cp{color:#75715e}.dark .chroma .cpf{color:#75715e}.dark .chroma .g{}.dark .chroma .gd{color:#f92672}.dark .chroma .ge{font-style:italic}.dark .chroma .gr{}.dark .chroma .gh{}.dark .chroma .gi{color:#a6e22e}.dark .chroma .go{}.dark .chroma .gp{}.dark .chroma .gs{font-weight:700}.dark .chroma .gu{color:#75715e}.dark .chroma .gt{}.dark .chroma .gl{}.dark .chroma .w{}</style><script>localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"></head><body><nav><div class="container flex flex-wrap items-center justify-between mx-auto max-w-6xl h-12 px-6"><div class="flex items-center justify-start justify-self-start"><div class="flex nav-item h-12 w-12 items-center justify-center"><a class=text-white href=https://aakinshin.net/><svg class="fai w-6 h-6"><use xlink:href="/img/fa/all.svg#house-chimney"/></svg></a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/posts/>Posts</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/about/>About</a></div></div><button id=theme-toggle type=button class="nav-item p-3 content-center justify-self-end"><svg id="theme-toggle-dark-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001.0 1010.586 10.586z"/></svg><svg id="theme-toggle-light-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1A1 1 0 119 4V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707A1 1 0 1113.536 5.05l.707-.707a1 1 0 011.414.0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707A1 1 0 004.343 5.757l.707.707zm1.414 8.486-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"/></svg></button></div></nav><div class="main container mx-auto max-w-6xl px-6"><div class=main-post><h1 class=blog-post-title id=post-title>Normality is a myth</h1><div class="flex flex-wrap justify-start items-center"><svg class="fai"><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2019-10-09>October 9, 2019</time><svg class="fai ml-3"><use xlink:href="/img/fa/all.svg#tag"/></svg>
<a class=label-link href=https://aakinshin.net/tags/mathematics/>Mathematics</a>
<a class=label-link href=https://aakinshin.net/tags/statistics/>Statistics</a>
<a class=label-link href=https://aakinshin.net/tags/normality/>Normality</a>
<a class=label-link href=https://aakinshin.net/tags/central-limit-theorem/>Central Limit Theorem</a></div><br><div class=main-content><p>In many statistical papers, you can find the following phrase: &ldquo;assuming that we have a normal distribution.&rdquo;
Probably, you saw plots of the normal distribution density function in some statistics textbooks,
it looks like this:</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/normality/img/normal-light.png target=_blank alt=normal><img src=/posts/normality/img/normal-light.png width=800></a>
<a class="img-dark hidden" href=/posts/normality/img/normal-dark.png target=_blank alt=normal><img src=/posts/normality/img/normal-dark.png width=800></a></div><p>The normal distribution is a pretty user-friendly mental model when we are trying to interpret the statistical metrics
like mean and standard deviation.
However, it may also be an insidious and misleading model when your distribution is not normal.
There is a great sentence in the <a href=https://doi.org/10.1093/biomet/34.3-4.209>&ldquo;Testing for normality&rdquo;</a> paper by R.C. Geary, 1947 (the quote was found <a href=https://garstats.wordpress.com/2019/06/17/myth/>here</a>):</p><blockquote><p>Normality is a myth; there never was, and never will be, a normal distribution.</p></blockquote><p>I 100% agree with this statement.
At least, if you are working with performance distributions
(that are based on the multiple iterations of your benchmarks that measure the performance metrics of your applications),
you should forget about normality.
That&rsquo;s how a typical performance distribution looks like
(I built the below picture based on a real benchmark that measures the load time of assemblies
when we open the <a href=https://github.com/OrchardCMS/Orchard>Orchard</a> solution in <a href=https://www.jetbrains.com/rider/>Rider</a> on Linux):</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/normality/img/performance-light.png target=_blank alt=performance><img src=/posts/normality/img/performance-light.png width=800></a>
<a class="img-dark hidden" href=/posts/normality/img/performance-dark.png target=_blank alt=performance><img src=/posts/normality/img/performance-dark.png width=800></a></div><p>Of course, <em>some</em> of the performance distributions look similar to the normal distribution.
And you can apply statistical approaches that assume normality to such distributions.
And these approaches may provide correct results in many cases.
If you are working with a single benchmark and manually check the results,
you will be probably lucky enough and get correct results which will strengthen your faith to the fact
that it&rsquo;s OK to use such approaches all the time.
However, if you are working with thousands of performance tests and you are trying to use such approaches automatically,
you will probably get wrong results for some of these tests <em>all the time</em>.</p><p>The worst thing about the real performance distributions (that are often right-skewed and multimodal) is that
it makes all of the statistical metrics (like the mean) misleading.
Let&rsquo;s look at an example of <a href=https://github.com/dotnet/BenchmarkDotNet>BenchmarkDotNet</a> summary table:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-md data-lang=md><span class=line><span class=cl>| Method |     Mean |    Error |   StdDev |   Median |
</span></span><span class=line><span class=cl>|------- |---------:|---------:|---------:|---------:|
</span></span><span class=line><span class=cl>|      A | 136.2 ms | 19.30 ms | 56.92 ms | 107.0 ms |
</span></span><span class=line><span class=cl>|      B | 133.7 ms |  4.14 ms | 12.20 ms | 130.2 ms |
</span></span></code></pre></div><p>From my observations, when the Mean value is presented,
people <em>usually</em> read only the Mean column and ignore other columns.
After that, they make conclusions only based on the Mean values and the normal distribution mental model.
Thus, they may think that <code>B</code> always works a little bit faster than <code>A</code> in the above table.
Now let&rsquo;s look at the &ldquo;Expectation vs. Reality&rdquo; picture for the <code>A</code> and <code>B</code> density plots:</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/normality/img/misleading-light.png target=_blank alt=misleading><img src=/posts/normality/img/misleading-light.png width=800></a>
<a class="img-dark hidden" href=/posts/normality/img/misleading-dark.png target=_blank alt=misleading><img src=/posts/normality/img/misleading-dark.png width=800></a></div><p>As you can see, both distributions are heavy-tailed right-skewed distributions.
<code>A</code> has very huge outliers (that spoiled the mean value),
but most of the <code>B</code> quantiles are larger than the corresponding <code>A</code> quantiles.
BenchmarkDotNet automatically added the <code>Median</code> column to highlight this fact
(the median value for <code>B</code> is much larger than the median value for <code>A</code>).
Unfortunately, most of the people ignore such kind of additional information and
continue to imagine a normal distribution based on the mean value.</p><p>There is one more thing in perception of statistics.
When I tell people about complex multimodal heavy-tailed right-skewed distributions,
they usually reply that we have the
<a href=https://en.wikipedia.org/wiki/Central_limit_theorem>Central Limit Theorem</a>.
For some reason, people think that it will magically stabilize the mean value and
rescue us from multimodal distributions if we collect &ldquo;enough&rdquo; measurements.
Here is the definition of this theorem from <a href=https://www.dummies.com/education/math/statistics/how-the-central-limit-theorem-is-used-in-statistics/>Statistics For Dummies</a>:</p><blockquote><p>The Central Limit Theorem (CLT for short) basically says that for non-normal data, the distribution of the sample means has an approximate normal distribution, no matter what the distribution of the original data looks like, as long as the sample size is large enough (usually at least 30) and all samples have the same size.</p></blockquote><p>So, if we take many samples (sets of measurements), calculate the mean value for each sample,
and build a distribution from these mean values, it should be normal.
If you are not sure that you understand the Central Limit Theorem, I you can watch this video
that explains it with Bunnies & Dragons (the original was found <a href=https://blog.minitab.com/blog/michelle-paret/explaining-the-central-limit-theorem-with-bunnies-and-dragons-v2>here</a>):</p><div class=text-center><iframe width=800 height=450 src=https://www.youtube.com/embed/jvoxEYmQHNM frameborder=0 allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div><p>Let&rsquo;s check how it works in practice.
I wrote a simple R script that emulates taking measurements from a &ldquo;strange&rdquo; distribution with high outliers:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=nf>library</span><span class=p>(</span><span class=n>ggplot2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>&lt;-</span> <span class=m>30</span> <span class=c1># Number of values in each sample</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>&lt;-</span> <span class=m>30</span> <span class=c1># Number of samples</span>
</span></span><span class=line><span class=cl><span class=n>k</span> <span class=o>&lt;-</span> <span class=m>16</span> <span class=c1># Number of CLT distributions</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>set.seed</span><span class=p>(</span><span class=m>159</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># Generate a single random value from a &#34;strange&#34; distribution</span>
</span></span><span class=line><span class=cl><span class=n>gen.value</span> <span class=o>&lt;-</span> <span class=nf>function</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nf>sample</span><span class=p>(</span><span class=m>1</span><span class=o>:</span><span class=m>10</span><span class=p>,</span> <span class=m>1</span><span class=p>)</span> <span class=o>+</span>                               <span class=c1># Offset</span>
</span></span><span class=line><span class=cl>  <span class=nf>rbeta</span><span class=p>(</span><span class=m>1</span><span class=p>,</span> <span class=m>1</span><span class=p>,</span> <span class=m>10</span><span class=p>)</span> <span class=o>*</span> <span class=nf>sample</span><span class=p>(</span><span class=m>1</span><span class=o>:</span><span class=m>10</span><span class=p>,</span> <span class=m>1</span><span class=p>)</span> <span class=o>+</span>             <span class=c1># Right-skewed distribution</span>
</span></span><span class=line><span class=cl>  <span class=nf>sample</span><span class=p>(</span><span class=nf>c</span><span class=p>(</span><span class=nf>rep</span><span class=p>(</span><span class=m>0</span><span class=p>,</span> <span class=m>50</span><span class=p>),</span> <span class=m>1</span><span class=o>:</span><span class=m>10</span><span class=p>))</span> <span class=o>*</span> <span class=nf>rnorm</span><span class=p>(</span><span class=m>1</span><span class=p>,</span> <span class=m>200</span><span class=p>,</span> <span class=m>10</span><span class=p>)</span> <span class=c1># Outliers</span>
</span></span><span class=line><span class=cl><span class=c1># Generate a sample mean</span>
</span></span><span class=line><span class=cl><span class=n>gen.mean</span> <span class=o>&lt;-</span> <span class=nf>function</span><span class=p>()</span> <span class=nf>mean</span><span class=p>(</span><span class=nf>sapply</span><span class=p>(</span><span class=m>1</span><span class=o>:</span><span class=n>n</span><span class=p>,</span> <span class=nf>function</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=nf>gen.value</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df</span> <span class=o>&lt;-</span> <span class=nf>data.frame</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nf>for </span><span class=p>(</span><span class=n>i</span> <span class=n>in</span> <span class=m>1</span><span class=o>:</span><span class=n>k</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>df</span> <span class=o>&lt;-</span> <span class=nf>rbind</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=nf>data.frame</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>Experiment</span> <span class=o>=</span> <span class=nf>rep</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>m</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>Time</span> <span class=o>=</span> <span class=nf>sapply</span><span class=p>(</span><span class=m>1</span><span class=o>:</span><span class=n>m</span><span class=p>,</span> <span class=nf>function</span><span class=p>(</span><span class=n>j</span><span class=p>)</span> <span class=nf>gen.mean</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>&lt;-</span> <span class=nf>ggplot</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=nf>aes</span><span class=p>(</span><span class=n>x</span> <span class=o>=</span> <span class=n>Time</span><span class=p>,</span> <span class=n>group</span> <span class=o>=</span> <span class=n>Experiment</span><span class=p>))</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>geom_density</span><span class=p>(</span><span class=n>fill</span> <span class=o>=</span> <span class=s>&#34;red&#34;</span><span class=p>,</span> <span class=n>alpha</span> <span class=o>=</span> <span class=m>0.4</span><span class=p>,</span> <span class=n>bw</span> <span class=o>=</span> <span class=s>&#34;SJ&#34;</span><span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>facet_wrap</span><span class=p>(</span><span class=o>~</span><span class=n>Experiment</span><span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>ylab</span><span class=p>(</span><span class=s>&#34;Density&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>In this script,
<code>gen.value</code> returns a random value from our &ldquo;strange&rdquo; distribution,
<code>gen.mean</code> generates a sample with 30 measurements (because <a href=https://stats.stackexchange.com/q/2541/261747>30 is a magic number</a>)
and returns the mean value of this sample.
Next, we perform 16 experiments.
In each experiment, we draw a distribution density function based on 30 mean values that we generated.
Here is the result:</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/normality/img/clt-light.png target=_blank alt=clt><img src=/posts/normality/img/clt-light.png width=800></a>
<a class="img-dark hidden" href=/posts/normality/img/clt-dark.png target=_blank alt=clt><img src=/posts/normality/img/clt-dark.png width=800></a></div><p>As you can see, many of the generated distribution are not looking as normal.
What&rsquo;s wrong?
Maybe the Central Limit Theorem doesn&rsquo;t work?
Don&rsquo;t worry, there are no problems with the theorem.
We just didn&rsquo;t take enough measurements.
If we increase the sample sizes (<code>n</code> and <code>m</code> parameters in the above R script), the plots will be &ldquo;fixed&rdquo;:
the observed density plots will become &ldquo;more normal.&rdquo;</p><p>Now let&rsquo;s think about the sample sizes.
In each experiment, we draw a density function based on 900 measurements
(we have 30 mean values; each value was calculated based on a sample with 30 measurements).
The script works pretty fast because it generates &ldquo;fake&rdquo; data.
In real life, we typically spend at least 1 second per measurement.
If we want to build such a plot based on the real data,
we will spend 900 seconds (or 15 minutes) per an experiment.
Some of the real benchmarks may take more than 1 minute per measurement which means that
we should spend <em>15 hours</em> for the whole experiment.
In theory, if we spend a lot of hours on the measurements,
we will most likely get a plot which will be similar to the normal distribution.
In practice, we will not spend so much time per each benchmark
(especially, if we have hundreds or thousands of them).</p><p>At the conclusion, I want to highlight some important facts about the Central Limit Theorem
that people usually don&rsquo;t understand
(based on the &ldquo;The Central Limit Theorem&rdquo; section from <a href=/prodotnetbenchmarking/>my book</a>):</p><ul><li>If we do many iterations, the original distribution will not become normal,
and we can&rsquo;t interpret the mean, the variance, the skewness, and the kurtosis as in the case of normal distribution.</li><li>The range of the mean values across all samples is not always narrow,
we still can have a huge difference between the mean values in different samples.
The normal distribution based on the mean values has its own standard deviation
which depends on the sample size and can be expressed via the standard error.</li><li>The central limit theorem doesn&rsquo;t work correctly when the sample sizes are small.
For example, if you make a single measurement in each sample,
the distribution based on the mean values will have the same shape as the original distribution.</li><li>If we take a small number of samples (<span class="math inline">\(n < 100\)</span>),
we will probably not see a normal distribution on the density plot for mean values.</li></ul><p>If we are speaking about the original performance distributions,
we can forget about normality at all.
The assumption of normality can work fine in some special cases,
but it will let you down in the long run.
Remember the R.C. Geary&rsquo;s words: <em>&ldquo;Normality is a myth; there never was, and never will be, a normal distribution.&rdquo;</em></p></div><br><br><div class="flex flex-wrap justify-center items-center mb-5"><span>Share:</span><div class="text-4xl pl-3"><a href="https://www.reddit.com/submit?url=https%3a%2f%2faakinshin.net%2fposts%2fnormality%2f&title=Normality%20is%20a%20myth" target=_blank title="Share on Reddit"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#reddit"/></svg></a></div><div class="text-4xl pl-3"><a href="https://twitter.com/intent/tweet?text=Normality%20is%20a%20myth&url=https%3a%2f%2faakinshin.net%2fposts%2fnormality%2f&via=andrey_akinshin&related=andrey_akinshin" rel=nofollow target=_blank title="Share on Twitter"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></div><div class="text-4xl pl-3"><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2faakinshin.net%2fposts%2fnormality%2f" target=_blank title="Share on HackerNews"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#hacker-news"/></svg></a></div><div class="text-4xl pl-3"><a href="https://getpocket.com/save?url=https%3a%2f%2faakinshin.net%2fposts%2fnormality%2f&title=Normality%20is%20a%20myth" target=_blank title="Add to Pocket"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#get-pocket"/></svg></a></div></div></div></div><script>var themeToggleDarkIcon=document.getElementById("theme-toggle-dark-icon"),themeToggleBtn,themeToggleLightIcon=document.getElementById("theme-toggle-light-icon");const imagesDark=document.querySelectorAll(".img-dark"),imagesLight=document.querySelectorAll(".img-light");localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(themeToggleLightIcon.classList.remove("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")})):(themeToggleDarkIcon.classList.remove("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")})),themeToggleBtn=document.getElementById("theme-toggle"),themeToggleBtn.addEventListener("click",function(){themeToggleDarkIcon.classList.toggle("hidden"),themeToggleLightIcon.classList.toggle("hidden"),imagesLight.forEach(e=>{e.classList.toggle("hidden")}),imagesDark.forEach(e=>{e.classList.toggle("hidden")}),localStorage.getItem("color-theme")?localStorage.getItem("color-theme")==="light"?(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"))})</script><footer class="z-20 p-4 md:p-6 mt-3 w-full border-t border-gray-200 shadow flex items-center justify-center dark:border-gray-600 bg-white dark:bg-zinc-800"><span class="dark:text-gray-400 text-center">© 2013—2022 <span class=whitespace-nowrap>Andrey Akinshin</span></span><ul class="flex flex-wrap items-center px-4 mb-1"><li><a href=https://github.com/AndreyAkinshin><svg class="fai fai-link w-5 h-5"><title>GitHub</title><use xlink:href="/img/fa/all.svg#github"/></svg></a></li><li><a href=https://twitter.com/andrey_akinshin><svg class="fai fai-link w-5 h-5"><title>Twitter</title><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></li><li><a href=https://aakinshin.net/posts/index.xml><svg class="fai fai-link w-5 h-5"><title>RSS</title><use xlink:href="/img/fa/all.svg#rss"/></svg></a></li></ul><div class=main-content><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.1/anchor.min.js integrity="sha512-zPB79j2C+3sFS9zcA3vg/z6bVKzJVEyu9pY5w89akQRys76zpAT2t6S3wZKla3QQ14O5l/Yt0RUQ/DHXx82Y5g==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>anchors.options={placement:"left",icon:"§"},anchors.add("h1"),anchors.add("h2"),anchors.add("h3")</script></body></html>