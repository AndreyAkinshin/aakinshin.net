<!doctype html><html lang=en class=h-100><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.103.0-DEV"><meta name=author content="Andrey Akinshin"><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content="Mathematics,Statistics,Research,Multimodality,QRDE,Harrell-Davis quantile estimator"><title>Lowland multimodality detection | Andrey Akinshin</title><meta name=description content="I came up with a new algorithm for multimodality detection. On my data sets, it works much better than all the other approaches I tried."><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><link href=https://aakinshin.net/sass/bootstrap-light.min.css theme=light rel=stylesheet type=text/css media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><link href=https://aakinshin.net/sass/bootstrap-dark.min.css theme=dark rel=stylesheet type=text/css media="(prefers-color-scheme: dark)"><script src=https://aakinshin.net/js/theme-before.min.d7f6578e23ad3f0c33c589f9bcb34f995b45121f1f3ce888869c86b26826c845.js></script>
<script type=module src=https://aakinshin.net/js/dark-mode-toggle.min.9e68d431432744c07a43381a8a833ffe0921cc0e006d84ad97f0b0d43c5cd82d.mjs></script>
<link href=https://aakinshin.net/css/fontawesome-all.min.178e95bba6ea2e9a90838cd646658f4bf6667a6ceaa057cb587bf7e6eb8412d3.css rel=stylesheet type=text/css media=all><link href=https://aakinshin.net/css/about.min.60773ab7266ecc6e9625306f57c0a82a219b011dc3ea2d83763d1ecdf11c86d2.css rel=stylesheet type=text/css media=all><link href=https://aakinshin.net/css/blog.min.7e186db80d8c431d196b3e0718afb0636b82a269a8c92521c11a55267a24fc27.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"><script src=/js/jquery-3.3.1.slim.min.js></script></head><body class="d-flex flex-column min-vh-100"><div class=bg-primary><div class="container bg-primary"><nav class="navbar navbar-expand-sm navbar-dark bg-primary"><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link id=nav-link-blog href=https://aakinshin.net/><i class="fas fa-home" title=Home style=color:#fff></i></a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-expanded=false>Blog</a><ul class="dropdown-menu bg-primary"><li><a class=dropdown-item href=https://aakinshin.net/posts/>All Posts</a></li><li><a class=dropdown-item href=https://aakinshin.net/tags/statistics/>Posts about Statistics</a></li><li></li><a class=dropdown-item href=https://aakinshin.net/tags/>All Tags</a></li></ul></li><li class=nav-item><a class=nav-link id=nav-link-about href=https://aakinshin.net/about/>About</a></li></ul><ul class="navbar-nav ms-auto"><li class=nav-item><dark-mode-toggle permanent=true></dark-mode-toggle></li></ul></nav></div></div><div class=container><main id=main><div class=blog-main><div class="blog-post table-sm"><h1 class=blog-post-title id=post-title>Lowland multimodality detection</h1><span class=blog-post-meta><div class=faicon><i class="far fa-calendar-alt"></i></div><time datetime=2020-11-03>November 3, 2020</time>
&nbsp;&nbsp;
<i class="fas fa-tag"></i>
&nbsp;
<a href=https://aakinshin.net/tags/mathematics/ class="badge badge-info">Mathematics</a>
<a href=https://aakinshin.net/tags/statistics/ class="badge badge-info">Statistics</a>
<a href=https://aakinshin.net/tags/research/ class="badge badge-info">Research</a>
<a href=https://aakinshin.net/tags/multimodality/ class="badge badge-info">Multimodality</a>
<a href=https://aakinshin.net/tags/qrde/ class="badge badge-info">QRDE</a>
<a href=https://aakinshin.net/tags/harrell-davis-quantile-estimator/ class="badge badge-info">Harrell-Davis quantile estimator</a></span><br><br><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/data5-light.svg target=_blank class=imgldlink alt=data5><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/data5-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/data5-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/data5-light.svg></picture></a></div></div><br><p>Multimodality is an essential feature of a distribution, which may create many troubles during automatic analysis.
One of the best ways to work with such distributions is to detect all the modes in advance based on the given samples.
Unfortunately, this problem is much harder than it looks like.</p><p>I tried many different approaches for multimodality detection, but none of them was good enough.
During the past several years, my approach of choice was the <a href=http://www.brendangregg.com/FrequencyTrails/modes.html>mvalue-based modal test</a> by Brendan Gregg.
It works nicely in simple cases, but I was constantly stumbling over noisy samples where this algorithm doesn&rsquo;t produce reliable results.
Also, it has some limitations that make it unapplicable to some corner cases.</p><p>So, I needed a better approach.
Here are my main requirements:</p><ul><li>It should detect the exact mode locations and ranges</li><li>It should provide reliable results even on noisy samples</li><li>It should be able to detect multimodality even when some modes are extremely close to each other</li><li>It should work out of the box without tricky parameter tuning for each specific distribution</li></ul><p>I failed to find such an algorithm anywhere, so I came up with my own!
The current working title is &ldquo;the lowland multimodality detector.&rdquo;
It takes an estimation of the probability density function (PDF) and tries to find &ldquo;lowlands&rdquo; (areas that are much lower than neighboring peaks).
Next, it splits the plot by these lowlands and detects modes between them.
For the PDF estimation, it uses the <a href=https://aakinshin.net/posts/qrde-hd/>quantile-respectful density estimation based on the Harrell-Davis quantile estimator</a> (QRDE-HD).
Let me explain how it works in detail.</p><h3 id=the-problem>The problem</h3><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/riddle-light.svg target=_blank class=imgldlink alt=riddle><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/riddle-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/riddle-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/riddle-light.svg></picture></a></div></div><br><p>How many modes do you see in the above image?
It&rsquo;s a trick question because it depends on the &ldquo;mode&rdquo; definition and on the kind of plot we have.
Here are some possible options:</p><ul><li><em>The plot is an exact probability density function; the mode is the global <a href=https://en.wikipedia.org/wiki/Maxima_and_minima>maxima</a>.</em><br>In this case, we have only a single mode (0.02).</li><li><em>The plot is an exact probability density function; the mode is a local maxima.</em><br>In this case, we have seven modes (-2.38, -1.11, 0.02, 0.41, 0.91, 1.61, 1.99).</li><li><em>The plot is an estimated probability density function based on a sample; the mode is a local maxima on the underlying distribution.</em><br>In this case, it&rsquo;s impossible to answer the question based on the given plot.
Meanwhile, the correct answer is &ldquo;one&rdquo;: the samples were collected from the normal distribution <span class="math inline">\(\mathcal{N}(0, 1^2)\)</span> (the picture presents a kernel density estimation with bandwidth = 0.1 based on the normal kernel).</li></ul><p>In this post, we will work with the most practical case.
Let&rsquo;s say that we have a sample, and we want to provide an estimation of the modes in the underlying distribution.
There is an important nuance here.
If we define the mode as the local maxima, we can easily get bunches of noisy modes that are close to each other,
but have no clear separation.
Typically, the true density of real-life distributions is very noisy and wobbly.</p><p>However, we are not interested in most of &ldquo;close to each other noisy modes&rdquo; in practice.
When we work with such distributions, we tend to make the density smoother.
We tend to reduce the impact of noise patterns, even if such patterns are integral parts of the original distribution.
We tend to group each bunch of nearby local maxima to a single mode.</p><p>During basic distribution exploration,
we are interested only in &ldquo;major&rdquo; modes that make sense to us from the practical point of view.
Here I have some good news and some bad news.
The bad news: we don&rsquo;t have a strict mathematical definition, so we can&rsquo;t verify and compare different approaches.
The good news: we are free to choose our own definition, which will be optimal for our use cases.</p><p>During my research, I often ask my colleagues: &ldquo;How many modes do you see in this plot?&rdquo;
Typically, I get identical answers for the same plot, which makes me think that there is a common understanding of this concept.
In this post, we focus on such &ldquo;practically significant&rdquo; modes which often look obvious for most people.</p><h3 id=the-mvalue-approach>The mvalue approach</h3><p>To get a better understanding of the problem, we start with the analysis of the mvalue approach.
It&rsquo;s described by Brendan Gregg in <a href=#Gregg2015>[Gregg2015]</a>.
It worth reading the original post, but I briefly describe the main idea.
Basically, the mvalue is the <a href=https://en.wikipedia.org/wiki/Total_variation>total variation</a> of a histogram or a density plot normalized by the plot height.
The modal test compares the mvalue with a predefined threshold and makes a decision about multimodality.
The easiest way to understand the idea is to just look at some examples.</p><p>Here is a visualization of a perfect unimodal distribution:</p><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/mvalue1-light.svg target=_blank class=imgldlink alt=mvalue1><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/mvalue1-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/mvalue1-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/mvalue1-light.svg></picture></a></div></div><br><p>Here we have three local extrema: the left corner point, the central peak, and the right corner point.
For each extremum, we should calculate the density value normalized by the global maxima.
For the left and right corner points, this value equals zero.
For the central peak, it equals one (because it&rsquo;s the highest peak).
The total variation is the sum of absolute differences between consecutive values.
In this case, it equals
(1.0 for ascent from the left corner point to the central peak) +
(1.0 for descent from the central peak to the right corner point).
Thus, the mvalue equals 2.
It&rsquo;s the minimum possible value of mvalue.</p><p>Here is a visualization of a perfect bimodal distribution:</p><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/mvalue2-light.svg target=_blank class=imgldlink alt=mvalue2><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/mvalue2-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/mvalue2-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/mvalue2-light.svg></picture></a></div></div><br><p>The mvalue equals 4 (1 for ascent + 1 for descent + 1 for ascent + 1 for descent).
It&rsquo;s the default value of the etalon bimodal distribution.</p><p>Here is a visualization of a perfect trimodal distribution:</p><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/mvalue3-light.svg target=_blank class=imgldlink alt=mvalue3><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/mvalue3-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/mvalue3-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/mvalue3-light.svg></picture></a></div></div><br><p>The mvalue equals 6 (1 for ascent + 1 for descent + 1 for ascent + 1 for descent + 1 for ascent + 1 for descent).
It&rsquo;s the default value of the etalon trimodal distribution.</p><p>You may think that we can get the number of modes by dividing mvalue by 2.
Unfortunately, it&rsquo;s not so simple.
Could you guess the mvalue of the below plot?</p><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/mvalue4a-light.svg target=_blank class=imgldlink alt=mvalue4a><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/mvalue4a-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/mvalue4a-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/mvalue4a-light.svg></picture></a></div></div><br><p>It equals 4:</p><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/mvalue4b-light.svg target=_blank class=imgldlink alt=mvalue4b><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/mvalue4b-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/mvalue4b-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/mvalue4b-light.svg></picture></a></div></div><br><p>It&rsquo;s hard to make an unequivocal conclusion about modality here, but it&rsquo;s definitely not a bimodal distribution.</p><p>And what could you say about the next plot?</p><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/mvalue5a-light.svg target=_blank class=imgldlink alt=mvalue5a><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/mvalue5a-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/mvalue5a-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/mvalue5a-light.svg></picture></a></div></div><br><p>It equals 6:</p><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/mvalue5b-light.svg target=_blank class=imgldlink alt=mvalue5b><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/mvalue5b-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/mvalue5b-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/mvalue5b-light.svg></picture></a></div></div><br><p>This distribution is most probably unimodal.
But because of the noise, the mvalue-based modal test thinks that it&rsquo;s a trimodal distribution.
Although mvalues allows detecting multimodal distributions in simple cases,
they have some serious disadvantages:</p><ul><li><strong>High false-positive rate</strong><br>Many noisy distributions may be considered as multimodal.</li><li><strong>No clear mode separation</strong><br>We get only a single number that expresses the measure of multimodality.
But we don&rsquo;t have the exact number of modes and their locations and ranges.</li><li><strong>Tricky tuning</strong><br>This approach provides too many degrees of freedom:<ul><li>We should choose the basis for mvalues: a histogram or a density plot.</li><li>If we use a histogram, we should choose the bandwidth and offset values
(which is <a href=https://aakinshin.net/posts/misleading-histograms/>not easy</a>).
If we use a kernel density estimation, we should choose the kernel bandwidth
(which is also <a href=https://aakinshin.net/posts/kde-bw/>not easy</a>)</li><li>We should manually remove outliers, so we have to choose an appropriate outlier detection algorithm.</li><li>We should specify adequate thresholds.
Brendan Gregg recommends using 2.4 as a signal that it worth manually investigate the distribution.
In <a href=https://github.com/AndreyAkinshin/perfolizer>perfolizer</a>, I currently use 2.8 as a lower threshold for multimodal distribution to reduce the false-positive rate.
It&rsquo;s hard to say which value is the best one in the general case.</li></ul></li></ul><p>Despite all these problems, this approach works and can be used in practice.
I have been using it in <a href=https://github.com/dotnet/BenchmarkDotNet>BenchmarkDotNet</a> for the past two years (it&rsquo;s available since v0.10.14), but there are still cases when it doesn&rsquo;t help to automatically make a reliable conclusion about multimodality.
So, I decided to find another approach that will work better.</p><h3 id=introducing-lowlands>Introducing lowlands</h3><p>Firstly, we will use the <a href=https://aakinshin.net/posts/qrde-hd/>QRDE-HD</a> instead of histograms and kernel density estimations.
The approach provides a much better estimation of the shape of the <em>collected data</em>, and it doesn&rsquo;t require parameter tuning.
Now imagine that this function describes a mountain relief (side view):</p><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/data1-light.svg target=_blank class=imgldlink alt=data1><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/data1-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/data1-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/data1-light.svg></picture></a></div></div><br><p>Next, it&rsquo;s starting to rain<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.
The rain fills the mountain hollows with water and forms a bunch of ponds.
The area of the mountain strictly below the ponds saturated with water.
Now let&rsquo;s introduce the following definitions:</p><ul><li><strong>Groundwater</strong>: the area below a pond saturated with water</li><li><strong>Shallow Water</strong>: a pond with an area <em>smaller</em> than the area of the corresponding underwater</li><li><strong>Deep Water</strong>: a pond with an area <em>larger</em> than the area of the corresponding underwater</li><li><strong>Lowland</strong>: a part of the mountain that is covered by a deep water<br>(we also assume that there are hidden lowlands on the right and on the left side of the visible mountain)</li><li><strong>Peak</strong>: a local maxima of the mountain relief (a point that is higher than its neighbors)</li><li><strong>Mode</strong>: the highest peak between two deep water ponds (including hidden ponds)</li></ul><p>For better understanding, let&rsquo;s see how this classification works in the bimodal case:</p><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/data2-light.svg target=_blank class=imgldlink alt=data2><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/data2-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/data2-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/data2-light.svg></picture></a></div></div><br><p>We can do the following observations:</p><ul><li>Here we have five ponds.</li><li>Only the second pond consists of deep water (because its area is larger than the area of the corresponding underwater). It&rsquo;s the only lowland that we see here.</li><li>Also, we have six peaks: two on the left side of the central lowland and four on the right side.</li><li>The second peak is the first mode because it&rsquo;s the highest peak between the central lowland and the left hidden lowland.</li><li>The third peak is the second mode because it&rsquo;s the highest peak between the central lowland and the right hidden lowland.</li><li>It&rsquo;s a bimodal distribution because we discovered exactly two modes.</li></ul><p>I hope that you got the idea.
Now it&rsquo;s time to formalize this schema.</p><h3 id=lowland-detection-algorithm>Lowland detection algorithm</h3><p>To find the number of modes and their locations for the given samples, we should do the following:</p><ol><li>Build the <a href=https://aakinshin.net/posts/qrde-hd/>QRDE-HD</a></li><li>Find all local maxima of the QRDE-HD except border points (peaks)</li><li>Enumerate all the segments between neighboring peaks in ascending order of size</li><li>For each segment, we try to fill it with &ldquo;water.&rdquo;
The water level is determined by the lowest peak.
If the water area is larger than the area under the water, we mark it as &ldquo;lowland.&rdquo;
Once we found a lowland, we don&rsquo;t touch it anymore: it can&rsquo;t be flooded by a larger pond.
If the water area is smaller than the area under the water, this pond can be merged with other ponds.</li><li>Once we found all the lowland areas, we split the whole plot by them to not-lowland areas.</li><li>In each not-lowland area, we choose the highest peek and mark them as a mode.</li></ol><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/data3-light.svg target=_blank class=imgldlink alt=data3><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/data3-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/data3-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/data3-light.svg></picture></a></div></div><br><h3 id=extreme-case>Extreme case</h3><p>Now consider a case of a bimodal distribution where two modes are very close to each other but still strictly separated.
Let&rsquo;s take two huge samples from the uniform distribution <span class="math inline">\(\{x_{1..1000}\}, \{y_{1..1000}\} \in \mathcal{U}(0, 1)\)</span> and build a bimodal sample of the following form: <span class="math inline">\(\{ -\delta - x^3_{1..1000}, +\delta +y^3_{1..1000} \}\)</span>.
It contains two modes (<span class="math inline">\(-\delta\)</span> and <span class="math inline">\(+\delta\)</span>), and it doesn&rsquo;t include any sample elements between them.
The distance between modes equals <span class="math inline">\(2\delta\)</span>.</p><p>Let&rsquo;s check out how the lowland detector works in such a case.
We start with <span class="math inline">\(\delta = 0.5\)</span>:</p><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/data-close-05-light.svg target=_blank class=imgldlink alt=data-close-05><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/data-close-05-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/data-close-05-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/data-close-05-light.svg></picture></a></div></div><br><p>It wasn&rsquo;t so hard to detect two modes here.
Let&rsquo;s try <span class="math inline">\(\delta = 0.1\)</span>:</p><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/data-close-01-light.svg target=_blank class=imgldlink alt=data-close-01><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/data-close-01-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/data-close-01-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/data-close-01-light.svg></picture></a></div></div><br><p>Not bad.
Now let&rsquo;s try an extreme case: <span class="math inline">\(\delta = 0.01\)</span>.</p><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/data-close-001-light.svg target=_blank class=imgldlink alt=data-close-001><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/data-close-001-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/data-close-001-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/data-close-001-light.svg></picture></a></div></div><br><p>We are still able to detect bimodality here!
Note that it&rsquo;s only possible thanks to the <a href=https://aakinshin.net/posts/qrde-hd/>QRDE-HD</a>.
If we use classic histograms or kernel density estimations here, we will not be able to see multimodality:</p><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/data-close-001-comparison-light.svg target=_blank class=imgldlink alt=data-close-001-comparison><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/data-close-001-comparison-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/data-close-001-comparison-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/data-close-001-comparison-light.svg></picture></a></div></div><br><h3 id=more-examples>More examples</h3><p>Below you can find some additional cases of applying this algorithm to multimodal distributions.</p><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/data4-light.svg target=_blank class=imgldlink alt=data4><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/data4-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/data4-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/data4-light.svg></picture></a></div></div><br><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/data6-light.svg target=_blank class=imgldlink alt=data6><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/data6-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/data6-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/data6-light.svg></picture></a></div></div><br><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/data7-light.svg target=_blank class=imgldlink alt=data7><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/data7-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/data7-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/data7-light.svg></picture></a></div></div><br><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/data8-light.svg target=_blank class=imgldlink alt=data8><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/data8-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/data8-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/data8-light.svg></picture></a></div></div><br><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/data9-light.svg target=_blank class=imgldlink alt=data9><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/data9-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/data9-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/data9-light.svg></picture></a></div></div><br><div class=row><div class=mx-auto><a href=/posts/lowland-multimodality-detection/img/data10-light.svg target=_blank class=imgldlink alt=data10><picture><source theme=dark srcset=/posts/lowland-multimodality-detection/img/data10-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/lowland-multimodality-detection/img/data10-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/lowland-multimodality-detection/img/data10-light.svg></picture></a></div></div><br><h3 id=implementation-notes>Implementation notes</h3><p>You can find a reference C# implementation of this algorithm in
the latest nightly version (0.3.0-nightly.54+) of <a href=https://github.com/AndreyAkinshin/perfolizer>perfolizer</a>
(you need <a href=https://github.com/AndreyAkinshin/perfolizer/blob/dc9d9a3997c0b395575cff06ec8af2a98b3b2bb7/src/Perfolizer/Perfolizer/Mathematics/Multimodality/LowlandModalityDetector.cs><code>LowlandModalityDetector</code></a>).
As I said in the beginning, it doesn&rsquo;t require any parameter tuning.
It should just work without any adjustments.
However, there are a few points of customization that you can use to adopt this algorithm to some very specific corner cases.</p><ul><li><strong>Sensitivity</strong><br>By default, we mark a pond as deep water when its area is larger than the area of the groundwater beneath it.
We can express this via the following equations: <code>Area(DeepWater) > 0.5 * (Area(DeepWater)+Area(Groundwater))</code>.
Let&rsquo;s call <code>0.5</code> in this equation <em>sensitivity</em>.
It defines how large the water area should be to be considered as deep water.
By manipulating this parameter, you can tune how sensitive the algorithm is.
However, based on my experience, <code>0.5</code> looks like an optimal value.</li><li><strong>Precision</strong><br>It&rsquo;s typically enough to calculate 101 quantile values (99 percentiles + minimum + maximum) to build the QRDE-HD as a step function.
However, if you expect an extremely large number of modes
(e.g., 200 modes and extremely large data sets that clearly highlights all of these modes),
you can increase the number of evaluated quantiles.
Note that it may significantly reduce the algorithm performance.</li><li><strong>PDF</strong><br>I suggest using the QRDE-HD to estimate the PDF.
However, other kinds of estimations may be considered.
I do not recommend using classic histograms and kernel density estimations because of the smoothness problems.
However, it may make sense to experiment with other kinds of the PDF estimators (e.g., QRDE based on other smooth quantile estimators).
In general, the algorithm supports any kind of density plots or histograms.</li></ul><h3 id=conclusion>Conclusion</h3><p>The suggested algorithm allows detecting multimodality phenomena based on the given sample.
You can try to use it via <a href=https://github.com/AndreyAkinshin/perfolizer>perfolizer</a> or implement it yourself.
Here are some of the main advantages of this approach:</p><ul><li><strong>Detailing</strong><br>It not only detects the exact number of modes but also provides their exact locations.</li><li><strong>Just works without tuning</strong><br>It works out of the box, and it doesn&rsquo;t require parameter tuning</li><li><strong>Close peak support</strong><br>It allows detecting modes even when they are extremely close to each other</li><li><strong>Robustness and reliability</strong><br>It&rsquo;s pretty robust, and it works reliably even on noisy samples (at least, on my data sets â˜º)</li><li><strong>Natural results</strong><br>The set of detected modes matches thoughts of real people when they manually explore distribution plots</li></ul><p>If you decide to try this algorithm on your data sets, I will be happy to get your feedback!</p><h3 id=references>References</h3><ul><li><b id=Gregg2015>[Gregg2015]</b><br>B. Gregg, 2015.
Frequency Trails: Modes and Modality.<br><a href=http://www.brendangregg.com/FrequencyTrails/modes.html>http://www.brendangregg.com/FrequencyTrails/modes.html</a></li><li><b id=Harrell1982>[Harrell1982]</b><br>Harrell, F.E. and Davis, C.E., 1982. A new distribution-free quantile estimator.
<em>Biometrika</em>, 69(3), pp.635-640.<br><a href=https://pdfs.semanticscholar.org/1a48/9bb74293753023c5bb6bff8e41e8fe68060f.pdf>https://pdfs.semanticscholar.org/1a48/9bb74293753023c5bb6bff8e41e8fe68060f.pdf</a></li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Inspired by the problem &ldquo;Rain&rdquo; from XIV All-Russian Olympiad for schoolchildren in computer science a.k.a. ROI-2002 (Day 1, Problem 2).
The problem description can be found <a href=https://neerc.ifmo.ru/school/archive/2001-2002.html>here</a> (In Russian). The problem solution can be found <a href=http://svgimnazia1.grodno.by/sinica/Book_ABC/Book_ABC_pascal/olimp_resh/olimp_resh55.htm>here</a> (In Russian).&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><br><br><div class=row><div class="justify-content-center share-block"><div class=share-title>Share:</div><div class=share-button><a href="https://www.reddit.com/submit?url=https%3a%2f%2faakinshin.net%2fposts%2flowland-multimodality-detection%2f&title=Lowland%20multimodality%20detection" target=_blank title="Share on Reddit"><i class="fab fa-reddit fa-2x"></i></a></div><div class=share-button><a href="https://twitter.com/intent/tweet?text=Lowland%20multimodality%20detection&url=https%3a%2f%2faakinshin.net%2fposts%2flowland-multimodality-detection%2f&via=andrey_akinshin&related=andrey_akinshin" rel=nofollow target=_blank title="Share on Twitter"><i class="fab fa-twitter fa-2x"></i></a></div><div class=share-button><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2faakinshin.net%2fposts%2flowland-multimodality-detection%2f" target=_blank title="Share on HackerNews"><i class="fab fa-hacker-news fa-2x"></i></a></div><div class=share-button><a href="https://getpocket.com/save?url=https%3a%2f%2faakinshin.net%2fposts%2flowland-multimodality-detection%2f&title=Lowland%20multimodality%20detection" target=_blank title="Add to Pocket"><i class="fab fa-get-pocket fa-2x"></i></a></div></div></div></div><hr></div></div></main></div><footer class="blog-footer mt-auto"><div class=container><p>&copy; 2013&mdash;2022 Andrey Akinshin
|
<a href=https://github.com/AndreyAkinshin><i class="fab fa-github" title=GitHub></i></a>
<a href=https://twitter.com/andrey_akinshin><i class="fab fa-twitter" title=Twitter></i></a>
<a href=https://aakinshin.net/posts/index.xml><i class="fas fa-rss" title=RSS></i></a>
|
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></p></div></footer><script src=https://aakinshin.net/js/theme-after.min.c26550621ac13c2221d7f6f5e6fe862345d3919723c50d730893e3e4856ecf35.js></script>
<script src=/js/bootstrap.bundle.min.js></script>
<script src=/js/anchor.min.js></script>
<script src=https://aakinshin.net/js/custom.min.f6e5d13fe39f305056cc743ee4cb8d117c1aba26176e58c82c79a480d02fe4b7.js></script>
<script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></body></html>