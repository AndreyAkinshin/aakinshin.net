<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.103.0-DEV"><meta name=author content="Andrey Akinshin"><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content="Mathematics,Statistics,Research,Effect Size,Research: Gamma Effect Size,MAD,Harrell-Davis quantile estimator"><title>Customization of the nonparametric Cohen's d-consistent effect size | Andrey Akinshin</title><meta name=description content="One year ago, I publish a post called Nonparametric Cohen&amp;#39;s d-consistent effect size. During this year, I got a lot of internal and external feedback f..."><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><script>localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><link href=https://aakinshin.net/css/main.min.3746982c0855975eba2f485ef34018c70576ba5fe5ea2f4333daa717341a2831.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"></head><body><nav><div class="container flex flex-wrap items-center justify-between mx-auto max-w-6xl h-12 px-6"><div class="flex items-center justify-start justify-self-start"><div class="flex nav-item h-12 w-12 items-center justify-center"><a class=text-white href=https://aakinshin.net/><svg class="fai w-5 h-5 pr-0 mb-0.5"><use xlink:href="/img/fa/all.svg#house-chimney"/></svg></a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/posts/>Posts</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/research/>Research</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/about/>About</a></div></div><div class="flex items-center justify-end justify-self-start"><div class="flex nav-item h-12 items-center" title='Support this blog'><a class="px-3 text-white" href=https://github.com/sponsors/AndreyAkinshin><svg class="fai w-5 h-5 pr-0 mb-0.5"><use xlink:href="/img/fa/all.svg#heart"/></svg></a></div><button id=theme-toggle type=button class="nav-item p-3 content-center justify-self-end"><svg id="theme-toggle-dark-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001.0 1010.586 10.586z"/></svg><svg id="theme-toggle-light-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1A1 1 0 119 4V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707A1 1 0 1113.536 5.05l.707-.707a1 1 0 011.414.0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707A1 1 0 004.343 5.757l.707.707zm1.414 8.486-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"/></svg></button></div></div></nav><div class="main container mx-auto max-w-6xl px-6"><div class=main-post><h1 class=blog-post-title id=post-title>Customization of the nonparametric Cohen's d-consistent effect size</h1><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2021-06-08>June 8, 2021</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/mathematics/>Mathematics</a>
<a class=label-link href=https://aakinshin.net/tags/statistics/>Statistics</a>
<a class=label-link href=https://aakinshin.net/tags/research/>Research</a>
<a class=label-link href=https://aakinshin.net/tags/effect-size/>Effect Size</a>
<a class=label-link href=https://aakinshin.net/tags/research-gamma-es/>Research: Gamma Effect Size</a>
<a class=label-link href=https://aakinshin.net/tags/mad/>MAD</a>
<a class=label-link href=https://aakinshin.net/tags/harrell-davis-quantile-estimator/>Harrell-Davis quantile estimator</a></div></div><br><div class=main-content><p>One year ago, I publish a post called <a href=https://aakinshin.net/posts/nonparametric-effect-size/>Nonparametric Cohen's d-consistent effect size</a>.
During this year, I got a lot of internal and external feedback from
my own statistical experiments and
<a href=https://twitter.com/ViljamiSairanen/status/1400457118340108293>people</a>
<a href=https://sherbold.github.io/autorank/autorank/>who</a>
<a href=https://github.com/Ramon-Diaz/Thesis-Project/blob/85df6b11050c7e05c4394d873585f701a7e3f32e/_util.py#L100>tried</a>
to use the suggested approach.
It seems that the nonparametric version of Cohen&rsquo;s d works much better with real-life not-so-normal data.
While the classic Cohen&rsquo;s d based on
the non-robust arithmetic mean and
the <a href=https://aakinshin.net/posts/misleading-stddev/>non-robust standard deviation</a>
can be easily <a href=https://aakinshin.net/posts/cohend-and-outliers/>corrupted by a single outlier</a>,
my approach is much more resistant to unexpected extreme values.
Also, it allows exploring
<a href=https://aakinshin.net/posts/comparing-distributions-using-gamma-es/>the difference between specific quantiles of considered samples</a>,
which can be useful in the non-parametric case.</p><p>However, I wasn&rsquo;t satisfied with the results of all of my experiments.
While I still like the basic idea
(replace the mean with the median; replace the standard deviation with the median absolute deviation),
it turned out that the final results heavily depend on the used quantile estimator.
To be more specific, the original Harrell-Davis quantile estimator is not always optimal;
in most cases, it&rsquo;s better to replace it with its <a href=https://aakinshin.net/posts/trimmed-hdqe/>trimmed</a> modification.
However, the particular choice of the quantile estimators depends on the situation.
Also, the consistency constant for the median absolute deviation
should be adjusted according to the current sample size and the used quantile estimator.
Of course, it also can be replaced by other dispersion estimators
that can be used as consistent estimators of the standard deviation.</p><p>In this post, I want to get a brief overview of possible customizations of the suggested metrics.</p><h3 id=the-generic-equations>The generic equations</h3><p>Let&rsquo;s say we have two samples <span class="math inline">\(x = \{ x_1, x_2, \ldots, x_{n_x} \}\)</span> and <span class="math inline">\(y = \{ y_1, y_2, \ldots, y_{n_y} \}\)</span>.
The &ldquo;classic&rdquo; Cohen&rsquo;s d can be defined as follows:</p><p><span class="math display">\[d = \frac{\overline{y}-\overline{x}}{s}
\]</span></p><p>where <span class="math inline">\(s\)</span> is the <a href=https://en.wikipedia.org/wiki/Pooled_standard_deviation>pooled standard deviation</a>:</p><p><span class="math display">\[s = \sqrt{\frac{(n_x - 1) s^2_x + (n_y - 1) s^2_y}{n_x + n_y - 2}}.
\]</span></p><p>And here is the quantile-specific effect size suggested in the <a href=https://aakinshin.net/posts/nonparametric-effect-size/>previous post</a>:</p><p><span class="math display">\[\gamma_p = \frac{Q_p(y) - Q_p(x)}{\operatorname{PMAD}_{xy}}
\]</span></p><p>where <span class="math inline">\(Q_p\)</span> is a quantile estimator of the <span class="math inline">\(p^\textrm{th}\)</span> quantile,
<span class="math inline">\(\operatorname{PMAD}_{xy}\)</span> is the pooled median absolute deviation:</p><p><span class="math display">\[\operatorname{PMAD}_{xy} = \sqrt{\frac{(n_x - 1) \operatorname{MAD}^2_x + (n_y - 1) \operatorname{MAD}^2_y}{n_x + n_y - 2}},
\]</span></p><p><span class="math inline">\(\operatorname{MAD}_x\)</span> and <span class="math inline">\(\operatorname{MAD}_y\)</span> are the median absolute deviations of <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>:</p><p><span class="math display">\[\operatorname{MAD}_x = C_{n_x} \cdot Q_{0.5}(|x_i - Q_{0.5}(x)|), \quad
\operatorname{MAD}_y = C_{n_y} \cdot Q_{0.5}(|y_i - Q_{0.5}(y)|),
\]</span></p><p><span class="math inline">\(C_{n_x}\)</span> and <span class="math inline">\(C_{n_y}\)</span> are consistency constants
that makes <span class="math inline">\(\operatorname{MAD}\)</span> a consistent estimator for the standard deviation estimation.</p><p>For the normal distribution, the Cohen&rsquo;s d equals to <span class="math inline">\(\gamma_{0.5}\)</span>:</p><p><span class="math display">\[d = \frac{\overline{y}-\overline{x}}{s} \approx \frac{Q_{0.5}(y) - Q_{0.5}(x)}{\mathcal{PMAD}_{xy}} = \gamma_{0.5}.
\]</span></p><p>Thus, <span class="math inline">\(\gamma_{0.5}\)</span> can be used as a robust alternative to the original Cohen&rsquo;s d.</p><h3 id=customization>Customization</h3><p>There are several things that we could customize in the above equations.</p><ul><li><strong>Quantile estimator</strong><br>The first thing we should define the quantile estimator <span class="math inline">\(Q_p\)</span>.
In many cases (especially in the case of light-tailed distribution),
the traditional quantile estimator doesn&rsquo;t provide optimal statistical efficiency.
The Harrell-Davis quantile estimator
<a href=https://aakinshin.net/posts/hdqe-efficiency/>provides great statistical efficiency in many light-tailed cases</a>.
Unfortunately, it could be <a href=https://aakinshin.net/posts/robust-statistical-efficiency/>inefficient in the case of heavy-tailed distributions</a>.
To fix this problem, we can consider
<a href=https://aakinshin.net/posts/trimmed-hdqe/>trimmed</a> and <a href=https://aakinshin.net/posts/winsorized-hdqe/>winsorized</a> modifications
of the Harrell-Davis quantile estimator.
These modifications are more robust, and <a href=https://aakinshin.net/posts/wthdqe-efficiency/>they have higher efficiency</a>.
For medium-size samples, we can use a trimming/winsorizing strategy based on the highest density interval of the Beta function.
However, <a href=https://aakinshin.net/posts/customized-wthdqe/>in some corner cases, advanced strategies may be required</a>.
It worth noting that in all of my experiments, the trimming modification works better than the winsorizing modification.
For some situations, we can also consider using
the <a href=https://aakinshin.net/posts/sfakianakis-verginis-quantile-estimator/>Sfakianakis-Verginis quantile estimator</a> or
the <a href=https://aakinshin.net/posts/navruz-ozdemir-quantile-estimator/>Navruz-Özdemir quantile estimator</a>.
However, if you don&rsquo;t have prior knowledge about the distribution form and the sample size,
<a href=https://aakinshin.net/posts/hd-sv-no-efficiency/>the Harrell-Davis quantile estimator still seems to be a good default option</a>.</li><li><strong>Consistency constant</strong><br>When we define the median absolute deviation, we should also define the consistency constant <span class="math inline">\(C_n\)</span>.
In the previous post, I suggested using <span class="math inline">\(C_n = 1.4826\)</span>, but this value works only for large <span class="math inline">\(n\)</span> values.
If we want to get an unbiased standard deviation estimator based on <span class="math inline">\(\operatorname{MAD}_n\)</span> for small n,
we should adjust the consistency constant.
The adjusting approach depends on the used quantile estimator.
I wrote a few blog posts about that show
<a href=https://aakinshin.net/posts/unbiased-mad/>how to choose the consistency constant for the traditional quantile estimator</a> and
<a href=https://aakinshin.net/posts/unbiased-mad-hd/>how to choose the consistency constant for the Harrell-Davis quantile estimator</a>.</li><li><strong>Dispersion estimator</strong><br><span class="math inline">\(\operatorname{MAD}\)</span> stats for the median absolute deviation around the median.
However, we can also consider
<a href=https://aakinshin.net/posts/qad/>the quantile absolute deviation around the given quantile</a> (<span class="math inline">\(\operatorname{QAD}\)</span>).
Initially, I thought that <span class="math inline">\(\operatorname{QAD}\)</span> should be useful for describing quantile-specific effect size.
I performed several experiments on applying this metric to <span class="math inline">\(\gamma_p\)</span>,
but I failed to get practically beneficial ways to do that (for now).<br>Another robust way to estimate the dispersion is to use the Shamos estimator:<p><span class="math display">\[\operatorname{Shamos} = C_n \cdot \operatorname{median}_{i < j} (|x_i - x_j|); \quad C_{\infty} \approx 1.0484
\]</span></p><p><span class="math display">\[\operatorname{Rousseeuw-Croux} =
C_n \cdot \operatorname{median}_{i}
\Big( \operatorname{median}_{j} \big( |x_i-x_j| \big) \Big); \quad C_{\infty} \approx 1.1926
\]</span></p>I guess these estimators <em>might</em> provide better statistical efficiency in some cases,
but I didn&rsquo;t perform any experiments with them
because they are computationally inefficient due to their algorithmic complexity (more than <span class="math inline">\(O(n^2)\)</span>).</li></ul><h3 id=summary>Summary</h3><p>There are three main ways to adopt the nonparametric Cohen&rsquo;s d-consistent effect size:</p><ul><li><strong>An easy way</strong><br>If you want to get the most simple solution, just use the traditional quantile estimator
(if <span class="math inline">\(n\)</span> is odd, the median is the middle element of the sorted sample;
if <span class="math inline">\(n\)</span> is even, the median is the arithmetic average of the two middle elements of the sorted sample).
The <span class="math inline">\(\operatorname{MAD}\)</span> consistency constant should be taken from
the main table of <a href=https://aakinshin.net/posts/unbiased-mad/>this post</a>.</li><li><strong>A relatively easy way</strong><br>If you want to get a relatively simple but more efficient solution,
use the <a href=https://aakinshin.net/posts/trimmed-hdqe/>trimmed modifications of the Harrell-Davis quantile estimator</a> and
the <span class="math inline">\(\operatorname{MAD}\)</span> consistency constant from the main table of <a href=https://aakinshin.net/posts/unbiased-mad-hd/>this post</a>.</li><li><strong>A hard way</strong><br>If you want to get the most efficient solution, you should spend some time on research.
First of all, you should explore all available options (you can find some by following the below links).
Next, you should think about the properties of your data sets
(what kind of distribution you have, and what are your typical sample sizes).
Finally, you should try different approaches with your data and check which one provides the most reliable results.</li></ul><h3 id=further-reading>Further reading</h3><ul><li>Effect sizes<ul><li><a href=https://aakinshin.net/posts/nonparametric-effect-size/>Nonparametric Cohen's d-consistent effect size</a></li><li><a href=https://aakinshin.net/posts/cohend-and-outliers/>A single outlier could completely distort your Cohen's d value</a></li><li><a href=https://aakinshin.net/posts/comparing-distributions-using-gamma-es/>Comparing distribution quantiles using gamma effect size</a></li></ul></li><li>Quantile estimators<ul><li><a href=https://aakinshin.net/posts/navruz-ozdemir-quantile-estimator/>Navruz-Özdemir quantile estimator</a></li><li><a href=https://aakinshin.net/posts/sfakianakis-verginis-quantile-estimator/>Sfakianakis-Verginis quantile estimator</a></li><li><a href=https://aakinshin.net/posts/winsorized-hdqe/>Winsorized modification of the Harrell-Davis quantile estimator</a></li><li><a href=https://aakinshin.net/posts/trimmed-hdqe/>Trimmed modification of the Harrell-Davis quantile estimator</a></li><li><a href=https://aakinshin.net/posts/customized-wthdqe/>Improving the efficiency of the Harrell-Davis quantile estimator for special cases using custom winsorizing and trimming strategies</a></li></ul></li><li>Statistical efficiency<ul><li><a href=https://aakinshin.net/posts/hdqe-efficiency/>Efficiency of the Harrell-Davis quantile estimator</a></li><li><a href=https://aakinshin.net/posts/wthdqe-efficiency/>Efficiency of the winsorized and trimmed Harrell-Davis quantile estimators</a></li><li><a href=https://aakinshin.net/posts/robust-statistical-efficiency/>Robust alternative to statistical efficiency</a></li></ul></li><li>Dispersion<ul><li><a href=https://aakinshin.net/posts/qad/>Quantile absolute deviation: estimating statistical dispersion around quantiles</a></li><li><a href=https://aakinshin.net/posts/unbiased-mad/>Unbiased median absolute deviation</a></li><li><a href=https://aakinshin.net/posts/unbiased-mad-hd/>Unbiased median absolute deviation based on the Harrell-Davis quantile estimator</a></li></ul></li></ul></div><br><br><div class="flex flex-wrap justify-center items-center">The source code of this post and all the relevant files are&nbsp;<a href=https://github.com/AndreyAkinshin/aakinshin.net/tree/master/content/en/posts/2021/06/nonparametric-effect-size2/index.md>available on GitHub</a>.</div><div class="flex flex-wrap justify-center items-center mb-5"><span>Share:</span><div class="text-4xl pl-3"><a href="https://www.reddit.com/submit?url=https%3a%2f%2faakinshin.net%2fposts%2fnonparametric-effect-size2%2f&title=Customization%20of%20the%20nonparametric%20Cohen%27s%20d-consistent%20effect%20size" target=_blank title="Share on Reddit"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#reddit"/></svg></a></div><div class="text-4xl pl-3"><a href="https://twitter.com/intent/tweet?text=Customization%20of%20the%20nonparametric%20Cohen%27s%20d-consistent%20effect%20size&url=https%3a%2f%2faakinshin.net%2fposts%2fnonparametric-effect-size2%2f&via=andrey_akinshin&related=andrey_akinshin" rel=nofollow target=_blank title="Share on Twitter"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></div><div class="text-4xl pl-3"><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2faakinshin.net%2fposts%2fnonparametric-effect-size2%2f" target=_blank title="Share on HackerNews"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#hacker-news"/></svg></a></div><div class="text-4xl pl-3"><a href="https://getpocket.com/save?url=https%3a%2f%2faakinshin.net%2fposts%2fnonparametric-effect-size2%2f&title=Customization%20of%20the%20nonparametric%20Cohen%27s%20d-consistent%20effect%20size" target=_blank title="Add to Pocket"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#get-pocket"/></svg></a></div></div></div></div><script>var themeToggleDarkIcon=document.getElementById("theme-toggle-dark-icon"),themeToggleBtn,themeToggleLightIcon=document.getElementById("theme-toggle-light-icon");const imagesDark=document.querySelectorAll(".img-dark"),imagesLight=document.querySelectorAll(".img-light");localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(themeToggleLightIcon.classList.remove("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")})):(themeToggleDarkIcon.classList.remove("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")})),themeToggleBtn=document.getElementById("theme-toggle"),themeToggleBtn.addEventListener("click",function(){themeToggleDarkIcon.classList.toggle("hidden"),themeToggleLightIcon.classList.toggle("hidden"),imagesLight.forEach(e=>{e.classList.toggle("hidden")}),imagesDark.forEach(e=>{e.classList.toggle("hidden")}),localStorage.getItem("color-theme")?localStorage.getItem("color-theme")==="light"?(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"))})</script><footer class="z-20 p-4 md:p-6 mt-3 w-full border-t border-gray-200 shadow flex items-center justify-center dark:border-gray-600 bg-white dark:bg-zinc-800"><span class="dark:text-gray-400 text-center">© 2013—2023 <span class=whitespace-nowrap>Andrey Akinshin</span></span><ul class="flex flex-wrap items-center px-4 mb-1"><li><a href=https://github.com/AndreyAkinshin><svg class="fai fai-link w-5 h-5"><title>GitHub</title><use xlink:href="/img/fa/all.svg#github"/></svg></a></li><li><a href=https://twitter.com/andrey_akinshin><svg class="fai fai-link w-5 h-5"><title>Twitter</title><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></li><li><a href=https://aakinshin.net/posts/index.xml><svg class="fai fai-link w-5 h-5"><title>RSS</title><use xlink:href="/img/fa/all.svg#rss"/></svg></a></li><li><a href=https://github.com/sponsors/AndreyAkinshin><svg class="fai fai-link w-5 h-5"><title>Support this blog</title><use xlink:href="/img/fa/all.svg#heart"/></svg></a></li></ul><div class=main-content><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></div></footer><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script></body></html>