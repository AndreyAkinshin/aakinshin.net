<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.123.3"><meta name=author content='Andrey Akinshin'><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content='Mathematics,Statistics,Research,Statistical Efficiency,Harrell-Davis Quantile Estimator,Winsorizing,Trimming,Small Samples,Research: Building trimmed Harrell-Davis quantile estimator'><title>Improving the efficiency of the Harrell-Davis quantile estimator for special cases using custom winsorizing and trimming strategies | Andrey Akinshin</title>
<meta name=description content="Let&amp;rsquo;s say we want to estimate the median based on a small sample (3 $\leq n \leq 7$) from a right-skewed heavy-tailed distribution with high statistical efficiency.
The traditional median estimator is the most robust estimator, but it&amp;rsquo;s not the ..."><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><script>localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><link href=https://aakinshin.net/css/main.min.d5a0830628a332736b49276c6d88c4bc429b98950014058537288a38d360b7e2.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"></head><body><nav><div class="container flex flex-wrap items-center justify-between mx-auto max-w-6xl h-12 px-2 xs:px-6"><div class="flex items-center justify-start justify-self-start"><div class="flex nav-item h-12 w-12 items-center justify-center"><a class=text-white href=https://aakinshin.net/><svg class="fai w-5 h-5 pr-0 mb-0.5"><use xlink:href="/img/fa/all.svg#house-chimney"/></svg></a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/posts/>Posts</a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/research/>Research</a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/library/>Library</a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/about/>About</a></div></div><button id=theme-toggle type=button title="Alt+Click to match OS color theme" class="nav-item p-3 content-center justify-self-end"><svg id="theme-toggle-dark-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001.0 1010.586 10.586z"/></svg><svg id="theme-toggle-light-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1A1 1 0 119 4V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707A1 1 0 1113.536 5.05l.707-.707a1 1 0 011.414.0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707A1 1 0 004.343 5.757l.707.707zm1.414 8.486-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"/></svg></button></div></nav><div class="main container mx-auto max-w-6xl px-6"><div class=main-post><h1 class=blog-post-title id=post-title>Improving the efficiency of the Harrell-Davis quantile estimator for special cases using custom winsorizing and trimming strategies</h1><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg>
<time datetime=2021-05-25>May 25, 2021</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/mathematics/>Mathematics</a>
<a class=label-link href=https://aakinshin.net/tags/statistics/>Statistics</a>
<a class=label-link href=https://aakinshin.net/tags/research/>Research</a>
<a class=label-link href=https://aakinshin.net/tags/statistical-efficiency/>Statistical Efficiency</a>
<a class=label-link href=https://aakinshin.net/tags/harrell-davis-quantile-estimator/>Harrell-Davis Quantile Estimator</a>
<a class=label-link href=https://aakinshin.net/tags/winsorizing/>Winsorizing</a>
<a class=label-link href=https://aakinshin.net/tags/trimming/>Trimming</a>
<a class=label-link href=https://aakinshin.net/tags/small-samples/>Small Samples</a>
<a class=label-link href=https://aakinshin.net/tags/research-thdqe/>Research: Building trimmed Harrell-Davis quantile estimator</a></div></div><br><div class="main-content mb-3 px-2 py-1 rounded border text-alert-text-l border-alert-frame-l dark:text-alert-text-d dark:border-alert-frame-d">Update: this blog post is a part of research that aimed to build a statistically efficient and robust quantile estimator. A <a href=/posts/pub-thdqe/>paper with final results</a> is available in <em>Communications in Statistics - Simulation and Computation</em> (DOI: <a href=https://www.tandfonline.com/doi/abs/10.1080/03610918.2022.2050396>10.1080/03610918.2022.2050396</a>). A preprint is available on arXiv: <a href=https://arxiv.org/abs/2111.11776>arXiv:2111.11776 [stat.ME]</a>. Some information in this blog post can be obsolete: please, use the official paper as the primary reference.</div><div class=main-content><p>Let&rsquo;s say we want to
<strong>estimate the median</strong>
based on a <strong>small sample</strong> (3 $\leq n \leq 7$)
from a <strong>right-skewed heavy-tailed distribution</strong>
with <strong>high statistical efficiency</strong>.</p><p>The traditional median estimator is the most robust estimator, but it&rsquo;s not the most efficient one.
Typically, the Harrell-Davis quantile estimator provides better efficiency,
but it&rsquo;s not robust (its breakdown point is zero),
so it may have worse efficiency in the given case.
The <a href=https://aakinshin.net/posts/winsorized-hdqe/>winsorized</a> and <a href=https://aakinshin.net/posts/trimmed-hdqe/>trimmed</a>
modifications of the Harrell-Davis quantile estimator provide a good trade-off
between efficiency and robustness, but they require a proper winsorizing/trimming rule.
A reasonable choice of such a rule for medium-size samples is based on the highest density interval of the Beta function
(as described <a href=https://aakinshin.net/posts/winsorized-hdqe/>here</a>).
Unfortunately, this approach may be suboptimal for small samples.
E.g., if we use the 99% highest density interval to estimate the median,
it starts to trim sample values only for $n \geq 8$.</p><p>In this post, we are going to discuss custom winsorizing/trimming strategies for special cases of the quantile estimation problem.</p><h3 id=beware-of-small-samples>Beware of small samples</h3><p>So, what&rsquo;s wrong with the small samples from heavy-tailed distributions?
There is a high chance to observe an extremely large value in such a sample.
As an example, let&rsquo;s consider the Pareto distribution.
Here is the PDF for $\textrm{Pareto}(x_m = 1, \alpha = 1)$:</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/customized-wthdqe/img/pareto-pdf-light.png target=_blank alt=pareto-pdf><img src=/posts/customized-wthdqe/img/pareto-pdf-light.png width=800>
</a><a class="img-dark hidden" href=/posts/customized-wthdqe/img/pareto-pdf-dark.png target=_blank alt=pareto-pdf><img src=/posts/customized-wthdqe/img/pareto-pdf-dark.png width=800></a></div><p>The quantile function for the Pareto distribution is defined as follows:</p>$$
Q_\textrm{Pareto}(p) = x_m (1 - p)^{(-1/\alpha)}
$$<p>In our case ($x_m = 1, \alpha = 1$), we have:</p>$$
Q_{\textrm{Pareto}(x_m = 1,\;\alpha = 1)}(p) = \frac{1}{1 - p}
$$<p>Here are some of the quantile values:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>q[0.500] = 2
</span></span><span class=line><span class=cl>q[0.750] = 4
</span></span><span class=line><span class=cl>q[0.900] = 10
</span></span><span class=line><span class=cl>q[0.950] = 20
</span></span><span class=line><span class=cl>q[0.990] = 100
</span></span><span class=line><span class=cl>q[0.999] = 1000
</span></span></code></pre></div><p>Thus, while the median value is $2$, the value of the $99.9^\textrm{th}$ percentile is 1000.
It may look like a small probability, but this impression is deceiving.
For example, if we consider 5000 values (or 1000 of 5-element samples),
there is a 99.3% chance that at least one of the values is higher than 1000.</p><h3 id=the-problem-of-the-harrell-davis-quantile-estimator>The problem of the Harrell-Davis quantile estimator</h3><p>The Harrell-Davis approach suggests estimating the quantile value as a weighted sum of all sample elements
where all weight values are positive.
Thus, its breakdown point is zero: a single &ldquo;extreme&rdquo; value may &ldquo;corrupt&rdquo; the estimation.
Let&rsquo;s say we have the following sample from $\textrm{Pareto}(x_m = 1, \alpha = 1)$:</p>$$
x = \{ 1, 2, 1000 \}
$$<p>The traditional median estimator just selects the middle element.
In our case, it gives</p>$$
Q_\textrm{Traditional}(x) = x_2 = 2
$$<p>which is a pretty accurate median estimation.
The Harrell-Davis quantile estimator produces a worse estimation:</p>$$
Q_\textrm{HD}(x) \approx 0.259259\cdot x_1 + 0.481481\cdot x_2 + 0.259259\cdot x_3 \approx 260.481.
$$<p>The Harrell-Davis quantile estimator is a good approach in many cases because it typically provides better efficiency
then the traditional one.
Unfortunately, in the considered case (small samples form heavy-tailed distribution),
its efficiency is quite bad because it&rsquo;s not robust enough.
Let&rsquo;s try to fix this problem.</p><h3 id=smart-winsorizingtrimming>Smart winsorizing/trimming</h3><p>If we want to improve the Harrell-Davis quantile estimator robustness,
we can consider its <a href=https://aakinshin.net/posts/winsorized-hdqe/>winsorized</a> and <a href=https://aakinshin.net/posts/trimmed-hdqe/>trimmed</a> modifications.
In one of the previous posts, I <a href=https://aakinshin.net/posts/winsorized-hdqe/>described</a> an approach
that selects the trimming percentage based on the highest density interval of the corresponding beta function.
It works great for medium-size samples, but it&rsquo;s useless for small samples.
If we use the 99% highest density interval to estimate the median,
the trimming percentage will be positive only for $n \geq 8$.</p><p>In our case, we can consider a custom trimming strategy.
Our greatest enemy here is the random extreme values.
We want to trim them whenever it&rsquo;s possible.</p><p>Let&rsquo;s consider a sample $x$ with $n$ elements where all the samples elements are already sorted:</p>$$
x_1 \leq x_2 \leq \ldots \leq x_n.
$$<p>Now let&rsquo;s discuss how we should trim the samples for different $n$ values:</p><ul><li>$n=3$<br>It&rsquo;s not a good idea to trim $x_2$ because it&rsquo;s our traditional median estimation.
It&rsquo;s also doesn&rsquo;t make sense to trim $x_1$ because the considered distribution is right-skewed
($x_1$ is the minimum element of the sample; it has the smallest chance to be &ldquo;extreme&rdquo;).
Thus, the reasonable decision is to trim $x_3$.</li><li>$n=4$<br>The traditional median estimator for samples with even size uses two middle elements.
For $n=4$, these elements are $x_2$ and $x_3$, so we don&rsquo;t want to trim them.
It&rsquo;s still useless to trim $x_1$, so our only option is to trim $x_4$.</li><li>$n=5$<br>Here the traditional median estimator uses only $x_3$.
So, we can trim two elements: $x_4$ and $x_5$.</li><li>$n=6$<br>By analogy, we can trim $x_5$ and $x_6$.</li><li>$n=7$<br>Here the traditional median estimator uses only $x_4$.
Thus, we can trim three elements: $x_5$, $x_6$, and $x_7$.</li></ul><p>This strategy can be described using the following scheme
(<code>@</code> denotes non-trimmed element; <code>x</code> denotes trimmed element; assuming sorted sample):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>n = 3: @@x
</span></span><span class=line><span class=cl>n = 4: @@@x
</span></span><span class=line><span class=cl>n = 5: @@@xx
</span></span><span class=line><span class=cl>n = 6: @@@@xx
</span></span><span class=line><span class=cl>n = 7: @@@@xxx
</span></span></code></pre></div><p>It&rsquo;s time to check how it works.</p><h3 id=numerical-simulation>Numerical simulation</h3><p>We are going to compare four quantile estimators:</p><ul><li><code>hf7</code>: the traditional quantile estimator (also known as the Hyndman-Fan Type 7)</li><li><code>hd</code>: the Harrell-Davis quantile estimator</li><li><code>whd</code>: the winsorized Harrell-Davis quantile estimator where
the winsorized elements are defined according to the scheme from the previous section</li><li><code>thd</code>: the trimmed Harrell-Davis quantile estimator where
the trimmed elements are defined according to the scheme from the previous section</li></ul><p>Typically, the estimator efficiency is evaluated using the mean squared error (<code>mse</code>) and the bias.
This approach works good for light-tailed error distribution,
but it could be misleading for heavy-tailed distribution.
Thus, in addition to the classic bias and mse metric,
we also consider different percentiles of the absolute values of simulated errors.
Also, we are going to draw the PDF of the error distributions.
Each error distribution is based on 100'000 random samples.</p><p>In this simulation, we are going to estimate the median for the normal distribution (the true median value is $0$)
and for $\textrm{Pareto}(x_m = 1, \alpha = 1)$ (the true median value is $2$).</p><h4 id=normal-distribution-n--5>Normal distribution (n = 5)</h4><p>Let&rsquo;s start with the normal distribution (which is symmetric and light-tailed) to do a dry-check of our estimators.</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/customized-wthdqe/img/normal5-light.png target=_blank alt=normal5><img src=/posts/customized-wthdqe/img/normal5-light.png width=800>
</a><a class="img-dark hidden" href=/posts/customized-wthdqe/img/normal5-dark.png target=_blank alt=normal5><img src=/posts/customized-wthdqe/img/normal5-dark.png width=800></a></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl> <span class=nx>estimator</span>       <span class=nx>bias</span>     <span class=nx>mse</span>     <span class=nx>p25</span>     <span class=nx>p50</span>     <span class=nx>p75</span>     <span class=nx>p90</span>     <span class=nx>p95</span>    <span class=nx>p99</span>
</span></span><span class=line><span class=cl>       <span class=nx>hf7</span> <span class=o>-</span><span class=mf>0.0016329</span> <span class=mf>0.29153</span> <span class=mf>0.16804</span> <span class=mf>0.36103</span> <span class=mf>0.61964</span> <span class=mf>0.89926</span> <span class=mf>1.06836</span> <span class=mf>1.3611</span>
</span></span><span class=line><span class=cl>        <span class=nx>hd</span> <span class=o>-</span><span class=mf>0.0056730</span> <span class=mf>0.21042</span> <span class=mf>0.14671</span> <span class=mf>0.31081</span> <span class=mf>0.52609</span> <span class=mf>0.74722</span> <span class=mf>0.89905</span> <span class=mf>1.1936</span>
</span></span><span class=line><span class=cl>       <span class=nx>whd</span> <span class=o>-</span><span class=mf>0.1920940</span> <span class=mf>0.28335</span> <span class=mf>0.17178</span> <span class=mf>0.36076</span> <span class=mf>0.60780</span> <span class=mf>0.87269</span> <span class=mf>1.04119</span> <span class=mf>1.3885</span>
</span></span><span class=line><span class=cl>       <span class=nx>thd</span> <span class=o>-</span><span class=mf>0.2879419</span> <span class=mf>0.32841</span> <span class=mf>0.18283</span> <span class=mf>0.38710</span> <span class=mf>0.65326</span> <span class=mf>0.94229</span> <span class=mf>1.14017</span> <span class=mf>1.4771</span>
</span></span></code></pre></div><p>TODO: rewrite
As we can see, <code>hf7</code> and <code>hd</code> give pretty similar results.
In this particular case, <code>whd</code> and <code>thd</code> give worse results (but they are still pretty acceptable)
It&rsquo;s an expected situation because our winsorizing/trimming strategy is &ldquo;overfitted&rdquo; to the right-skewed case
while the actual distribution is symmetric.</p><h4 id=pareto-distribution-n--3>Pareto distribution (n = 3)</h4><p>Now it&rsquo;s time to check our estimators on the most complicated case:
we should guess the median value of $\textrm{Pareto}(x_m = 1, \alpha = 1)$
based only on three elements!</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/customized-wthdqe/img/pareto3-light.png target=_blank alt=pareto3><img src=/posts/customized-wthdqe/img/pareto3-light.png width=800>
</a><a class="img-dark hidden" href=/posts/customized-wthdqe/img/pareto3-dark.png target=_blank alt=pareto3><img src=/posts/customized-wthdqe/img/pareto3-dark.png width=800></a></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl> <span class=nx>estimator</span>     <span class=nx>bias</span>        <span class=nx>mse</span>     <span class=nx>p25</span>     <span class=nx>p50</span>     <span class=nx>p75</span>    <span class=nx>p90</span>     <span class=nx>p95</span>    <span class=nx>p99</span>
</span></span><span class=line><span class=cl>       <span class=nx>hf7</span>  <span class=mf>0.96402</span>     <span class=mf>14.093</span> <span class=mf>0.33215</span> <span class=mf>0.63298</span> <span class=mf>1.09961</span> <span class=mf>3.1286</span>  <span class=mf>5.4061</span> <span class=mf>15.677</span>
</span></span><span class=line><span class=cl>        <span class=nx>hd</span> <span class=mf>12.75015</span> <span class=mf>175467.942</span> <span class=mf>0.37914</span> <span class=mf>0.84069</span> <span class=mf>3.02464</span> <span class=mf>8.9115</span> <span class=mf>18.5175</span> <span class=mf>90.129</span>
</span></span><span class=line><span class=cl>       <span class=nx>whd</span>  <span class=mf>0.62981</span>     <span class=mf>14.147</span> <span class=mf>0.32802</span> <span class=mf>0.61526</span> <span class=mf>0.89961</span> <span class=mf>2.4955</span>  <span class=mf>4.2395</span> <span class=mf>11.140</span>
</span></span><span class=line><span class=cl>       <span class=nx>thd</span>  <span class=mf>0.48012</span>     <span class=mf>23.503</span> <span class=mf>0.33245</span> <span class=mf>0.61360</span> <span class=mf>0.88120</span> <span class=mf>1.9543</span>  <span class=mf>3.4305</span>  <span class=mf>9.819</span>
</span></span></code></pre></div><p>Expectedly, <code>hd</code> has the worst error values because of its zero breakdown point.
Meanwhile, <code>whd</code> and <code>thd</code> have better error values than <code>hf7</code> (which is our baseline).
They are better not only based on the &ldquo;classic&rdquo; <code>bias</code> and <code>mse</code> metrics but only based on all the percentile values.</p><p>Let&rsquo;s see what happens for higher $n$ values.</p><h4 id=pareto-distribution-n--4>Pareto distribution (n = 4)</h4><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/customized-wthdqe/img/pareto4-light.png target=_blank alt=pareto4><img src=/posts/customized-wthdqe/img/pareto4-light.png width=800>
</a><a class="img-dark hidden" href=/posts/customized-wthdqe/img/pareto4-dark.png target=_blank alt=pareto4><img src=/posts/customized-wthdqe/img/pareto4-dark.png width=800></a></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl> <span class=nx>estimator</span>    <span class=nx>bias</span>      <span class=nx>mse</span>     <span class=nx>p25</span>     <span class=nx>p50</span>     <span class=nx>p75</span>    <span class=nx>p90</span>     <span class=nx>p95</span>    <span class=nx>p99</span>
</span></span><span class=line><span class=cl>       <span class=nx>hf7</span> <span class=mf>0.99630</span>   <span class=mf>13.376</span> <span class=mf>0.28927</span> <span class=mf>0.58443</span> <span class=mf>1.22370</span> <span class=mf>3.1813</span>  <span class=mf>5.1862</span> <span class=mf>12.015</span>
</span></span><span class=line><span class=cl>        <span class=nx>hd</span> <span class=mf>4.33302</span> <span class=mf>1376.949</span> <span class=mf>0.35408</span> <span class=mf>0.81399</span> <span class=mf>2.56402</span> <span class=mf>6.8722</span> <span class=mf>12.2750</span> <span class=mf>53.703</span>
</span></span><span class=line><span class=cl>       <span class=nx>whd</span> <span class=mf>0.95874</span>   <span class=mf>25.060</span> <span class=mf>0.28729</span> <span class=mf>0.57546</span> <span class=mf>1.12468</span> <span class=mf>2.9193</span>  <span class=mf>4.8311</span> <span class=mf>12.190</span>
</span></span><span class=line><span class=cl>       <span class=nx>thd</span> <span class=mf>0.72518</span>   <span class=mf>11.554</span> <span class=mf>0.27726</span> <span class=mf>0.54553</span> <span class=mf>0.91749</span> <span class=mf>2.3926</span>  <span class=mf>4.0997</span> <span class=mf>10.723</span>
</span></span></code></pre></div><h4 id=pareto-distribution-n--5>Pareto distribution (n = 5)</h4><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/customized-wthdqe/img/pareto5-light.png target=_blank alt=pareto5><img src=/posts/customized-wthdqe/img/pareto5-light.png width=800>
</a><a class="img-dark hidden" href=/posts/customized-wthdqe/img/pareto5-dark.png target=_blank alt=pareto5><img src=/posts/customized-wthdqe/img/pareto5-dark.png width=800></a></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl> <span class=nx>estimator</span>     <span class=nx>bias</span>        <span class=nx>mse</span>     <span class=nx>p25</span>     <span class=nx>p50</span>     <span class=nx>p75</span>    <span class=nx>p90</span>    <span class=nx>p95</span>     <span class=nx>p99</span>
</span></span><span class=line><span class=cl>       <span class=nx>hf7</span> <span class=mf>0.504146</span>     <span class=mf>5.2105</span> <span class=mf>0.26675</span> <span class=mf>0.52613</span> <span class=mf>0.87303</span> <span class=mf>2.1065</span> <span class=mf>3.3679</span>  <span class=mf>7.2826</span>
</span></span><span class=line><span class=cl>        <span class=nx>hd</span> <span class=mf>4.396743</span> <span class=mf>22596.2795</span> <span class=mf>0.31288</span> <span class=mf>0.74502</span> <span class=mf>2.24599</span> <span class=mf>5.3275</span> <span class=mf>9.3600</span> <span class=mf>34.9101</span>
</span></span><span class=line><span class=cl>       <span class=nx>whd</span> <span class=mf>0.231205</span>     <span class=mf>2.1152</span> <span class=mf>0.26279</span> <span class=mf>0.50793</span> <span class=mf>0.77450</span> <span class=mf>1.4745</span> <span class=mf>2.4296</span>  <span class=mf>5.8547</span>
</span></span><span class=line><span class=cl>       <span class=nx>thd</span> <span class=mf>0.067092</span>     <span class=mf>1.6300</span> <span class=mf>0.26268</span> <span class=mf>0.50467</span> <span class=mf>0.74328</span> <span class=mf>1.1175</span> <span class=mf>1.9506</span>  <span class=mf>4.6478</span>
</span></span></code></pre></div><h4 id=pareto-distribution-n--6>Pareto distribution (n = 6)</h4><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/customized-wthdqe/img/pareto6-light.png target=_blank alt=pareto6><img src=/posts/customized-wthdqe/img/pareto6-light.png width=800>
</a><a class="img-dark hidden" href=/posts/customized-wthdqe/img/pareto6-dark.png target=_blank alt=pareto6><img src=/posts/customized-wthdqe/img/pareto6-dark.png width=800></a></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl> <span class=nx>estimator</span>    <span class=nx>bias</span>       <span class=nx>mse</span>     <span class=nx>p25</span>     <span class=nx>p50</span>     <span class=nx>p75</span>    <span class=nx>p90</span>    <span class=nx>p95</span>     <span class=nx>p99</span>
</span></span><span class=line><span class=cl>       <span class=nx>hf7</span> <span class=mf>0.51371</span>    <span class=mf>2.5938</span> <span class=mf>0.23690</span> <span class=mf>0.48757</span> <span class=mf>0.86252</span> <span class=mf>2.0152</span> <span class=mf>3.0778</span>  <span class=mf>6.4690</span>
</span></span><span class=line><span class=cl>        <span class=nx>hd</span> <span class=mf>2.46898</span> <span class=mf>1195.1400</span> <span class=mf>0.29120</span> <span class=mf>0.66492</span> <span class=mf>1.78711</span> <span class=mf>4.0332</span> <span class=mf>6.8272</span> <span class=mf>20.9587</span>
</span></span><span class=line><span class=cl>       <span class=nx>whd</span> <span class=mf>0.42000</span>    <span class=mf>2.5518</span> <span class=mf>0.23282</span> <span class=mf>0.47884</span> <span class=mf>0.79029</span> <span class=mf>1.7981</span> <span class=mf>2.8478</span>  <span class=mf>6.0907</span>
</span></span><span class=line><span class=cl>       <span class=nx>thd</span> <span class=mf>0.25985</span>    <span class=mf>1.4532</span> <span class=mf>0.23638</span> <span class=mf>0.46981</span> <span class=mf>0.74189</span> <span class=mf>1.4778</span> <span class=mf>2.3190</span>  <span class=mf>4.9017</span>
</span></span></code></pre></div><h4 id=pareto-distribution-n--7>Pareto distribution (n = 7)</h4><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/customized-wthdqe/img/pareto7-light.png target=_blank alt=pareto7><img src=/posts/customized-wthdqe/img/pareto7-light.png width=800>
</a><a class="img-dark hidden" href=/posts/customized-wthdqe/img/pareto7-dark.png target=_blank alt=pareto7><img src=/posts/customized-wthdqe/img/pareto7-dark.png width=800></a></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl> <span class=nx>estimator</span>      <span class=nx>bias</span>        <span class=nx>mse</span>     <span class=nx>p25</span>     <span class=nx>p50</span>     <span class=nx>p75</span>    <span class=nx>p90</span>    <span class=nx>p95</span>     <span class=nx>p99</span>
</span></span><span class=line><span class=cl>       <span class=nx>hf7</span>  <span class=mf>0.337121</span>    <span class=mf>1.85904</span> <span class=mf>0.23519</span> <span class=mf>0.46158</span> <span class=mf>0.75627</span> <span class=mf>1.5838</span> <span class=mf>2.4504</span>  <span class=mf>5.3569</span>
</span></span><span class=line><span class=cl>        <span class=nx>hd</span>  <span class=mf>1.975857</span> <span class=mf>1989.76770</span> <span class=mf>0.26722</span> <span class=mf>0.60452</span> <span class=mf>1.52104</span> <span class=mf>3.2602</span> <span class=mf>5.0468</span> <span class=mf>13.5435</span>
</span></span><span class=line><span class=cl>       <span class=nx>whd</span>  <span class=mf>0.082059</span>    <span class=mf>0.88772</span> <span class=mf>0.23247</span> <span class=mf>0.44718</span> <span class=mf>0.68616</span> <span class=mf>1.0932</span> <span class=mf>1.7480</span>  <span class=mf>3.8571</span>
</span></span><span class=line><span class=cl>       <span class=nx>thd</span> <span class=o>-</span><span class=mf>0.039714</span>    <span class=mf>0.68217</span> <span class=mf>0.23089</span> <span class=mf>0.45429</span> <span class=mf>0.67313</span> <span class=mf>0.8878</span> <span class=mf>1.3837</span>  <span class=mf>3.0663</span>
</span></span></code></pre></div><h3 id=conclusion>Conclusion</h3><p>In this post, we performed a numerical simulation that compared the statistical efficiency
of the median estimation on small samples from right-skewed heavy-tailed distributions.
We compared four quantile estimators:
the traditional one (also known as the Hyndman-Fan Type 7),
the Harrell-Davis quantile estimator,
and its winsorized/trimming modifications that use a custom trimming strategy optimized for the given case.
Based on the simulation results, we can conclude that the <strong>trimmed modification is the clear winner</strong>.</p></div><br><br></div></div><script>var themeToggleDarkIcon=document.getElementById("theme-toggle-dark-icon"),themeToggleBtn,themeToggleLightIcon=document.getElementById("theme-toggle-light-icon");const imagesDark=document.querySelectorAll(".img-dark"),imagesLight=document.querySelectorAll(".img-light");localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(themeToggleLightIcon.classList.remove("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")})):(themeToggleDarkIcon.classList.remove("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")}));function toggleTheme(e){e?(document.documentElement.classList.add("dark"),themeToggleLightIcon.classList.remove("hidden"),themeToggleDarkIcon.classList.add("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")}),imagesLight.forEach(e=>{e.classList.add("hidden")})):(document.documentElement.classList.remove("dark"),themeToggleDarkIcon.classList.remove("hidden"),themeToggleLightIcon.classList.add("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")}),imagesDark.forEach(e=>{e.classList.add("hidden")}))}themeToggleBtn=document.getElementById("theme-toggle"),themeToggleBtn.addEventListener("click",function(){themeToggleDarkIcon.classList.toggle("hidden"),themeToggleLightIcon.classList.toggle("hidden"),imagesLight.forEach(e=>{e.classList.toggle("hidden")}),imagesDark.forEach(e=>{e.classList.toggle("hidden")}),event.altKey?(localStorage.removeItem("color-theme"),toggleTheme(window.matchMedia("(prefers-color-scheme: dark)").matches)):localStorage.getItem("color-theme")?localStorage.getItem("color-theme")==="light"?(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"))}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{if(localStorage.getItem("color-theme")===null){const t=e.matches?"dark":"light";toggleTheme(t==="dark")}})</script><footer class="z-20 p-4 md:p-6 mt-3 w-full border-t border-gray-200 shadow flex items-center justify-center dark:border-gray-600 bg-white dark:bg-zinc-800"><span class="dark:text-gray-400 text-center">© 2013—2024 <span class=whitespace-nowrap>Andrey Akinshin</span></span><ul class="flex flex-wrap items-center px-4 mb-1"><li><a href=https://github.com/AndreyAkinshin><svg class="fai fai-link w-5 h-5"><title>GitHub</title><use xlink:href="/img/fa/all.svg#github"/></svg></a></li><li><a href=https://twitter.com/andrey_akinshin><svg class="fai fai-link w-5 h-5"><title>Twitter</title><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></li><li><a href=https://aakinshin.net/posts/index.xml><svg class="fai fai-link w-5 h-5"><title>RSS</title><use xlink:href="/img/fa/all.svg#rss"/></svg></a></li></ul><div class=main-content><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></div></footer><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+=" has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script></body></html>