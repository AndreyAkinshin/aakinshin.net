<!doctype html><html lang=en class=h-100><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.74.3"><meta name=author content="Andrey Akinshin"><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content="Statistics,Statistical efficiency,Harrell-Davis quantile estimator,Winsorizing,Trimming,Small samples"><title>Improving the efficiency of the Harrell-Davis quantile estimator for special cases using custom winsorizing and trimming strategies | Andrey Akinshin</title><meta name=description content="Let&amp;rsquo;s say we want to estimate the median based on a small sample (3 \(\leq n \leq 7\)) from a right-skewed heavy-tailed distribution with high statis..."><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><link href=/css/lumen-bootstrap.min.css theme=light rel=stylesheet type=text/css media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><link href=/css/slate-bootstrap.min.css theme=dark rel=stylesheet type=text/css media="(prefers-color-scheme: dark)"><link href=/css/syntax-light.css theme=light rel=stylesheet type=text/css media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><link href=/css/syntax-dark.css theme=dark rel=stylesheet type=text/css media="(prefers-color-scheme: dark)"><script src=https://aakinshin.net/js/theme-before.min.26d61b7027fe55e642f0001cef94cb75b567d721086492aab6b4e32d9ee7811d.js></script><script type=module src=https://aakinshin.net/js/dark-mode-toggle.min.882998740b9c4c24677576b997bde5a487246e2e3bd72128a0e922eaa59db029.mjs></script><link href=https://aakinshin.net/css/fontawesome-all.min.50da8736f05b35aac9691de67fe993cbe01b7d88fcf0cb682c3a8f39933fe4a3.css rel=stylesheet type=text/css media=all><link href=https://aakinshin.net/css/about.min.2a76db7cc14055b3bafacc363f453917ab54a818a7db2a0a9b2409c0f6bf07c5.css rel=stylesheet type=text/css media=all><link href=https://aakinshin.net/css/blog.min.ae812fc71daf5160d927febda5a991cee6c361345e3f685d3736931ed7537986.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZVB6MXSX32"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-ZVB6MXSX32');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-41419012-5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-41419012-5');</script><script type=text/javascript>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym");ym(28700916,"init",{clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src=https://mc.yandex.ru/watch/28700916 style=position:absolute;left:-9999px alt></div></noscript><script src=/js/jquery-3.3.1.slim.min.js></script></head><body><div class=bg-primary><div class="container bg-primary"><nav class="navbar navbar-expand-sm navbar-dark bg-primary"><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link id=nav-link-blog href=https://aakinshin.net/><i class="fas fa-home" title=Home style=color:#fff></i></a></li><li class=nav-item><a class=nav-link id=nav-link-posts href=https://aakinshin.net/posts/>Posts</a></li><li class=nav-item><a class=nav-link id=nav-link-about href=https://aakinshin.net/about/>About</a></li><li class=nav-item><a class=nav-link id=nav-link-pdnb href=https://aakinshin.net/prodotnetbenchmarking/>Pro .NET Benchmarking</a></li></ul><ul class="navbar-nav ml-auto"><li class=nav-item><dark-mode-toggle permanent=true></dark-mode-toggle></li></ul></nav></div></div><div class=container><main id=main><div class=blog-main><div class="blog-post table-sm"><h1 class=blog-post-title id=post-title>Improving the efficiency of the Harrell-Davis quantile estimator for special cases using custom winsorizing and trimming strategies</h1><span class=blog-post-meta><div class=faicon><i class="far fa-calendar-alt"></i></div><time datetime=2021-05-25>May 25, 2021</time>
&nbsp;&nbsp;
<i class="fas fa-tag"></i>&nbsp;
<a href=https://aakinshin.net/tags/statistics/ class="badge badge-info">Statistics</a>
<a href=https://aakinshin.net/tags/statistical-efficiency/ class="badge badge-info">Statistical efficiency</a>
<a href=https://aakinshin.net/tags/harrell-davis-quantile-estimator/ class="badge badge-info">Harrell-Davis quantile estimator</a>
<a href=https://aakinshin.net/tags/winsorizing/ class="badge badge-info">Winsorizing</a>
<a href=https://aakinshin.net/tags/trimming/ class="badge badge-info">Trimming</a>
<a href=https://aakinshin.net/tags/small-samples/ class="badge badge-info">Small samples</a></span><br><br><p>Let&rsquo;s say we want to
<strong>estimate the median</strong>
based on a <strong>small sample</strong> (3 <span class="math inline">\(\leq n \leq 7\)</span>)
from a <strong>right-skewed heavy-tailed distribution</strong>
with <strong>high statistical efficiency</strong>.</p><p>The traditional median estimator is the most robust estimator, but it&rsquo;s not the most efficient one.
Typically, the Harrell-Davis quantile estimator provides better efficiency,
but it&rsquo;s not robust (its breakdown point is zero),
so it may have worse efficiency in the given case.
The <a href=https://aakinshin.net/posts/winsorized-hdqe/>winsorized</a> and <a href=https://aakinshin.net/posts/trimmed-hdqe/>trimmed</a>
modifications of the Harrell-Davis quantile estimator provide a good trade-off
between efficiency and robustness, but they require a proper winsorizing/trimming rule.
A reasonable choice of such a rule for medium-size samples is based on the highest density interval of the Beta function
(as described <a href=https://aakinshin.net/posts/winsorized-hdqe/>here</a>).
Unfortunately, this approach may be suboptimal for small samples.
E.g., if we use the 99% highest density interval to estimate the median,
it starts to trim sample values only for <span class="math inline">\(n \geq 8\)</span>.</p><p>In this post, we are going to discuss custom winsorizing/trimming strategies for special cases of the quantile estimation problem.</p><h3 id=beware-of-small-samples>Beware of small samples</h3><p>So, what&rsquo;s wrong with the small samples from heavy-tailed distributions?
There is a high chance to observe an extremely large value in such a sample.
As an example, let&rsquo;s consider the Pareto distribution.
Here is the PDF for <span class="math inline">\(\textrm{Pareto}(x_m = 1, \alpha = 1)\)</span>:</p><div class=row><div class=mx-auto><a href=/posts/customized-wthdqe/img/pareto-pdf-light.png target=_blank class=imgldlink alt=pareto-pdf><picture>
<source theme=dark srcset=/posts/customized-wthdqe/img/pareto-pdf-dark.png media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/customized-wthdqe/img/pareto-pdf-light.png media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/customized-wthdqe/img/pareto-pdf-light.png></picture></a></div></div><br><p>The quantile function for the Pareto distribution is defined as follows:</p><p><span class="math display">\[Q_\textrm{Pareto}(p) = x_m (1 - p)^{(-1/\alpha)}
\]</span></p><p>In our case (<span class="math inline">\(x_m = 1, \alpha = 1\)</span>), we have:</p><p><span class="math display">\[Q_{\textrm{Pareto}(x_m = 1,\;\alpha = 1)}(p) = \frac{1}{1 - p}
\]</span></p><p>Here are some of the quantile values:</p><div class=highlight><pre class=chroma><code class=language-txt data-lang=txt>q[0.500] = 2
q[0.750] = 4
q[0.900] = 10
q[0.950] = 20
q[0.990] = 100
q[0.999] = 1000
</code></pre></div><p>Thus, while the median value is <span class="math inline">\(2\)</span>, the value of the <span class="math inline">\(99.9^\textrm{th}\)</span> percentile is 1000.
It may look like a small probability, but this impression is deceiving.
For example, if we consider 5000 values (or 1000 of 5-element samples),
there is a 99.3% chance that at least one of the values is higher than 1000.</p><h3 id=the-problem-of-the-harrell-davis-quantile-estimator>The problem of the Harrell-Davis quantile estimator</h3><p>The Harrell-Davis approach suggests estimating the quantile value as a weighted sum of all sample elements
where all weight values are positive.
Thus, its breakdown point is zero: a single &ldquo;extreme&rdquo; value may &ldquo;corrupt&rdquo; the estimation.
Let&rsquo;s say we have the following sample from <span class="math inline">\(\textrm{Pareto}(x_m = 1, \alpha = 1)\)</span>:</p><p><span class="math display">\[x = \{ 1, 2, 1000 \}
\]</span></p><p>The traditional median estimator just selects the middle element.
In our case, it gives</p><p><span class="math display">\[Q_\textrm{Traditional}(x) = x_2 = 2
\]</span></p><p>which is a pretty accurate median estimation.
The Harrell-Davis quantile estimator produces a worse estimation:</p><p><span class="math display">\[Q_\textrm{HD}(x) \approx 0.259259\cdot x_1 + 0.481481\cdot x_2 + 0.259259\cdot x_3 \approx 260.481.
\]</span></p><p>The Harrell-Davis quantile estimator is a good approach in many cases because it typically provides better efficiency
then the traditional one.
Unfortunately, in the considered case (small samples form heavy-tailed distribution),
its efficiency is quite bad because it&rsquo;s not robust enough.
Let&rsquo;s try to fix this problem.</p><h3 id=smart-winsorizingtrimming>Smart winsorizing/trimming</h3><p>If we want to improve the Harrell-Davis quantile estimator robustness,
we can consider its <a href=https://aakinshin.net/posts/winsorized-hdqe/>winsorized</a> and <a href=https://aakinshin.net/posts/trimmed-hdqe/>trimmed</a> modifications.
In one of the previous posts, I <a href=https://aakinshin.net/posts/winsorized-hdqe/>described</a> an approach
that selects the trimming percentage based on the highest density interval of the corresponding beta function.
It works great for medium-size samples, but it&rsquo;s useless for small samples.
If we use the 99% highest density interval to estimate the median,
the trimming percentage will be positive only for <span class="math inline">\(n \geq 8\)</span>.</p><p>In our case, we can consider a custom trimming strategy.
Our greatest enemy here is the random extreme values.
We want to trim them whenever it&rsquo;s possible.</p><p>Let&rsquo;s consider a sample <span class="math inline">\(x\)</span> with <span class="math inline">\(n\)</span> elements where all the samples elements are already sorted:</p><p><span class="math display">\[x_1 \leq x_2 \leq \ldots \leq x_n.
\]</span></p><p>Now let&rsquo;s discuss how we should trim the samples for different <span class="math inline">\(n\)</span> values:</p><ul><li><span class="math inline">\(n=3\)</span><br>It&rsquo;s not a good idea to trim <span class="math inline">\(x_2\)</span> because it&rsquo;s our traditional median estimation.
It&rsquo;s also doesn&rsquo;t make sense to trim <span class="math inline">\(x_1\)</span> because the considered distribution is right-skewed
(<span class="math inline">\(x_1\)</span> is the minimum element of the sample; it has the smallest chance to be &ldquo;extreme&rdquo;).
Thus, the reasonable decision is to trim <span class="math inline">\(x_3\)</span>.</li><li><span class="math inline">\(n=4\)</span><br>The traditional median estimator for samples with even size uses two middle elements.
For <span class="math inline">\(n=4\)</span>, these elements are <span class="math inline">\(x_2\)</span> and <span class="math inline">\(x_3\)</span>, so we don&rsquo;t want to trim them.
It&rsquo;s still useless to trim <span class="math inline">\(x_1\)</span>, so our only option is to trim <span class="math inline">\(x_4\)</span>.</li><li><span class="math inline">\(n=5\)</span><br>Here the traditional median estimator uses only <span class="math inline">\(x_3\)</span>.
So, we can trim two elements: <span class="math inline">\(x_4\)</span> and <span class="math inline">\(x_5\)</span>.</li><li><span class="math inline">\(n=6\)</span><br>By analogy, we can trim <span class="math inline">\(x_5\)</span> and <span class="math inline">\(x_6\)</span>.</li><li><span class="math inline">\(n=7\)</span><br>Here the traditional median estimator uses only <span class="math inline">\(x_4\)</span>.
Thus, we can trim three elements: <span class="math inline">\(x_5\)</span>, <span class="math inline">\(x_6\)</span>, and <span class="math inline">\(x_7\)</span>.</li></ul><p>This strategy can be described using the following scheme
(<code>@</code> denotes non-trimmed element; <code>x</code> denotes trimmed element; assuming sorted sample):</p><div class=highlight><pre class=chroma><code class=language-txt data-lang=txt>n = 3: @@x
n = 4: @@@x
n = 5: @@@xx
n = 6: @@@@xx
n = 7: @@@@xxx
</code></pre></div><p>It&rsquo;s time to check how it works.</p><h3 id=numerical-simulation>Numerical simulation</h3><p>We are going to compare four quantile estimators:</p><ul><li><code>hf7</code>: the traditional quantile estimator (also known as the Hyndman-Fan Type 7)</li><li><code>hd</code>: the Harrell-Davis quantile estimator</li><li><code>whd</code>: the winsorized Harrell-Davis quantile estimator where
the winsorized elements are defined according to the scheme from the previous section</li><li><code>thd</code>: the trimmed Harrell-Davis quantile estimator where
the trimmed elements are defined according to the scheme from the previous section</li></ul><p>Typically, the estimator efficiency is evaluated using the mean squared error (<code>mse</code>) and the bias.
This approach works good for light-tailed error distribution,
but it could be misleading for heavy-tailed distribution.
Thus, in addition to the classic bias and mse metric,
we also consider different percentiles of the absolute values of simulated errors.
Also, we are going to draw the PDF of the error distributions.
Each error distribution is based on 100'000 random samples.</p><p>In this simulation, we are going to estimate the median for the normal distribution (the true median value is <span class="math inline">\(0\)</span>)
and for <span class="math inline">\(\textrm{Pareto}(x_m = 1, \alpha = 1)\)</span> (the true median value is <span class="math inline">\(2\)</span>).</p><h4 id=normal-distribution-n--5>Normal distribution (n = 5)</h4><p>Let&rsquo;s start with the normal distribution (which is symmetric and light-tailed) to do a dry-check of our estimators.</p><div class=row><div class=mx-auto><a href=/posts/customized-wthdqe/img/normal5-light.png target=_blank class=imgldlink alt=normal5><picture>
<source theme=dark srcset=/posts/customized-wthdqe/img/normal5-dark.png media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/customized-wthdqe/img/normal5-light.png media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/customized-wthdqe/img/normal5-light.png></picture></a></div></div><br><div class=highlight><pre class=chroma><code class=language-js data-lang=js> <span class=nx>estimator</span>       <span class=nx>bias</span>     <span class=nx>mse</span>     <span class=nx>p25</span>     <span class=nx>p50</span>     <span class=nx>p75</span>     <span class=nx>p90</span>     <span class=nx>p95</span>    <span class=nx>p99</span>
       <span class=nx>hf7</span> <span class=o>-</span><span class=mf>0.0016329</span> <span class=mf>0.29153</span> <span class=mf>0.16804</span> <span class=mf>0.36103</span> <span class=mf>0.61964</span> <span class=mf>0.89926</span> <span class=mf>1.06836</span> <span class=mf>1.3611</span>
        <span class=nx>hd</span> <span class=o>-</span><span class=mf>0.0056730</span> <span class=mf>0.21042</span> <span class=mf>0.14671</span> <span class=mf>0.31081</span> <span class=mf>0.52609</span> <span class=mf>0.74722</span> <span class=mf>0.89905</span> <span class=mf>1.1936</span>
       <span class=nx>whd</span> <span class=o>-</span><span class=mf>0.1920940</span> <span class=mf>0.28335</span> <span class=mf>0.17178</span> <span class=mf>0.36076</span> <span class=mf>0.60780</span> <span class=mf>0.87269</span> <span class=mf>1.04119</span> <span class=mf>1.3885</span>
       <span class=nx>thd</span> <span class=o>-</span><span class=mf>0.2879419</span> <span class=mf>0.32841</span> <span class=mf>0.18283</span> <span class=mf>0.38710</span> <span class=mf>0.65326</span> <span class=mf>0.94229</span> <span class=mf>1.14017</span> <span class=mf>1.4771</span>
</code></pre></div><p>TODO: rewrite
As we can see, <code>hf7</code> and <code>hd</code> give pretty similar results.
In this particular case, <code>whd</code> and <code>thd</code> give worse results (but they are still pretty acceptable)
It&rsquo;s an expected situation because our winsorizing/trimming strategy is &ldquo;overfitted&rdquo; to the right-skewed case
while the actual distribution is symmetric.</p><h4 id=pareto-distribution-n--3>Pareto distribution (n = 3)</h4><p>Now it&rsquo;s time to check our estimators on the most complicated case:
we should guess the median value of <span class="math inline">\(\textrm{Pareto}(x_m = 1, \alpha = 1)\)</span>
based only on three elements!</p><div class=row><div class=mx-auto><a href=/posts/customized-wthdqe/img/pareto3-light.png target=_blank class=imgldlink alt=pareto3><picture>
<source theme=dark srcset=/posts/customized-wthdqe/img/pareto3-dark.png media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/customized-wthdqe/img/pareto3-light.png media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/customized-wthdqe/img/pareto3-light.png></picture></a></div></div><br><div class=highlight><pre class=chroma><code class=language-js data-lang=js> <span class=nx>estimator</span>     <span class=nx>bias</span>        <span class=nx>mse</span>     <span class=nx>p25</span>     <span class=nx>p50</span>     <span class=nx>p75</span>    <span class=nx>p90</span>     <span class=nx>p95</span>    <span class=nx>p99</span>
       <span class=nx>hf7</span>  <span class=mf>0.96402</span>     <span class=mf>14.093</span> <span class=mf>0.33215</span> <span class=mf>0.63298</span> <span class=mf>1.09961</span> <span class=mf>3.1286</span>  <span class=mf>5.4061</span> <span class=mf>15.677</span>
        <span class=nx>hd</span> <span class=mf>12.75015</span> <span class=mf>175467.942</span> <span class=mf>0.37914</span> <span class=mf>0.84069</span> <span class=mf>3.02464</span> <span class=mf>8.9115</span> <span class=mf>18.5175</span> <span class=mf>90.129</span>
       <span class=nx>whd</span>  <span class=mf>0.62981</span>     <span class=mf>14.147</span> <span class=mf>0.32802</span> <span class=mf>0.61526</span> <span class=mf>0.89961</span> <span class=mf>2.4955</span>  <span class=mf>4.2395</span> <span class=mf>11.140</span>
       <span class=nx>thd</span>  <span class=mf>0.48012</span>     <span class=mf>23.503</span> <span class=mf>0.33245</span> <span class=mf>0.61360</span> <span class=mf>0.88120</span> <span class=mf>1.9543</span>  <span class=mf>3.4305</span>  <span class=mf>9.819</span>
</code></pre></div><p>Expectedly, <code>hd</code> has the worst error values because of its zero breakdown point.
Meanwhile, <code>whd</code> and <code>thd</code> have better error values than <code>hf7</code> (which is our baseline).
They are better not only based on the &ldquo;classic&rdquo; <code>bias</code> and <code>mse</code> metrics but only based on all the percentile values.</p><p>Let&rsquo;s see what happens for higher <span class="math inline">\(n\)</span> values.</p><h4 id=pareto-distribution-n--4>Pareto distribution (n = 4)</h4><div class=row><div class=mx-auto><a href=/posts/customized-wthdqe/img/pareto4-light.png target=_blank class=imgldlink alt=pareto4><picture>
<source theme=dark srcset=/posts/customized-wthdqe/img/pareto4-dark.png media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/customized-wthdqe/img/pareto4-light.png media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/customized-wthdqe/img/pareto4-light.png></picture></a></div></div><br><div class=highlight><pre class=chroma><code class=language-js data-lang=js> <span class=nx>estimator</span>    <span class=nx>bias</span>      <span class=nx>mse</span>     <span class=nx>p25</span>     <span class=nx>p50</span>     <span class=nx>p75</span>    <span class=nx>p90</span>     <span class=nx>p95</span>    <span class=nx>p99</span>
       <span class=nx>hf7</span> <span class=mf>0.99630</span>   <span class=mf>13.376</span> <span class=mf>0.28927</span> <span class=mf>0.58443</span> <span class=mf>1.22370</span> <span class=mf>3.1813</span>  <span class=mf>5.1862</span> <span class=mf>12.015</span>
        <span class=nx>hd</span> <span class=mf>4.33302</span> <span class=mf>1376.949</span> <span class=mf>0.35408</span> <span class=mf>0.81399</span> <span class=mf>2.56402</span> <span class=mf>6.8722</span> <span class=mf>12.2750</span> <span class=mf>53.703</span>
       <span class=nx>whd</span> <span class=mf>0.95874</span>   <span class=mf>25.060</span> <span class=mf>0.28729</span> <span class=mf>0.57546</span> <span class=mf>1.12468</span> <span class=mf>2.9193</span>  <span class=mf>4.8311</span> <span class=mf>12.190</span>
       <span class=nx>thd</span> <span class=mf>0.72518</span>   <span class=mf>11.554</span> <span class=mf>0.27726</span> <span class=mf>0.54553</span> <span class=mf>0.91749</span> <span class=mf>2.3926</span>  <span class=mf>4.0997</span> <span class=mf>10.723</span>
</code></pre></div><h4 id=pareto-distribution-n--5>Pareto distribution (n = 5)</h4><div class=row><div class=mx-auto><a href=/posts/customized-wthdqe/img/pareto5-light.png target=_blank class=imgldlink alt=pareto5><picture>
<source theme=dark srcset=/posts/customized-wthdqe/img/pareto5-dark.png media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/customized-wthdqe/img/pareto5-light.png media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/customized-wthdqe/img/pareto5-light.png></picture></a></div></div><br><div class=highlight><pre class=chroma><code class=language-js data-lang=js> <span class=nx>estimator</span>     <span class=nx>bias</span>        <span class=nx>mse</span>     <span class=nx>p25</span>     <span class=nx>p50</span>     <span class=nx>p75</span>    <span class=nx>p90</span>    <span class=nx>p95</span>     <span class=nx>p99</span>
       <span class=nx>hf7</span> <span class=mf>0.504146</span>     <span class=mf>5.2105</span> <span class=mf>0.26675</span> <span class=mf>0.52613</span> <span class=mf>0.87303</span> <span class=mf>2.1065</span> <span class=mf>3.3679</span>  <span class=mf>7.2826</span>
        <span class=nx>hd</span> <span class=mf>4.396743</span> <span class=mf>22596.2795</span> <span class=mf>0.31288</span> <span class=mf>0.74502</span> <span class=mf>2.24599</span> <span class=mf>5.3275</span> <span class=mf>9.3600</span> <span class=mf>34.9101</span>
       <span class=nx>whd</span> <span class=mf>0.231205</span>     <span class=mf>2.1152</span> <span class=mf>0.26279</span> <span class=mf>0.50793</span> <span class=mf>0.77450</span> <span class=mf>1.4745</span> <span class=mf>2.4296</span>  <span class=mf>5.8547</span>
       <span class=nx>thd</span> <span class=mf>0.067092</span>     <span class=mf>1.6300</span> <span class=mf>0.26268</span> <span class=mf>0.50467</span> <span class=mf>0.74328</span> <span class=mf>1.1175</span> <span class=mf>1.9506</span>  <span class=mf>4.6478</span>
</code></pre></div><h4 id=pareto-distribution-n--6>Pareto distribution (n = 6)</h4><div class=row><div class=mx-auto><a href=/posts/customized-wthdqe/img/pareto6-light.png target=_blank class=imgldlink alt=pareto6><picture>
<source theme=dark srcset=/posts/customized-wthdqe/img/pareto6-dark.png media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/customized-wthdqe/img/pareto6-light.png media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/customized-wthdqe/img/pareto6-light.png></picture></a></div></div><br><div class=highlight><pre class=chroma><code class=language-js data-lang=js> <span class=nx>estimator</span>    <span class=nx>bias</span>       <span class=nx>mse</span>     <span class=nx>p25</span>     <span class=nx>p50</span>     <span class=nx>p75</span>    <span class=nx>p90</span>    <span class=nx>p95</span>     <span class=nx>p99</span>
       <span class=nx>hf7</span> <span class=mf>0.51371</span>    <span class=mf>2.5938</span> <span class=mf>0.23690</span> <span class=mf>0.48757</span> <span class=mf>0.86252</span> <span class=mf>2.0152</span> <span class=mf>3.0778</span>  <span class=mf>6.4690</span>
        <span class=nx>hd</span> <span class=mf>2.46898</span> <span class=mf>1195.1400</span> <span class=mf>0.29120</span> <span class=mf>0.66492</span> <span class=mf>1.78711</span> <span class=mf>4.0332</span> <span class=mf>6.8272</span> <span class=mf>20.9587</span>
       <span class=nx>whd</span> <span class=mf>0.42000</span>    <span class=mf>2.5518</span> <span class=mf>0.23282</span> <span class=mf>0.47884</span> <span class=mf>0.79029</span> <span class=mf>1.7981</span> <span class=mf>2.8478</span>  <span class=mf>6.0907</span>
       <span class=nx>thd</span> <span class=mf>0.25985</span>    <span class=mf>1.4532</span> <span class=mf>0.23638</span> <span class=mf>0.46981</span> <span class=mf>0.74189</span> <span class=mf>1.4778</span> <span class=mf>2.3190</span>  <span class=mf>4.9017</span>
</code></pre></div><h4 id=pareto-distribution-n--7>Pareto distribution (n = 7)</h4><div class=row><div class=mx-auto><a href=/posts/customized-wthdqe/img/pareto7-light.png target=_blank class=imgldlink alt=pareto7><picture>
<source theme=dark srcset=/posts/customized-wthdqe/img/pareto7-dark.png media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/customized-wthdqe/img/pareto7-light.png media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/customized-wthdqe/img/pareto7-light.png></picture></a></div></div><br><div class=highlight><pre class=chroma><code class=language-js data-lang=js> <span class=nx>estimator</span>      <span class=nx>bias</span>        <span class=nx>mse</span>     <span class=nx>p25</span>     <span class=nx>p50</span>     <span class=nx>p75</span>    <span class=nx>p90</span>    <span class=nx>p95</span>     <span class=nx>p99</span>
       <span class=nx>hf7</span>  <span class=mf>0.337121</span>    <span class=mf>1.85904</span> <span class=mf>0.23519</span> <span class=mf>0.46158</span> <span class=mf>0.75627</span> <span class=mf>1.5838</span> <span class=mf>2.4504</span>  <span class=mf>5.3569</span>
        <span class=nx>hd</span>  <span class=mf>1.975857</span> <span class=mf>1989.76770</span> <span class=mf>0.26722</span> <span class=mf>0.60452</span> <span class=mf>1.52104</span> <span class=mf>3.2602</span> <span class=mf>5.0468</span> <span class=mf>13.5435</span>
       <span class=nx>whd</span>  <span class=mf>0.082059</span>    <span class=mf>0.88772</span> <span class=mf>0.23247</span> <span class=mf>0.44718</span> <span class=mf>0.68616</span> <span class=mf>1.0932</span> <span class=mf>1.7480</span>  <span class=mf>3.8571</span>
       <span class=nx>thd</span> <span class=o>-</span><span class=mf>0.039714</span>    <span class=mf>0.68217</span> <span class=mf>0.23089</span> <span class=mf>0.45429</span> <span class=mf>0.67313</span> <span class=mf>0.8878</span> <span class=mf>1.3837</span>  <span class=mf>3.0663</span>
</code></pre></div><h3 id=conclusion>Conclusion</h3><p>In this post, we performed a numerical simulation that compared the statistical efficiency
of the median estimation on small samples from right-skewed heavy-tailed distributions.
We compared four quantile estimators:
the traditional one (also known as the Hyndman-Fan Type 7),
the Harrell-Davis quantile estimator,
and its winsorized/trimming modifications that use a custom trimming strategy optimized for the given case.
Based on the simulation results, we can conclude that the <strong>trimmed modification is the clear winner</strong>.</p><br><br><div class=row><div class="mx-auto share-block"><div class=share-title>Share:</div><div class=share-button><a href="https://www.reddit.com/submit?url=https%3a%2f%2faakinshin.net%2fposts%2fcustomized-wthdqe%2f&title=Improving%20the%20efficiency%20of%20the%20Harrell-Davis%20quantile%20estimator%20for%20special%20cases%20using%20custom%20winsorizing%20and%20trimming%20strategies" target=_blank title="Share on Reddit"><i class="fab fa-reddit fa-2x"></i></a></div><div class=share-button><a href="https://twitter.com/intent/tweet?text=Improving%20the%20efficiency%20of%20the%20Harrell-Davis%20quantile%20estimator%20for%20special%20cases%20using%20custom%20winsorizing%20and%20trimming%20strategies&url=https%3a%2f%2faakinshin.net%2fposts%2fcustomized-wthdqe%2f&via=andrey_akinshin&related=andrey_akinshin" rel=nofollow target=_blank title="Share on Twitter"><i class="fab fa-twitter fa-2x"></i></a></div><div class=share-button><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2faakinshin.net%2fposts%2fcustomized-wthdqe%2f" target=_blank title="Share on HackerNews"><i class="fab fa-hacker-news fa-2x"></i></a></div><div class=share-button><a href="https://facebook.com/sharer.php?u=https%3a%2f%2faakinshin.net%2fposts%2fcustomized-wthdqe%2f" rel=nofollow target=_blank title="Share on Facebook"><i class="fab fa-facebook fa-2x"></i></a></div><div class=share-button><a href="http://vk.com/share.php?url=https%3a%2f%2faakinshin.net%2fposts%2fcustomized-wthdqe%2f" target=_blank title="Share on VKontakte"><i class="fab fa-vk fa-2x"></i></a></div><div class=share-button><a href="https://getpocket.com/save?url=https%3a%2f%2faakinshin.net%2fposts%2fcustomized-wthdqe%2f&title=Improving%20the%20efficiency%20of%20the%20Harrell-Davis%20quantile%20estimator%20for%20special%20cases%20using%20custom%20winsorizing%20and%20trimming%20strategies" target=_blank title="Add to Pocket"><i class="fab fa-get-pocket fa-2x"></i></a></div></div></div></div><hr></div></div></main></div><footer class=blog-footer><div class=container><p>&copy; 2013â€“2021 Andrey Akinshin
|
<a href=https://github.com/AndreyAkinshin><i class="fab fa-github" title=GitHub></i></a><a href=https://twitter.com/andrey_akinshin><i class="fab fa-twitter" title=Twitter></i></a><a href=https://aakinshin.net/posts/index.xml><i class="fas fa-rss" title=RSS></i></a>|
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></p></div></footer><script src=https://aakinshin.net/js/theme-after.min.082780cb948cc57eabbc0d80172a7a5347d5572b599938b4c9876dfd7978b424.js></script><script src=/js/popper.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/anchor.min.js></script><script src=https://aakinshin.net/js/custom.min.11932490dde776463ed165b345838c701accc0cfdedf2e0868f13415f41f0872.js></script><script>window.MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']],processEscapes:true,processEnvironments:true,},options:{skipHtmlTags:['script','noscript','style','textarea','pre'],ignoreHtmlClass:'tex2jax_ignore',processHtmlClass:'tex2jax_process'}};</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></body></html>