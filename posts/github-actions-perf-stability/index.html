<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.103.0-DEV"><meta name=author content="Andrey Akinshin"><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content="Statistics,Performance analysis"><title>Performance stability of GitHub Actions | Andrey Akinshin</title><meta name=description content="Investigating the stability of performance measurements on GitHub Actions build agents using simple benchmarks."><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><meta name=og:image content="https://aakinshin.net/posts/github-actions-perf-stability/img/macos_disk-light.svg"><script>localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><link href=https://aakinshin.net/css/main.min.fe1c45a5bb1462c47792274eba884723afa28a87c7a92405ed21b423927e7fbf.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"></head><body><nav><div class="container flex flex-wrap items-center justify-between mx-auto max-w-6xl h-12 px-6"><div class="flex items-center justify-start justify-self-start"><div class="flex nav-item h-12 w-12 items-center justify-center"><a class=text-white href=https://aakinshin.net/><svg class="fai w-5 h-5 pr-0 mb-0.5"><use xlink:href="/img/fa/all.svg#house-chimney"/></svg></a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/posts/>Posts</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/research/>Research</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/about/>About</a></div></div><button id=theme-toggle type=button class="nav-item p-3 content-center justify-self-end"><svg id="theme-toggle-dark-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001.0 1010.586 10.586z"/></svg><svg id="theme-toggle-light-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1A1 1 0 119 4V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707A1 1 0 1113.536 5.05l.707-.707a1 1 0 011.414.0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707A1 1 0 004.343 5.757l.707.707zm1.414 8.486-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"/></svg></button></div></nav><div class="main container mx-auto max-w-6xl px-6"><div class=main-post><h1 class=blog-post-title id=post-title>Performance stability of GitHub Actions</h1><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2023-03-21>March 21, 2023</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/statistics/>Statistics</a>
<a class=label-link href=https://aakinshin.net/tags/perf-analysis/>Performance analysis</a></div></div><br><div class=main-content><p>Nowadays, <a href=https://github.com/features/actions>GitHub Actions</a> is one of the most popular free CI systems.
It&rsquo;s quite convenient to use it to run unit and integration tests.
However, some developers try to use it to run benchmarks and performance tests.
Unfortunately, default GitHub Actions build agents do not provide
a consistent execution environment from the performance point of view.
Therefore, performance measurements from different builds can not be compared.
This makes it almost impossible to set up reliable performance tests based
on the default GitHub Actions build agent pool.</p><p>So, it&rsquo;s expected that the execution environments are not <em>absolutely</em> identical.
But how bad is the situation?
What&rsquo;s the maximum difference between performance measurements from different builds?
Is there a chance that we can play with thresholds and
utilize GitHub Actions to detect at least major performance degradations?
Let&rsquo;s find out!</p><h3 id=benchmark-design>Benchmark design</h3><p>I created a small <a href=https://github.com/dotnet/BenchmarkDotNet>BenchmarkDotNet</a>-based project
that performs simple CPU-bound, Memory-bound, and Disk-bound benchmarks
(the full source code is available at the repository
<a href=https://github.com/AndreyAkinshin/GitHubActionsPerfStability>GitHubActionsPerfStability</a>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=k>public</span> <span class=k>class</span> <span class=nc>Benchmarks</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>readonly</span> <span class=kt>byte</span><span class=p>[]</span> <span class=n>data</span> <span class=p>=</span> <span class=k>new</span> <span class=kt>byte</span><span class=p>[</span><span class=m>100</span> <span class=p>*</span> <span class=m>1024</span> <span class=p>*</span> <span class=m>1024</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [GlobalSetup]</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>void</span> <span class=n>Setup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=m>1729</span><span class=p>).</span><span class=n>NextBytes</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [Benchmark]</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=kt>double</span> <span class=n>Cpu</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>double</span> <span class=n>pi</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>var</span> <span class=n>i</span> <span class=p>=</span> <span class=m>1</span><span class=p>;</span> <span class=n>i</span> <span class=p>&lt;=</span> <span class=m>500_000_000</span><span class=p>;</span> <span class=n>i</span><span class=p>++)</span>
</span></span><span class=line><span class=cl>            <span class=n>pi</span> <span class=p>+=</span> <span class=m>1.0</span> <span class=p>/</span> <span class=n>i</span> <span class=p>/</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>pi</span> <span class=p>=</span> <span class=n>Math</span><span class=p>.</span><span class=n>Sqrt</span><span class=p>(</span><span class=n>pi</span> <span class=p>*</span> <span class=m>6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>pi</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [Benchmark]</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>void</span> <span class=n>Disk</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>var</span> <span class=n>i</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span> <span class=n>i</span> <span class=p>&lt;</span> <span class=m>10</span><span class=p>;</span> <span class=n>i</span><span class=p>++)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>fileName</span> <span class=p>=</span> <span class=n>Path</span><span class=p>.</span><span class=n>GetTempFileName</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=n>File</span><span class=p>.</span><span class=n>WriteAllBytes</span><span class=p>(</span><span class=n>fileName</span><span class=p>,</span> <span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>File</span><span class=p>.</span><span class=n>Delete</span><span class=p>(</span><span class=n>fileName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [Benchmark]</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=kt>int</span> <span class=n>Memory</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>random</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=m>1729</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>sum</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span> <span class=n>i</span> <span class=p>&lt;</span> <span class=m>200_000_00</span><span class=p>;</span> <span class=n>i</span><span class=p>++)</span>
</span></span><span class=line><span class=cl>            <span class=n>sum</span> <span class=p>+=</span> <span class=n>data</span><span class=p>[</span><span class=n>random</span><span class=p>.</span><span class=n>Next</span><span class=p>(</span><span class=n>data</span><span class=p>.</span><span class=n>Length</span><span class=p>)];</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>These benchmarks are synthetic, and they don&rsquo;t measure anything useful.
But in the scope of this investigation, we are not interested in measuring anything useful,
we are interested only in the reproducibility of obtained measurements across different builds.</p><p>I configured these benchmarks to run 100 iterations of each method.
These are not microbenchmarks, so each iteration contains a single method invocation.
Next, I executed <a href=https://github.com/AndreyAkinshin/GitHubActionsPerfStability/actions>100 GitHub Actions builds</a>
using the same revision.
Each build was performed on three operating systems: Windows, Linux, and macOS.</p><h3 id=benchmark-results>Benchmark results</h3><p>The full dataset with the benchmarking results is available <a href=https://github.com/AndreyAkinshin/aakinshin.net/tree/master/content/en/posts/2023/03/github-actions-perf-stability/img/data.csv>here</a>
(the <code>buildId</code> column matches the numbers of
the <a href=https://github.com/AndreyAkinshin/GitHubActionsPerfStability/actions>original builds</a>).</p><p>Here is the summary plot for all builds
(measurements from all builds were aggregated to a unified time series with 10000 observations;
different builds are marked with different colors
so that we can identify the transition moment between adjacent builds;
six colors are reused across multiple builds):</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/github-actions-perf-stability/img/summary-light.svg target=_blank alt=summary><img src=/posts/github-actions-perf-stability/img/summary-light.svg width=800></a>
<a class="img-dark hidden" href=/posts/github-actions-perf-stability/img/summary-dark.svg target=_blank alt=summary><img src=/posts/github-actions-perf-stability/img/summary-dark.svg width=800></a></div><p>And here is a shortened summary for the first 20 builds:</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/github-actions-perf-stability/img/summary20-light.svg target=_blank alt=summary20><img src=/posts/github-actions-perf-stability/img/summary20-light.svg width=800></a>
<a class="img-dark hidden" href=/posts/github-actions-perf-stability/img/summary20-dark.svg target=_blank alt=summary20><img src=/posts/github-actions-perf-stability/img/summary20-dark.svg width=800></a></div><p>Below you can find separate plots for each configuration:</p><p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/github-actions-perf-stability/img/linux_cpu-light.svg target=_blank alt=linux_cpu><img src=/posts/github-actions-perf-stability/img/linux_cpu-light.svg width=800></a>
<a class="img-dark hidden" href=/posts/github-actions-perf-stability/img/linux_cpu-dark.svg target=_blank alt=linux_cpu><img src=/posts/github-actions-perf-stability/img/linux_cpu-dark.svg width=800></a></div><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/github-actions-perf-stability/img/linux_disk-light.svg target=_blank alt=linux_disk><img src=/posts/github-actions-perf-stability/img/linux_disk-light.svg width=800></a>
<a class="img-dark hidden" href=/posts/github-actions-perf-stability/img/linux_disk-dark.svg target=_blank alt=linux_disk><img src=/posts/github-actions-perf-stability/img/linux_disk-dark.svg width=800></a></div><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/github-actions-perf-stability/img/linux_memory-light.svg target=_blank alt=linux_memory><img src=/posts/github-actions-perf-stability/img/linux_memory-light.svg width=800></a>
<a class="img-dark hidden" href=/posts/github-actions-perf-stability/img/linux_memory-dark.svg target=_blank alt=linux_memory><img src=/posts/github-actions-perf-stability/img/linux_memory-dark.svg width=800></a></div><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/github-actions-perf-stability/img/windows_cpu-light.svg target=_blank alt=windows_cpu><img src=/posts/github-actions-perf-stability/img/windows_cpu-light.svg width=800></a>
<a class="img-dark hidden" href=/posts/github-actions-perf-stability/img/windows_cpu-dark.svg target=_blank alt=windows_cpu><img src=/posts/github-actions-perf-stability/img/windows_cpu-dark.svg width=800></a></div><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/github-actions-perf-stability/img/windows_disk-light.svg target=_blank alt=windows_disk><img src=/posts/github-actions-perf-stability/img/windows_disk-light.svg width=800></a>
<a class="img-dark hidden" href=/posts/github-actions-perf-stability/img/windows_disk-dark.svg target=_blank alt=windows_disk><img src=/posts/github-actions-perf-stability/img/windows_disk-dark.svg width=800></a></div><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/github-actions-perf-stability/img/windows_memory-light.svg target=_blank alt=windows_memory><img src=/posts/github-actions-perf-stability/img/windows_memory-light.svg width=800></a>
<a class="img-dark hidden" href=/posts/github-actions-perf-stability/img/windows_memory-dark.svg target=_blank alt=windows_memory><img src=/posts/github-actions-perf-stability/img/windows_memory-dark.svg width=800></a></div><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/github-actions-perf-stability/img/macos_cpu-light.svg target=_blank alt=macos_cpu><img src=/posts/github-actions-perf-stability/img/macos_cpu-light.svg width=800></a>
<a class="img-dark hidden" href=/posts/github-actions-perf-stability/img/macos_cpu-dark.svg target=_blank alt=macos_cpu><img src=/posts/github-actions-perf-stability/img/macos_cpu-dark.svg width=800></a></div><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/github-actions-perf-stability/img/macos_disk-light.svg target=_blank alt=macos_disk><img src=/posts/github-actions-perf-stability/img/macos_disk-light.svg width=800></a>
<a class="img-dark hidden" href=/posts/github-actions-perf-stability/img/macos_disk-dark.svg target=_blank alt=macos_disk><img src=/posts/github-actions-perf-stability/img/macos_disk-dark.svg width=800></a></div><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/github-actions-perf-stability/img/macos_memory-light.svg target=_blank alt=macos_memory><img src=/posts/github-actions-perf-stability/img/macos_memory-light.svg width=800></a>
<a class="img-dark hidden" href=/posts/github-actions-perf-stability/img/macos_memory-dark.svg target=_blank alt=macos_memory><img src=/posts/github-actions-perf-stability/img/macos_memory-dark.svg width=800></a></div></p><h3 id=conclusions>Conclusions</h3><p>As we can see, the stability of measurements heavily depends on the operating system and the benchmark bottleneck.
In the general case, we can not expect reproducibility of the performance measurements.
In the scope of this experiment, the worst result was obtained for <code>macos</code>/<code>Disk</code>:
two subsequent builds on the same revision can have ranges of 1.5..2 seconds and 12..36 seconds.
CPU-bound benchmarks are much more stable than Memory/Disk-bound benchmarks,
but the &ldquo;average&rdquo; performance levels still can be up to three times different across builds.</p><p>Based on this brief study, I <em>do not</em> recommend using the default GitHub Actions build agent pool
for any kind of performance comparisons across multiple builds:
such results can not be trusted in the general case.
If you want to get a reliable set of performance tests,
it&rsquo;s better to have a dedicated pool of physical build agents with a unified hardware/software configuration
using carefully prepared OS images.</p><p>Note that this study is a small experiment that aims to demonstrate a possible difference
between GitHub Actions build agents in a simple case,
but it <em>is not</em> a full-fledged study that fully explores the full range of possible performance distributions.
If you try to set up a set of benchmarks or performance tests,
it is recommended to perform separate thoughtful research on the build environment consistency
using your target workloads.</p></div><br><br></div></div><script>var themeToggleDarkIcon=document.getElementById("theme-toggle-dark-icon"),themeToggleBtn,themeToggleLightIcon=document.getElementById("theme-toggle-light-icon");const imagesDark=document.querySelectorAll(".img-dark"),imagesLight=document.querySelectorAll(".img-light");localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(themeToggleLightIcon.classList.remove("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")})):(themeToggleDarkIcon.classList.remove("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")})),themeToggleBtn=document.getElementById("theme-toggle"),themeToggleBtn.addEventListener("click",function(){themeToggleDarkIcon.classList.toggle("hidden"),themeToggleLightIcon.classList.toggle("hidden"),imagesLight.forEach(e=>{e.classList.toggle("hidden")}),imagesDark.forEach(e=>{e.classList.toggle("hidden")}),localStorage.getItem("color-theme")?localStorage.getItem("color-theme")==="light"?(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"))})</script><footer class="z-20 p-4 md:p-6 mt-3 w-full border-t border-gray-200 shadow flex items-center justify-center dark:border-gray-600 bg-white dark:bg-zinc-800"><span class="dark:text-gray-400 text-center">© 2013—2023 <span class=whitespace-nowrap>Andrey Akinshin</span></span><ul class="flex flex-wrap items-center px-4 mb-1"><li><a href=https://github.com/AndreyAkinshin><svg class="fai fai-link w-5 h-5"><title>GitHub</title><use xlink:href="/img/fa/all.svg#github"/></svg></a></li><li><a href=https://twitter.com/andrey_akinshin><svg class="fai fai-link w-5 h-5"><title>Twitter</title><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></li><li><a href=https://aakinshin.net/posts/index.xml><svg class="fai fai-link w-5 h-5"><title>RSS</title><use xlink:href="/img/fa/all.svg#rss"/></svg></a></li></ul><div class=main-content><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></div></footer><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script></body></html>