<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.123.3"><meta name=author content='Andrey Akinshin'><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content='Mathematics,Statistics,Research,Quantile,Statistical Efficiency,Research: Building trimmed Harrell-Davis quantile estimator'><title>Avoiding over-trimming with the trimmed Harrell-Davis quantile estimator | Andrey Akinshin</title>
<meta name=description content="Previously, I already discussed the trimmed modification of the Harrell-Davis quantile estimator several times. I performed several numerical simulations that compare the statistical efficiency of this estimator with the efficiency of the classic Harrell-Da..."><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><meta name=og:image content="https://aakinshin.net/posts/thdqe-overtrimming/img/LightAndHeavy__N05_Efficiency-light.png"><script>localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><link href=https://aakinshin.net/css/main.min.c61942ad3fb32a41f8a3bca6f32ed9e12e725f37cccbcd7c4e52232b65d7f106.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"></head><body><nav><div class="container flex flex-wrap items-center justify-between mx-auto max-w-6xl h-12 px-2 xs:px-6"><div class="flex items-center justify-start justify-self-start"><div class="flex nav-item h-12 w-12 items-center justify-center"><a class=text-white href=https://aakinshin.net/><svg class="fai w-5 h-5 pr-0 mb-0.5"><use xlink:href="/img/fa/all.svg#house-chimney"/></svg></a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/posts/>Posts</a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/research/>Research</a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/library/>Library</a></div><div class="flex nav-item h-12 items-center"><a class=text-white href=https://aakinshin.net/about/>About</a></div></div><button id=theme-toggle type=button title="Alt+Click to match OS color theme" class="nav-item p-3 content-center justify-self-end"><svg id="theme-toggle-dark-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001.0 1010.586 10.586z"/></svg><svg id="theme-toggle-light-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1A1 1 0 119 4V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707A1 1 0 1113.536 5.05l.707-.707a1 1 0 011.414.0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707A1 1 0 004.343 5.757l.707.707zm1.414 8.486-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"/></svg></button></div></nav><div class="main container mx-auto max-w-6xl px-6"><div class=main-post><h1 class=blog-post-title id=post-title>Avoiding Over-Trimming with the Trimmed Harrell-Davis Quantile Estimator</h1><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg>
<time datetime=2021-07-27>July 27, 2021</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/mathematics/>Mathematics</a>
<a class=label-link href=https://aakinshin.net/tags/statistics/>Statistics</a>
<a class=label-link href=https://aakinshin.net/tags/research/>Research</a>
<a class=label-link href=https://aakinshin.net/tags/quantile/>Quantile</a>
<a class=label-link href=https://aakinshin.net/tags/statistical-efficiency/>Statistical Efficiency</a>
<a class=label-link href=https://aakinshin.net/tags/research-thdqe/>Research: Building Trimmed Harrell-Davis Quantile Estimator</a></div></div><br><div class="main-content mb-3 px-2 py-1 rounded border text-alert-text-l border-alert-frame-l dark:text-alert-text-d dark:border-alert-frame-d">Update: this blog post is a part of research that aimed to build a statistically efficient and robust quantile estimator. A <a href=/posts/pub-thdqe/>paper with final results</a> is available in <em>Communications in Statistics - Simulation and Computation</em> (DOI: <a href=https://www.tandfonline.com/doi/abs/10.1080/03610918.2022.2050396>10.1080/03610918.2022.2050396</a>). A preprint is available on arXiv: <a href=https://arxiv.org/abs/2111.11776>arXiv:2111.11776 [stat.ME]</a>. Some information in this blog post can be obsolete: please, use the official paper as the primary reference.</div><div class=main-content><p>Previously, I already discussed the
<a href=https://aakinshin.net/posts/trimmed-hdqe/>trimmed modification of the Harrell-Davis quantile estimator</a> several times.
I performed several numerical simulations that compare the statistical efficiency of this estimator
with the efficiency of the <a href=https://aakinshin.net/posts/wthdqe-efficiency/>classic Harrell-Davis quantile estimator</a> (HDQE)
and its <a href=https://aakinshin.net/posts/winsorized-hdqe/>winsorized modification</a>;
I showed how we can improve the efficiency using <a href=https://aakinshin.net/posts/customized-wthdqe/>custom trimming strategies</a>
and how to choose a <a href=https://aakinshin.net/posts/thdqe-threshold/>good trimming threshold value</a>.</p><p>In the heavy-tailed cases, the trimmed HDQE provides better estimations than the classic HDQE
because of its higher breakdown point.
However, in the light-tailed cases, we could get efficiency that is worse than
the baseline Hyndman-Fan Type 7 (HF7) quantile estimator.
In many cases, such an effect arises because of the over-trimming effect.
If the trimming percentage is too high or if the evaluated quantile is too far from the median,
the trimming strategy based on the highest-density interval may lead to an estimation
that is based on single order statistics.
In this case, we get an efficiency level similar to the Hyndman-Fan Type 1-3 quantile estimators
(which are also based on single order statistics).
In the light-tailed case, such a result is less preferable than Hyndman-Fan Type 4-9 quantile estimators
(which are based on two subsequent order statistics).</p><p>In order to improve the situation, we could introduce the lower bound for the number of order statistics
that contribute to the final quantile estimations.
In this post, I look at some numerical simulations
that compare trimmed HDQEs with different lower bounds.</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/thdqe-overtrimming/img/LightAndHeavy__N05_Efficiency-light.png target=_blank alt=LightAndHeavy__N05_Efficiency><img src=/posts/thdqe-overtrimming/img/LightAndHeavy__N05_Efficiency-light.png width=800>
</a><a class="img-dark hidden" href=/posts/thdqe-overtrimming/img/LightAndHeavy__N05_Efficiency-dark.png target=_blank alt=LightAndHeavy__N05_Efficiency><img src=/posts/thdqe-overtrimming/img/LightAndHeavy__N05_Efficiency-dark.png width=800></a></div><h2 id=simulation-design>Simulation design</h2><p>The basic settings for the simulation are the same ones that were used in the <a href=https://aakinshin.net/posts/thdqe-threshold/>previous post</a>.
However, now we are going to compare the following quantile estimators:</p><ul><li><code>HD</code>: the classic Harrell-Davis quantile estimator that is based on a weighted sum of <em>all</em> order statistics</li><li><code>THD|0.5|Min1</code>: <a href=https://aakinshin.net/posts/trimmed-hdqe/>the trimmed modification of the Harrell-Davis quantile estimator</a>
that is based on 50% highest density interval with lower bound = 1
(works the same way as trimmed HDQEs from previous posts)</li><li><code>THD|0.5|Min2</code>: <a href=https://aakinshin.net/posts/trimmed-hdqe/>the trimmed modification of the Harrell-Davis quantile estimator</a>
that is based on 50% highest density interval with lower bound = 2
(always uses at least 2 order statistics)</li><li><code>THD|0.5|Min3</code>: <a href=https://aakinshin.net/posts/trimmed-hdqe/>the trimmed modification of the Harrell-Davis quantile estimator</a>
that is based on 50% highest density interval with lower bound = 3
(always uses at least 3 order statistics)</li></ul><p>Let&rsquo;s look at the results!</p><h2 id=n2>N=2</h2><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/thdqe-overtrimming/img/LightAndHeavy__N02_Efficiency-light.png target=_blank alt=LightAndHeavy__N02_Efficiency><img src=/posts/thdqe-overtrimming/img/LightAndHeavy__N02_Efficiency-light.png width=800>
</a><a class="img-dark hidden" href=/posts/thdqe-overtrimming/img/LightAndHeavy__N02_Efficiency-dark.png target=_blank alt=LightAndHeavy__N02_Efficiency><img src=/posts/thdqe-overtrimming/img/LightAndHeavy__N02_Efficiency-dark.png width=800></a></div><p>With N=2, <code>HD</code>, <code>THD|0.5|Min2</code>, and <code>THD|0.5|Min3</code> work the same way:
all of them always use both sample elements, unlike <code>THD|0.5|Min1</code> that can use only a single element.
Obviously, <code>THD|0.5|Min1</code> &ldquo;wins&rdquo; when we evaluate lower quantiles of heavy-tailed distributions because of
its higher robustness level.
Unfortunately, it provides poor median estimations in the light-tailed cases.</p><h2 id=n3>N=3</h2><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/thdqe-overtrimming/img/LightAndHeavy__N03_Efficiency-light.png target=_blank alt=LightAndHeavy__N03_Efficiency><img src=/posts/thdqe-overtrimming/img/LightAndHeavy__N03_Efficiency-light.png width=800>
</a><a class="img-dark hidden" href=/posts/thdqe-overtrimming/img/LightAndHeavy__N03_Efficiency-dark.png target=_blank alt=LightAndHeavy__N03_Efficiency><img src=/posts/thdqe-overtrimming/img/LightAndHeavy__N03_Efficiency-dark.png width=800></a></div><p>With N=3, <code>HD</code> and <code>THD|0.5|Min3</code> still work the same way (both of them always use all sample elements).
<code>THD|0.5|Min2</code> and <code>THD|0.5|Min1</code> works pretty good on lower quantiles of heavy-tailed distributions
and not-so-good with light-tailed distributions.
However, <code>THD|0.5|Min2</code> shows better results than <code>THD|0.5|Min1</code> because it always uses at least two order statistics.</p><h2 id=n4-n5-n10-n20>N=4, N=5, N=10, N=20</h2><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/thdqe-overtrimming/img/LightAndHeavy__N04_Efficiency-light.png target=_blank alt=LightAndHeavy__N04_Efficiency><img src=/posts/thdqe-overtrimming/img/LightAndHeavy__N04_Efficiency-light.png width=800>
</a><a class="img-dark hidden" href=/posts/thdqe-overtrimming/img/LightAndHeavy__N04_Efficiency-dark.png target=_blank alt=LightAndHeavy__N04_Efficiency><img src=/posts/thdqe-overtrimming/img/LightAndHeavy__N04_Efficiency-dark.png width=800></a></div><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/thdqe-overtrimming/img/LightAndHeavy__N05_Efficiency-light.png target=_blank alt=LightAndHeavy__N05_Efficiency><img src=/posts/thdqe-overtrimming/img/LightAndHeavy__N05_Efficiency-light.png width=800>
</a><a class="img-dark hidden" href=/posts/thdqe-overtrimming/img/LightAndHeavy__N05_Efficiency-dark.png target=_blank alt=LightAndHeavy__N05_Efficiency><img src=/posts/thdqe-overtrimming/img/LightAndHeavy__N05_Efficiency-dark.png width=800></a></div><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/thdqe-overtrimming/img/LightAndHeavy__N10_Efficiency-light.png target=_blank alt=LightAndHeavy__N10_Efficiency><img src=/posts/thdqe-overtrimming/img/LightAndHeavy__N10_Efficiency-light.png width=800>
</a><a class="img-dark hidden" href=/posts/thdqe-overtrimming/img/LightAndHeavy__N10_Efficiency-dark.png target=_blank alt=LightAndHeavy__N10_Efficiency><img src=/posts/thdqe-overtrimming/img/LightAndHeavy__N10_Efficiency-dark.png width=800></a></div><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/thdqe-overtrimming/img/LightAndHeavy__N20_Efficiency-light.png target=_blank alt=LightAndHeavy__N20_Efficiency><img src=/posts/thdqe-overtrimming/img/LightAndHeavy__N20_Efficiency-light.png width=800>
</a><a class="img-dark hidden" href=/posts/thdqe-overtrimming/img/LightAndHeavy__N20_Efficiency-dark.png target=_blank alt=LightAndHeavy__N20_Efficiency><img src=/posts/thdqe-overtrimming/img/LightAndHeavy__N20_Efficiency-dark.png width=800></a></div><p>With N>3, all considered quantile estimators show different efficiency levels.
We can see that all trimmed HDQEs work better than the classic HDQE in the heavy-tailed case
and worse than the classic HDQE in the light-tailed case.
However, there is a noticeable difference between different trimmed HDQEs on small light-tailed samples:
<code>THD|0.5|Min3</code> performs better than <code>THD|0.5|Min1</code> and <code>THD|0.5|Min2</code>.</p><h2 id=conclusion>Conclusion</h2><p>The choice of a quantile estimator is always a trade-off between robustness and efficiency.
Specifying a lower bound for the number of target order statistics in the trimmed HDQE is one of the ways
to control this trade-off.
As we can see from the above simulations, such a trick could improve the statistical efficiency of trimmed HDQE
in the light-tailed case by reducing the statistical efficiency in the heavy-tailed cases
(meanwhile, it still keeps a better robustness level than the classic HDQE).</p></div><br><br></div></div><script>var themeToggleDarkIcon=document.getElementById("theme-toggle-dark-icon"),themeToggleBtn,themeToggleLightIcon=document.getElementById("theme-toggle-light-icon");const imagesDark=document.querySelectorAll(".img-dark"),imagesLight=document.querySelectorAll(".img-light");localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(themeToggleLightIcon.classList.remove("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")})):(themeToggleDarkIcon.classList.remove("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")}));function toggleTheme(e){e?(document.documentElement.classList.add("dark"),themeToggleLightIcon.classList.remove("hidden"),themeToggleDarkIcon.classList.add("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")}),imagesLight.forEach(e=>{e.classList.add("hidden")})):(document.documentElement.classList.remove("dark"),themeToggleDarkIcon.classList.remove("hidden"),themeToggleLightIcon.classList.add("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")}),imagesDark.forEach(e=>{e.classList.add("hidden")}))}themeToggleBtn=document.getElementById("theme-toggle"),themeToggleBtn.addEventListener("click",function(){themeToggleDarkIcon.classList.toggle("hidden"),themeToggleLightIcon.classList.toggle("hidden"),imagesLight.forEach(e=>{e.classList.toggle("hidden")}),imagesDark.forEach(e=>{e.classList.toggle("hidden")}),event.altKey?(localStorage.removeItem("color-theme"),toggleTheme(window.matchMedia("(prefers-color-scheme: dark)").matches)):localStorage.getItem("color-theme")?localStorage.getItem("color-theme")==="light"?(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"))}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{if(localStorage.getItem("color-theme")===null){const t=e.matches?"dark":"light";toggleTheme(t==="dark")}})</script><footer class="z-20 p-4 md:p-6 mt-3 w-full border-t border-gray-200 shadow flex items-center justify-center dark:border-gray-600 bg-white dark:bg-zinc-800"><span class="dark:text-gray-400 text-center">© 2013—2024 <span class=whitespace-nowrap>Andrey Akinshin</span></span><ul class="flex flex-wrap items-center px-4 mb-1"><li><a href=https://github.com/AndreyAkinshin><svg class="fai fai-link w-5 h-5"><title>GitHub</title><use xlink:href="/img/fa/all.svg#github"/></svg></a></li><li><a href=https://twitter.com/andrey_akinshin><svg class="fai fai-link w-5 h-5"><title>Twitter</title><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></li><li><a href=https://aakinshin.net/posts/index.xml><svg class="fai fai-link w-5 h-5"><title>RSS</title><use xlink:href="/img/fa/all.svg#rss"/></svg></a></li></ul><div class=main-content><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></div></footer><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+=" has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script></body></html>