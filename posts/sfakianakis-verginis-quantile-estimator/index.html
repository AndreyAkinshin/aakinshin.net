<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.103.0-DEV"><meta name=author content="Andrey Akinshin"><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content="Mathematics,Statistics,Research,Quantile"><title>Sfakianakis-Verginis quantile estimator | Andrey Akinshin</title><meta name=description content="A brief description of the Sfakianakis-Verginis quantile estimator"><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><script src=https://cdn.tailwindcss.com/3.2.4></script>
<script>tailwind.config={darkMode:"class"}</script><style type=text/tailwindcss>
    @layer base {
       
      body {
        @apply bg-white dark:bg-zinc-800;
        @apply text-black dark:text-gray-400;
      }
      nav {
        @apply bg-sky-800 dark:bg-zinc-900;
      }
      a {
        @apply text-sky-600 dark:text-white;
        @apply no-underline;
      }
      .main-content a:not(.label-link) {
        @apply hover:underline;
      }
      hr {
        @apply h-px my-3 border-0 bg-gray-300 dark:bg-gray-600;
      }
      h1, h2, h3, h4, h5, h6 {
        @apply leading-tight;
      }
      h1, h2, h3 {
        @apply text-4xl py-4;
      }
      h4 {
        @apply text-3xl py-3;
      }
      h5, h6 {
        @apply text-2xl py-2;
      }
      table {
        @apply border self-center mx-auto;
      }
      th, td {
        @apply border p-2
      }
      blockquote {
        @apply border-l-8 border-gray-300 bg-gray-100 dark:border-zinc-600 dark:bg-zinc-700;
        @apply ml-4 my-4 px-4 py-2;
      }

       
      .main ul {
        @apply list-disc ml-10 my-2;
      }
      .main ol {
        @apply list-decimal ml-10 my-2;
      }
      .main p {
        @apply mb-3;
      }

       
      .label {
        @apply mx-1 px-1 py-0.5;
        @apply rounded border border-gray-400 dark:border-gray-500;
      }
      .label-link {
        @apply mx-1 px-1 py-0.5;
        @apply rounded border border-sky-600 dark:border-slate-400;
        @apply hover:bg-sky-200 dark:hover:bg-gray-500;
      }
      .nav-item {
        @apply text-white hover:bg-sky-700 dark:hover:bg-gray-700;
      }

       
      .paginator {
        @apply flex flex-wrap justify-center mb-4;
      }
      .paginator .page-item {
        @apply inline-flex border rounded px-3 py-1;
      }
      .paginator .page-item:not(.active):not(.disabled) {
        @apply border-gray-400 dark:border-gray-400;
      }
      .paginator .page-item.active {
        @apply border-sky-600 dark:border-white;
      }
      .paginator .page-item.disabled {
        @apply bg-gray-50 dark:bg-gray-500 dark:border-gray-400;
      }
      .paginator .page-item.disabled a {
        @apply text-gray-400 dark:text-gray-400;
      }

       
      .block-example {
        @apply my-4 pl-3;
        @apply border-l-8 border-gray-300 dark:border-zinc-600;
      }

       
      #about img {
        @apply inline-flex h-4;
      }

       
      .fai {
        @apply inline-flex h-[1.2em] w-[1.2em] pr-[0.4em] fill-current;
      }
      .fai-link {
        @apply hover:text-sky-400 dark:hover:text-blue-400;
      }
      .label-link .fai {
        @apply pl-1 pb-1 h-[1.5em] w-[1.5em];
      }

       
      .chroma {
        @apply my-5 overflow-y-scroll;
        @apply p-1 border rounded;
      }
    }
  </style><style>.block-example-title::before{counter-increment:example;content:"Example " counter(example)}body{counter-reset:example}code.has-jax{-webkit-font-smoothing:antialiased;background:inherit!important;border:none!important;font-size:100%}.anchorjs-link{transition:all .25s linear}*:hover>.anchorjs-link{margin-left:-1.125em!important}.chroma{background-color:#fff}.chroma .x{}.chroma .err{color:#a61717;background-color:#e3d2d2}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.chroma .hl{display:block;width:100%;background-color:#ffc}.chroma .lnt{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .k{color:#000;font-weight:700}.chroma .kc{color:#000;font-weight:700}.chroma .kd{color:#000;font-weight:700}.chroma .kn{color:#000;font-weight:700}.chroma .kp{color:#000;font-weight:700}.chroma .kr{color:#000;font-weight:700}.chroma .kt{color:#458;font-weight:700}.chroma .n{}.chroma .na{color:teal}.chroma .nb{color:#0086b3}.chroma .bp{color:#999}.chroma .nc{color:#458;font-weight:700}.chroma .no{color:teal}.chroma .nd{color:#3c5d5d;font-weight:700}.chroma .ni{color:purple}.chroma .ne{color:#900;font-weight:700}.chroma .nf{color:#900;font-weight:700}.chroma .fm{}.chroma .nl{color:#900;font-weight:700}.chroma .nn{color:#555}.chroma .nx{}.chroma .py{}.chroma .nt{color:navy}.chroma .nv{color:teal}.chroma .vc{color:teal}.chroma .vg{color:teal}.chroma .vi{color:teal}.chroma .vm{}.chroma .l{}.chroma .ld{}.chroma .s{color:#d14}.chroma .sa{color:#d14}.chroma .sb{color:#d14}.chroma .sc{color:#d14}.chroma .dl{color:#d14}.chroma .sd{color:#d14}.chroma .s2{color:#d14}.chroma .se{color:#d14}.chroma .sh{color:#d14}.chroma .si{color:#d14}.chroma .sx{color:#d14}.chroma .sr{color:#009926}.chroma .s1{color:#d14}.chroma .ss{color:#990073}.chroma .m{color:#099}.chroma .mb{color:#099}.chroma .mf{color:#099}.chroma .mh{color:#099}.chroma .mi{color:#099}.chroma .il{color:#099}.chroma .mo{color:#099}.chroma .o{color:#000;font-weight:700}.chroma .ow{color:#000;font-weight:700}.chroma .p{}.chroma .c{color:#998;font-style:italic}.chroma .ch{color:#998;font-style:italic}.chroma .cm{color:#998;font-style:italic}.chroma .c1{color:#998;font-style:italic}.chroma .cs{color:#999;font-weight:700;font-style:italic}.chroma .cp{color:#999;font-weight:700;font-style:italic}.chroma .cpf{color:#999;font-weight:700;font-style:italic}.chroma .g{}.chroma .gd{color:#000;background-color:#fdd}.chroma .ge{color:#000;font-style:italic}.chroma .gr{color:#a00}.chroma .gh{color:#999}.chroma .gi{color:#000;background-color:#dfd}.chroma .go{color:#888}.chroma .gp{color:#555}.chroma .gs{font-weight:700}.chroma .gu{color:#aaa}.chroma .gt{color:#a00}.chroma .gl{text-decoration:underline}.chroma .w{color:#bbb}.dark.chroma{color:#f8f8f2;background-color:#272822}.dark .chroma{color:#f8f8f2;background-color:#272822}.dark .chroma .x{}.dark .chroma .err{color:#960050;background-color:#1e0010}.dark .chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.dark .chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.dark .chroma .hl{display:block;width:100%;background-color:#ffc}.dark .chroma .lnt{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.dark .chroma .ln{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.dark .chroma .k{color:#66d9ef}.dark .chroma .kc{color:#66d9ef}.dark .chroma .kd{color:#66d9ef}.dark .chroma .kn{color:#f92672}.dark .chroma .kp{color:#66d9ef}.dark .chroma .kr{color:#66d9ef}.dark .chroma .kt{color:#66d9ef}.dark .chroma .n{}.dark .chroma .na{color:#a6e22e}.dark .chroma .nb{}.dark .chroma .bp{}.dark .chroma .nc{color:#a6e22e}.dark .chroma .no{color:#66d9ef}.dark .chroma .nd{color:#a6e22e}.dark .chroma .ni{}.dark .chroma .ne{color:#a6e22e}.dark .chroma .nf{color:#a6e22e}.dark .chroma .fm{}.dark .chroma .nl{}.dark .chroma .nn{}.dark .chroma .nx{color:#a6e22e}.dark .chroma .py{}.dark .chroma .nt{color:#f92672}.dark .chroma .nv{}.dark .chroma .vc{}.dark .chroma .vg{}.dark .chroma .vi{}.dark .chroma .vm{}.dark .chroma .l{color:#ae81ff}.dark .chroma .ld{color:#e6db74}.dark .chroma .s{color:#e6db74}.dark .chroma .sa{color:#e6db74}.dark .chroma .sb{color:#e6db74}.dark .chroma .sc{color:#e6db74}.dark .chroma .dl{color:#e6db74}.dark .chroma .sd{color:#e6db74}.dark .chroma .s2{color:#e6db74}.dark .chroma .se{color:#ae81ff}.dark .chroma .sh{color:#e6db74}.dark .chroma .si{color:#e6db74}.dark .chroma .sx{color:#e6db74}.dark .chroma .sr{color:#e6db74}.dark .chroma .s1{color:#e6db74}.dark .chroma .ss{color:#e6db74}.dark .chroma .m{color:#ae81ff}.dark .chroma .mb{color:#ae81ff}.dark .chroma .mf{color:#ae81ff}.dark .chroma .mh{color:#ae81ff}.dark .chroma .mi{color:#ae81ff}.dark .chroma .il{color:#ae81ff}.dark .chroma .mo{color:#ae81ff}.dark .chroma .o{color:#f92672}.dark .chroma .ow{color:#f92672}.dark .chroma .p{}.dark .chroma .c{color:#75715e}.dark .chroma .ch{color:#75715e}.dark .chroma .cm{color:#75715e}.dark .chroma .c1{color:#75715e}.dark .chroma .cs{color:#75715e}.dark .chroma .cp{color:#75715e}.dark .chroma .cpf{color:#75715e}.dark .chroma .g{}.dark .chroma .gd{color:#f92672}.dark .chroma .ge{font-style:italic}.dark .chroma .gr{}.dark .chroma .gh{}.dark .chroma .gi{color:#a6e22e}.dark .chroma .go{}.dark .chroma .gp{}.dark .chroma .gs{font-weight:700}.dark .chroma .gu{color:#75715e}.dark .chroma .gt{}.dark .chroma .gl{}.dark .chroma .w{}</style><script>localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"></head><body><nav><div class="container flex flex-wrap items-center justify-between mx-auto max-w-6xl h-12 px-6"><div class="flex items-center justify-start justify-self-start"><div class="flex nav-item h-12 w-12 items-center justify-center"><a class=text-white href=https://aakinshin.net/><svg class="fai w-6 h-6"><use xlink:href="/img/fa/all.svg#house-chimney"/></svg></a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/posts/>Posts</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/about/>About</a></div></div><button id=theme-toggle type=button class="nav-item p-3 content-center justify-self-end"><svg id="theme-toggle-dark-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001.0 1010.586 10.586z"/></svg><svg id="theme-toggle-light-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1A1 1 0 119 4V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707A1 1 0 1113.536 5.05l.707-.707a1 1 0 011.414.0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707A1 1 0 004.343 5.757l.707.707zm1.414 8.486-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"/></svg></button></div></nav><div class="main container mx-auto max-w-6xl px-6"><div class=main-post><h1 class=blog-post-title id=post-title>Sfakianakis-Verginis quantile estimator</h1><div class="flex flex-wrap justify-start items-center"><svg class="fai"><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2021-03-09>March 9, 2021</time><svg class="fai ml-3"><use xlink:href="/img/fa/all.svg#tag"/></svg>
<a class=label-link href=https://aakinshin.net/tags/mathematics/>Mathematics</a>
<a class=label-link href=https://aakinshin.net/tags/statistics/>Statistics</a>
<a class=label-link href=https://aakinshin.net/tags/research/>Research</a>
<a class=label-link href=https://aakinshin.net/tags/quantile/>Quantile</a></div><br><div class=main-content><p>There are dozens of different ways to estimate quantiles.
One of these ways is to use the Sfakianakis-Verginis quantile estimator.
To be more specific, it&rsquo;s a family of three estimators.
If we want to estimate the <span class="math inline">\(p^\textrm{th}\)</span> quantile of sample <span class="math inline">\(X\)</span>,
we can use one of the following equations:</p><p><span class="math display">\[\begin{split}
\operatorname{SV1}_p =&
\frac{B_0}{2} \big( X_{(1)}+X_{(2)}-X_{(3)} \big) +
\sum_{i=1}^{n} \frac{B_i+B_{i-1}}{2} X_{(i)} +
\frac{B_n}{2} \big(- X_{(n-2)}+X_{(n-1)}-X_{(n)} \big),\\
\operatorname{SV2}_p =& \sum_{i=1}^{n} B_{i-1} X_{(i)} + B_n \cdot \big(2X_{(n)} - X_{(n-1)}\big),\\
\operatorname{SV3}_p =& \sum_{i=1}^n B_i X_{(i)} + B_0 \cdot \big(2X_{(1)}-X_{(2)}\big).
\end{split}
\]</span></p><p>where <span class="math inline">\(B_i = B(i; n, p)\)</span> is probability mass function of the binomial distribution <span class="math inline">\(B(n, p)\)</span>,
<span class="math inline">\(X_{(i)}\)</span> are order statistics of sample <span class="math inline">\(X\)</span>.</p><p>In this post, I derive these equations following the paper
<a href=https://doi.org/10.1080/03610910701790491>&ldquo;A new family of nonparametric quantile estimators&rdquo;</a> (2008)
by Michael E. Sfakianakis and Dimitris G. Verginis.
Also, I add some additional explanations,
reconstruct missing steps,
simplify the final equations,
and provide reference implementations in C# and R.</p><h3 id=preparation>Preparation</h3><p>Consider sample <span class="math inline">\(X = \{ X_1, X_2, \ldots, X_n \}\)</span> (<span class="math inline">\(n \geq 3\)</span>).
Let <span class="math inline">\(X_{(1)}, X_{(2)}, \ldots, X_{(n)}\)</span> be the order statistics of this sample
(<span class="math inline">\(X_{(k)}\)</span> is the <span class="math inline">\(k^\textrm{th}\)</span> smallest element).
Now let&rsquo;s build the following intervals:</p><p><span class="math display">\[S_0 = \big(L, X_{(1)} \big),\;
S_1 = \big[X_{(1)}, X_{(2)} \big),
\ldots,
S_{n-1} = \big[X_{(n-1)},X_{n} \big),\;
S_{(n)} = \big[X_{(n)}, U \big)
\]</span></p><p>where <span class="math inline">\(L\)</span> and <span class="math inline">\(U\)</span> are lower and upper bounds for <span class="math inline">\(X\)</span> values (<span class="math inline">\(L\)</span> and <span class="math inline">\(U\)</span> could be equal to <span class="math inline">\(-\infty\)</span> and <span class="math inline">\(\infty\)</span>).</p><div class=row><div class=mx-auto><a href=/posts/sfakianakis-verginis-quantile-estimator/img/segments.png target=_blank alt=segments><img class="mx-auto d-block img-fluid" width=800 src=/posts/sfakianakis-verginis-quantile-estimator/img/segments.png></a></div></div><br><p>We want to estimate <span class="math inline">\(p^\textrm{th}\)</span> quantile <span class="math inline">\(Q_p\)</span>.
Obviously, <span class="math inline">\(Q_p\)</span> should belong to one of the <span class="math inline">\(S_i\)</span> intervals (because they cover all possible <span class="math inline">\(Q_p\)</span> values).
With the help of <span class="math inline">\(Q_p\)</span>, we can introduce variables <span class="math inline">\(\delta_i\)</span>:</p><p><span class="math display">\[\delta_i =
\begin{cases}
1 & \textrm{if}\; X_i \leq Q_p,\\
0 & \textrm{if}\; X_i > Q_p.
\end{cases}
\]</span></p><p>Since <span class="math inline">\(Q_p\)</span> is the <span class="math inline">\(p^\textrm{th}\)</span> quantile,
the probability of <span class="math inline">\((X_i \leq Q_p)\)</span> is <span class="math inline">\(p\)</span> and
the probability of <span class="math inline">\((X_i > Q_p)\)</span> is <span class="math inline">\(1-p\)</span>.
Thus, <span class="math inline">\(\delta_i\)</span> belongs to the <a href=https://en.wikipedia.org/wiki/Bernoulli_distribution>bernoulli distribution</a>:
<span class="math inline">\(\delta_i \sim \textrm{Bernoulli}(p)\)</span>.</p><p>Next, consider the sum of <span class="math inline">\(\delta_i\)</span> values:</p><p><span class="math display">\[N = \delta_1 + \delta_2 + \ldots + \delta_{n-1} + \delta_n.
\]</span></p><p>Since <span class="math inline">\(\delta_i\)</span> are independent variables from the Bernoulli distribution,
their sum belongs to the <a href=https://en.wikipedia.org/wiki/Binomial_distribution>binomial distribution</a>:
<span class="math inline">\(N \sim \textrm{Binomial(n, p)}\)</span>.
Now we can get the probability of <span class="math inline">\(Q_p \in S_i\)</span>:</p><p><span class="math display">\[P(Q_p \in S_i) = P(N = i) = B(i; n, p) = {n \choose k} p^k (1-p)^{(n-k)}.
\]</span></p><p>Let <span class="math inline">\(Q'_{p,i}\)</span> be a point estimator of <span class="math inline">\(Q_p\)</span> conditioned on the event <span class="math inline">\(Q_p \in S_i\)</span>.
With the help of <span class="math inline">\(Q'_{p,i}\)</span>, we could introduce the Sfakianakis-Verginis quantile estimator:</p><p><span class="math display">\[\operatorname{SV}_p = \operatorname{E}(Q'_p) = \sum_{i=0}^n P(Q_p \in S_i) \cdot Q'_{p,i}.
\]</span></p><p>There are three variations of the Sfakianakis-Verginis quantile estimator depending on the definition of <span class="math inline">\(Q'_{p,i}\)</span>.</p><h3 id=sv1>SV1</h3><p>The first approach assumes that the <span class="math inline">\(p^\textrm{th}\)</span> quantile is in the middle of the <span class="math inline">\(i^\textrm{th}\)</span> segment:</p><p><span class="math display">\[Q'_{p,i} = \frac{X_{(i)}+X_{(i+1)}}{2}\quad \textrm{for}\;\; i=1..n-1.
\]</span></p><p>If we don&rsquo;t know values of <span class="math inline">\(L\)</span> and <span class="math inline">\(U\)</span>, we need a way to define <span class="math inline">\(Q'_{p,i}\)</span> for <span class="math inline">\(i=0\)</span> and <span class="math inline">\(i=n\)</span>.
The author suggests using these assumptions:</p><p><span class="math display">\[Q'_{p,0}-Q'_{p,1} = Q'_{p,1} - Q'_{p,2}; \quad Q'_{p,n} - Q'_{p,n-1} = Q'_{p,n-1}-Q'_{p,n-2}.
\]</span></p><p>Thus, we have:</p><p><span class="math display">\[\begin{split}
Q'_{p,0} = & 2Q'_{p,1} - Q'_{p,2}
&= 2 \frac{X_{(1)}+X_{(2)}}{2} - \frac{X_{(2)}+X_{(3)}}{2}
&= \frac{2X_{(1)}+X_{(2)}-X_{(3)}}{2},\\
Q'_{p,n} = & 2Q'_{p,n-1} - Q'_{p,n-2}
&= 2 \frac{X_{(n-1)}+X_{(n)}}{2} - \frac{X_{(n-2)}+X_{(n-1)}}{2}
&= \frac{2X_{(n)}+X_{(n-1)}-X_{(n-2)}}{2}.
\end{split}
\]</span></p><p>Now we can start deriving <span class="math inline">\(\operatorname{SV1}_p\)</span>:</p><p><span class="math display">\[\begin{split}
\operatorname{SV1}_p
& = \operatorname{E}(Q'_{p,i}) = \sum_{i=0}^n P(Q_p \in S_i) \cdot Q'_{p,i} = \\
& = \sum_{i=0}^n B(i;n,p) Q'_{p,i} = \\
& = B(0;n,p) Q'_{p,0} + \sum_{i=1}^{n-1} B(i;n,p) Q'_{p,i} + B(n;n,p) Q'_{p,n} \\
\end{split}
\]</span></p><p>It gives us the following expression:</p><p><span class="math display">\[\begin{split}
\operatorname{SV1}_p =
B(0;n,p) \frac{2X_{(1)}+X_{(2)}-X_{(3)}}{2} +
B(1;n,p) \frac{X_{(1)}+X_{(2)}}{2} +
B(2;n,p) \frac{X_{(2)}+X_{(3)}}{2} + \ldots + \\+
B(n-2;n,p) \frac{X_{(n-2)}+X_{(n-1)}}{2} +
B(n-1;n,p) \frac{X_{(n-1)}+X_{(n)}}{2} +
B(n;n,p) \frac{2X_{(n)}+X_{(n-1)}-X_{(n-2)}}{2}.
\end{split}
\]</span></p><p>By regrouping the equation members, we get the final result from the paper:</p><p><span class="math display">\[\begin{split}
\operatorname{SV1}_p =
& \frac{2B(0;n,p)+B(1;n,p)}{2} X_{(1)} + \frac{B(0;n,p)}{2}X_{(2)} - \frac{B(0;n,p)}{2}X_{(3)}\\
& +\sum_{i=2}^{n-1} \frac{B(i;n,p)+B(i-1;n,p)}{2} X_{(i)} \\
& -\frac{B(n;n,p)}{2} X_{(n-2)} + \frac{B(n;n,p)}{2} X_{(n-1)} + \frac{2B(n;n,p)+B(n-1;n,p)}{2}X_{(n)}
\end{split}
\]</span></p><h3 id=sv2>SV2</h3><p>The second approach assumes that the <span class="math inline">\(p^\textrm{th}\)</span> quantile is in the right endpoint of the <span class="math inline">\(i^\textrm{th}\)</span> segment:</p><p><span class="math display">\[Q'_{p,i} = X_{(i+1)}\quad \textrm{for}\;\; i=0..n-1.
\]</span></p><p>To get the value of <span class="math inline">\(Q'_{p,n}\)</span>, we use an assumption from the <span class="math inline">\(\operatorname{SV1}_p\)</span> section:</p><p><span class="math display">\[Q'_{p,n} - Q'_{p,n-1} = Q'_{p,n-1}-Q'_{p,n-2}
\]</span></p><p>which can be transformed to</p><p><span class="math display">\[Q'_{p,n} = 2Q'_{p,n-1} - Q'_{p,n-2} = 2X_{(n)} - X_{(n-1)}.
\]</span></p><p>Using <span class="math inline">\(\operatorname{SV2}_p = \sum_{i=0}^n B(i;n,p) Q'_{p,i}\)</span>, we get:</p><p><span class="math display">\[\operatorname{SV2}_p = \sum_{i=0}^{n-1} B(i;n,p) X_{(i+1)} + (2X_{(n)} - X_{(n-1)}) B(n;n,p)
\]</span></p><h3 id=sv3>SV3</h3><p>The third approach assumes that the <span class="math inline">\(p^\textrm{th}\)</span> quantile is in the left endpoint of the <span class="math inline">\(i^\textrm{th}\)</span> segment:</p><p><span class="math display">\[Q'_{p,i} = X_{(i)}\quad \textrm{for}\;\; i=1..n.
\]</span></p><p>To get the value of <span class="math inline">\(Q'_{p,0}\)</span>, we use an assumption from the <span class="math inline">\(\operatorname{SV1}_p\)</span> section:</p><p><span class="math display">\[Q'_{p,0}-Q'_{p,1} = Q'_{p,1} - Q'_{p,2}
\]</span></p><p>which can be transformed to</p><p><span class="math display">\[Q'_{p,0} = 2Q'_{p,1} - Q'_{p,2} = 2X_{(1)}-X_{(2)}.
\]</span></p><p>Using <span class="math inline">\(\operatorname{SV3}_p = \sum_{i=0}^n B(i;n,p) Q'_{p,i}\)</span>, we get:</p><p><span class="math display">\[\operatorname{SV3}_p = \sum_{i=1}^n B(i;n,p) X_{(i)} + (2X_{(1)}-X_{(2)}) B(0;n,p)
\]</span></p><h3 id=simplification>Simplification</h3><p>In my opinion, the above equations (that match the original paper) are too bulky.
Let&rsquo;s simplify them!
We can notice that we work with the same Binomial distribution <span class="math inline">\(B(n, p)\)</span>.
What the point of writing the arguments <span class="math inline">\(n\)</span> and <span class="math inline">\(p\)</span> each time?
This just makes it difficult to read the equation!
(If you read the original paper, you may notice that the authors are also confused with this notation;
sometimes they write <span class="math inline">\(B(i;p,n)\)</span> or <span class="math inline">\(B(i;p)\)</span> instead of <span class="math inline">\(B(i;n,p)\)</span>.)
Let&rsquo;s denote <span class="math inline">\(B(i;p,n)\)</span> as <span class="math inline">\(B_i\)</span>:</p><p><span class="math display">\[B_i = B(i;p,n).
\]</span></p><p>Now we could rewrite the first equation in a shorter form:</p><p><span class="math display">\[\begin{split}
SV1_p = & \frac{2B_0+B_1}{2}X_{(1)} + \frac{B_0}{2} X_{(2)} - \frac{B_0}{2} X_{(3)}\\
& + \sum_{i=2}^{n-1} \frac{B_i+B_{i-1}}{2} X_{(i)}\\
& -\frac{B_n}{2} X_{(n-2)} + \frac{B_n}{2} X _{(n-1)} + \frac{2B_n + B_{n-1}}{2} X_{(n)}
\end{split}
\]</span></p><p>Currently, the sum part <span class="math inline">\(\sum_{i=2}^{n-1} \frac{B_i+B_{i-1}}{2} X_{(i)}\)</span> enumerates <span class="math inline">\(i\)</span> from <span class="math inline">\(2\)</span> to <span class="math inline">\(n-1\)</span>.
The part could &ldquo;absorb&rdquo; the <span class="math inline">\(\frac{B_i+B_{i-1}}{2} X_{(i)}\)</span> expression for <span class="math inline">\(i=1\)</span> and for <span class="math inline">\(i=n\)</span> from other members of the equation:</p><p><span class="math display">\[\operatorname{SV1}_p =
\frac{B_0}{2} \big( X_{(1)}+X_{(2)}-X_{(3)} \big) +
\sum_{i=1}^{n} \frac{B_i+B_{i-1}}{2} X_{(i)} +
\frac{B_n}{2} \big(- X_{(n-2)}+X_{(n-1)}-X_{(n)} \big)
\]</span></p><p>In the second equation, we could adjust indexes and enumerate <span class="math inline">\(i\)</span> in range <span class="math inline">\(1..n\)</span> instead of <span class="math inline">\(0..(n-1)\)</span>
(to make it consistent with the first and the third equations):</p><p><span class="math display">\[\operatorname{SV2}_p = \sum_{i=1}^{n} B_{i-1} X_{(i)} + B_n \cdot \big(2X_{(n)} - X_{(n-1)}\big)
\]</span></p><p>In the third equation, we should just replace <span class="math inline">\(B(i;p,n)\)</span> by <span class="math inline">\(B_i\)</span>:</p><p><span class="math display">\[\operatorname{SV3}_p = \sum_{i=1}^n B_i X_{(i)} + B_0 \cdot \big(2X_{(1)}-X_{(2)}\big)
\]</span></p><h3 id=reference-implementation>Reference implementation</h3><p>If you use R, here is the function that you can use in your scripts:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=n>sv1quantile</span> <span class=o>&lt;-</span> <span class=nf>function</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>probs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>n</span> <span class=o>&lt;-</span> <span class=nf>length</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nf>if </span><span class=p>(</span><span class=n>n</span> <span class=o>&lt;=</span> <span class=m>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>return</span><span class=p>(</span><span class=nf>quantile</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>probs</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=n>x</span> <span class=o>&lt;-</span> <span class=nf>sort</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nf>sapply</span><span class=p>(</span><span class=n>probs</span><span class=p>,</span> <span class=nf>function</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>B</span> <span class=o>&lt;-</span> <span class=nf>function</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=nf>dbinom</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>B</span><span class=p>(</span><span class=m>0</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>x[1]</span> <span class=o>+</span> <span class=n>x[2]</span> <span class=o>-</span> <span class=n>x[3]</span><span class=p>)</span> <span class=o>/</span> <span class=m>2</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>      <span class=nf>sum</span><span class=p>(</span><span class=nf>sapply</span><span class=p>(</span><span class=m>1</span><span class=o>:</span><span class=n>n</span><span class=p>,</span> <span class=nf>function</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=p>(</span><span class=nf>B</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=o>+</span> <span class=nf>B</span><span class=p>(</span><span class=n>i</span> <span class=o>-</span> <span class=m>1</span><span class=p>))</span> <span class=o>*</span> <span class=n>x[i]</span> <span class=o>/</span> <span class=m>2</span><span class=p>))</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>      <span class=nf>B</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=o>-</span><span class=n>x[n</span><span class=m>-2</span><span class=n>]</span> <span class=o>+</span> <span class=n>x[n</span><span class=m>-1</span><span class=n>]</span> <span class=o>+</span> <span class=n>x[n]</span><span class=p>)</span> <span class=o>/</span> <span class=m>2</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>sv2quantile</span> <span class=o>&lt;-</span> <span class=nf>function</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>probs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>n</span> <span class=o>&lt;-</span> <span class=nf>length</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nf>if </span><span class=p>(</span><span class=n>n</span> <span class=o>&lt;=</span> <span class=m>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>return</span><span class=p>(</span><span class=nf>quantile</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>probs</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=n>x</span> <span class=o>&lt;-</span> <span class=nf>sort</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nf>sapply</span><span class=p>(</span><span class=n>probs</span><span class=p>,</span> <span class=nf>function</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>B</span> <span class=o>&lt;-</span> <span class=nf>function</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=nf>dbinom</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>sum</span><span class=p>(</span><span class=nf>sapply</span><span class=p>(</span><span class=m>1</span><span class=o>:</span><span class=n>n</span><span class=p>,</span> <span class=nf>function</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=nf>B</span><span class=p>(</span><span class=n>i</span> <span class=o>-</span> <span class=m>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>x[i]</span><span class=p>))</span> <span class=o>+</span> <span class=nf>B</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=m>2</span> <span class=o>*</span> <span class=n>x[n]</span> <span class=o>-</span> <span class=n>x[n</span> <span class=o>-</span> <span class=m>1</span><span class=n>]</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>sv3quantile</span> <span class=o>&lt;-</span> <span class=nf>function</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>probs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>n</span> <span class=o>&lt;-</span> <span class=nf>length</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nf>if </span><span class=p>(</span><span class=n>n</span> <span class=o>&lt;=</span> <span class=m>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>return</span><span class=p>(</span><span class=nf>quantile</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>probs</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=n>x</span> <span class=o>&lt;-</span> <span class=nf>sort</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nf>sapply</span><span class=p>(</span><span class=n>probs</span><span class=p>,</span> <span class=nf>function</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>B</span> <span class=o>&lt;-</span> <span class=nf>function</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=nf>dbinom</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>sum</span><span class=p>(</span><span class=nf>sapply</span><span class=p>(</span><span class=m>1</span><span class=o>:</span><span class=n>n</span><span class=p>,</span> <span class=nf>function</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=nf>B</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=o>*</span> <span class=n>x[i]</span><span class=p>))</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>      <span class=nf>B</span><span class=p>(</span><span class=m>0</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=m>2</span> <span class=o>*</span> <span class=n>x[1]</span> <span class=o>-</span> <span class=n>x[2]</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>If you use C#, you can take an implementation from
the latest nightly version (0.3.0-nightly.90+) of <a href=https://github.com/AndreyAkinshin/perfolizer>Perfolizer</a>
(you need <code>SfakianakisVerginis1QuantileEstimator</code>, <code>SfakianakisVerginis2QuantileEstimator</code>, <code>SfakianakisVerginis3QuantileEstimator</code>).</p><h3 id=conclusion>Conclusion</h3><p>The Sfakianakis-Verginis quantile estimator is an interesting way to estimate quantiles.
In this post, we briefly described the idea and looked at the estimator equations.
In future posts, we compare the efficiency of the suggested approach with other quantile estimators.</p><h3 id=references>References</h3><ul><li><b id=Sfakianakis2008>[Sfakianakis2008]</b><br>Sfakianakis, Michael E., and Dimitris G. Verginis. &ldquo;A new family of nonparametric quantile estimators.&rdquo; Communications in Statistics—Simulation and Computation® 37, no. 2 (2008): 337-345.<br><a href=https://doi.org/10.1080/03610910701790491>https://doi.org/10.1080/03610910701790491</a></li></ul></div><br><br><div class="flex flex-wrap justify-center items-center mb-5"><span>Share:</span><div class="text-4xl pl-3"><a href="https://www.reddit.com/submit?url=https%3a%2f%2faakinshin.net%2fposts%2fsfakianakis-verginis-quantile-estimator%2f&title=Sfakianakis-Verginis%20quantile%20estimator" target=_blank title="Share on Reddit"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#reddit"/></svg></a></div><div class="text-4xl pl-3"><a href="https://twitter.com/intent/tweet?text=Sfakianakis-Verginis%20quantile%20estimator&url=https%3a%2f%2faakinshin.net%2fposts%2fsfakianakis-verginis-quantile-estimator%2f&via=andrey_akinshin&related=andrey_akinshin" rel=nofollow target=_blank title="Share on Twitter"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></div><div class="text-4xl pl-3"><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2faakinshin.net%2fposts%2fsfakianakis-verginis-quantile-estimator%2f" target=_blank title="Share on HackerNews"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#hacker-news"/></svg></a></div><div class="text-4xl pl-3"><a href="https://getpocket.com/save?url=https%3a%2f%2faakinshin.net%2fposts%2fsfakianakis-verginis-quantile-estimator%2f&title=Sfakianakis-Verginis%20quantile%20estimator" target=_blank title="Add to Pocket"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#get-pocket"/></svg></a></div></div></div></div><script>var themeToggleDarkIcon=document.getElementById("theme-toggle-dark-icon"),themeToggleBtn,themeToggleLightIcon=document.getElementById("theme-toggle-light-icon");const imagesDark=document.querySelectorAll(".img-dark"),imagesLight=document.querySelectorAll(".img-light");localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(themeToggleLightIcon.classList.remove("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")})):(themeToggleDarkIcon.classList.remove("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")})),themeToggleBtn=document.getElementById("theme-toggle"),themeToggleBtn.addEventListener("click",function(){themeToggleDarkIcon.classList.toggle("hidden"),themeToggleLightIcon.classList.toggle("hidden"),imagesLight.forEach(e=>{e.classList.toggle("hidden")}),imagesDark.forEach(e=>{e.classList.toggle("hidden")}),localStorage.getItem("color-theme")?localStorage.getItem("color-theme")==="light"?(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"))})</script><footer class="z-20 p-4 md:p-6 mt-3 w-full border-t border-gray-200 shadow flex items-center justify-center dark:border-gray-600 bg-white dark:bg-zinc-800"><span class="dark:text-gray-400 text-center">© 2013—2022 Andrey Akinshin</span><ul class="flex flex-wrap items-center px-4 mb-1"><li><a href=https://github.com/AndreyAkinshin><svg class="fai fai-link w-5 h-5"><title>GitHub</title><use xlink:href="/img/fa/all.svg#github"/></svg></a></li><li><a href=https://twitter.com/andrey_akinshin><svg class="fai fai-link w-5 h-5"><title>Twitter</title><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></li><li><a href=https://aakinshin.net/posts/index.xml><svg class="fai fai-link w-5 h-5"><title>RSS</title><use xlink:href="/img/fa/all.svg#rss"/></svg></a></li></ul><div class=main-content><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.1/anchor.min.js integrity="sha512-zPB79j2C+3sFS9zcA3vg/z6bVKzJVEyu9pY5w89akQRys76zpAT2t6S3wZKla3QQ14O5l/Yt0RUQ/DHXx82Y5g==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>anchors.options={placement:"left",icon:"§"},anchors.add("h1"),anchors.add("h2"),anchors.add("h3")</script><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script></body></html>