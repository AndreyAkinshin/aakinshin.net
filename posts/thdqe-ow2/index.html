<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.103.0-DEV"><meta name=author content="Andrey Akinshin"><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content="Mathematics,Statistics,Research,Optimal window of the trimmed Harrell-Davis quantile estimator,Research: Building trimmed Harrell-Davis quantile estimator"><title>Optimal window of the trimmed Harrell-Davis quantile estimator, Part 2: Trying Planck-taper window | Andrey Akinshin</title><meta name=description content="In the previous post, I discussed the problem of non-smooth quantile-respectful density estimation (QRDE) which is generated by the trimmed Harrell-Davis q..."><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><script>localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><link href=https://aakinshin.net/css/main.min.13341ac97e21004cde7f286e6b392a1234aa8b2656426c008cfd9f98cd200dd1.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"></head><body><nav><div class="container flex flex-wrap items-center justify-between mx-auto max-w-6xl h-12 px-6"><div class="flex items-center justify-start justify-self-start"><div class="flex nav-item h-12 w-12 items-center justify-center"><a class=text-white href=https://aakinshin.net/><svg class="fai w-5 h-5 pr-0 mb-0.5"><use xlink:href="/img/fa/all.svg#house-chimney"/></svg></a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/posts/>Posts</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/research/>Research</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/about/>About</a></div></div><button id=theme-toggle type=button class="nav-item p-3 content-center justify-self-end"><svg id="theme-toggle-dark-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001.0 1010.586 10.586z"/></svg><svg id="theme-toggle-light-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1A1 1 0 119 4V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707A1 1 0 1113.536 5.05l.707-.707a1 1 0 011.414.0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707A1 1 0 004.343 5.757l.707.707zm1.414 8.486-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"/></svg></button></div></nav><div class="main container mx-auto max-w-6xl px-6"><div class=main-post><h1 class=blog-post-title id=post-title>Optimal window of the trimmed Harrell-Davis quantile estimator, Part 2: Trying Planck-taper window</h1><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2021-10-12>October 12, 2021</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/mathematics/>Mathematics</a>
<a class=label-link href=https://aakinshin.net/tags/statistics/>Statistics</a>
<a class=label-link href=https://aakinshin.net/tags/research/>Research</a>
<a class=label-link href=https://aakinshin.net/tags/optimal-window-of-the-trimmed-harrell-davis-quantile-estimator/>Optimal window of the trimmed Harrell-Davis quantile estimator</a>
<a class=label-link href=https://aakinshin.net/tags/research-thdqe/>Research: Building trimmed Harrell-Davis quantile estimator</a></div></div><br><div class="main-content mb-3 px-2 py-1 rounded border text-alert-text-l border-alert-frame-l dark:text-alert-text-d dark:border-alert-frame-d">Update: this blog post is a part of research that aimed to build a statistically efficient and robust quantile estimator. A <a href=/posts/pub-thdqe/>paper with final results</a> is available in <em>Communications in Statistics - Simulation and Computation</em> (DOI: <a href=https://www.tandfonline.com/doi/abs/10.1080/03610918.2022.2050396>10.1080/03610918.2022.2050396</a>). A preprint is available on arXiv: <a href=https://arxiv.org/abs/2111.11776>arXiv:2111.11776 [stat.ME]</a>. Some information in this blog post can be obsolete: please, use the official paper as the primary reference.</div><div class=main-content><p>In the <a href=https://aakinshin.net/posts/thdqe-ow1/>previous post</a>,
I discussed the problem of non-smooth quantile-respectful density estimation (QRDE)
which is generated by the trimmed Harrell-Davis quantile estimator
based on the highest density interval of the given width.
I assumed that non-smoothness was caused by a non-smooth rectangular window
which was used to build the truncated beta distribution.
In this post, we are going to try another option: the Planck-taper window.</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/thdqe-ow2/img/qrde-light.png target=_blank alt=qrde><img src=/posts/thdqe-ow2/img/qrde-light.png width=800></a>
<a class="img-dark hidden" href=/posts/thdqe-ow2/img/qrde-dark.png target=_blank alt=qrde><img src=/posts/thdqe-ow2/img/qrde-dark.png width=800></a></div><p>All posts from this series:</p><ul><li><a href=https://aakinshin.net/posts/thdqe-ow1/>Optimal window of the trimmed Harrell-Davis quantile estimator, Part 1: Problems with the rectangular window</a> <i>(October 5, 2021)</i></li><li><a href=https://aakinshin.net/posts/thdqe-ow2/>Optimal window of the trimmed Harrell-Davis quantile estimator, Part 2: Trying Planck-taper window</a> <i>(October 12, 2021)</i></li></ul><h3 id=planck-taper-window>Planck-taper window</h3><p>The Planck-taper window on <span class="math inline">\([0;1]\)</span> could be expressed using the following function:</p><p><span class="math display">\[h_\varepsilon(x) = \begin{cases}
0, & \textrm{for }\, x = 0,\\
\big( 1+e^{\frac{\varepsilon}{x} - \frac{\varepsilon}{\varepsilon - x}} \big)^{-1}, & \textrm{for }\, 0 < x < \varepsilon,\\
1, & \textrm{for }\, \varepsilon \leq x \leq 1 - \varepsilon,\\
\big( 1+e^{\frac{\varepsilon}{1 - x} - \frac{\varepsilon}{\varepsilon - (1 - x)}} \big)^{-1}, & \textrm{for }\, 1 - \varepsilon < x < 1,\\
0, & \textrm{for }\, x = 1.\\
\end{cases}
\]</span></p><p>Here is an example of such function for <span class="math inline">\(\varepsilon = 0.1\)</span>:</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/thdqe-ow2/img/ptw-light.png target=_blank alt=ptw><img src=/posts/thdqe-ow2/img/ptw-light.png width=800></a>
<a class="img-dark hidden" href=/posts/thdqe-ow2/img/ptw-dark.png target=_blank alt=ptw><img src=/posts/thdqe-ow2/img/ptw-dark.png width=800></a></div><h3 id=planck-taper-powered-trimmed-harrell-davis-quantile-estimator>Planck-taper-powered trimmed Harrell-Davis quantile estimator</h3><p>In the <a href=https://aakinshin.net/posts/thdqe-ow1/>previous post</a>,
we discussed how to build a trimmed Harrell-Davis quantile estimator using a rectangular window.
The suggested approach is based on the multiplication of
the probability density function of the Beta distribution <span class="math inline">\(f_{\operatorname{HD}}\)</span>
(which is used in the classic Harrell-Davis quantile estimator)
and the rectangular window <span class="math inline">\(f_{\operatorname{rw}}\)</span>:</p><p><span class="math display">\[f_{\operatorname{HD}}(x) = \frac{x^{\alpha - 1} (1 - x)^{\beta - 1}}{\operatorname{B}(\alpha, \beta)}.
\]</span></p><p><span class="math display">\[f_{\operatorname{rw}}(x) = \begin{cases}
0, & \textrm{if }\, x < L,\\
1, & \textrm{if }\, L \leq x \leq R,\\
0, & \textrm{if }\, R < x.\\
\end{cases}
\]</span></p><p><span class="math display">\[f_{\operatorname{THD/rw}}(x) = \dfrac{f_{\operatorname{HD}}(x) \cdot f_{\operatorname{rw}}(x)}{
\int_0^1 f_{\operatorname{HD}}(u) \cdot f_{\operatorname{rw}}(u) du}
\]</span></p><p><span class="math display">\[F_{\operatorname{THD/rw}}(x) = \int_0^x f_{\operatorname{THD/rw}}(t) dt
\]</span></p><p>This time, we are going to use the same procedure for the following multiplier function based on the Planck-taper window:</p><p><span class="math display">\[f_{\operatorname{ptw}}(x) = \begin{cases}
0, & \textrm{if }\, x < L,\\
h_\varepsilon((x - L) / (R - L)), & \textrm{if }\, L \leq x \leq R,\\
0, & \textrm{if }\, R < x.\\
\end{cases}
\]</span></p><p><span class="math display">\[f_{\operatorname{THD/ptw}}(x) = \dfrac{f_{\operatorname{HD}}(x) \cdot f_{\operatorname{ptw}}(x)}{
\int_0^1 f_{\operatorname{HD}}(u) \cdot f_{\operatorname{ptw}}(u) du}
\]</span></p><p><span class="math display">\[F_{\operatorname{THD/ptw}}(x) = \int_0^x f_{\operatorname{THD/ptw}}(t) dt
\]</span></p><h2 id=simulation-results>Simulation results</h2><p>I have tried multiple combinations of sample sizes, <span class="math inline">\(\varepsilon\)</span> values, and trimming percentage values.
In most cases, the Planck-taper-powered estimator gives quantile-respectful density estimation that
<em>a little bit</em> smoother than the estimation in the rectangular window case.</p><p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/thdqe-ow2/img/qrde-light.png target=_blank alt=qrde><img src=/posts/thdqe-ow2/img/qrde-light.png width=800></a>
<a class="img-dark hidden" href=/posts/thdqe-ow2/img/qrde-dark.png target=_blank alt=qrde><img src=/posts/thdqe-ow2/img/qrde-dark.png width=800></a></div><em>(Quantile estimator based on the Planck-taper window is denoted as <code>THD-SQRT*</code>)</em></p><h2 id=discussion>Discussion</h2><p>It seems that we can&rsquo;t obtain smooth density estimation using trimmed quantile estimators regardless of the window form.
Here is the intuition behind the density estimation discontinuous points (that looks like steps).
Imagine that we slowly change the probability <span class="math inline">\(p\)</span> of the target quantile from <span class="math inline">\(0\)</span> to <span class="math inline">\(1\)</span>
and build the corresponding density function values.
Each <span class="math inline">\(p\)</span> value gives us the <span class="math inline">\([L;R]\)</span> interval which defines the set of order statistics that are actually used to build
the quantile estimation.
While we change <span class="math inline">\(p\)</span> from <span class="math inline">\(0\)</span> to <span class="math inline">\(1\)</span>, we also change <span class="math inline">\([L;R]\)</span> from <span class="math inline">\([0;w]\)</span> to <span class="math inline">\([1-w;1]\)</span> where <span class="math inline">\(w\)</span> is the interval width.
When the <span class="math inline">\([L;R]\)</span> interval crosses a border between two order statistics, it starts to cover another sample element.
If the gap between these two order statistics is huge, we could observe a density functions step
<em>regardless</em> of the smoothness of <span class="math inline">\(W_i(p)\)</span>.
Using different window functions, we could improve smoothness <em>a little bit</em>, but it seems to be impossible
to get rid of steps completely.
Apparently, this is the price of estimator robustness.</p></div><br><br><div class="flex flex-wrap justify-center items-center">The source code of this post and all the relevant files are&nbsp;<a href=https://github.com/AndreyAkinshin/aakinshin.net/tree/master/content/en/posts/2021/10/thdqe-ow2/index.md>available on GitHub</a>.</div><div class="flex flex-wrap justify-center items-center mb-5"><span>Share:</span><div class="text-4xl pl-3"><a href="https://www.reddit.com/submit?url=https%3a%2f%2faakinshin.net%2fposts%2fthdqe-ow2%2f&title=Optimal%20window%20of%20the%20trimmed%20Harrell-Davis%20quantile%20estimator%2c%20Part%202%3a%20Trying%20Planck-taper%20window" target=_blank title="Share on Reddit"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#reddit"/></svg></a></div><div class="text-4xl pl-3"><a href="https://twitter.com/intent/tweet?text=Optimal%20window%20of%20the%20trimmed%20Harrell-Davis%20quantile%20estimator%2c%20Part%202%3a%20Trying%20Planck-taper%20window&url=https%3a%2f%2faakinshin.net%2fposts%2fthdqe-ow2%2f&via=andrey_akinshin&related=andrey_akinshin" rel=nofollow target=_blank title="Share on Twitter"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></div><div class="text-4xl pl-3"><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2faakinshin.net%2fposts%2fthdqe-ow2%2f" target=_blank title="Share on HackerNews"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#hacker-news"/></svg></a></div><div class="text-4xl pl-3"><a href="https://getpocket.com/save?url=https%3a%2f%2faakinshin.net%2fposts%2fthdqe-ow2%2f&title=Optimal%20window%20of%20the%20trimmed%20Harrell-Davis%20quantile%20estimator%2c%20Part%202%3a%20Trying%20Planck-taper%20window" target=_blank title="Add to Pocket"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#get-pocket"/></svg></a></div></div></div></div><script>var themeToggleDarkIcon=document.getElementById("theme-toggle-dark-icon"),themeToggleBtn,themeToggleLightIcon=document.getElementById("theme-toggle-light-icon");const imagesDark=document.querySelectorAll(".img-dark"),imagesLight=document.querySelectorAll(".img-light");localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(themeToggleLightIcon.classList.remove("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")})):(themeToggleDarkIcon.classList.remove("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")})),themeToggleBtn=document.getElementById("theme-toggle"),themeToggleBtn.addEventListener("click",function(){themeToggleDarkIcon.classList.toggle("hidden"),themeToggleLightIcon.classList.toggle("hidden"),imagesLight.forEach(e=>{e.classList.toggle("hidden")}),imagesDark.forEach(e=>{e.classList.toggle("hidden")}),localStorage.getItem("color-theme")?localStorage.getItem("color-theme")==="light"?(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"))})</script><footer class="z-20 p-4 md:p-6 mt-3 w-full border-t border-gray-200 shadow flex items-center justify-center dark:border-gray-600 bg-white dark:bg-zinc-800"><span class="dark:text-gray-400 text-center">© 2013—2023 <span class=whitespace-nowrap>Andrey Akinshin</span></span><ul class="flex flex-wrap items-center px-4 mb-1"><li><a href=https://github.com/AndreyAkinshin><svg class="fai fai-link w-5 h-5"><title>GitHub</title><use xlink:href="/img/fa/all.svg#github"/></svg></a></li><li><a href=https://twitter.com/andrey_akinshin><svg class="fai fai-link w-5 h-5"><title>Twitter</title><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></li><li><a href=https://aakinshin.net/posts/index.xml><svg class="fai fai-link w-5 h-5"><title>RSS</title><use xlink:href="/img/fa/all.svg#rss"/></svg></a></li></ul><div class=main-content><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></div></footer><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script></body></html>