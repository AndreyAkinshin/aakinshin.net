<!doctype html><html lang=en class=h-100><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.74.3"><meta name=author content="Andrey Akinshin"><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content=".NET,C#,Internals"><title>Blittable types | Andrey Akinshin</title><meta name=description content="Challenge of the day: what will the following code display?
[StructLayout(LayoutKind.Explicit)] public struct UInt128 { [FieldOffset(0)] public ulong Value..."><link href=/css/lumen-bootstrap.min.css theme=light rel=stylesheet type=text/css media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><link href=/css/slate-bootstrap.min.css theme=dark rel=stylesheet type=text/css media="(prefers-color-scheme: dark)"><link href=/css/syntax-light.css theme=light rel=stylesheet type=text/css media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><link href=/css/syntax-dark.css theme=dark rel=stylesheet type=text/css media="(prefers-color-scheme: dark)"><script src=https://aakinshin.net/js/theme-before.min.26d61b7027fe55e642f0001cef94cb75b567d721086492aab6b4e32d9ee7811d.js></script><script type=module src=https://aakinshin.net/js/dark-mode-toggle.min.882998740b9c4c24677576b997bde5a487246e2e3bd72128a0e922eaa59db029.mjs></script><link href=https://aakinshin.net/css/fontawesome-all.min.50da8736f05b35aac9691de67fe993cbe01b7d88fcf0cb682c3a8f39933fe4a3.css rel=stylesheet type=text/css media=all><link href=https://aakinshin.net/css/about.min.2a76db7cc14055b3bafacc363f453917ab54a818a7db2a0a9b2409c0f6bf07c5.css rel=stylesheet type=text/css media=all><link href=https://aakinshin.net/css/blog.min.fe41ce51781393cea2f6a8fd3567674242dd6203d0a0b62f852fb257e992a236.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZVB6MXSX32"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-ZVB6MXSX32');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-41419012-5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-41419012-5');</script><script type=text/javascript>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym");ym(28700916,"init",{clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src=https://mc.yandex.ru/watch/28700916 style=position:absolute;left:-9999px alt></div></noscript><script src=/js/jquery-3.3.1.slim.min.js></script></head><body><div class=bg-primary><div class="container bg-primary"><nav class="navbar navbar-expand-sm navbar-dark bg-primary"><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link id=nav-link-blog href=https://aakinshin.net/><i class="fas fa-home" title=Home style=color:#fff></i></a></li><li class=nav-item><a class=nav-link id=nav-link-posts href=https://aakinshin.net/posts/>Posts</a></li><li class=nav-item><a class=nav-link id=nav-link-about href=https://aakinshin.net/about/>About</a></li><li class=nav-item><a class=nav-link id=nav-link-pdnb href=https://aakinshin.net/prodotnetbenchmarking/>Pro .NET Benchmarking</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" data-toggle=dropdown href=# role=button aria-haspopup=true aria-expanded=false>EN</a><div class=dropdown-menu><a class=dropdown-item href=https://aakinshin.net/ru/posts/blittable/>RU</a></div></li></ul><ul class="navbar-nav ml-auto"><li class=nav-item><dark-mode-toggle permanent=true></dark-mode-toggle></li></ul></nav></div></div><div class=container><main id=main><div class=blog-main><div class=blog-post><h1 class=blog-post-title id=post-title>Blittable types</h1><span class=blog-post-meta><div class=faicon><i class="far fa-calendar-alt"></i></div><time datetime=2015-11-26>November 26, 2015</time>
&nbsp;&nbsp;
<i class="fas fa-tag"></i>&nbsp;
<a href=https://aakinshin.net/tags/dotnet/ class="badge badge-info">.NET</a>
<a href=https://aakinshin.net/tags/cs/ class="badge badge-info">C#</a>
<a href=https://aakinshin.net/tags/internals/ class="badge badge-info">Internals</a></span><br><br><p>Challenge of the day: what will the following code display?</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=na>[StructLayout(LayoutKind.Explicit)]</span>
<span class=k>public</span> <span class=k>struct</span> <span class=nc>UInt128</span>
<span class=p>{</span>
<span class=na>    [FieldOffset(0)]</span>
    <span class=k>public</span> <span class=kt>ulong</span> <span class=n>Value1</span><span class=p>;</span>
<span class=na>    [FieldOffset(8)]</span>
    <span class=k>public</span> <span class=kt>ulong</span> <span class=n>Value2</span><span class=p>;</span>
<span class=p>}</span>
<span class=na>[StructLayout(LayoutKind.Sequential)]</span>
<span class=k>public</span> <span class=k>struct</span> <span class=nc>MyStruct</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=n>UInt128</span> <span class=n>UInt128</span><span class=p>;</span>
    <span class=k>public</span> <span class=kt>char</span> <span class=n>Char</span><span class=p>;</span>
<span class=p>}</span>
<span class=k>class</span> <span class=nc>Program</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=k>static</span> <span class=k>unsafe</span> <span class=k>void</span> <span class=n>Main</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=kt>var</span> <span class=n>myStruct</span> <span class=p>=</span> <span class=k>new</span> <span class=n>MyStruct</span><span class=p>();</span>
        <span class=kt>var</span> <span class=n>baseAddress</span> <span class=p>=</span> <span class=p>(</span><span class=kt>int</span><span class=p>)&amp;</span><span class=n>myStruct</span><span class=p>;</span>
        <span class=kt>var</span> <span class=n>uInt128Adress</span> <span class=p>=</span> <span class=p>(</span><span class=kt>int</span><span class=p>)&amp;</span><span class=n>myStruct</span><span class=p>.</span><span class=n>UInt128</span><span class=p>;</span>
        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>uInt128Adress</span> <span class=p>-</span> <span class=n>baseAddress</span><span class=p>);</span>
        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>Marshal</span><span class=p>.</span><span class=n>OffsetOf</span><span class=p>(</span><span class=k>typeof</span><span class=p>(</span><span class=n>MyStruct</span><span class=p>),</span> <span class=s>&#34;UInt128&#34;</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>A hint: two zeros or two another same values are wrong answers in the general case. The following table shows the console output on different runtimes:</p><table><tr><th></th><th>MS.NET-x86</th><th>MS.NET-x64</th><th>Mono</th></tr><tr><td>uInt128Adress - baseAddress</td><td>4</td><td>8</td><td>0</td></tr><tr><td>Marshal.OffsetOf(typeof(MyStruct), "UInt128")</td><td>0</td><td>0</td><td>0</td></tr></table><p>If you want to know why it happens, you probably should learn some useful information about blittable types.</p><h3 id=theory>Theory</h3><p>There is a definition of <a href=https://en.wikipedia.org/wiki/Blittable_types>blittable types</a> from Wikipedia:</p><blockquote><p>Blittable types are data types in software applications which have a unique characteristic. Data are often represented in memory differently in managed and unmanaged code in the Microsoft .NET framework. However, blittable types are defined as having an identical presentation in memory for both environments, and can be directly shared. Understanding the difference between blittable and non-blittable types can aid in using COM Interop or P/Invoke, two techniques for interoperability in .NET applications.</p></blockquote><p>If you want to marshall your structures, it is very important to know: is your type blittable or not. Indeed, marshalling will be easier, if your data in memory has a proper representation for marshalling. Furthermore, there are situations when you can use only blittable types. For example:</p><ul><li>Structures that are returned from platform invoke calls must be blittable types.</li><li>As an optimization, arrays of blittable types and classes that contain only blittable members are pinned instead of copied during marshaling.</li></ul><p>Let&rsquo;s discuss it in detail: which types are blittable and what does it depend?</p><p>First of all, we should know about the following attribute: <a href=https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.structlayoutattribute.aspx>System.Runtime.InteropServices.StructLayoutAttribute</a>, it lets you control the physical layout of the data fields of a class or structure in memory. You can use <a href=https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.layoutkind.aspx>3 following values</a> of <code>LayoutKind</code>:</p><ul><li><code>Auto</code>: The runtime automatically chooses an appropriate layout for the members of an object in unmanaged memory. Objects defined with this enumeration member cannot be exposed outside of managed code. Attempting to do so generates an exception.</li><li><code>Explicit</code>: The precise position of each member of an object in unmanaged memory is explicitly controlled, subject to the setting of the StructLayoutAttribute.Pack field. Each member must use the FieldOffsetAttribute to indicate the position of that field within the type.</li><li><code>Sequential</code>: The members of the object are laid out sequentially, in the order in which they appear when exported to unmanaged memory. The members are laid out according to the packing specified in StructLayoutAttribute.Pack, and can be noncontiguous.</li></ul><p>Two last values (<code>Explicit</code> and <code>Sequential</code>) are also called Formatted because they define the fields order for marshalling. C# uses <code>Sequential</code> as default.</p><h3 id=blittable-types>Blittable types</h3><p>It is very important to know, which types are blittable. We have the following groups of blittable types:</p><ul><li>Some primitive types: <a href=https://msdn.microsoft.com/en-us/library/system.byte.aspx>System.Byte</a>, <a href=https://msdn.microsoft.com/en-us/library/system.sbyte.aspx>System.SByte</a>, <a href=https://msdn.microsoft.com/en-us/library/system.int16.aspx>System.Int16</a>, <a href=https://msdn.microsoft.com/en-us/library/system.uint16.aspx>System.UInt16</a>, <a href=https://msdn.microsoft.com/en-us/library/system.int32.aspx>System.Int32</a>, <a href=https://msdn.microsoft.com/en-us/library/system.uint32.aspx>System.UInt32</a>, <a href=https://msdn.microsoft.com/en-us/library/system.int64.aspx>System.Int64</a>, <a href=https://msdn.microsoft.com/en-us/library/system.uint64.aspx>System.UInt64</a>, <a href=https://msdn.microsoft.com/en-us/library/system.intptr.aspx>System.IntPtr</a>, <a href=https://msdn.microsoft.com/en-us/library/system.uintptr.aspx>System.UIntPtr</a>, <a href=https://msdn.microsoft.com/en-us/library/system.single.aspx>System.Single</a>, <a href=https://msdn.microsoft.com/en-us/library/system.double.aspx>System.Double</a>.</li><li>One-dimensional arrays of blittable types, such as an array of integers. However, a type that contains a variable array of blittable types is not itself blittable.</li><li>Formatted value types that contain only blittable types (and classes if they are marshaled as formatted types).</li></ul><h3 id=non-blittable-types>Non-Blittable Types</h3><p>There are several non-blittable types which we should discussed in detail.</p><h4 id=decimal>Decimal</h4><p>Yep, <a href=https://msdn.microsoft.com/en-us/library/system.decimal.aspx>Decimal</a> is not a blittable type. If you want to use it as a blittable, you probably should write a wrapper (based on the <a href=http://stackoverflow.com/a/30217247/184842>method</a> by Hans Passant, see <a href=http://stackoverflow.com/questions/30213132/why-is-decimal-data-type-non-blittable>Why is “decimal” data type non-blittable?</a>):</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=k>public</span> <span class=k>struct</span> <span class=nc>BlittableDecimal</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=kt>long</span> <span class=n>longValue</span><span class=p>;</span>

    <span class=k>public</span> <span class=kt>decimal</span> <span class=n>Value</span>
    <span class=p>{</span>
        <span class=k>get</span> <span class=p>{</span> <span class=k>return</span> <span class=kt>decimal</span><span class=p>.</span><span class=n>FromOACurrency</span><span class=p>(</span><span class=n>longValue</span><span class=p>);</span> <span class=p>}</span>
        <span class=k>set</span> <span class=p>{</span> <span class=n>longValue</span> <span class=p>=</span> <span class=kt>decimal</span><span class=p>.</span><span class=n>ToOACurrency</span><span class=p>(</span><span class=k>value</span><span class=p>);</span> <span class=p>}</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>static</span> <span class=k>explicit</span> <span class=k>operator</span> <span class=n>BlittableDecimal</span><span class=p>(</span><span class=kt>decimal</span> <span class=k>value</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>BlittableDecimal</span> <span class=p>{</span> <span class=n>Value</span> <span class=p>=</span> <span class=k>value</span> <span class=p>};</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>static</span> <span class=k>implicit</span> <span class=k>operator</span> <span class=kt>decimal</span> <span class=p>(</span><span class=n>BlittableDecimal</span> <span class=k>value</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=k>value</span><span class=p>.</span><span class=n>Value</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h4 id=datetime>DateTime</h4><p>An interesting fact: <a href=https://msdn.microsoft.com/en-us/library/system.datetime.aspx>DateTime</a> contains a single <code>UInt64</code> field, but the LayoutKind <a href=http://referencesource.microsoft.com/#mscorlib/system/datetime.cs,55>explicitly set</a> to <code>Auto</code>:</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=na>[StructLayout(LayoutKind.Auto)]</span>
<span class=na>[Serializable]</span>
<span class=k>public</span> <span class=k>struct</span> <span class=nc>DateTime</span> <span class=p>:</span> 
  <span class=n>IComparable</span><span class=p>,</span> <span class=n>IFormattable</span><span class=p>,</span> <span class=n>IConvertible</span><span class=p>,</span> <span class=n>ISerializable</span><span class=p>,</span> <span class=n>IComparable</span><span class=p>&lt;</span><span class=n>DateTime</span><span class=p>&gt;,</span><span class=n>IEquatable</span><span class=p>&lt;</span><span class=n>DateTime</span><span class=p>&gt;</span> <span class=p>{</span>
    
    <span class=c1>// ...
</span><span class=c1></span>                    
    <span class=c1>// The data is stored as an unsigned 64-bit integeter
</span><span class=c1></span>    <span class=c1>//   Bits 01-62: The value of 100-nanosecond ticks where 0 represents 1/1/0001 12:00am, up until the value
</span><span class=c1></span>    <span class=c1>//               12/31/9999 23:59:59.9999999
</span><span class=c1></span>    <span class=c1>//   Bits 63-64: A four-state value that describes the DateTimeKind value of the date time, with a 2nd
</span><span class=c1></span>    <span class=c1>//               value for the rare case where the date time is local, but is in an overlapped daylight
</span><span class=c1></span>    <span class=c1>//               savings time hour and it is in daylight savings time. This allows distinction of these
</span><span class=c1></span>    <span class=c1>//               otherwise ambiguous local times and prevents data loss when round tripping from Local to
</span><span class=c1></span>    <span class=c1>//               UTC time.
</span><span class=c1></span>    <span class=k>private</span> <span class=n>UInt64</span> <span class=n>dateData</span><span class=p>;</span>
    
    <span class=c1>// ...
</span><span class=c1></span><span class=p>}</span>
</code></pre></div><p>It means that <code>DateTime</code> is a non-blittable type. Thus, if you have a value type with a <code>DateTime</code> field, your types will be also non-blittable. Such behaviour has historical causes and confuses some people, see: <a href=http://stackoverflow.com/questions/21881554/why-does-the-system-datetime-struct-have-layout-kind-auto>Why does the System.DateTime struct have layout kind Auto?</a>, <a href=http://stackoverflow.com/questions/4132533/why-does-layoutkind-sequential-work-differently-if-a-struct-contains-a-datetime>Why does LayoutKind.Sequential work differently if a struct contains a DateTime field?</a> (I recommend to read <a href=http://stackoverflow.com/a/21883421/184842>this answer</a> by Hans Passant).</p><p>Of course, you can write a blittable wrapper like follows:</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=k>public</span> <span class=k>struct</span> <span class=nc>BlittableDateTime</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=kt>long</span> <span class=n>ticks</span><span class=p>;</span>

    <span class=k>public</span> <span class=n>DateTime</span> <span class=n>Value</span>
    <span class=p>{</span>
        <span class=k>get</span> <span class=p>{</span> <span class=k>return</span> <span class=k>new</span> <span class=n>DateTime</span><span class=p>(</span><span class=n>ticks</span><span class=p>);</span> <span class=p>}</span>
        <span class=k>set</span> <span class=p>{</span> <span class=n>ticks</span> <span class=p>=</span> <span class=k>value</span><span class=p>.</span><span class=n>Ticks</span><span class=p>;</span> <span class=p>}</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>static</span> <span class=k>explicit</span> <span class=k>operator</span> <span class=n>BlittableDateTime</span><span class=p>(</span><span class=n>DateTime</span> <span class=k>value</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>BlittableDateTime</span> <span class=p>{</span> <span class=n>Value</span> <span class=p>=</span> <span class=k>value</span> <span class=p>};</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>static</span> <span class=k>implicit</span> <span class=k>operator</span> <span class=n>DateTime</span><span class=p>(</span><span class=n>BlittableDateTime</span> <span class=k>value</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=k>value</span><span class=p>.</span><span class=n>Value</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h4 id=guid>Guid</h4><p>Of course, you know about the <a href=https://msdn.microsoft.com/en-us/library/system.guid.aspx>Guid</a> type. But do you know about its internal representation? Let&rsquo;s look to <a href=http://referencesource.microsoft.com/#mscorlib/system/guid.cs,30>the source code</a>:</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=k>private</span> <span class=kt>int</span>         <span class=n>_a</span><span class=p>;</span>
<span class=k>private</span> <span class=kt>short</span>       <span class=n>_b</span><span class=p>;</span>
<span class=k>private</span> <span class=kt>short</span>       <span class=n>_c</span><span class=p>;</span>
<span class=k>private</span> <span class=kt>byte</span>       <span class=n>_d</span><span class=p>;</span>
<span class=k>private</span> <span class=kt>byte</span>       <span class=n>_e</span><span class=p>;</span>
<span class=k>private</span> <span class=kt>byte</span>       <span class=n>_f</span><span class=p>;</span>
<span class=k>private</span> <span class=kt>byte</span>       <span class=n>_g</span><span class=p>;</span>
<span class=k>private</span> <span class=kt>byte</span>       <span class=n>_h</span><span class=p>;</span>
<span class=k>private</span> <span class=kt>byte</span>       <span class=n>_i</span><span class=p>;</span>
<span class=k>private</span> <span class=kt>byte</span>       <span class=n>_j</span><span class=p>;</span>
<span class=k>private</span> <span class=kt>byte</span>       <span class=n>_k</span><span class=p>;</span>

<span class=c1>// Creates a new guid from an array of bytes.
</span><span class=c1></span><span class=k>public</span> <span class=n>Guid</span><span class=p>(</span><span class=kt>byte</span><span class=p>[]</span> <span class=n>b</span><span class=p>)</span>
<span class=p>{</span>
    <span class=c1>// Some checks ...
</span><span class=c1></span>
    <span class=n>_a</span> <span class=p>=</span> <span class=p>((</span><span class=kt>int</span><span class=p>)</span><span class=n>b</span><span class=p>[</span><span class=m>3</span><span class=p>]</span> <span class=p>&lt;&lt;</span> <span class=m>24</span><span class=p>)</span> <span class=p>|</span> <span class=p>((</span><span class=kt>int</span><span class=p>)</span><span class=n>b</span><span class=p>[</span><span class=m>2</span><span class=p>]</span> <span class=p>&lt;&lt;</span> <span class=m>16</span><span class=p>)</span> <span class=p>|</span> <span class=p>((</span><span class=kt>int</span><span class=p>)</span><span class=n>b</span><span class=p>[</span><span class=m>1</span><span class=p>]</span> <span class=p>&lt;&lt;</span> <span class=m>8</span><span class=p>)</span> <span class=p>|</span> <span class=n>b</span><span class=p>[</span><span class=m>0</span><span class=p>];</span>
    <span class=n>_b</span> <span class=p>=</span> <span class=p>(</span><span class=kt>short</span><span class=p>)(((</span><span class=kt>int</span><span class=p>)</span><span class=n>b</span><span class=p>[</span><span class=m>5</span><span class=p>]</span> <span class=p>&lt;&lt;</span> <span class=m>8</span><span class=p>)</span> <span class=p>|</span> <span class=n>b</span><span class=p>[</span><span class=m>4</span><span class=p>]);</span>
    <span class=n>_c</span> <span class=p>=</span> <span class=p>(</span><span class=kt>short</span><span class=p>)(((</span><span class=kt>int</span><span class=p>)</span><span class=n>b</span><span class=p>[</span><span class=m>7</span><span class=p>]</span> <span class=p>&lt;&lt;</span> <span class=m>8</span><span class=p>)</span> <span class=p>|</span> <span class=n>b</span><span class=p>[</span><span class=m>6</span><span class=p>]);</span>
    <span class=n>_d</span> <span class=p>=</span> <span class=n>b</span><span class=p>[</span><span class=m>8</span><span class=p>];</span>
    <span class=n>_e</span> <span class=p>=</span> <span class=n>b</span><span class=p>[</span><span class=m>9</span><span class=p>];</span>
    <span class=n>_f</span> <span class=p>=</span> <span class=n>b</span><span class=p>[</span><span class=m>10</span><span class=p>];</span>
    <span class=n>_g</span> <span class=p>=</span> <span class=n>b</span><span class=p>[</span><span class=m>11</span><span class=p>];</span>
    <span class=n>_h</span> <span class=p>=</span> <span class=n>b</span><span class=p>[</span><span class=m>12</span><span class=p>];</span>
    <span class=n>_i</span> <span class=p>=</span> <span class=n>b</span><span class=p>[</span><span class=m>13</span><span class=p>];</span>
    <span class=n>_j</span> <span class=p>=</span> <span class=n>b</span><span class=p>[</span><span class=m>14</span><span class=p>];</span>
    <span class=n>_k</span> <span class=p>=</span> <span class=n>b</span><span class=p>[</span><span class=m>15</span><span class=p>];</span>
<span class=p>}</span>
</code></pre></div><p>It is interesting. If we open <a href=https://en.wikipedia.org/wiki/Globally_unique_identifier>wikipedia</a>, we can find the following table:</p><table><tr><th>Bits</th><th>Bytes</th><th>Name</th><th>Endianness (Microsoft GUID Structure)</th><th>Endianness (RFC 4122)</th></tr><tr><td>32</td><td>4</td><td>Data1</td><td>Native</td><td>Big</td></tr><tr><td>16</td><td>2</td><td>Data2</td><td>Native</td><td>Big</td></tr><tr><td>16</td><td>2</td><td>Data3</td><td>Native</td><td>Big</td></tr><tr><td>64</td><td>8</td><td>Data4</td><td>Big</td><td>Big</td></tr></table><p>GUID has the following Type library representation:</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=k>typedef</span> <span class=k>struct</span> <span class=n>tagGUID</span> <span class=p>{</span>
    <span class=n>DWORD</span> <span class=n>Data1</span><span class=p>;</span>
    <span class=n>WORD</span>  <span class=n>Data2</span><span class=p>;</span>
    <span class=n>WORD</span>  <span class=n>Data3</span><span class=p>;</span>
    <span class=n>BYTE</span>  <span class=n>Data4</span><span class=p>[</span> <span class=mi>8</span> <span class=p>];</span>
<span class=p>}</span> <span class=n>GUID</span><span class=p>;</span>
</code></pre></div><p>It is very important that internal representation of GUID is depend on platform. If you work with the little-endian architecture (you likely uses exactly little-endian, see <a href=https://en.wikipedia.org/wiki/Endianness>Endianness</a>), the GUID representation will differ from RFC 4122. It can create some troubles during interop with another application (for example, <a href=http://docs.oracle.com/javase/8/docs/api/java/util/UUID.html>Java UUID</a> uses RFC 4122).</p><h4 id=char>Char</h4><p><a href=https://msdn.microsoft.com/en-us/library/system.char.aspx>Char</a> is also non-blittable type, it can be converted to <code>Unicode</code> or <code>ANSI</code> character. The marshalling type depends on <a href=https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.charset.aspx>CharSet</a> of <code>StructLayout</code>, which can be equal to one of the following values: <code>Auto</code>, <code>Ansi</code>, <code>Unicode</code>. On the modern versions of Windows, <code>Auto</code> resolves to <code>Unicode</code>, but on Windows 98 and Windows Me <code>Auto</code> resolves to <code>Ansi</code>. The C# compiler uses <code>Ansi</code> as default that makes char a non-blittable type. However, we can write the following wrapper and solve the problem:</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=na>[StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]</span>
<span class=k>public</span> <span class=k>struct</span> <span class=nc>BlittableChar</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=kt>char</span> <span class=n>Value</span><span class=p>;</span>

    <span class=k>public</span> <span class=k>static</span> <span class=k>explicit</span> <span class=k>operator</span> <span class=n>BlittableChar</span><span class=p>(</span><span class=kt>char</span> <span class=k>value</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>BlittableChar</span> <span class=p>{</span> <span class=n>Value</span> <span class=p>=</span> <span class=k>value</span> <span class=p>};</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>static</span> <span class=k>implicit</span> <span class=k>operator</span> <span class=kt>char</span> <span class=p>(</span><span class=n>BlittableChar</span> <span class=k>value</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=k>value</span><span class=p>.</span><span class=n>Value</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h4 id=boolean>Boolean</h4><p>MSDN <a href=https://msdn.microsoft.com/en-us/library/75dwhxf7.aspx>says</a> the following phrase about <a href=https://msdn.microsoft.com/en-us/library/system.boolean.aspx>Boolean</a>:</p><blockquote><p>Converts to a 1, 2, or 4-byte value with true as 1 or -1.</p></blockquote><p>Let&rsquo;s write one more wrapper and make blittable bool:</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=k>public</span> <span class=k>struct</span> <span class=nc>BlittableBoolean</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=kt>byte</span> <span class=n>byteValue</span><span class=p>;</span>

    <span class=k>public</span> <span class=kt>bool</span> <span class=n>Value</span>
    <span class=p>{</span>
        <span class=k>get</span> <span class=p>{</span> <span class=k>return</span> <span class=n>Convert</span><span class=p>.</span><span class=n>ToBoolean</span><span class=p>(</span><span class=n>byteValue</span><span class=p>);</span> <span class=p>}</span>
        <span class=k>set</span> <span class=p>{</span> <span class=n>byteValue</span> <span class=p>=</span> <span class=n>Convert</span><span class=p>.</span><span class=n>ToByte</span><span class=p>(</span><span class=k>value</span><span class=p>);</span> <span class=p>}</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>static</span> <span class=k>explicit</span> <span class=k>operator</span> <span class=n>BlittableBoolean</span><span class=p>(</span><span class=kt>bool</span> <span class=k>value</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>BlittableBoolean</span> <span class=p>{</span> <span class=n>Value</span> <span class=p>=</span> <span class=k>value</span> <span class=p>};</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>static</span> <span class=k>implicit</span> <span class=k>operator</span> <span class=kt>bool</span> <span class=p>(</span><span class=n>BlittableBoolean</span> <span class=k>value</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=k>value</span><span class=p>.</span><span class=n>Value</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h3 id=blittable-or-non-blittable>Blittable or Non-Blittable?</h3><p>Sometimes it is useful to know, is your type blittable or not. How we can do it? Recall that we can&rsquo;t allocate pinned instances of non-blittable type. So, we can write the following helper class for our aim (based on the <a href=http://stackoverflow.com/a/31485271/184842>method by IllidanS4</a>, see <a href=http://stackoverflow.com/questions/10574645/the-fastest-way-to-check-if-a-type-is-blittable>The fastest way to check if a type is blittable?</a>):</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=k>public</span> <span class=k>static</span> <span class=k>class</span> <span class=nc>BlittableHelper</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=k>static</span> <span class=kt>bool</span> <span class=n>IsBlittable</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;()</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=n>IsBlittableCache</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;.</span><span class=n>Value</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>static</span> <span class=kt>bool</span> <span class=n>IsBlittable</span><span class=p>(</span><span class=k>this</span> <span class=n>Type</span> <span class=n>type</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>type</span><span class=p>.</span><span class=n>IsArray</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=kt>var</span> <span class=n>elem</span> <span class=p>=</span> <span class=n>type</span><span class=p>.</span><span class=n>GetElementType</span><span class=p>();</span>
            <span class=k>return</span> <span class=n>elem</span><span class=p>.</span><span class=n>IsValueType</span> <span class=p>&amp;&amp;</span> <span class=n>IsBlittable</span><span class=p>(</span><span class=n>elem</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>try</span>
        <span class=p>{</span>
            <span class=kt>object</span> <span class=n>instance</span> <span class=p>=</span> <span class=n>FormatterServices</span><span class=p>.</span><span class=n>GetUninitializedObject</span><span class=p>(</span><span class=n>type</span><span class=p>);</span>
            <span class=n>GCHandle</span><span class=p>.</span><span class=n>Alloc</span><span class=p>(</span><span class=n>instance</span><span class=p>,</span> <span class=n>GCHandleType</span><span class=p>.</span><span class=n>Pinned</span><span class=p>).</span><span class=n>Free</span><span class=p>();</span>
            <span class=k>return</span> <span class=k>true</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=k>catch</span>
        <span class=p>{</span>
            <span class=k>return</span> <span class=k>false</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=k>private</span> <span class=k>static</span> <span class=k>class</span> <span class=nc>IsBlittableCache</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;</span>
    <span class=p>{</span>
        <span class=k>public</span> <span class=k>static</span> <span class=k>readonly</span> <span class=kt>bool</span> <span class=n>Value</span> <span class=p>=</span> <span class=n>IsBlittable</span><span class=p>(</span><span class=k>typeof</span><span class=p>(</span><span class=n>T</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>However, there is one type that broke our approach: decimal. Surprisingly, but you can allocate a pinned decimal. And you can&rsquo;t allocate a pinned instance of value types that contains decimal field (because decimal is non-blittable). I don&rsquo;t know other such types. So, we probably can write a hack in the <code>IsBlittable</code> method:</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=p>==</span> <span class=k>typeof</span><span class=p>(</span><span class=kt>decimal</span><span class=p>))</span>
    <span class=k>return</span> <span class=k>false</span><span class=p>;</span>
</code></pre></div><p>If you know a general solution, I&rsquo;ll be glad to discuss it.</p><h3 id=coreclr-sources>CoreCLR sources</h3><p>Nowadays, we have open source CoreCLR. So, we can look inside the runtime and find something interesting. An interesting file is <a href=https://github.com/dotnet/coreclr/blob/master/src/vm/fieldmarshaler.cpp#L283-L318>fieldmarshaler.cpp</a>, it contains the following lines:</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=k>if</span> <span class=p>(!(*</span><span class=n>pfDisqualifyFromManagedSequential</span><span class=p>))</span>
<span class=p>{</span>
    <span class=c1>// This type may qualify for ManagedSequential. Collect managed size and alignment info.
</span><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=n>CorTypeInfo</span><span class=p>::</span><span class=n>IsPrimitiveType</span><span class=p>(</span><span class=n>corElemType</span><span class=p>))</span>
    <span class=p>{</span>
        <span class=n>pfwalk</span><span class=p>-&gt;</span><span class=n>m_managedSize</span> <span class=p>=</span> <span class=p>((</span><span class=n>UINT32</span><span class=p>)</span><span class=n>CorTypeInfo</span><span class=p>::</span><span class=n>Size</span><span class=p>(</span><span class=n>corElemType</span><span class=p>));</span> <span class=c1>// Safe cast - no primitive type is larger than 4gb!
</span><span class=c1></span>        <span class=n>pfwalk</span><span class=p>-&gt;</span><span class=n>m_managedAlignmentReq</span> <span class=p>=</span> <span class=n>pfwalk</span><span class=p>-&gt;</span><span class=n>m_managedSize</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>corElemType</span> <span class=p>==</span> <span class=n>ELEMENT_TYPE_PTR</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>pfwalk</span><span class=p>-&gt;</span><span class=n>m_managedSize</span> <span class=p>=</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>LPVOID</span><span class=p>);</span>
        <span class=n>pfwalk</span><span class=p>-&gt;</span><span class=n>m_managedAlignmentReq</span> <span class=p>=</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>LPVOID</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>corElemType</span> <span class=p>==</span> <span class=n>ELEMENT_TYPE_VALUETYPE</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>TypeHandle</span> <span class=n>pNestedType</span> <span class=p>=</span> <span class=n>fsig</span><span class=p>.</span><span class=n>GetLastTypeHandleThrowing</span><span class=p>(</span><span class=n>ClassLoader</span><span class=p>::</span><span class=n>LoadTypes</span><span class=p>,</span>
                                                                <span class=n>CLASS_LOAD_APPROXPARENTS</span><span class=p>,</span>
                                                                <span class=n>TRUE</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>pNestedType</span><span class=p>.</span><span class=n>GetMethodTable</span><span class=p>()-&gt;</span><span class=n>IsManagedSequential</span><span class=p>())</span>
        <span class=p>{</span>
            <span class=n>pfwalk</span><span class=p>-&gt;</span><span class=n>m_managedSize</span> <span class=p>=</span> <span class=p>(</span><span class=n>pNestedType</span><span class=p>.</span><span class=n>GetMethodTable</span><span class=p>()-&gt;</span><span class=n>GetNumInstanceFieldBytes</span><span class=p>());</span>

            <span class=n>_ASSERTE</span><span class=p>(</span><span class=n>pNestedType</span><span class=p>.</span><span class=n>GetMethodTable</span><span class=p>()-&gt;</span><span class=n>HasLayout</span><span class=p>());</span> <span class=c1>// If it is ManagedSequential(), it also has Layout but doesn&#39;t hurt to check before we do a cast!
</span><span class=c1></span>            <span class=n>pfwalk</span><span class=p>-&gt;</span><span class=n>m_managedAlignmentReq</span> <span class=p>=</span> <span class=n>pNestedType</span><span class=p>.</span><span class=n>GetMethodTable</span><span class=p>()-&gt;</span><span class=n>GetLayoutInfo</span><span class=p>()-&gt;</span><span class=n>m_ManagedLargestAlignmentRequirementOfAllMembers</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=k>else</span>
        <span class=p>{</span>
            <span class=p>*</span><span class=n>pfDisqualifyFromManagedSequential</span> <span class=p>=</span> <span class=n>TRUE</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>else</span>
    <span class=p>{</span>
        <span class=c1>// No other type permitted for ManagedSequential.
</span><span class=c1></span>        <span class=p>*</span><span class=n>pfDisqualifyFromManagedSequential</span> <span class=p>=</span> <span class=n>TRUE</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h3 id=explanation-of-the-example>Explanation of the example</h3><p>Let&rsquo;s back to the first example from this post. Now we can understand why MS.NET shows different results. <code>Marshal.OffsetOf(typeof(MyStruct), "UInt128")</code> display «honest» marshalling offset (<code>0</code>). However, CLR does not guarantee anything about memory representation of our value types because it is not a blittable type:</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>BlittableHelper</span><span class=p>.</span><span class=n>IsBlittable</span><span class=p>&lt;</span><span class=n>MyStruct</span><span class=p>&gt;());</span> <span class=c1>// False
</span></code></pre></div><p>But now we know how to change the situation and make the result more predictable. Let&rsquo;s replace <code>char</code> by our wrapper:</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=na>[StructLayout(LayoutKind.Sequential)]</span>
<span class=k>public</span> <span class=k>struct</span> <span class=nc>MyStruct</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=n>UInt128</span> <span class=n>UInt128</span><span class=p>;</span>
    <span class=k>public</span> <span class=n>BlittableChar</span> <span class=n>Char</span><span class=p>;</span>
<span class=p>}</span>

<span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>uInt128Adress</span> <span class=p>-</span> <span class=n>baseAddress</span><span class=p>);</span> <span class=c1>// 0
</span><span class=c1></span><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>Marshal</span><span class=p>.</span><span class=n>OffsetOf</span><span class=p>(</span><span class=k>typeof</span><span class=p>(</span><span class=n>MyStruct</span><span class=p>),</span> <span class=s>&#34;UInt128&#34;</span><span class=p>));</span> <span class=c1>// 0
</span><span class=c1></span><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>BlittableHelper</span><span class=p>.</span><span class=n>IsBlittable</span><span class=p>&lt;</span><span class=n>MyStruct</span><span class=p>&gt;());</span> <span class=c1>// True
</span></code></pre></div><p>I don&rsquo;t recommend try to predict memory representation of your non-blittable types, it depends on big amount of different conditions. For example, the following modification of the example shows that non-blittable types can be represented in memory without field reordering:</p><div class=highlight><pre class=chroma><code class=language-cs data-lang=cs><span class=na>[StructLayout(LayoutKind.Sequential)]</span>
<span class=k>public</span> <span class=k>struct</span> <span class=nc>UInt128</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=kt>ulong</span> <span class=n>Value1</span><span class=p>;</span>
    <span class=k>public</span> <span class=kt>ulong</span> <span class=n>Value2</span><span class=p>;</span>
<span class=p>}</span>
<span class=na>[StructLayout(LayoutKind.Sequential)]</span>
<span class=k>public</span> <span class=k>struct</span> <span class=nc>MyStruct</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=n>UInt128</span> <span class=n>UInt128</span><span class=p>;</span>
    <span class=k>public</span> <span class=kt>char</span> <span class=n>Char</span><span class=p>;</span>
<span class=p>}</span>

<span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>uInt128Adress</span> <span class=p>-</span> <span class=n>baseAddress</span><span class=p>);</span> <span class=c1>// 0
</span><span class=c1></span><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>Marshal</span><span class=p>.</span><span class=n>OffsetOf</span><span class=p>(</span><span class=k>typeof</span><span class=p>(</span><span class=n>MyStruct</span><span class=p>),</span> <span class=s>&#34;UInt128&#34;</span><span class=p>));</span> <span class=c1>// 0
</span><span class=c1></span><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>BlittableHelper</span><span class=p>.</span><span class=n>IsBlittable</span><span class=p>&lt;</span><span class=n>MyStruct</span><span class=p>&gt;());</span> <span class=c1>// False
</span></code></pre></div><h3 id=nuget--github>NuGet & GitHub</h3><p>I pushed my blittable wrappers to GitHub and publish a NuGet package:</p><ul><li><a href=https://github.com/AndreyAkinshin/BlittableStructs>https://github.com/AndreyAkinshin/BlittableStructs</a></li><li><a href=https://www.nuget.org/packages/BlittableStructs/>https://www.nuget.org/packages/BlittableStructs/</a></li></ul><p>I hope, it will be useful for someone. If you have any good ideas about blittable wrappers, PRs are welcome.</p><h3 id=links>Links</h3><ul><li><a href=https://msdn.microsoft.com/en-us/library/75dwhxf7.aspx>MSDN: Blittable and Non-Blittable Types</a></li><li><a href=https://msdn.microsoft.com/en-us/library/zah6xy75.aspx>MSDN: Default Marshaling Behavior</a></li><li><a href=https://msdn.microsoft.com/en-us/library/s9ts558h.aspx>MSDN: Default Marshaling for Strings</a></li><li><a href=https://msdn.microsoft.com/en-us/library/7b93s42f.aspx>MSDN: Specifying a Character Set</a></li><li><a href=https://msdn.microsoft.com/en-us/library/cwe8bzh0.aspx>MSDN: Unicode and MBCS</a></li><li><a href=https://msdn.microsoft.com/en-us/library/23acw07k.aspx>MSDN: Copying and Pinning</a></li><li><a href=https://msdn.microsoft.com/library/y8ewk18b.aspx>MSDN: Marshal.OffsetOf</a></li><li><a href=https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.structlayoutattribute.aspx>MSDN: System.Runtime.InteropServices.StructLayoutAttribute</a></li><li><a href=https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.layoutkind.aspx>MSDN: System.Runtime.InteropServices.LayoutKind</a></li><li><a href=https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.structlayoutattribute.charset.aspx>MSDN: System.Runtime.InteropServices.StructLayoutAttribute.CharSet</a></li><li><a href=https://en.wikipedia.org/wiki/Globally_unique_identifier>Wikipedia: Globally unique identifier</a></li><li><a href=https://en.wikipedia.org/wiki/Universally_unique_identifier>Wikipedia: Universally unique identifier</a></li><li><a href=https://en.wikipedia.org/wiki/Endianness>Wikipedia: Endianness</a></li><li><a href=http://stackoverflow.com/questions/10574645/the-fastest-way-to-check-if-a-type-is-blittable>Stackoverflow: The fastest way to check if a type is blittable?</a></li><li><a href=http://stackoverflow.com/questions/11416433/marshalling-non-blittable-structs-from-c-sharp-to-c>Stackoverflow: Marshalling non-Blittable Structs from C# to C++</a></li><li><a href=http://stackoverflow.com/questions/30213132/why-is-decimal-data-type-non-blittable>Stackoverflow: Why is “decimal” data type non-blittable?</a></li><li><a href=http://stackoverflow.com/questions/15544818/non-blitable-error-on-a-blitable-type>Stackoverflow: Non-blitable error on a blitable type</a></li><li><a href=http://stackoverflow.com/questions/17510042/using-reflection-to-determine-how-a-net-type-is-layed-out-in-memory>Stackoverflow: Using reflection to determine how a .Net type is layed out in memory</a></li><li><a href=http://stackoverflow.com/questions/5584160/are-net-enums-blittable-types-marshalling>Stackoverflow: Are .net Enums blittable types? (Marshalling)</a></li><li><a href=http://stackoverflow.com/questions/21881554/why-does-the-system-datetime-struct-have-layout-kind-auto>Stackoverflow: Why does the System.DateTime struct have layout kind Auto?</a></li><li><a href=http://stackoverflow.com/questions/4132533/why-does-layoutkind-sequential-work-differently-if-a-struct-contains-a-datetime>Stackoverflow: Why does LayoutKind.Sequential work differently if a struct contains a DateTime field?</a></li><li><a href=http://stackoverflow.com/questions/16333511/layoutkind-sequential-not-followed-when-substruct-has-layoutkind-explicit>Stackoverflow: LayoutKind.Sequential not followed when substruct has LayoutKind.Explicit</a></li><li><a href=http://stackoverflow.com/questions/246930/is-there-any-difference-between-a-guid-and-a-uuid>Stackoverflow: Is there any difference between a GUID and a UUID?</a></li><li><a href=https://github.com/dotnet/coreclr/blob/master/src/vm/fieldmarshaler.cpp>GitHub CoreCLR: coreclr/src/vm/fieldmarshaler.cpp</a></li><li><a href=http://referencesource.microsoft.com/#mscorlib/system/guid.cs>Microsoft Reference Source: GUID</a></li><li><a href=http://referencesource.microsoft.com/#mscorlib/system/datetime.cs>Microsoft Reference Source: DateTime</a></li><li><a href=https://tools.ietf.org/html/rfc4122>RFC 4122</a></li><li><a href=http://docs.oracle.com/javase/8/docs/api/java/util/UUID.html>Java UUID</a></li><li><a href=http://blog.stephencleary.com/2010/11/few-words-on-guids.html>Stephen Cleary: A Few Words on GUIDs</a></li></ul><br><br><div class=row><div class="mx-auto share-block"><div class=share-title>Share:</div><div class=share-button><a href="https://www.reddit.com/submit?url=https%3a%2f%2faakinshin.net%2fposts%2fblittable%2f&title=Blittable%20types" target=_blank title="Share on Reddit"><i class="fab fa-reddit fa-2x"></i></a></div><div class=share-button><a href="https://twitter.com/intent/tweet?text=Blittable%20types&url=https%3a%2f%2faakinshin.net%2fposts%2fblittable%2f&via=andrey_akinshin&related=andrey_akinshin" rel=nofollow target=_blank title="Share on Twitter"><i class="fab fa-twitter fa-2x"></i></a></div><div class=share-button><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2faakinshin.net%2fposts%2fblittable%2f" target=_blank title="Share on HackerNews"><i class="fab fa-hacker-news fa-2x"></i></a></div><div class=share-button><a href="https://facebook.com/sharer.php?u=https%3a%2f%2faakinshin.net%2fposts%2fblittable%2f" rel=nofollow target=_blank title="Share on Facebook"><i class="fab fa-facebook fa-2x"></i></a></div><div class=share-button><a href="http://vk.com/share.php?url=https%3a%2f%2faakinshin.net%2fposts%2fblittable%2f" target=_blank title="Share on VKontakte"><i class="fab fa-vk fa-2x"></i></a></div><div class=share-button><a href="https://getpocket.com/save?url=https%3a%2f%2faakinshin.net%2fposts%2fblittable%2f&title=Blittable%20types" target=_blank title="Add to Pocket"><i class="fab fa-get-pocket fa-2x"></i></a></div></div></div></div><hr></div></div></main></div><footer class=blog-footer><div class=container><p>&copy; 2013–2020 Andrey Akinshin
|
<a href=https://github.com/AndreyAkinshin><i class="fab fa-github" title=GitHub style=color:#fff></i></a><a href=https://twitter.com/andrey_akinshin><i class="fab fa-twitter" title=Twitter style=color:#fff></i></a><a href=https://aakinshin.net/posts/index.xml><i class="fas fa-rss" title=RSS style=color:#fff></i></a>|
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></p></div></footer><script src=https://aakinshin.net/js/theme-after.min.082780cb948cc57eabbc0d80172a7a5347d5572b599938b4c9876dfd7978b424.js></script><script src=/js/popper.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/anchor.min.js></script><script src=https://aakinshin.net/js/custom.min.11932490dde776463ed165b345838c701accc0cfdedf2e0868f13415f41f0872.js></script></body></html>