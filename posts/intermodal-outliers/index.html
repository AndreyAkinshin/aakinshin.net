<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.103.0-DEV"><meta name=author content="Andrey Akinshin"><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content="Mathematics,Statistics,Research,Multimodality,QRDE,Harrell-Davis quantile estimator,Outliers"><title>Intermodal outliers | Andrey Akinshin</title><meta name=description content="In this post, we cover outliers that appear between modes of multimodal distributions"><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><script>localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><link href=https://aakinshin.net/css/main.min.3694189c64d6e73f07022b9b02e5f1a3ce7adaa4b67d9bd3ed23e8f8115e6411.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"></head><body><nav><div class="container flex flex-wrap items-center justify-between mx-auto max-w-6xl h-12 px-6"><div class="flex items-center justify-start justify-self-start"><div class="flex nav-item h-12 w-12 items-center justify-center"><a class=text-white href=https://aakinshin.net/><svg class="fai w-5 h-5 pr-0 mb-0.5"><use xlink:href="/img/fa/all.svg#house-chimney"/></svg></a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/posts/>Posts</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/research/>Research</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/about/>About</a></div></div><button id=theme-toggle type=button class="nav-item p-3 content-center justify-self-end"><svg id="theme-toggle-dark-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001.0 1010.586 10.586z"/></svg><svg id="theme-toggle-light-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1A1 1 0 119 4V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707A1 1 0 1113.536 5.05l.707-.707a1 1 0 011.414.0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707A1 1 0 004.343 5.757l.707.707zm1.414 8.486-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"/></svg></button></div></nav><div class="main container mx-auto max-w-6xl px-6"><div class=main-post><h1 class=blog-post-title id=post-title>Intermodal outliers</h1><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2020-11-10>November 10, 2020</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/tags/mathematics/>Mathematics</a>
<a class=label-link href=https://aakinshin.net/tags/statistics/>Statistics</a>
<a class=label-link href=https://aakinshin.net/tags/research/>Research</a>
<a class=label-link href=https://aakinshin.net/tags/multimodality/>Multimodality</a>
<a class=label-link href=https://aakinshin.net/tags/qrde/>QRDE</a>
<a class=label-link href=https://aakinshin.net/tags/harrell-davis-quantile-estimator/>Harrell-Davis quantile estimator</a>
<a class=label-link href=https://aakinshin.net/tags/outliers/>Outliers</a></div></div><br><div class=main-content><p><a href=https://en.wikipedia.org/wiki/Outlier>Outlier</a> analysis is a typical step in distribution exploration.
Usually, we work with the &ldquo;lower outliers&rdquo; (extremely low values) and the &ldquo;upper outliers&rdquo; (extremely high values).
However, outliers are not always extreme values.
In the general case, an outlier is a value that significantly differs from other values in the same sample.
In the case of multimodal distribution, we can also consider outliers in the middle of the distribution.
Let&rsquo;s call such outliers that we found between modes the &ldquo;<em>intermodal outliers</em>.&rdquo;</p><div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/intermodal-outliers/img/step4-light.svg target=_blank alt=step4><img src=/posts/intermodal-outliers/img/step4-light.svg width=800></a>
<a class="img-dark hidden" href=/posts/intermodal-outliers/img/step4-dark.svg target=_blank alt=step4><img src=/posts/intermodal-outliers/img/step4-dark.svg width=800></a></div><p>Look at the above density plot.
It&rsquo;s a bimodal distribution that is formed as a combination of two unimodal distributions.
Each of the unimodal distributions may have its own lower and upper outliers.
When we merge them, the upper outliers of the first distribution and the lower outliers of the second distribution
stop being lower or upper outliers.
However, if these values don&rsquo;t belong to the modes, they still are a subject of interest.
In this post, I will show you how to detect such intermodal outliers
and how they can be used to form a better distribution description.</p><h3 id=intermodal-outlier-detection>Intermodal outlier detection</h3><p>The intermodal outliers can be easily detected using multimodality detection and outlier detection algorithms.</p><ol><li><strong>Mode detection</strong><br>First of all, we should detect the location of each mode.
It can be done via the <a href=https://aakinshin.net/posts/lowland-multimodality-detection/>lowland multimodality detector</a> which uses the <a href=https://aakinshin.net/posts/qrde-hd/>quantile-respectful density estimation based on the Harrell-Davis quantile estimator</a> (QRDE-HD)<div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/intermodal-outliers/img/step1-light.svg target=_blank alt=step1><img src=/posts/intermodal-outliers/img/step1-light.svg width=800></a>
<a class="img-dark hidden" href=/posts/intermodal-outliers/img/step1-dark.svg target=_blank alt=step1><img src=/posts/intermodal-outliers/img/step1-dark.svg width=800></a></div></li><li><strong>Sample splitting</strong><br>Next, we should split the distribution into ranges where each range contains a single mode.
Let&rsquo;s call them &ldquo;mode ranges.&rdquo;
With the lowland multimodality detector, we can use the lowest points of QRDE-HD in lowlands that separate modes.<div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/intermodal-outliers/img/step2-light.svg target=_blank alt=step2><img src=/posts/intermodal-outliers/img/step2-light.svg width=800></a>
<a class="img-dark hidden" href=/posts/intermodal-outliers/img/step2-dark.svg target=_blank alt=step2><img src=/posts/intermodal-outliers/img/step2-dark.svg width=800></a></div></li><li><strong>Outlier detection</strong><br>Now we have to find lower and upper outliers in each mode range.
The distribution inside mode is most likely unimodal, but we can have sub-modes in some complicated cases.
Also, they can be skewed and heavy-tailed.
To find outliers in such tricky asymmetric distributions, we need a non-parametric and robust outlier detector.
I suggest using the <a href=https://aakinshin.net/posts/harrell-davis-double-mad-outlier-detector/>DoubleMAD outlier detector based on the Harrell-Davis quantile estimator</a>, but it can be easily replaced by your favorite algorithm.<div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/intermodal-outliers/img/step3-light.svg target=_blank alt=step3><img src=/posts/intermodal-outliers/img/step3-light.svg width=800></a>
<a class="img-dark hidden" href=/posts/intermodal-outliers/img/step3-dark.svg target=_blank alt=step3><img src=/posts/intermodal-outliers/img/step3-dark.svg width=800></a></div></li><li><strong>Result gathering</strong><br>The lower outliers of the first mode become the lower outliers of the whole distribution.
The upper outliers of the last mode become the upper outliers of the whole distribution.
To find the whole set of intermodal outliers between two modes,
we should combine the upper outliers of the first mode with the lower outliers of the second mode.<div class="flex my-7 justify-center"><a class="img-light hidden" href=/posts/intermodal-outliers/img/step4-light.svg target=_blank alt=step4><img src=/posts/intermodal-outliers/img/step4-light.svg width=800></a>
<a class="img-dark hidden" href=/posts/intermodal-outliers/img/step4-dark.svg target=_blank alt=step4><img src=/posts/intermodal-outliers/img/step4-dark.svg width=800></a></div></li></ol><h3 id=reference-implementation>Reference implementation</h3><p>You can find a reference C# implementation of this algorithm in
the latest nightly version (0.3.0-nightly.59+) of <a href=https://github.com/AndreyAkinshin/perfolizer>perfolizer</a>
(see <code>LowlandModalityDetector</code>, <code>DoubleMadOutlierDetector</code>, <code>ManualModalityDataFormatter</code>).
Here is a code sample:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=c1>// Generate sample</span>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>random</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=m>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>data</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=kt>double</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=p>.</span><span class=n>AddRange</span><span class=p>(</span><span class=k>new</span><span class=p>[]</span> <span class=p>{</span><span class=m>1.0</span><span class=p>,</span> <span class=m>2.0</span><span class=p>});</span> <span class=c1>// Lower outliers</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=p>.</span><span class=n>AddRange</span><span class=p>(</span><span class=k>new</span> <span class=n>NormalDistribution</span><span class=p>(</span><span class=m>10</span><span class=p>,</span> <span class=m>1</span><span class=p>).</span><span class=n>Random</span><span class=p>(</span><span class=n>random</span><span class=p>).</span><span class=n>Next</span><span class=p>(</span><span class=m>100</span><span class=p>));</span> <span class=c1>// Mode #1</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=p>.</span><span class=n>AddRange</span><span class=p>(</span><span class=k>new</span><span class=p>[]</span> <span class=p>{</span><span class=m>19.0</span><span class=p>,</span> <span class=m>21.0</span><span class=p>});</span> <span class=c1>// Intermodal outliers</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=p>.</span><span class=n>AddRange</span><span class=p>(</span><span class=k>new</span> <span class=n>NormalDistribution</span><span class=p>(</span><span class=m>30</span><span class=p>,</span> <span class=m>1</span><span class=p>).</span><span class=n>Random</span><span class=p>(</span><span class=n>random</span><span class=p>).</span><span class=n>Next</span><span class=p>(</span><span class=m>100</span><span class=p>));</span> <span class=c1>// Mode #2</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=p>.</span><span class=n>AddRange</span><span class=p>(</span><span class=k>new</span><span class=p>[]</span> <span class=p>{</span><span class=m>38.0</span><span class=p>,</span> <span class=m>39.0</span><span class=p>});</span> <span class=c1>// Upper outliers</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Find modes and outliers</span>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>modalityData</span> <span class=p>=</span> <span class=n>LowlandModalityDetector</span><span class=p>.</span><span class=n>Instance</span><span class=p>.</span><span class=n>DetectModes</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>AutomaticModalityDataFormatter</span><span class=p>.</span><span class=n>Instance</span><span class=p>.</span><span class=n>Format</span><span class=p>(</span><span class=n>modalityData</span><span class=p>));</span>
</span></span></code></pre></div><p>This prints the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=p>{</span><span class=m>1.00</span><span class=p>,</span> <span class=m>2.00</span><span class=p>}</span> <span class=p>+</span> <span class=p>[</span><span class=m>7.16</span><span class=p>;</span> <span class=m>13.12</span><span class=p>]</span><span class=n>_100</span> <span class=p>+</span> <span class=p>{</span><span class=m>19.00</span><span class=p>,</span> <span class=m>21.00</span><span class=p>}</span> <span class=p>+</span> <span class=p>[</span><span class=m>27.69</span><span class=p>;</span> <span class=m>32.34</span><span class=p>]</span><span class=n>_100</span> <span class=p>+</span> <span class=p>{</span><span class=m>38.00</span><span class=p>,</span> <span class=m>39.00</span><span class=p>}</span>
</span></span></code></pre></div><p>The code presents the sample as a combination of five groups:</p><ul><li><em>Lower outliers</em>: <code>{1.00, 2.00}</code> (two elements)</li><li><em>Mode #1</em>: <code>[7.16; 13.12]_100</code> (100 elements between 7.16 and 13.12)</li><li><em>Intermodal outliers</em>: <code>{19.00, 21.00}</code> (two elements)</li><li><em>Mode #2</em>: <code>[27.69; 32.34]_100</code> (100 elements between 27.69 and 32.34)</li><li><em>Upper outliers</em>: <code>{38.00, 39.00}</code> (two elements)</li></ul><p>I will explain this notation in detail in future posts.</p><h3 id=conclusion>Conclusion</h3><p>In this post, we discussed the concept of intermodal outliers.
Unlike &ldquo;classic&rdquo; lower and upper outliers, these values are located in the middle of a distribution.
However, they still can be considered outliers if they significantly differ from most of the other values.</p><p>Such outliers may appear in multimodal distributions as lower or upper outliers of unimodal sub-distributions.
To find these values, we can detect mode range using the <a href=https://aakinshin.net/posts/lowland-multimodality-detection/>lowland multimodality detector</a>,
and discover outliers in each mode independently.
To find the whole set of intermodal outliers between two modes,
we should combine the upper outliers of the first mode with the lower outliers of the second mode.</p><p>The knowledge of intermodal outlier locations helps to clean up the sample values.
It significantly reduces the risk of getting distorted statistical metric values.</p></div><br><br><div class="flex flex-wrap justify-center items-center">The source code of this post and all the relevant files are&nbsp;<a href=https://github.com/AndreyAkinshin/aakinshin.net/tree/master/content/en/posts/2020/11/intermodal-outliers/index.md>available on GitHub</a>.</div><div class="flex flex-wrap justify-center items-center mb-5"><span>Share:</span><div class="text-4xl pl-3"><a href="https://www.reddit.com/submit?url=https%3a%2f%2faakinshin.net%2fposts%2fintermodal-outliers%2f&title=Intermodal%20outliers" target=_blank title="Share on Reddit"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#reddit"/></svg></a></div><div class="text-4xl pl-3"><a href="https://twitter.com/intent/tweet?text=Intermodal%20outliers&url=https%3a%2f%2faakinshin.net%2fposts%2fintermodal-outliers%2f&via=andrey_akinshin&related=andrey_akinshin" rel=nofollow target=_blank title="Share on Twitter"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></div><div class="text-4xl pl-3"><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2faakinshin.net%2fposts%2fintermodal-outliers%2f" target=_blank title="Share on HackerNews"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#hacker-news"/></svg></a></div><div class="text-4xl pl-3"><a href="https://getpocket.com/save?url=https%3a%2f%2faakinshin.net%2fposts%2fintermodal-outliers%2f&title=Intermodal%20outliers" target=_blank title="Add to Pocket"><svg class="fai fai-link"><use xlink:href="/img/fa/all.svg#get-pocket"/></svg></a></div></div></div></div><script>var themeToggleDarkIcon=document.getElementById("theme-toggle-dark-icon"),themeToggleBtn,themeToggleLightIcon=document.getElementById("theme-toggle-light-icon");const imagesDark=document.querySelectorAll(".img-dark"),imagesLight=document.querySelectorAll(".img-light");localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(themeToggleLightIcon.classList.remove("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")})):(themeToggleDarkIcon.classList.remove("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")})),themeToggleBtn=document.getElementById("theme-toggle"),themeToggleBtn.addEventListener("click",function(){themeToggleDarkIcon.classList.toggle("hidden"),themeToggleLightIcon.classList.toggle("hidden"),imagesLight.forEach(e=>{e.classList.toggle("hidden")}),imagesDark.forEach(e=>{e.classList.toggle("hidden")}),localStorage.getItem("color-theme")?localStorage.getItem("color-theme")==="light"?(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"))})</script><footer class="z-20 p-4 md:p-6 mt-3 w-full border-t border-gray-200 shadow flex items-center justify-center dark:border-gray-600 bg-white dark:bg-zinc-800"><span class="dark:text-gray-400 text-center">© 2013—2023 <span class=whitespace-nowrap>Andrey Akinshin</span></span><ul class="flex flex-wrap items-center px-4 mb-1"><li><a href=https://github.com/AndreyAkinshin><svg class="fai fai-link w-5 h-5"><title>GitHub</title><use xlink:href="/img/fa/all.svg#github"/></svg></a></li><li><a href=https://twitter.com/andrey_akinshin><svg class="fai fai-link w-5 h-5"><title>Twitter</title><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></li><li><a href=https://aakinshin.net/posts/index.xml><svg class="fai fai-link w-5 h-5"><title>RSS</title><use xlink:href="/img/fa/all.svg#rss"/></svg></a></li></ul><div class=main-content><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></div></footer><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script></body></html>