<!doctype html><html lang=en class=h-100><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.103.0-DEV"><meta name=author content="Andrey Akinshin"><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content="Mathematics,Statistics,Research,Multimodality,QRDE,Harrell-Davis quantile estimator,Outliers"><title>Intermodal outliers | Andrey Akinshin</title><meta name=description content="In this post, we cover outliers that appear between modes of multimodal distributions"><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><link href=https://aakinshin.net/sass/bootstrap-light.min.css theme=light rel=stylesheet type=text/css media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><link href=https://aakinshin.net/sass/bootstrap-dark.min.css theme=dark rel=stylesheet type=text/css media="(prefers-color-scheme: dark)"><script src=https://aakinshin.net/js/theme-before.min.d7f6578e23ad3f0c33c589f9bcb34f995b45121f1f3ce888869c86b26826c845.js></script>
<script type=module src=https://aakinshin.net/js/dark-mode-toggle.min.9e68d431432744c07a43381a8a833ffe0921cc0e006d84ad97f0b0d43c5cd82d.mjs></script>
<link href=https://aakinshin.net/css/fontawesome-all.min.178e95bba6ea2e9a90838cd646658f4bf6667a6ceaa057cb587bf7e6eb8412d3.css rel=stylesheet type=text/css media=all><link href=https://aakinshin.net/css/about.min.60773ab7266ecc6e9625306f57c0a82a219b011dc3ea2d83763d1ecdf11c86d2.css rel=stylesheet type=text/css media=all><link href=https://aakinshin.net/css/blog.min.7e186db80d8c431d196b3e0718afb0636b82a269a8c92521c11a55267a24fc27.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/posts/index.xml title="RSS Feed"><script src=/js/jquery-3.3.1.slim.min.js></script></head><body class="d-flex flex-column min-vh-100"><div class=bg-primary><div class="container bg-primary"><nav class="navbar navbar-expand-sm navbar-dark bg-primary"><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link id=nav-link-blog href=https://aakinshin.net/><i class="fas fa-home" title=Home style=color:#fff></i></a></li><li class=nav-item><a class=nav-link id=nav-link-posts href=https://aakinshin.net/posts/>Posts</a></li><li class=nav-item><a class=nav-link id=nav-link-about href=https://aakinshin.net/about/>About</a></li></ul><ul class="navbar-nav ms-auto"><li class=nav-item><dark-mode-toggle permanent=true></dark-mode-toggle></li></ul></nav></div></div><div class=container><main id=main><div class=blog-main><div class="blog-post table-sm"><h1 class=blog-post-title id=post-title>Intermodal outliers</h1><span class=blog-post-meta><div class=faicon><i class="far fa-calendar-alt"></i></div><time datetime=2020-11-10>November 10, 2020</time>
&nbsp;&nbsp;
<i class="fas fa-tag"></i>
&nbsp;
<a href=https://aakinshin.net/tags/mathematics/ class="badge badge-info">Mathematics</a>
<a href=https://aakinshin.net/tags/statistics/ class="badge badge-info">Statistics</a>
<a href=https://aakinshin.net/tags/research/ class="badge badge-info">Research</a>
<a href=https://aakinshin.net/tags/multimodality/ class="badge badge-info">Multimodality</a>
<a href=https://aakinshin.net/tags/qrde/ class="badge badge-info">QRDE</a>
<a href=https://aakinshin.net/tags/harrell-davis-quantile-estimator/ class="badge badge-info">Harrell-Davis quantile estimator</a>
<a href=https://aakinshin.net/tags/outliers/ class="badge badge-info">Outliers</a></span><br><br><p><a href=https://en.wikipedia.org/wiki/Outlier>Outlier</a> analysis is a typical step in distribution exploration.
Usually, we work with the &ldquo;lower outliers&rdquo; (extremely low values) and the &ldquo;upper outliers&rdquo; (extremely high values).
However, outliers are not always extreme values.
In the general case, an outlier is a value that significantly differs from other values in the same sample.
In the case of multimodal distribution, we can also consider outliers in the middle of the distribution.
Let&rsquo;s call such outliers that we found between modes the &ldquo;<em>intermodal outliers</em>.&rdquo;</p><div class=row><div class=mx-auto><a href=/posts/intermodal-outliers/img/step4-light.svg target=_blank class=imgldlink alt=step4><picture><source theme=dark srcset=/posts/intermodal-outliers/img/step4-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/intermodal-outliers/img/step4-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/intermodal-outliers/img/step4-light.svg></picture></a></div></div><br><p>Look at the above density plot.
It&rsquo;s a bimodal distribution that is formed as a combination of two unimodal distributions.
Each of the unimodal distributions may have its own lower and upper outliers.
When we merge them, the upper outliers of the first distribution and the lower outliers of the second distribution
stop being lower or upper outliers.
However, if these values don&rsquo;t belong to the modes, they still are a subject of interest.
In this post, I will show you how to detect such intermodal outliers
and how they can be used to form a better distribution description.</p><h3 id=intermodal-outlier-detection>Intermodal outlier detection</h3><p>The intermodal outliers can be easily detected using multimodality detection and outlier detection algorithms.</p><ol><li><strong>Mode detection</strong><br>First of all, we should detect the location of each mode.
It can be done via the <a href=https://aakinshin.net/posts/lowland-multimodality-detection/>lowland multimodality detector</a> which uses the <a href=https://aakinshin.net/posts/qrde-hd/>quantile-respectful density estimation based on the Harrell-Davis quantile estimator</a> (QRDE-HD)<div class=row><div class=mx-auto><a href=/posts/intermodal-outliers/img/step1-light.svg target=_blank class=imgldlink alt=step1><picture><source theme=dark srcset=/posts/intermodal-outliers/img/step1-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/intermodal-outliers/img/step1-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/intermodal-outliers/img/step1-light.svg></picture></a></div></div><br></li><li><strong>Sample splitting</strong><br>Next, we should split the distribution into ranges where each range contains a single mode.
Let&rsquo;s call them &ldquo;mode ranges.&rdquo;
With the lowland multimodality detector, we can use the lowest points of QRDE-HD in lowlands that separate modes.<div class=row><div class=mx-auto><a href=/posts/intermodal-outliers/img/step2-light.svg target=_blank class=imgldlink alt=step2><picture><source theme=dark srcset=/posts/intermodal-outliers/img/step2-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/intermodal-outliers/img/step2-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/intermodal-outliers/img/step2-light.svg></picture></a></div></div><br></li><li><strong>Outlier detection</strong><br>Now we have to find lower and upper outliers in each mode range.
The distribution inside mode is most likely unimodal, but we can have sub-modes in some complicated cases.
Also, they can be skewed and heavy-tailed.
To find outliers in such tricky asymmetric distributions, we need a non-parametric and robust outlier detector.
I suggest using the <a href=https://aakinshin.net/posts/harrell-davis-double-mad-outlier-detector/>DoubleMAD outlier detector based on the Harrell-Davis quantile estimator</a>, but it can be easily replaced by your favorite algorithm.<div class=row><div class=mx-auto><a href=/posts/intermodal-outliers/img/step3-light.svg target=_blank class=imgldlink alt=step3><picture><source theme=dark srcset=/posts/intermodal-outliers/img/step3-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/intermodal-outliers/img/step3-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/intermodal-outliers/img/step3-light.svg></picture></a></div></div><br></li><li><strong>Result gathering</strong><br>The lower outliers of the first mode become the lower outliers of the whole distribution.
The upper outliers of the last mode become the upper outliers of the whole distribution.
To find the whole set of intermodal outliers between two modes,
we should combine the upper outliers of the first mode with the lower outliers of the second mode.<div class=row><div class=mx-auto><a href=/posts/intermodal-outliers/img/step4-light.svg target=_blank class=imgldlink alt=step4><picture><source theme=dark srcset=/posts/intermodal-outliers/img/step4-dark.svg media="(prefers-color-scheme: dark)"><source theme=light srcset=/posts/intermodal-outliers/img/step4-light.svg media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><img class="mx-auto d-block img-fluid" width=800 src=/posts/intermodal-outliers/img/step4-light.svg></picture></a></div></div><br></li></ol><h3 id=reference-implementation>Reference implementation</h3><p>You can find a reference C# implementation of this algorithm in
the latest nightly version (0.3.0-nightly.59+) of <a href=https://github.com/AndreyAkinshin/perfolizer>perfolizer</a>
(see <code>LowlandModalityDetector</code>, <code>DoubleMadOutlierDetector</code>, <code>ManualModalityDataFormatter</code>).
Here is a code sample:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=c1>// Generate sample</span>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>random</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=m>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>data</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=kt>double</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=p>.</span><span class=n>AddRange</span><span class=p>(</span><span class=k>new</span><span class=p>[]</span> <span class=p>{</span><span class=m>1.0</span><span class=p>,</span> <span class=m>2.0</span><span class=p>});</span> <span class=c1>// Lower outliers</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=p>.</span><span class=n>AddRange</span><span class=p>(</span><span class=k>new</span> <span class=n>NormalDistribution</span><span class=p>(</span><span class=m>10</span><span class=p>,</span> <span class=m>1</span><span class=p>).</span><span class=n>Random</span><span class=p>(</span><span class=n>random</span><span class=p>).</span><span class=n>Next</span><span class=p>(</span><span class=m>100</span><span class=p>));</span> <span class=c1>// Mode #1</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=p>.</span><span class=n>AddRange</span><span class=p>(</span><span class=k>new</span><span class=p>[]</span> <span class=p>{</span><span class=m>19.0</span><span class=p>,</span> <span class=m>21.0</span><span class=p>});</span> <span class=c1>// Intermodal outliers</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=p>.</span><span class=n>AddRange</span><span class=p>(</span><span class=k>new</span> <span class=n>NormalDistribution</span><span class=p>(</span><span class=m>30</span><span class=p>,</span> <span class=m>1</span><span class=p>).</span><span class=n>Random</span><span class=p>(</span><span class=n>random</span><span class=p>).</span><span class=n>Next</span><span class=p>(</span><span class=m>100</span><span class=p>));</span> <span class=c1>// Mode #2</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=p>.</span><span class=n>AddRange</span><span class=p>(</span><span class=k>new</span><span class=p>[]</span> <span class=p>{</span><span class=m>38.0</span><span class=p>,</span> <span class=m>39.0</span><span class=p>});</span> <span class=c1>// Upper outliers</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Find modes and outliers</span>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>modalityData</span> <span class=p>=</span> <span class=n>LowlandModalityDetector</span><span class=p>.</span><span class=n>Instance</span><span class=p>.</span><span class=n>DetectModes</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>AutomaticModalityDataFormatter</span><span class=p>.</span><span class=n>Instance</span><span class=p>.</span><span class=n>Format</span><span class=p>(</span><span class=n>modalityData</span><span class=p>));</span>
</span></span></code></pre></div><p>This prints the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=p>{</span><span class=m>1.00</span><span class=p>,</span> <span class=m>2.00</span><span class=p>}</span> <span class=p>+</span> <span class=p>[</span><span class=m>7.16</span><span class=p>;</span> <span class=m>13.12</span><span class=p>]</span><span class=n>_100</span> <span class=p>+</span> <span class=p>{</span><span class=m>19.00</span><span class=p>,</span> <span class=m>21.00</span><span class=p>}</span> <span class=p>+</span> <span class=p>[</span><span class=m>27.69</span><span class=p>;</span> <span class=m>32.34</span><span class=p>]</span><span class=n>_100</span> <span class=p>+</span> <span class=p>{</span><span class=m>38.00</span><span class=p>,</span> <span class=m>39.00</span><span class=p>}</span>
</span></span></code></pre></div><p>The code presents the sample as a combination of five groups:</p><ul><li><em>Lower outliers</em>: <code>{1.00, 2.00}</code> (two elements)</li><li><em>Mode #1</em>: <code>[7.16; 13.12]_100</code> (100 elements between 7.16 and 13.12)</li><li><em>Intermodal outliers</em>: <code>{19.00, 21.00}</code> (two elements)</li><li><em>Mode #2</em>: <code>[27.69; 32.34]_100</code> (100 elements between 27.69 and 32.34)</li><li><em>Upper outliers</em>: <code>{38.00, 39.00}</code> (two elements)</li></ul><p>I will explain this notation in detail in future posts.</p><h3 id=conclusion>Conclusion</h3><p>In this post, we discussed the concept of intermodal outliers.
Unlike &ldquo;classic&rdquo; lower and upper outliers, these values are located in the middle of a distribution.
However, they still can be considered outliers if they significantly differ from most of the other values.</p><p>Such outliers may appear in multimodal distributions as lower or upper outliers of unimodal sub-distributions.
To find these values, we can detect mode range using the <a href=https://aakinshin.net/posts/lowland-multimodality-detection/>lowland multimodality detector</a>,
and discover outliers in each mode independently.
To find the whole set of intermodal outliers between two modes,
we should combine the upper outliers of the first mode with the lower outliers of the second mode.</p><p>The knowledge of intermodal outlier locations helps to clean up the sample values.
It significantly reduces the risk of getting distorted statistical metric values.</p><br><br><div class=row><div class="justify-content-center share-block"><div class=share-title>Share:</div><div class=share-button><a href="https://www.reddit.com/submit?url=https%3a%2f%2faakinshin.net%2fposts%2fintermodal-outliers%2f&title=Intermodal%20outliers" target=_blank title="Share on Reddit"><i class="fab fa-reddit fa-2x"></i></a></div><div class=share-button><a href="https://twitter.com/intent/tweet?text=Intermodal%20outliers&url=https%3a%2f%2faakinshin.net%2fposts%2fintermodal-outliers%2f&via=andrey_akinshin&related=andrey_akinshin" rel=nofollow target=_blank title="Share on Twitter"><i class="fab fa-twitter fa-2x"></i></a></div><div class=share-button><a href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2faakinshin.net%2fposts%2fintermodal-outliers%2f" target=_blank title="Share on HackerNews"><i class="fab fa-hacker-news fa-2x"></i></a></div><div class=share-button><a href="https://getpocket.com/save?url=https%3a%2f%2faakinshin.net%2fposts%2fintermodal-outliers%2f&title=Intermodal%20outliers" target=_blank title="Add to Pocket"><i class="fab fa-get-pocket fa-2x"></i></a></div></div></div></div><hr></div></div></main></div><footer class="blog-footer mt-auto"><div class=container><p>&copy; 2013&mdash;2022 Andrey Akinshin
|
<a href=https://github.com/AndreyAkinshin><i class="fab fa-github" title=GitHub></i></a>
<a href=https://twitter.com/andrey_akinshin><i class="fab fa-twitter" title=Twitter></i></a>
<a href=https://aakinshin.net/posts/index.xml><i class="fas fa-rss" title=RSS></i></a>
|
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></p></div></footer><script src=https://aakinshin.net/js/theme-after.min.c26550621ac13c2221d7f6f5e6fe862345d3919723c50d730893e3e4856ecf35.js></script>
<script src=/js/bootstrap.bundle.min.js></script>
<script src=/js/anchor.min.js></script>
<script src=https://aakinshin.net/js/custom.min.f6e5d13fe39f305056cc743ee4cb8d117c1aba26176e58c82c79a480d02fe4b7.js></script>
<script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></body></html>