<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="description" content="Andrey Akinshin">
    <meta name="author" content="Andrey Akinshin">
    <link href="/img/favicon.ico" rel="icon" type="image/x-icon"/>
    <meta name="keywords" content=''>

    <title>Andrey Akinshin</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

    <!-- Custom styles -->
    <link href="/css/about.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/blog.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/highlight.css" rel="stylesheet" type="text/css" media="all">

    <!-- Feeds -->
    <link href="/ru/rss.xml" type="application/rss+xml" rel="alternate" title="Blog RSS Feed" />
    <link href="/ru/atom.xml" type="application/atom+xml" rel="alternate" title="Blog ATOM Feed" />

    <!-- Google analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-41419012-5', 'auto');
      ga('send', 'pageview');
    </script>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter28700916 = new Ya.Metrika({id:28700916,
                        clickmap:true,
                        trackLinks:true,
                        accurateTrackBounce:true});
            } catch(e) { }
        });
        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";
        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
    </script>
    <!-- /Yandex.Metrika counter -->
    <!-- Disqus -->
    <script id="dsq-count-scr" src="//aakinshinnet-ru.disqus.com/count.js" async></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
  </head>

  <body>
     <div class="blog-masthead">
      <div class="container">
        <nav class="nav blog-nav">
          <a class="nav-link" id="nav-link-blog" href="/ru/blog/">Блог</a>
          <a class="nav-link" id="nav-link-blog-content" href="/ru/blog/content/">Содержание</a>
          <a class="nav-link" id="nav-link-about" href="/ru/about/">Об авторе </a>
          <a class="nav-link" href='/blog/tag/arrays/''>English version</a>
        </nav>
      </div>
    </div>

    <div class="container">
      <div class="blog-main">

<h1 id="arrays">Посты про Arrays</h1>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/ru/blog/post/arrays-internal-structure/'>Внутреннее устройство массивов в .NET</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> 11 октября 2013.
          <b>Tags:</b>
                <a href="/ru/blog/tag//dotnet"><span class="badge badge-pill badge-info">.NET</span></a>
                <a href="/ru/blog/tag//csharp"><span class="badge badge-pill badge-info">C#</span></a>
                <a href="/ru/blog/tag//arrays"><span class="badge badge-pill badge-info">Arrays</span></a>
        </span><br /><br />
        <p>Иногда бывает полезно понимать, как выглядит внутреннее представление объектов, с которыми мы работаем. В этой статье я хотел бы поговорить о массивах: как именно они хранятся в памяти, какие IL-команды используются для работы с ними, как выглядит ассемблерный код при обращении к их элементам. Я рассмотрю три вида массивов: single (<code>T[]</code>), rectangular (<code>T[,]</code>), jagged (<code>T[][]</code>). Также будет затронута тема массивов с ненулевой нижней границей (<code>T[*]</code>) и нюансов работы с ними.</p>
        <a href='/ru/blog/post/arrays-internal-structure/'>Читать дальше</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/ru/blog/post/arrays-internal-structure/#disqus_thread">Комментарии</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/ru/blog/post/arrays-access-performance/'>Сравнение производительности массивов в .NET</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> 31 августа 2013.
          <b>Tags:</b>
                <a href="/ru/blog/tag//dotnet"><span class="badge badge-pill badge-info">.NET</span></a>
                <a href="/ru/blog/tag//csharp"><span class="badge badge-pill badge-info">C#</span></a>
                <a href="/ru/blog/tag//benchmarking"><span class="badge badge-pill badge-info">Benchmarking</span></a>
                <a href="/ru/blog/tag//asm"><span class="badge badge-pill badge-info">ASM</span></a>
                <a href="/ru/blog/tag//jit"><span class="badge badge-pill badge-info">JIT</span></a>
                <a href="/ru/blog/tag//arrays"><span class="badge badge-pill badge-info">Arrays</span></a>
        </span><br /><br />
        <h2 id="section">Часть 1</h2>
<p>Платформа .NET поддерживает два способа задания многомерных массивов: прямоугольные (rectangular) и изломанные (jagged). Второй способ по сути представляет собой массив массивов. Это обстоятельство создаёт у многих программистов иллюзию того, что jagged-массивы должны работать медленнее, т.к. обращение к их элементам реализуется через многократные переходы по ссылкам в управляемой куче. Но на самом деле jagged-массивы могут работают быстрее (если речь идёт непосредственно о работе с массивами, а не о их инициализации), ведь они представляют собой комбинацию одномерных (single) массивов, работа с которыми в CLR весьма оптимизирована (за счёт IL-команд <code>newarr</code>, <code>ldelem</code>, <code>ldelema</code>, <code>ldlen</code>, <code>stelem</code>). Другим подходом к представлению многомерных данных является использование одномерного массива с ручным преобразованием координат (в массиве размерности N<em>M для обращения к элементу [i,j] будем писать [i</em>M+j]). Если производительности не хватает, то можно использовать неуправляемый код, но этот случай мы сейчас рассматривать не будем, остановимся на трёх вышеозначенных способах. Для замеров времени используется
<a href="https://github.com/AndreyAkinshin/BenchmarkDotNet">BenchmarkDotNet</a>. Рассмотрим C# код, который замеряет время работы каждого варианта (полный вариант кода:
<a href="https://github.com/AndreyAkinshin/BenchmarkDotNet/blob/master/Benchmarks/MultidimensionalArrayProgram.cs">MultidimensionalArrayProgram.cs</a>, тестировать следует в <strong>Release mode without debugging</strong>). Данные результаты получены в сборке под x64 для процессора Intel Core i7-3632QM CPU 2.20GHz и параметров N=M=100, IterationCount=100000. Исследование вопроса о влиянии используемой архитектуры и параметров запуска на результат бенчмарка можно найти во второй части статьи.
        <a href='/ru/blog/post/arrays-access-performance/'>Читать дальше</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/ru/blog/post/arrays-access-performance/#disqus_thread">Комментарии</a><br /><br />
        <hr />
    </div>
<div class="blog-post">
        <h2 class="blog-post-title"><a href='/ru/blog/post/static-array-iteration/'>Об итерировании статичных массивов в .NET</a></h2>
        <span class="blog-post-meta">
          <b>Date:</b> 29 августа 2013.
          <b>Tags:</b>
                <a href="/ru/blog/tag//dotnet"><span class="badge badge-pill badge-info">.NET</span></a>
                <a href="/ru/blog/tag//csharp"><span class="badge badge-pill badge-info">C#</span></a>
                <a href="/ru/blog/tag//benchmarking"><span class="badge badge-pill badge-info">Benchmarking</span></a>
                <a href="/ru/blog/tag//static"><span class="badge badge-pill badge-info">Static</span></a>
                <a href="/ru/blog/tag//il"><span class="badge badge-pill badge-info">IL</span></a>
                <a href="/ru/blog/tag//arrays"><span class="badge badge-pill badge-info">Arrays</span></a>
        </span><br /><br />
        <h2 id="section">Часть 1</h2>
<p>Управляемый подход платформы .NET делает жизнь разработчиков достаточно простой, беря на себя многие рутинные операции. Большую часть времени программист может вообще не вспоминать о технической реализации платформы, сосредоточившись исключительно на логике своего приложения. Но иногда попадаются задачи, критичные по производительности. Существует множество различных подходов к оптимизации кода в таких ситуациях вплоть до переписывания наиболее важных частей кода через неуправляемый код. Однако, зачастую для увеличения скорости приложения достаточно понимать, сколько времени тратится на ту или иную операцию. Знание подобных вещей позволит оптимизировать некоторые методы с помощью достаточно простых модификаций исходного кода.</p>
<p>В этой статье мне хотелось бы поговорить о скорости доступа к массивам, ссылки на которые хранятся в статичных переменных. Дело в том, что в скорость итерирования по ним в зависимости от условий запуска может быть ниже, чем для массива, ссылка на который хранится в обычном поле экземпляра класса или локальной переменной. Рассмотрим пример.
        <a href='/ru/blog/post/static-array-iteration/'>Читать дальше</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/ru/blog/post/static-array-iteration/#disqus_thread">Комментарии</a><br /><br />
        <hr />
    </div>
</div>
    </div>

    <footer class="blog-footer">
      <div class="container">
        <p>&copy; 2014–2017 Андрей Акиньшин</p>
      </div>
    </footer>

    <!-- jQuery first (header), then Tether, then Bootstrap JS. -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
    <!-- Other scripts -->
    <script src="/js/highlight.pack.js"></script>
    <script src="/js/anchor.min.js"></script>
    <script src="/js/custom.js"></script>
  </body>
</html>
