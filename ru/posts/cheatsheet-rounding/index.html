<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="description" content="Учимся округлять в C#">
    <meta name="author" content="Andrey Akinshin">
    <link href="/img/favicon.ico" rel="icon" type="image/x-icon"/>
    <meta name="keywords" content='.NET,C#,Rounding,CheatSheet'>

    <title>Учимся округлять в C#</title>

    <!-- Bootstrap CSS & Highlight.js-->
    <link href="/css/lumen-bootstrap.min.css" theme="light" rel="stylesheet" type="text/css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
    <link href="/css/slate-bootstrap.min.css" theme="dark" rel="stylesheet" type="text/css" media="(prefers-color-scheme: dark)">
    <link href="/css/github-highlight.css" theme="light" rel="stylesheet" type="text/css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
    <link href="/css/darcula-highlight.css" theme="dark" rel="stylesheet" type="text/css" media="(prefers-color-scheme: dark)">
    <script src="/js/theme-before.js"></script>

    <!-- DarkModeToggle -->
    <script type="module" src="https://googlechromelabs.github.io/dark-mode-toggle/src/dark-mode-toggle.mjs"></script>

    <!-- FontAwesome -->
    <link href="/css/fontawesome-all.min.css" rel="stylesheet" type="text/css" media="all">

    <!-- Custom styles -->
    <link href="/css/about.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/blog.css" rel="stylesheet" type="text/css" media="all">

    <!-- Feeds -->
    <link href="/ru/rss.xml" type="application/rss+xml" rel="alternate" title="Blog RSS Feed" />
    <link href="/ru/atom.xml" type="application/atom+xml" rel="alternate" title="Blog ATOM Feed" />

    <!-- Google analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-41419012-5', 'auto');
      ga('send', 'pageview');
    </script>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
        (function (d, w, c) {
            (w[c] = w[c] || []).push(function() {
                try {
                    w.yaCounter28700916 = new Ya.Metrika({
                        id:28700916,
                        clickmap:true,
                        trackLinks:true,
                        accurateTrackBounce:true,
                        webvisor:true,
                        trackHash:true
                    });
                } catch(e) { }
            });

            var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function () { n.parentNode.insertBefore(s, n); };
            s.type = "text/javascript";
            s.async = true;
            s.src = "https://mc.yandex.ru/metrika/watch.js";

            if (w.opera == "[object Opera]") {
                d.addEventListener("DOMContentLoaded", f, false);
            } else { f(); }
        })(document, window, "yandex_metrika_callbacks");
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/28700916" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->

    <!-- jQuery -->
    <script src="/js/jquery-3.3.1.slim.min.js"></script>
  </head>

  <body>
    <div class="bg-primary">
      <div class="container bg-primary">
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" id="nav-link-blog" href="/ru/posts/">Блог</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="nav-link-blog-content" href="/ru/content/">Содержание</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="nav-link-about" href="/ru/about/">Об авторе</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="nav-link-about" href="/prodotnetbenchmarking/">Pro .NET Benchmarking</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Ru</a>
              <div class="dropdown-menu">
                  <a class="dropdown-item" href='/posts/cheatsheet-rounding/'>En</a>
              </div>
            </li>
            <li class="nav-item"></li>
              <dark-mode-toggle permanent="true"></dark-mode-toggle>
            </li>
          </ul>
          <ul class="navbar-nav ml-auto">
            <li class="nav-item"><a class="nav-link" href="https://github.com/AndreyAkinshin"><i class="fab fa-github" title="GitHub" style="color:white"></i></a></li>
            <li class="nav-item"><a class="nav-link" href="https://twitter.com/andrey_akinshin"><i class="fab fa-twitter" title="Twitter" style="color:white"></i></a></li>
            <li class="nav-item"><a class="nav-link" href="/ru/rss.xml"><i class="fas fa-rss" title="RSS" style="color:white"></i></a></li>
          </ul>
        </nav>
      </div>
    </div>

    <div class="container">
      <div class="blog-main">
<div class="blog-post">

<h2 class="blog-post-title" id="post-title">Учимся округлять в C#</h2>
<span class="blog-post-meta">
  <b>Дата:</b> 18 сентября 2013.
  <b>Теги:</b>
        <a href="/ru/tags/dotnet"><span class="badge badge-pill badge-info">.NET</span></a>
        <a href="/ru/tags/csharp"><span class="badge badge-pill badge-info">C#</span></a>
        <a href="/ru/tags/rounding"><span class="badge badge-pill badge-info">Rounding</span></a>
        <a href="/ru/tags/cheatsheet"><span class="badge badge-pill badge-info">CheatSheet</span></a>
</span><br /><br />

<p>А знаете ли вы, что <code>Math.Round(1.5) == Math.Round(2.5) == 2</code>? Можете ли сходу сказать, сколько будет <code>-7%3</code> и <code>7%-3</code>? Помните ли, чем отличаются
<code>Math.Round</code>, <code>Math.Floor</code>, <code>Math.Ceiling</code>, <code>Math.Truncate</code>? А как происходит округление при использовании <code>string.Format</code>? Давайте немного погрузимся в мир округлений и разберёмся с нюансами, которые не для всех могут быть очевидными.<!--more--></p>
<h3 id="math.round">Math.Round</h3>
<p>MSDN:
<a href="http://msdn.microsoft.com/en-us/library/system.math.round.aspx">Round</a></p>
<pre><code class="language-cs">public static decimal Round(decimal value)
public static double Round(double value)
public static decimal Round(decimal value, int digits)
public static double Round(double value, int digits)
public static decimal Round(decimal value, MidpointRounding mode)
public static double Round(double value, MidpointRounding mode)
public static decimal Round(decimal value, int digits, MidpointRounding mode)
public static double Round(double value, int digits, MidpointRounding mode)
</code></pre>
<p><code>Math.Round</code> — это метод округления к ближайшему числу или к ближайшему числу с заданным количеством знаков после запятой. Работает с типами <code>decimal</code> и <code>double</code>, в параметрах можно встретить три вида параметров:</p>
<ul>
<li><code>value</code>: округляемое число</li>
<li><code>digits</code>: количество знаков в дробной части, которые нужно оставить</li>
<li><code>mode</code>: параметр, который определяет в какую сторону округлять число, которое находится ровно посередине между двумя вариантами</li>
</ul>
<p>Параметр <code>mode</code> используется, когда округляемое значение находится ровно посередине между двумя вариантами. Принимает значение из следующего перечисления:</p>
<pre><code class="language-cs">public enum MidpointRounding { AwayFromZero, ToEven}
</code></pre>
<ul>
<li><code>AwayFromZero</code>: округление происходит к тому числу, которое дальше от нуля.</li>
<li><code>ToEven</code>: округление происходит к чётному числу.</li>
</ul>
<p>Обратите внимание, что по умолчанию <code>mode == MidpointRounding.ToEven</code>, поэтому <code>Math.Round(1.5) == Math.Round(2.5) == 2</code>.</p>
<h3 id="math.floor-math.ceiling-math.truncate">Math.Floor, Math.Ceiling, Math.Truncate</h3>
<p>MSDN:
<a href="http://msdn.microsoft.com/en-us/library/system.math.floor.aspx">Floor</a>,
<a href="http://msdn.microsoft.com/en-us/library/system.math.ceiling.aspx">Ceiling</a>,
<a href="http://msdn.microsoft.com/en-us/library/system.math.truncate.aspx">Truncate</a></p>
<pre><code class="language-cs">public static decimal Floor(decimal value)
public static double Floor(double value)
public static decimal Ceiling(decimal value)
public static double Ceiling(double value)
public static decimal Truncate(decimal value)
public static double Truncate(double value)
</code></pre>
<ul>
<li><code>Math.Floor</code> округляет вниз по направлению к отрицательной бесконечности.</li>
<li><code>Math.Ceiling</code> округляет вверх по направлению к положительной бесконечности.</li>
<li><code>Math.Truncate</code> округляет вниз или вверх по направлению к нулю.</li>
</ul>
<h3 id="section">Сводная таблица</h3>
<p>Сориентироваться в методах округления может помочь следующая табличка:</p>
<pre><code>value               | -2.9 | -0.5 | 0.3 | 1.5 | 2.9 |
--------------------+------+------+-----+-----+-----+
Round(ToEven)       |   -3 |    0 |   0 |   2 |   3 |
Round(AwayFromZero) |   -3 |   -1 |   0 |   2 |   3 |
Floor               |   -3 |   -1 |   0 |   1 |   2 |
Ceiling             |   -2 |    0 |   1 |   2 |   3 |
Truncate            |   -2 |    0 |   0 |   1 |   2 |
</code></pre>
<p>Округление проводится в соответствии со стандартом <em>IEEE Standard 754, section 4</em>.</p>
<h3 id="section-1">Целочисленное деление и взятие по модулю</h3>
<p>В C# есть два замечательных оператора над целыми числами: <code>/</code> для целочисленного деления (<a href="http://msdn.microsoft.com/en-us/library/3b1ff23f.aspx">MSDN</a>) и <code>%</code>
для взятия остатка от деления (<a href="http://msdn.microsoft.com/en-us/library/0w4e0fzs.aspx">MSDN</a>). Деление производится по следующим правилам:</p>
<ul>
<li>При целочисленном делении результат всегда округляется по направлению к нулю.</li>
<li>При взятии остатка от деления должно выполняться следующее правило: <code>x % y = x – (x / y) * y</code></li>
</ul>
<p>Также можно пользоваться шпаргалкой:</p>
<pre><code> a |  b | a/b | a%b |
---+----+-----+-----+
 7 |  3 |  2  |  1  |
-7 |  3 | -2  | -1  |
 7 | -3 | -2  |  1  |
-7 | -3 |  2  | -1  |
</code></pre>
<h3 id="string.format">string.Format</h3>
<p>При форматировании чисел в виде строки можно пользоваться функцией <code>string.Format</code> (см. <a href="http://msdn.microsoft.com/en-us/library/dwhawy9k.aspx">Standard Numeric Format Strings</a>, <a href="http://msdn.microsoft.com/en-us/library/0c899ak8.aspx">Custom Numeric Format Strings</a>). Например, для вывода числа с двумя знаками после десятичной точки можно воспользоваться <code>string.Format(&quot;{0:0.00}&quot;, value)</code> или <code>string.Format(&quot;{0:N2}&quot;, value)</code>. Округление происходит по принципу <code>AwayFromZero</code>. Проиллюстрируем правила округления очередной табличкой:</p>
<pre><code>value  | string.Format(&quot;{0:N2}&quot;, value) |
-------+--------------------------------+
-2.006 | -2.01                          |
-2.005 | -2.01                          |
-2.004 | -2.00                          |
 2.004 |  2.00                          |
 2.005 |  2.01                          |
 2.006 |  2.01                          |
</code></pre>
<h3 id="section-2">Задачи</h3>
<p>На приведённую тему есть две задачки в <a href="http://problembook.net">ProblemBook.NET</a>: <a href="http://problembook.net/content/ru/Math/Rounding1-P.html">Rounding1</a>, <a href="http://problembook.net/content/ru/Math/Rounding2-P.html">Rounding2</a>.</p>

<!-- Share -->

Поделиться:
<a href="https://twitter.com/intent/tweet?text=Учимся округлять в C#&url=http://aakinshin.net/ru/posts/cheatsheet-rounding/&via=andrey_akinshin&related=andrey_akinshin" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fab fa-twitter fa-2x" title="Twitter"></i></a>
<a href="https://www.reddit.com/submit?url=http://aakinshin.net/ru/posts/cheatsheet-rounding/" target="_blank" title="Share on Reddit"><i class="fab fa-reddit fa-2x"></i></a>
<a href="https://news.ycombinator.com/submitlink?u=http://aakinshin.net/ru/posts/cheatsheet-rounding/" target="_blank" title="Share on HackerNews"><i class="fab fa-hacker-news fa-2x"></i></a>
<a href="https://facebook.com/sharer.php?u=http://aakinshin.net/ru/posts/cheatsheet-rounding/" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fab fa-facebook fa-2x"></i></a>
<a href="https://plus.google.com/share?url=http://aakinshin.net/ru/posts/cheatsheet-rounding/" rel="nofollow" target="_blank" title="Share on Google+"><i class="fab fab fa-google-plus-g fa-2x"></i></a>
<a href="http://vk.com/share.php?url=http://aakinshin.net/ru/posts/cheatsheet-rounding/" target="_blank" title="Share on VKontakte"><i class="fab fa-vk fa-2x"></i></a>
<a href="https://getpocket.com/save?url=http://aakinshin.net/ru/posts/cheatsheet-rounding/&title=Учимся округлять в C#" target="_blank" title="Add to Pocket"><i class="fab fa-get-pocket fa-2x"></i></a>
<hr />

<!-- GitHub -->
<div>
  Исходный код поста находится на GitHub:<br />
  <a href="https://github.com/AndreyAkinshin/aakinshin.net/blob/master/web/_posts/ru/2013/cheatsheet-rounding.md">https://github.com/AndreyAkinshin/aakinshin.net/blob/master/web/_posts/ru/2013/cheatsheet-rounding.md</a>
</div>

</div>
</div>
    </div>

    <footer class="blog-footer">
      <div class="container">
        <p>&copy; 2013–2020 Андрей Акиньшин | <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></p>
      </div>
    </footer>

    <script src="/js/theme-after.js"></script>
    <!-- jQuery first (header), then popper, then Bootstrap JS. -->
    <script src="/js/popper.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <!-- Other scripts -->
    <script src="/js/highlight.pack.js"></script>
    <script src="/js/anchor.min.js"></script>
    <script src="/js/custom.js"></script>
  </body>
</html>
