<!doctype html><html lang=ru><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.103.0-DEV"><meta name=author content="Андрей Акиньшин"><link href=/img/favicon.ico rel=icon type=image/x-icon><meta name=keywords content><title>Блог Андрея Акиньшина (Страница 2)</title><meta name=description content="Блог Андрея Акиньшина"><meta name=twitter:site content="@andrey_akinshin"><meta name=twitter:creator content="@andrey_akinshin"><script>localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><link href=https://aakinshin.net/css/main.min.f751294c5451e9789c779068f99c67f9f6a021b5ecfedbb6d3099758d7552784.css rel=stylesheet type=text/css media=all><link rel=alternate type=application/rss+xml href=https://aakinshin.net/ru/posts/index.xml title="RSS Feed"></head><body><nav><div class="container flex flex-wrap items-center justify-between mx-auto max-w-6xl h-12 px-6"><div class="flex items-center justify-start justify-self-start"><div class="flex nav-item h-12 w-12 items-center justify-center"><a class=text-white href=https://aakinshin.net/ru/about/><svg class="fai w-5 h-5 pr-0 mb-0.5"><use xlink:href="/img/fa/all.svg#house-chimney"/></svg></a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/ru/posts/>Посты</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/ru/about/>Об авторе</a></div><div class="flex nav-item h-12 items-center"><a class="px-3 text-white" href=https://aakinshin.net/>EN</a></div></div><button id=theme-toggle type=button class="nav-item p-3 content-center justify-self-end"><svg id="theme-toggle-dark-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001.0 1010.586 10.586z"/></svg><svg id="theme-toggle-light-icon" class="hidden w-6 h-6" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1A1 1 0 119 4V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707A1 1 0 1113.536 5.05l.707-.707a1 1 0 011.414.0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707A1 1 0 004.343 5.757l.707.707zm1.414 8.486-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"/></svg></button></div></nav><div class="main container mx-auto max-w-6xl px-6"><script>window.location.replace("/ru/about")</script><div class="my-5 px-5 py-2 rounded border border-alert-frame-l dark:border-alert-frame-d hover:bg-orange-200 dark:hover:bg-orange-900"><a style=font-size:150% class="text-alert-text-l dark:text-alert-text-d" href=https://aakinshin.net/>Последние посты доступны только в английской версии блога</a></div><div class=main-content><div><h2><a href=/ru/posts/static-field-in-generic-type/>Статические поля в generic-классах</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2015-01-21>21 января 2015</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/ru/tags/dotnet/>.NET</a>
<a class=label-link href=https://aakinshin.net/ru/tags/cs/>C#</a>
<a class=label-link href=https://aakinshin.net/ru/tags/generic/>Generic</a>
<a class=label-link href=https://aakinshin.net/ru/tags/static/>Static</a></div></div><br><p>Сегодня мы кратко поговорим о статических полях в generic-классах. Тема простая, но у некоторых разработчиков она вызывает трудности. Итак, задачка: что выведет следующий код?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=k>class</span> <span class=nc>Foo</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>public</span> <span class=k>static</span> <span class=kt>int</span> <span class=n>Bar</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>void</span> <span class=n>Main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Foo</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;.</span><span class=n>Bar</span><span class=p>++;</span>
</span></span><span class=line><span class=cl>  <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>Foo</span><span class=p>&lt;</span><span class=kt>double</span><span class=p>&gt;.</span><span class=n>Bar</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><br><a href=/ru/posts/static-field-in-generic-type/>Читать дальше</a><br><br><hr></div><div><h2><a href=/ru/posts/listforeach-net-45/>List.ForEach в .NET 4.5</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2014-11-24>24 ноября 2014</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/ru/tags/dotnet/>.NET</a>
<a class=label-link href=https://aakinshin.net/ru/tags/loops/>Loops</a>
<a class=label-link href=https://aakinshin.net/ru/tags/list/>List</a></div></div><br><p>Продолжим обсуждать <a href=http://aakinshin.blogspot.ru/2014/11/dotnet-list-version-side-effect.html>тему</a> изменения коллекции внутри цикла <code>foreach</code>. Следующий код</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=kt>var</span> <span class=n>list</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;</span> <span class=p>{</span> <span class=m>1</span><span class=p>,</span> <span class=m>2</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=kt>var</span> <span class=n>i</span> <span class=k>in</span> <span class=n>list</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=p>==</span> <span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>list</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=m>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>выбросит <code>InvalidOperationException</code>. А как думаете, что случится при выполнении цикла через <a href=http://msdn.microsoft.com/library/bwabdf9z.aspx>List&lt;T>.ForEach</a>?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=kt>var</span> <span class=n>list</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;</span> <span class=p>{</span> <span class=m>1</span><span class=p>,</span> <span class=m>2</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=n>list</span><span class=p>.</span><span class=n>ForEach</span><span class=p>(</span><span class=n>i</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=p>==</span> <span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>list</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=m>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>Правильный ответ: зависит.</p><br><a href=/ru/posts/listforeach-net-45/>Читать дальше</a><br><br><hr></div><div><h2><a href=/ru/posts/list-version-side-effect/>Сайд-эффект внутренней реализации List</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2014-11-19>19 ноября 2014</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/ru/tags/dotnet/>.NET</a>
<a class=label-link href=https://aakinshin.net/ru/tags/cs/>C#</a>
<a class=label-link href=https://aakinshin.net/ru/tags/list/>List</a>
<a class=label-link href=https://aakinshin.net/ru/tags/bugs/>Bugs</a></div></div><br><p>Если вы делаете <code>foreach</code> по некоторому <a href=http://msdn.microsoft.com/library/6sh2ey19.aspx>List</a>-у, то менять итерируемый лист внутри цикла крайне не рекомендуется, ведь это верный способ получить <a href=http://msdn.microsoft.com/library/system.invalidoperationexception.aspx>InvalidOperationException</a>. А теперь загадка: как думаете, что случится со следующим кодом:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=kt>var</span> <span class=n>list</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;</span> <span class=p>{</span> <span class=m>0</span><span class=p>,</span> <span class=m>1</span><span class=p>,</span> <span class=m>2</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span><span class=p>(</span><span class=kt>var</span> <span class=n>x</span> <span class=k>in</span> <span class=n>list</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>x</span> <span class=p>==</span> <span class=m>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=p>=</span> <span class=kt>int</span><span class=p>.</span><span class=n>MinValue</span><span class=p>;</span> <span class=n>i</span> <span class=p>&lt;</span> <span class=kt>int</span><span class=p>.</span><span class=n>MaxValue</span><span class=p>;</span> <span class=n>i</span><span class=p>++)</span>
</span></span><span class=line><span class=cl>      <span class=n>list</span><span class=p>[</span><span class=m>0</span><span class=p>]</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>list</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=m>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><br><a href=/ru/posts/list-version-side-effect/>Читать дальше</a><br><br><hr></div><div><h2><a href=/ru/posts/uri-escaping/>Об экранировании URI в .NET</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2014-11-13>13 ноября 2014</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/ru/tags/dotnet/>.NET</a>
<a class=label-link href=https://aakinshin.net/ru/tags/cs/>C#</a>
<a class=label-link href=https://aakinshin.net/ru/tags/mono/>Mono</a>
<a class=label-link href=https://aakinshin.net/ru/tags/uri/>URI</a>
<a class=label-link href=https://aakinshin.net/ru/tags/escaping/>Escaping</a></div></div><br><h2 id=часть-1>Часть 1</h2><p>Загадка на сегодня: что выведет код?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=kt>var</span> <span class=n>uri</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Uri</span><span class=p>(</span><span class=s>&#34;http://localhost/%2F1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>uri</span><span class=p>.</span><span class=n>OriginalString</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>uri</span><span class=p>.</span><span class=n>AbsoluteUri</span><span class=p>);</span>
</span></span></code></pre></div><p>Правильный ответ: зависит. Давайте немножко поразбираемся.</p><br><a href=/ru/posts/uri-escaping/>Читать дальше</a><br><br><hr></div><div><h2><a href=/ru/posts/cheatsheet-nullable/>Nullable-арифметика</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2014-11-11>11 ноября 2014</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/ru/tags/dotnet/>.NET</a>
<a class=label-link href=https://aakinshin.net/ru/tags/nullable/>Nullable</a>
<a class=label-link href=https://aakinshin.net/ru/tags/cs/>C#</a>
<a class=label-link href=https://aakinshin.net/ru/tags/cheatsheet/>CheatSheet</a></div></div><br><p>Что будет, если <code>null</code> поделить на ноль? А сколько будет <code>null | true</code>? А <code>null & true</code>? А <code>((string)null + null)</code>?</p><p>Практика подсказывает, что C#-разработчики зачастую не особо задумываются о том, как будут оцениваться выражения, если один из операндов равен <code>null</code>. Поэтому я решил составить небольшую шпаргалку на эту тему.</p><br><a href=/ru/posts/cheatsheet-nullable/>Читать дальше</a><br><br><hr></div><div><h2><a href=/ru/posts/mono-utf8-conversions/>Об UTF-8-преобразованиях в Mono</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2014-11-10>10 ноября 2014</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/ru/tags/encodings/>Encodings</a>
<a class=label-link href=https://aakinshin.net/ru/tags/dotnet/>.NET</a>
<a class=label-link href=https://aakinshin.net/ru/tags/mono/>Mono</a></div></div><br><p>Данный пост является логическим продолжением поста Джона Скита <a href=http://codeblog.jonskeet.uk/2014/11/07/when-is-a-string-not-a-string>“When is a string not a string?”</a>. Jon showed very interesting things about behavior of ill-formed Unicode strings in .NET. I wondered about how similar examples will work on Mono. And I have got very interesting results.</p><h3 id=experiment-1-compilation>Experiment 1: Compilation</h3><p>Let&rsquo;s take the Jon&rsquo;s code with a small modification. We will just add <code>text</code> null check in <code>DumpString</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=k>using</span> <span class=nn>System</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.ComponentModel</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Text</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Linq</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=na>[Description(Value)]</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Test</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=kt>string</span> <span class=n>Value</span> <span class=p>=</span> <span class=s>&#34;X\ud800Y&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=k>void</span> <span class=n>Main</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>description</span> <span class=p>=</span> <span class=p>(</span><span class=n>DescriptionAttribute</span><span class=p>)</span><span class=k>typeof</span><span class=p>(</span><span class=n>Test</span><span class=p>).</span>
</span></span><span class=line><span class=cl>            <span class=n>GetCustomAttributes</span><span class=p>(</span><span class=k>typeof</span><span class=p>(</span><span class=n>DescriptionAttribute</span><span class=p>),</span> <span class=k>true</span><span class=p>)[</span><span class=m>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>DumpString</span><span class=p>(</span><span class=s>&#34;Attribute&#34;</span><span class=p>,</span> <span class=n>description</span><span class=p>.</span><span class=n>Description</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>DumpString</span><span class=p>(</span><span class=s>&#34;Constant&#34;</span><span class=p>,</span> <span class=n>Value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=k>void</span> <span class=n>DumpString</span><span class=p>(</span><span class=kt>string</span> <span class=n>name</span><span class=p>,</span> <span class=kt>string</span> <span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=n>Write</span><span class=p>(</span><span class=s>&#34;{0}: &#34;</span><span class=p>,</span> <span class=n>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>text</span> <span class=p>!=</span> <span class=k>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>utf16</span> <span class=p>=</span> <span class=n>text</span><span class=p>.</span><span class=n>Select</span><span class=p>(</span><span class=n>c</span> <span class=p>=&gt;</span> <span class=p>((</span><span class=kt>uint</span><span class=p>)</span> <span class=n>c</span><span class=p>).</span><span class=n>ToString</span><span class=p>(</span><span class=s>&#34;x4&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=kt>string</span><span class=p>.</span><span class=n>Join</span><span class=p>(</span><span class=s>&#34; &#34;</span><span class=p>,</span> <span class=n>utf16</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;null&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><br><a href=/ru/posts/mono-utf8-conversions/>Читать дальше</a><br><br><hr></div><div><h2><a href=/ru/posts/endianness/>Endianness в .NET</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2014-10-29>29 октября 2014</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/ru/tags/dotnet/>.NET</a>
<a class=label-link href=https://aakinshin.net/ru/tags/endianness/>Endianness</a>
<a class=label-link href=https://aakinshin.net/ru/tags/asm/>ASM</a>
<a class=label-link href=https://aakinshin.net/ru/tags/mono/>Mono</a>
<a class=label-link href=https://aakinshin.net/ru/tags/cs/>C#</a></div></div><br><table class=table-ok><tr><td valign=top><div class=separator style=clear:both;text-align:center><img src=/img/posts/dotnet/endianness/front.png alt="Endian funny image" style="margin:0 2em 1em 0"></div></td><td valign=top><p>Рассмотрим простую задачку: что выведет следующий код?</p><pre class="prettyprint lang-cs">
[StructLayout(LayoutKind.Explicit)]
struct UInt16Wrapper
{
  [FieldOffset(0)]
  public UInt16 Value;
  [FieldOffset(0)]
  public Byte Byte1;
  [FieldOffset(1)]
  public Byte Byte2;
}
void Main()
{
  var uint16 = new UInt16Wrapper();
  uint16.Value = 1 + 2 * 256;
  Console.WriteLine(uint16.Byte1);
  Console.WriteLine(uint16.Byte2);
}
</pre></td></tr></table><p>Полагаю, что внимательный читатель должен обратить внимание на название поста и дать правильный ответ: «зависит». Сегодня мы немного поговорим о том, как в .NET обстоят дела с порядком байтов.</p><br><a href=/ru/posts/endianness/>Читать дальше</a><br><br><hr></div><div><h2><a href=/ru/posts/cultureinfo/>Эти занимательные региональные настройки</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2014-09-21>21 сентября 2014</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/ru/tags/dotnet/>.NET</a>
<a class=label-link href=https://aakinshin.net/ru/tags/cultureinfo/>CultureInfo</a>
<a class=label-link href=https://aakinshin.net/ru/tags/localization/>Localization</a>
<a class=label-link href=https://aakinshin.net/ru/tags/globalization/>Globalization</a></div></div><br><p>Сегодня мы поговорим о региональных настройках. Но сперва — небольшая задачка: что выведет нижеприведённый код? (Код приведён на языке C#, но рассматривается достаточно общая проблематика, так что вы можете представить на его месте какой-нибудь другой язык.)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>((-</span><span class=m>42</span><span class=p>).</span><span class=n>ToString</span><span class=p>()</span> <span class=p>==</span> <span class=s>&#34;-42&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=kt>double</span><span class=p>.</span><span class=n>NaN</span><span class=p>.</span><span class=n>ToString</span><span class=p>()</span> <span class=p>==</span> <span class=s>&#34;NaN&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=kt>int</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=s>&#34;-42&#34;</span><span class=p>)</span> <span class=p>==</span> <span class=p>-</span><span class=m>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=m>1.1</span><span class=p>.</span><span class=n>ToString</span><span class=p>().</span><span class=n>Contains</span><span class=p>(</span><span class=s>&#34;?&#34;</span><span class=p>)</span> <span class=p>==</span> <span class=k>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=k>new</span> <span class=n>DateTime</span><span class=p>(</span><span class=m>2014</span><span class=p>,</span> <span class=m>1</span><span class=p>,</span> <span class=m>1</span><span class=p>).</span><span class=n>ToString</span><span class=p>().</span><span class=n>Contains</span><span class=p>(</span><span class=s>&#34;2014&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;i&#34;</span><span class=p>.</span><span class=n>ToUpper</span><span class=p>()</span> <span class=p>==</span> <span class=s>&#34;I&#34;</span> <span class=p>||</span> <span class=s>&#34;I&#34;</span><span class=p>.</span><span class=n>ToLower</span><span class=p>()</span> <span class=p>==</span> <span class=s>&#34;i&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p>Сколько значений <code>true</code> у вас получилось? Если больше <code>0</code>, то вам не мешает узнать больше про региональные настройки, т. к. правильный ответ: «зависит». К сожалению, многие программисты вообще не задумываются о том, что настройки эти в различных окружениях могут отличаться. А выставлять для всего кода InvariantCulture этим программистом лениво, в результате чего их прекрасные приложения ведут себя очень странно, попадая к пользователям из других стран.</p><p>Ошибки бывают самые разные, но чаще всего связаны они с форматированием и парсингом строк — достаточно частыми задачами для многих программистов. В статье приведена краткая подборка некоторых важных моментов, на которые влияют региональные настройки.</p><p class=center><img src=/img/posts/dotnet/cultureinfo/dotnet-cultureinfoexplorer.png></p><br><a href=/ru/posts/cultureinfo/>Читать дальше</a><br><br><hr></div><div><h2><a href=/ru/posts/happy-monday/>Happy Monday!</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2014-08-11>11 августа 2014</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/ru/tags/bugs/>Bugs</a>
<a class=label-link href=https://aakinshin.net/ru/tags/dotnet/>.NET</a>
<a class=label-link href=https://aakinshin.net/ru/tags/hate/>Hate</a>
<a class=label-link href=https://aakinshin.net/ru/tags/postsharp/>PostSharp</a></div></div><br><p>Хотелось бы рассказать историю одного волшебного бага. Волшебство его заключалось в том, что он не давал нам отлаживать по понедельникам. Я сейчас совершенно серьёзно: каждый понедельник у нас отваливался Debug mode. Мало того, этот баг с циничным видом желал нам счастливого понедельничка. Для меня это был очень ценный урок в плане того, какие же всё-таки разнообразные бывают проблемы. Возможно, кому-то ещё эта история покажется любопытной.</p><p>Итак, как же я впервые встретился с этой багой. Был замечательный вечер воскресенья, ничего не предвещало беды. В понедельник планировался очередной релиз нашей программки (ничего мажорного, но клиенты ждали обещанных мелких фич). На часах отображалось 00:00, и тут мне пришла в голову мысль, что один из пользовательских сценариев для новой фичи мы не проработали. Нужно было дописать всего несколько дополнительных строк, делов минут на 10. Я решил, что сейчас быстренько допишу нужную логику и с чистой совестью лягу спать. Запускаю студию, запускаю билд проекта, жду. И тут моё лицо становится озадаченным, т.к. я вижу ошибку:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>Error connecting to the pipe server.
</span></span></code></pre></div><p>Хм&mldr; Странная ошибка-то какая-то.</p><br><a href=/ru/posts/happy-monday/>Читать дальше</a><br><br><hr></div><div><h2><a href=/ru/posts/ms-mcp/>Получение MCP: личный опыт</a></h2><div class="flex flex-wrap justify-start items-center"><svg class="fai text-accent-l dark:text-front-d"><title>Date</title><use xlink:href="/img/fa/all.svg#calendar-days"/></svg><time datetime=2014-07-24>24 июля 2014</time><svg class="fai ml-3 text-accent-l dark:text-front-d"><title>Tags</title><use xlink:href="/img/fa/all.svg#tag"/></svg><div class="flex flex-wrap gap-y-1"><a class=label-link href=https://aakinshin.net/ru/tags/exams/>Exams</a>
<a class=label-link href=https://aakinshin.net/ru/tags/dotnet/>.NET</a>
<a class=label-link href=https://aakinshin.net/ru/tags/cs/>C#</a>
<a class=label-link href=https://aakinshin.net/ru/tags/microsoft/>Microsoft</a>
<a class=label-link href=https://aakinshin.net/ru/tags/mcp/>MCP</a></div></div><br><p>Не так давно мне на работе перепал ваучер на бесплатную сдачу экзамена от Microsoft. «А почему бы и нет?» — подумал я. План был выполнен успешно, в связи с чем мне хотелось бы поделиться личным опытом. Возможно, эта история пригодится тем, кто только собирается начать получать сертификации от Microsoft.</p><p class=center><img src=/img/posts/dotnet/ms-mcp/mvp-roadmap.png></p><br><a href=/ru/posts/ms-mcp/>Читать дальше</a><br><br><hr></div></div><div class=paginator><ul class="pagination pagination-default"><li class=page-item><a href=/ru/ aria-label=First class=page-link role=button><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/ru/ aria-label=Previous class=page-link role=button><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a href=/ru/ aria-label="Page 1" class=page-link role=button>1</a></li><li class="page-item active"><a aria-current=page aria-label="Page 2" class=page-link role=button>2</a></li><li class=page-item><a href=/ru/page/3/ aria-label="Page 3" class=page-link role=button>3</a></li><li class=page-item><a href=/ru/page/4/ aria-label="Page 4" class=page-link role=button>4</a></li><li class=page-item><a href=/ru/page/5/ aria-label="Page 5" class=page-link role=button>5</a></li><li class=page-item><a href=/ru/page/3/ aria-label=Next class=page-link role=button><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/ru/page/6/ aria-label=Last class=page-link role=button><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div><script>var themeToggleDarkIcon=document.getElementById("theme-toggle-dark-icon"),themeToggleBtn,themeToggleLightIcon=document.getElementById("theme-toggle-light-icon");const imagesDark=document.querySelectorAll(".img-dark"),imagesLight=document.querySelectorAll(".img-light");localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(themeToggleLightIcon.classList.remove("hidden"),imagesDark.forEach(e=>{e.classList.remove("hidden")})):(themeToggleDarkIcon.classList.remove("hidden"),imagesLight.forEach(e=>{e.classList.remove("hidden")})),themeToggleBtn=document.getElementById("theme-toggle"),themeToggleBtn.addEventListener("click",function(){themeToggleDarkIcon.classList.toggle("hidden"),themeToggleLightIcon.classList.toggle("hidden"),imagesLight.forEach(e=>{e.classList.toggle("hidden")}),imagesDark.forEach(e=>{e.classList.toggle("hidden")}),localStorage.getItem("color-theme")?localStorage.getItem("color-theme")==="light"?(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"))})</script><footer class="z-20 p-4 md:p-6 mt-3 w-full border-t border-gray-200 shadow flex items-center justify-center dark:border-gray-600 bg-white dark:bg-zinc-800"><span class="dark:text-gray-400 text-center">© 2013—2023 <span class=whitespace-nowrap>Андрей Акиньшин</span></span><ul class="flex flex-wrap items-center px-4 mb-1"><li><a href=https://github.com/AndreyAkinshin><svg class="fai fai-link w-5 h-5"><title>GitHub</title><use xlink:href="/img/fa/all.svg#github"/></svg></a></li><li><a href=https://twitter.com/andrey_akinshin><svg class="fai fai-link w-5 h-5"><title>Twitter</title><use xlink:href="/img/fa/all.svg#twitter"/></svg></a></li><li><a href=https://aakinshin.net/ru/posts/index.xml><svg class="fai fai-link w-5 h-5"><title>RSS</title><use xlink:href="/img/fa/all.svg#rss"/></svg></a></li></ul><div class=main-content><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></div></footer><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script></body></html>